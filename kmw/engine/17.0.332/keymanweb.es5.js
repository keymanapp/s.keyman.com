(function(){var tl=Object.create;var an=Object.defineProperty;var nl=Object.getOwnPropertyDescriptor;var cl=Object.getOwnPropertyNames;var il=Object.getPrototypeOf,rl=Object.prototype.hasOwnProperty;var pc=function(i,t){return function(){return t||i((t={exports:{}}).exports,t),t.exports}},Gc=function(i,t){for(var e in t)an(i,e,{get:t[e],enumerable:!0})},on=function(i,t,e,n){if(t&&typeof t=="object"||typeof t=="function")for(var c=cl(t),r=0,l=c.length,s;r<l;r++)s=c[r],!rl.call(i,s)&&s!==e&&an(i,s,{get:function(o){return t[o]}.bind(null,s),enumerable:!(n=nl(t,s))||n.enumerable});return i},Bn=function(i,t,e){return on(i,t,"default"),e&&on(e,t,"default")},N=function(i,t,e){return e=i!=null?tl(il(i)):{},on(t||!i||!i.__esModule?an(e,"default",{value:i,enumerable:!0}):e,i)};var dn=pc(function(No,vt){var mc,Xc,Vc,Zc,fc,vc,Lc,ft;(function(i){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(n){i(e(t,e(n)))}):typeof vt=="object"&&typeof vt.exports=="object"?i(e(t,e(vt.exports))):i(e(t));function e(n,c){return n!==t&&(typeof Object.create=="function"?Object.defineProperty(n,"__esModule",{value:!0}):n.__esModule=!0),function(r,l){return n[r]=c?c(r,l):l}}})(function(i){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var c in n)Object.prototype.hasOwnProperty.call(n,c)&&(e[c]=n[c])};mc=function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function c(){this.constructor=e}e.prototype=n===null?Object.create(n):(c.prototype=n.prototype,new c)},Xc=Object.assign||function(e){for(var n,c=1,r=arguments.length;c<r;c++){n=arguments[c];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(e[l]=n[l])}return e},Vc=function(e,n,c,r){var l=arguments.length,s=l<3?n:r===null?r=Object.getOwnPropertyDescriptor(n,c):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,n,c,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(l<3?o(s):l>3?o(n,c,s):o(n,c))||s);return l>3&&s&&Object.defineProperty(n,c,s),s},Zc=function(e,n,c,r){function l(s){return s instanceof c?s:new c(function(o){o(s)})}return new(c||(c=Promise))(function(s,o){function a(u){try{g(r.next(u))}catch(F){o(F)}}function B(u){try{g(r.throw(u))}catch(F){o(F)}}function g(u){u.done?s(u.value):l(u.value).then(a,B)}g((r=r.apply(e,n||[])).next())})},fc=function(e,n){var c={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,l,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(g){return function(u){return B([g,u])}}function B(g){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,g[0]&&(c=0)),c;)try{if(r=1,l&&(s=g[0]&2?l.return:g[0]?l.throw||((s=l.return)&&s.call(l),0):l.next)&&!(s=s.call(l,g[1])).done)return s;switch(l=0,s&&(g=[g[0]&2,s.value]),g[0]){case 0:case 1:s=g;break;case 4:return c.label++,{value:g[1],done:!1};case 5:c.label++,l=g[1],g=[0];continue;case 7:g=c.ops.pop(),c.trys.pop();continue;default:if(s=c.trys,!(s=s.length>0&&s[s.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!s||g[1]>s[0]&&g[1]<s[3])){c.label=g[1];break}if(g[0]===6&&c.label<s[1]){c.label=s[1],s=g;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(g);break}s[2]&&c.ops.pop(),c.trys.pop();continue}g=n.call(e,c)}catch(u){g=[6,u],l=0}finally{r=s=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},vc=function(e){var n=typeof Symbol=="function"&&Symbol.iterator,c=n&&e[n],r=0;if(c)return c.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},Lc=function(e,n){var c=typeof Symbol=="function"&&e[Symbol.iterator];if(!c)return e;var r=c.call(e),l,s=[],o;try{for(;(n===void 0||n-- >0)&&!(l=r.next()).done;)s.push(l.value)}catch(a){o={error:a}}finally{try{l&&!l.done&&(c=r.return)&&c.call(r)}finally{if(o)throw o.error}}return s},ft=function(e){return this instanceof ft?(this.v=e,this):new ft(e)},i("__extends",mc),i("__assign",Xc),i("__decorate",Vc),i("__awaiter",Zc),i("__generator",fc),i("__values",vc),i("__read",Lc),i("__await",ft)})});var T=pc(function(Eo,gn){"use strict";var sl=Object.prototype.hasOwnProperty,q="~";function st(){}Object.create&&(st.prototype=Object.create(null),new st().__proto__||(q=!1));function ol(i,t,e){this.fn=i,this.context=t,this.once=e||!1}function Sc(i,t,e,n,c){if(typeof e!="function")throw new TypeError("The listener must be a function");var r=new ol(e,n||i,c),l=q?q+t:t;return i._events[l]?i._events[l].fn?i._events[l]=[i._events[l],r]:i._events[l].push(r):(i._events[l]=r,i._eventsCount++),i}function Lt(i,t){--i._eventsCount===0?i._events=new st:delete i._events[t]}function K(){this._events=new st,this._eventsCount=0}K.prototype.eventNames=function(){var t=[],e,n;if(this._eventsCount===0)return t;for(n in e=this._events)sl.call(e,n)&&t.push(q?n.slice(1):n);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(e)):t};K.prototype.listeners=function(t){var e=q?q+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var c=0,r=n.length,l=new Array(r);c<r;c++)l[c]=n[c].fn;return l};K.prototype.listenerCount=function(t){var e=q?q+t:t,n=this._events[e];return n?n.fn?1:n.length:0};K.prototype.emit=function(t,e,n,c,r,l){var s=q?q+t:t;if(!this._events[s])return!1;var o=this._events[s],a=arguments.length,B,g;if(o.fn){switch(o.once&&this.removeListener(t,o.fn,void 0,!0),a){case 1:return o.fn.call(o.context),!0;case 2:return o.fn.call(o.context,e),!0;case 3:return o.fn.call(o.context,e,n),!0;case 4:return o.fn.call(o.context,e,n,c),!0;case 5:return o.fn.call(o.context,e,n,c,r),!0;case 6:return o.fn.call(o.context,e,n,c,r,l),!0}for(g=1,B=new Array(a-1);g<a;g++)B[g-1]=arguments[g];o.fn.apply(o.context,B)}else{var u=o.length,F;for(g=0;g<u;g++)switch(o[g].once&&this.removeListener(t,o[g].fn,void 0,!0),a){case 1:o[g].fn.call(o[g].context);break;case 2:o[g].fn.call(o[g].context,e);break;case 3:o[g].fn.call(o[g].context,e,n);break;case 4:o[g].fn.call(o[g].context,e,n,c);break;default:if(!B)for(F=1,B=new Array(a-1);F<a;F++)B[F-1]=arguments[F];o[g].fn.apply(o[g].context,B)}}return!0};K.prototype.on=function(t,e,n){return Sc(this,t,e,n,!1)};K.prototype.once=function(t,e,n){return Sc(this,t,e,n,!0)};K.prototype.removeListener=function(t,e,n,c){var r=q?q+t:t;if(!this._events[r])return this;if(!e)return Lt(this,r),this;var l=this._events[r];if(l.fn)l.fn===e&&(!c||l.once)&&(!n||l.context===n)&&Lt(this,r);else{for(var s=0,o=[],a=l.length;s<a;s++)(l[s].fn!==e||c&&!l[s].once||n&&l[s].context!==n)&&o.push(l[s]);o.length?this._events[r]=o.length===1?o[0]:o:Lt(this,r)}return this};K.prototype.removeAllListeners=function(t){var e;return t?(e=q?q+t:t,this._events[e]&&Lt(this,e)):(this._events=new st,this._eventsCount=0),this};K.prototype.off=K.prototype.removeListener;K.prototype.addListener=K.prototype.on;K.prefixed=q;K.EventEmitter=K;typeof gn!="undefined"&&(gn.exports=K)});var d={};Gc(d,{tslib:function(){return ll}});Bn(d,N(dn(),1));var ll=N(dn(),1);var zc=N(T(),1);var re={modifierCodes:{LCTRL:1,RCTRL:2,LALT:4,RALT:8,SHIFT:16,CTRL:32,ALT:64,META:128,CAPS:256,NO_CAPS:512,NUM_LOCK:1024,NO_NUM_LOCK:2048,SCROLL_LOCK:4096,NO_SCROLL_LOCK:8192,VIRTUAL_KEY:16384,VIRTUAL_CHAR_KEY:32768},modifierBitmasks:{ALL:127,ALT_GR_SIM:5,CHIRAL:31,IS_CHIRAL:15,NON_CHIRAL:112,NON_LEGACY:111},stateBitmasks:{ALL:16128,CAPS:768,NUM_LOCK:3072,SCROLL_LOCK:12288},keyCodes:{K_BKSP:8,K_TAB:9,K_ENTER:13,K_SHIFT:16,K_CONTROL:17,K_ALT:18,K_PAUSE:19,K_CAPS:20,K_ESC:27,K_SPACE:32,K_PGUP:33,K_PGDN:34,K_END:35,K_HOME:36,K_LEFT:37,K_UP:38,K_RIGHT:39,K_DOWN:40,K_SEL:41,K_PRINT:42,K_EXEC:43,K_INS:45,K_DEL:46,K_HELP:47,K_0:48,K_1:49,K_2:50,K_3:51,K_4:52,K_5:53,K_6:54,K_7:55,K_8:56,K_9:57,K_A:65,K_B:66,K_C:67,K_D:68,K_E:69,K_F:70,K_G:71,K_H:72,K_I:73,K_J:74,K_K:75,K_L:76,K_M:77,K_N:78,K_O:79,K_P:80,K_Q:81,K_R:82,K_S:83,K_T:84,K_U:85,K_V:86,K_W:87,K_X:88,K_Y:89,K_Z:90,K_NP0:96,K_NP1:97,K_NP2:98,K_NP3:99,K_NP4:100,K_NP5:101,K_NP6:102,K_NP7:103,K_NP8:104,K_NP9:105,K_NPSTAR:106,K_NPPLUS:107,K_SEPARATOR:108,K_NPMINUS:109,K_NPDOT:110,K_NPSLASH:111,K_F1:112,K_F2:113,K_F3:114,K_F4:115,K_F5:116,K_F6:117,K_F7:118,K_F8:119,K_F9:120,K_F10:121,K_F11:122,K_F12:123,K_NUMLOCK:144,K_SCROLL:145,K_LSHIFT:160,K_RSHIFT:161,K_LCONTROL:162,K_RCONTROL:163,K_LALT:164,K_RALT:165,K_COLON:186,K_EQUAL:187,K_COMMA:188,K_HYPHEN:189,K_PERIOD:190,K_SLASH:191,K_BKQUOTE:192,K_LBRKT:219,K_BKSLASH:220,K_RBRKT:221,K_QUOTE:222,K_oE2:226,K_OE2:226,K_LOPT:50001,K_ROPT:50002,K_NUMERALS:50003,K_SYMBOLS:50004,K_CURRENCIES:50005,K_UPPER:50006,K_LOWER:50007,K_ALPHA:50008,K_SHIFTED:50009,K_ALTGR:50010,K_TABBACK:50011,K_TABFWD:50012},codesUS:[["0123456789",";=,-./`","[\\]'"],[")!@#$%^&*(",":+<_>?~",'{|}"']],isKnownOSKModifierKey:function(i){switch(i){case"K_SHIFT":case"K_LOPT":case"K_ROPT":case"K_NUMLOCK":case"K_CAPS":return!0;default:if(re.keyCodes[i]>=5e4)return!0;var t=re[i];if(t>5e4&&t<50011)return!0}return!1},getModifierState:function(i){var t=0;i.indexOf("shift")>=0&&(t|=re.modifierCodes.SHIFT);var e=!1;i.indexOf("leftctrl")>=0&&(t|=re.modifierCodes.LCTRL,e=!0),i.indexOf("rightctrl")>=0&&(t|=re.modifierCodes.RCTRL,e=!0),i.indexOf("ctrl")>=0&&!e&&(t|=re.modifierCodes.CTRL);var n=!1;return i.indexOf("leftalt")>=0&&(t|=re.modifierCodes.LALT,n=!0),i.indexOf("rightalt")>=0&&(t|=re.modifierCodes.RALT,n=!0),i.indexOf("alt")>=0&&!n&&(t|=re.modifierCodes.ALT),t},getStateFromLayer:function(i){var t=0;return i.indexOf("caps")>=0?t|=re.modifierCodes.CAPS:t|=re.modifierCodes.NO_CAPS,t}},b=re;var Je;(function(i){i.Enter="\n",i.Backspace="\b"})(Je||(Je={}));var al=function(){function i(){}return i.prototype.codeForEvent=function(t){return b.keyCodes[t.kName]||t.Lcode},i.prototype.forAny=function(t,e,n){var c="";if((c=this.forSpecialEmulation(t))!=null)return c;if(!e&&(c=this.forNumpadKeys(t))!=null)return c;if((c=this.forUnicodeKeynames(t,n))!=null)return c;if((c=this.forBaseKeys(t,n))!=null)return c;var r=this.codeForEvent(t);switch(r){default:return null}},i.prototype.isCommand=function(t){var e=this.codeForEvent(t);switch(e){default:return!1}},i.prototype.applyCommand=function(t,e){},i.prototype.forSpecialEmulation=function(t){var e=this.codeForEvent(t);switch(e){case b.keyCodes.K_BKSP:return Je.Backspace;case b.keyCodes.K_ENTER:return Je.Enter;default:return null}},i.prototype.forNumpadKeys=function(t){if(t.Lcode>=b.keyCodes.K_NP0&&t.Lcode<=b.keyCodes.K_NPSLASH){if(t.Lcode<106)var e=t.Lcode-48;else e=t.Lcode-64;var n=String._kmwFromCharCode(e);return n}else return null},i.prototype.forUnicodeKeynames=function(t,e){var n=t.kName;if(!n||n.substr(0,2)!="U_")return null;for(var c="",r=n.substr(2).split("_"),l=0,s=r;l<s.length;l++){var o=s[l],a=parseInt(o,16);if(0<=a&&a<=31||128<=a&&a<=159||isNaN(a)){e&&(e.errorLog="Suppressing Unicode control code in "+n);continue}else c+=String.kmwFromCharCode(a)}return c||null},i.prototype.forBaseKeys=function(t,e){var n=t.Lcode,c=t.Lmodifiers;if(c==b.modifierCodes.SHIFT)c=1;else if(c!=0)return e&&(e.warningLog="KMW only defines default key output for the 'default' and 'shift' layers!"),null;try{if(n==b.keyCodes.K_SPACE)return" ";if(n>=b.keyCodes.K_0&&n<=b.keyCodes.K_9)return b.codesUS[c][0][n-b.keyCodes.K_0];if(n>=b.keyCodes.K_A&&n<=b.keyCodes.K_Z)return String.fromCharCode(n+(c?0:32));if(n>=b.keyCodes.K_COLON&&n<=b.keyCodes.K_BKQUOTE)return b.codesUS[c][1][n-b.keyCodes.K_COLON];if(n>=b.keyCodes.K_LBRKT&&n<=b.keyCodes.K_QUOTE)return b.codesUS[c][2][n-b.keyCodes.K_LBRKT];if(n==b.keyCodes.K_oE2)return c?"|":"\\"}catch(r){e&&(e.errorLog="Error detected with default mapping for key:  code = "+n+", shift state = "+(c==1?"shift":"default"))}return null},i}(),ke=al;var Bl=new ke,dl=function(){function i(t){this.isSynthetic=!0;for(var e in t)t[e]!==void 0&&(this[e]=t[e])}return i.constructNullKeyEvent=function(t){var e=new i({Lcode:0,kName:"",device:t,Lstates:void 0,Lmodifiers:void 0,vkCode:void 0,LisVirtualKey:void 0});return e},Object.defineProperty(i.prototype,"isModifier",{get:function(){switch(this.Lcode){case 16:case 17:case 18:case 20:case 144:case 145:return!0;default:return!1}},enumerable:!1,configurable:!0}),i.prototype.setMnemonicCode=function(t,e){if(this.Lcode!=b.keyCodes.K_SPACE){var n=new i(this);for(var c in this)n[c]=this[c];n.kName="K_xxxx",n.Lmodifiers=t?16:0;var r=Bl.forAny(n,!0);this.vkCode=this.Lcode,r?this.Lcode=r.charCodeAt(0):this.isModifier||delete this.Lcode}e&&(this.Lcode>=65&&this.Lcode<=90||this.Lcode>=97&&this.Lcode<=122)&&(this.Lmodifiers^=16,this.Lcode^=32)},i}(),ae=dl;var Ye=function(){function i(){}return i}(),gl=function(){function i(){this.FF=new Ye,this.Safari=new Ye,this.Opera=new Ye,this.FF.k61=187,this.FF.k59=186,this.FF.k173=189}return i}(),ul=function(){function i(){this.se=new Ye,this.se.k220=192,this.se.k187=189,this.se.k219=187,this.se.k221=219,this.se.k186=221,this.se.k191=220,this.se.k192=186,this.se.k189=191,this.uk=new Ye,this.uk.k223=192,this.uk.k192=222,this.uk.k222=226,this.uk.k220=220}return i}(),Fl=function(){function i(){}return i._usCodeInit=function(){var t=new Ye,e=new Ye;t.k192=96,t.k49=49,t.k50=50,t.k51=51,t.k52=52,t.k53=53,t.k54=54,t.k55=55,t.k56=56,t.k57=57,t.k48=48,t.k189=45,t.k187=61,t.k81=113,t.k87=119,t.k69=101,t.k82=114,t.k84=116,t.k89=121,t.k85=117,t.k73=105,t.k79=111,t.k80=112,t.k219=91,t.k221=93,t.k220=92,t.k65=97,t.k83=115,t.k68=100,t.k70=102,t.k71=103,t.k72=104,t.k74=106,t.k75=107,t.k76=108,t.k186=59,t.k222=39,t.k90=122,t.k88=120,t.k67=99,t.k86=118,t.k66=98,t.k78=110,t.k77=109,t.k188=44,t.k190=46,t.k191=47,e.k192=126,e.k49=33,e.k50=64,e.k51=35,e.k52=36,e.k53=37,e.k54=94,e.k55=38,e.k56=42,e.k57=40,e.k48=41,e.k189=95,e.k187=43,e.k81=81,e.k87=87,e.k69=69,e.k82=82,e.k84=84,e.k89=89,e.k85=85,e.k73=73,e.k79=79,e.k80=80,e.k219=123,e.k221=125,e.k220=124,e.k65=65,e.k83=83,e.k68=68,e.k70=70,e.k71=71,e.k72=72,e.k74=74,e.k75=75,e.k76=76,e.k186=58,e.k222=34,e.k90=90,e.k88=88,e.k67=67,e.k86=86,e.k66=66,e.k78=78,e.k77=77,e.k188=60,e.k190=62,e.k191=63,i._usCharCodes=[t,e]},i._USKeyCodeToCharCode=function(t){return i.usCharCodes[t.Lmodifiers&16?1:0]["k"+t.Lcode]},Object.defineProperty(i,"usCharCodes",{get:function(){return i._usCharCodes||i._usCodeInit(),i._usCharCodes},enumerable:!1,configurable:!0}),i.browserMap=new gl,i.languageMap=new ul,i}(),Be=Fl;function te(i,t){var e=t||{};for(var n in i)typeof i[n]=="object"&&i[n]!=null?(e[n]=i[n].constructor===Array?[]:{},te(i[n],e[n])):e[n]=i[n];return e}var ot=function(){function i(t,e,n,c){switch(t.toLowerCase()){case i.Browser.Chrome:case i.Browser.Edge:case i.Browser.Firefox:case i.Browser.Native:case i.Browser.Opera:case i.Browser.Safari:this.browser=t.toLowerCase();break;default:this.browser=i.Browser.Other}switch(e.toLowerCase()){case i.FormFactor.Desktop:case i.FormFactor.Phone:case i.FormFactor.Tablet:this.formFactor=e.toLowerCase();break;default:throw"Invalid form factor specified for device: "+e}switch(n.toLowerCase()){case i.OperatingSystem.Windows.toLowerCase():case i.OperatingSystem.macOS.toLowerCase():case i.OperatingSystem.Linux.toLowerCase():case i.OperatingSystem.Android.toLowerCase():case i.OperatingSystem.iOS.toLowerCase():this.OS=n.toLowerCase();break;default:this.OS=i.OperatingSystem.Other}this.touchable=c}return i}();(function(i){var t;(function(c){c.Chrome="chrome",c.Edge="edge",c.Firefox="firefox",c.Native="native",c.Opera="opera",c.Safari="safari",c.Other="other"})(t=i.Browser||(i.Browser={}));var e;(function(c){c.Windows="windows",c.macOS="macosx",c.Linux="linux",c.Android="android",c.iOS="ios",c.Other="other"})(e=i.OperatingSystem||(i.OperatingSystem={}));var n;(function(c){c.Desktop="desktop",c.Phone="phone",c.Tablet="tablet"})(n=i.FormFactor||(i.FormFactor={}))})(ot||(ot={}));function un(i){return new ot(i.browser,ot.FormFactor.Desktop,i.OS,!1)}var v=ot;var Fn=function(){function i(){}return i.VERSION="17.0.332",i.VERSION_RELEASE="17.0",i.VERSION_MAJOR="17",i.VERSION_MINOR="0",i.VERSION_PATCH="332",i.TIER="stable",i.VERSION_TAG="",i.VERSION_WITH_TAG="17.0.332",i.VERSION_ENVIRONMENT="stable",i.VERSION_GIT_TAG="release@17.0.332",i}();var Re=Fn;var yl=function(){function i(t){if(t==null){this.components=[].concat(i.DEVELOPER_VERSION_FALLBACK.components);return}if(Array.isArray(t)){var e=t;if(e.length<2)throw new Error("Version string must have at least a major and minor component!");this.components=[].concat(e);return}var n=t.split("."),c=[];if(n.length<2)throw new Error("Version string must have at least a major and minor component!");for(var r=0;r<n.length;r++){var l=parseInt(n[r],10);if(isNaN(l))throw new Error("Version string components must be numerical!");c.push(l)}this.components=c}return Object.defineProperty(i.prototype,"major",{get:function(){return this.components[0]},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"minor",{get:function(){return this.components[1]},enumerable:!1,configurable:!0}),i.prototype.toString=function(){return this.components.join(".")},i.prototype.toJSON=function(){return this.toString()},i.prototype.equals=function(t){return this.compareTo(t)==0},i.prototype.precedes=function(t){return this.compareTo(t)<0},i.prototype.compareTo=function(t){var e=this.components.length<t.components.length,n=this.components.length<t.components.length?this.components.length:t.components.length,c;for(c=0;c<n;c++){var r=this.components[c]-t.components[c];if(r!=0)return r}var l=e?t.components:this.components;do{if(l[c]>0)return e?-1:1;c++}while(c<l.length);return 0},i.CURRENT=new i(Re.VERSION_RELEASE),i.DEVELOPER_VERSION_FALLBACK=new i([9,0,0]),i.NO_DEFAULT_KEYCAPS=new i([12,0]),i.MAC_POSSIBLE_IPAD_ALIAS=new i([10,15]),i}(),ne=yl;function _e(){return typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof self!="undefined"?self:global}function at(){String.kmwFromCharCode=function(i){var t=[],e;for(e=0;e<arguments.length;e++){var n=Number(arguments[e]);if(!isFinite(n)||n<0||n>1114111||Math.floor(n)!==n)throw new RangeError("Invalid code point "+n);n<65536?t.push(n):(n-=65536,t.push((n>>10)+55296),t.push(n%1024+56320))}return String.fromCharCode.apply(void 0,t)},String.prototype.kmwCharCodeAt=function(i){var t=String(this),e=0;if(i<0||i>=t.length)return NaN;for(var n=0;n<i;n++)if(e=t.kmwNextChar(e),e===null)return NaN;var c=t.charCodeAt(e);if(c>=55296&&c<=56319&&t.length>e+1){var r=t.charCodeAt(e+1);if(r>=56320&&r<=57343)return(c-55296<<10)+(r-56320)+65536}return c},String.prototype.kmwIndexOf=function(i,t){var e=String(this),n=e.indexOf(i,t);if(n<0)return n;for(var c=0,r=0;r!==null&&r<n;r=e.kmwNextChar(r))c++;return c},String.prototype.kmwLastIndexOf=function(i,t){var e=String(this),n=e.lastIndexOf(i,t);if(n<0)return n;for(var c=0,r=0;r!==null&&r<n;r=e.kmwNextChar(r))c++;return c},String.prototype.kmwLength=function(){var i=String(this);if(i.length==0)return 0;for(var t=0,e=0;e!==null;t++)e=i.kmwNextChar(e);return t},String.prototype.kmwSlice=function(i,t){var e=String(this),n=e.kmwCodePointToCodeUnit(i),c=e.kmwCodePointToCodeUnit(t);return n===null||c===null?"":e.slice(n,c)},String.prototype.kmwSubstr=function(i,t){var e=String(this);i<0&&(i=e.kmwLength()+i),i<0&&(i=0);var n=e.kmwCodePointToCodeUnit(i),c=n;if(n===null)return"";if(arguments.length<2)c=e.length;else for(var r=0;r<t;r++)c=e.kmwNextChar(c);return c===null?e.substring(n):e.substring(n,c)},String.prototype.kmwSubstring=function(i,t){var e=String(this),n,c;if(typeof t=="undefined")n=e.kmwCodePointToCodeUnit(i),c=e.length;else{if(i>t){var r=i;i=t,t=r}n=e.kmwCodePointToCodeUnit(i),c=e.kmwCodePointToCodeUnit(t)}return(isNaN(n)||n===null)&&(n=0),(isNaN(c)||c===null)&&(c=e.length),e.substring(n,c)},String.prototype.kmwNextChar=function(i){var t=String(this);if(i===null||i<0||i>=t.length-1)return null;var e=t.charCodeAt(i);if(e>=55296&&e<=56319&&t.length>i+1){var n=t.charCodeAt(i+1);if(n>=56320&&n<=57343)return i==t.length-2?null:i+2}return i+1},String.prototype.kmwPrevChar=function(i){var t=String(this);if(i==null||i<=0||i>t.length)return null;var e=t.charCodeAt(i-1);if(e>=56320&&e<=57343&&i>1){var n=t.charCodeAt(i-2);if(n>=55296&&n<=56319)return i-2}return i-1},String.prototype.kmwCodePointToCodeUnit=function(i){if(i===null)return null;var t=String(this),e=0;if(i<0){e=t.length;for(var n=0;n>i;n--)e=t.kmwPrevChar(e);return e}if(i==t.kmwLength())return t.length;for(var n=0;n<i;n++)e=t.kmwNextChar(e);return e},String.prototype.kmwCodeUnitToCodePoint=function(i){var t=String(this);return i===null?null:i==0?0:i<0?t.substr(i).kmwLength():t.substr(0,i).kmwLength()},String.prototype.kmwCharAt=function(i){var t=String(this);return i>=0?t.kmwSubstr(i,1):""},String.prototype.kmwBMPNextChar=function(i){var t=String(this);return i<0||i>=t.length-1?null:i+1},String.prototype.kmwBMPPrevChar=function(i){var t=String(this);return i<=0||i>t.length?null:i-1},String.prototype.kmwBMPCodePointToCodeUnit=function(i){return i},String.prototype.kmwBMPCodeUnitToCodePoint=function(i){return i},String.prototype.kmwBMPLength=function(){var i=String(this);return i.length},String.prototype.kmwBMPSubstr=function(i,t){var e=String(this);return i>-1?e.substr(i,t):e.substr(e.length+i,-i)},String.kmwEnableSupplementaryPlane=function(i){var t=String.prototype;String._kmwFromCharCode=i?String.kmwFromCharCode:String.fromCharCode,t._kmwCharAt=i?t.kmwCharAt:t.charAt,t._kmwCharCodeAt=i?t.kmwCharCodeAt:t.charCodeAt,t._kmwIndexOf=i?t.kmwIndexOf:t.indexOf,t._kmwLastIndexOf=i?t.kmwLastIndexOf:t.lastIndexOf,t._kmwSlice=i?t.kmwSlice:t.slice,t._kmwSubstring=i?t.kmwSubstring:t.substring,t._kmwSubstr=i?t.kmwSubstr:t.kmwBMPSubstr,t._kmwLength=i?t.kmwLength:t.kmwBMPLength,t._kmwNextChar=i?t.kmwNextChar:t.kmwBMPNextChar,t._kmwPrevChar=i?t.kmwPrevChar:t.kmwBMPPrevChar,t._kmwCodePointToCodeUnit=i?t.kmwCodePointToCodeUnit:t.kmwBMPCodePointToCodeUnit,t._kmwCodeUnitToCodePoint=i?t.kmwCodeUnitToCodePoint:t.kmwBMPCodeUnitToCodePoint},String._kmwFromCharCode||String.kmwEnableSupplementaryPlane(!1)}at();var Il=function(){function i(t){var e=this;this._isFulfilled=!1,this._isRejected=!1,this._promise=new Promise(function(n,c){e._resolve=function(r){e._isFulfilled=!0,n(r)},e._reject=function(r){e._isRejected=!0,c(r)},t&&t(e._resolve,e._reject)})}return Object.defineProperty(i.prototype,"resolve",{get:function(){return this._resolve},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"reject",{get:function(){return this._reject},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isFulfilled",{get:function(){return this._isFulfilled},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isRejected",{get:function(){return this._isRejected},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isResolved",{get:function(){return this.isFulfilled||this.isRejected},enumerable:!1,configurable:!0}),i.prototype.then=function(t,e){return this._promise.then(t,e)},i.prototype.catch=function(t){return this._promise.catch(t)},i.prototype.finally=function(t){return this._promise.finally(t)},Object.defineProperty(i.prototype,"corePromise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),i}(),J=Il;var Jc=function(i){(0,d.__extends)(t,i);function t(e){var n=this,c=null;n=i.call(this,function(s){var o=setTimeout(function(){n.isResolved||s(!0)},e);c=o})||this,n.timerHandle=c;var r=n._resolve;n._resolve=function(s){clearTimeout(n.timerHandle),r(s)};var l=n._reject;return n._reject=function(s){clearTimeout(n.timerHandle),l(s)},n}return t}(J),Bt=Jc,de=function(i){var t=new Jc(i);return t.corePromise};var Ql=55296,hl=56319,Cl=56320,bl=57343;function St(i){return i>=Ql&&i<=hl}function Jt(i){return i>=Cl&&i<=bl}var xl=200,D=function(){function i(){}return i.buildDefaultLayout=function(t,e,n){var c=n;typeof i.dfltLayout[c]!="object"&&(c="desktop");var r=b.modifierBitmasks.NON_CHIRAL,l=ne.CURRENT;e&&(r=e.modifierBitmask,l=e.compilerVersion),t||(t=this.DEFAULT_RAW_SPEC);var s=te(i.dfltLayout[c]),o,a=s.layer,B=t.KLS,g=t.K102,u,F,I,y,Q,h,C,x,U=(r&b.modifierBitmasks.IS_CHIRAL)!=0;if(t.F){var p=/^(?:(?:italic|bold) )* *[0-9.eE-]+(?:[a-z]+) "(.+)"$/.exec(t.F);p&&(s.font=p[1])}var X=!(typeof B=="undefined"||!B);X||(B=t.KLS=i.processLegacyDefinitions(t.BK));var G=/\*\w+\*/,V=Object.getOwnPropertyNames(B),L=[];if(V.splice(V.indexOf("default"),1),V=["default"].concat(V),e&&e.emulatesAltGr&&(V.indexOf("leftctrl-leftalt")==-1&&V.indexOf("rightalt")!=-1&&(V.push("leftctrl-leftalt"),B["leftctrl-leftalt"]=B.rightalt),V.indexOf("leftctrl-leftalt-shift")==-1&&V.indexOf("rightalt-shift")!=-1&&(V.push("leftctrl-leftalt-shift"),B["leftctrl-leftalt-shift"]=B["rightalt-shift"])),s.displayUnderlying=e?!!e.scriptObject.KDU:!1,n=="desktop")for(L=i.generateLayerIds(U),o=0;o<L.length;o++)V.indexOf(L[o])!=-1&&L.splice(o--,1);var m=V.concat(L);if(X&&n!="desktop"){var S=null;h=a[0].row;for(var E=0;E<h.length;E++){x=h[E].key;for(var H=0;H<x.length;H++)C=x[H],C.id=="K_SHIFT"&&(S=C)}if(S){S.sk=[];for(var R in B)if(!(R=="default"||R=="shift")){var Y=i.modifierSpecials[R],A={id:"K_".concat(Y),text:Y,sp:1,nextlayer:R};S.sk.push(A)}}else console.warn("Error in default layout - cannot find default Shift key!")}for(o=0;o<m.length;o++)o>0&&(a[o]=te(a[0])),a[o].id=m[o],a[o].nextlayer=m[o],i.formatDefaultLayer(a[o],U,n,!!g);for(o=0;o<a.length;o++){var Z=a[o],W,S=null,w=null,Se="",ct=null,it=null,rt=null,Ke=B[Z.id],lt=Z.id=="shift"?1:0,Zt=Z.id=="default"||lt?1:0;for(h=Z.row,u=0;u<h.length;u++)for(x=h[u].key,F=0;F<x.length;F++){switch(C=x[F],W=i.dfltCodes.indexOf(C.id),(Ke||Zt)&&(Ke&&W>=0&&W<Ke.length&&(C.text=Ke[W]),Zt&&l.precedes(ne.NO_DEFAULT_KEYCAPS)&&C.id!="K_SPACE"&&W+65*lt<i.dfltText.length&&C.text!==null&&(C.text=C.text||i.dfltText[W+65*lt])),C.text!==null&&(C.text=C.text||""),C.id){case"K_SHIFT":S=C;break;case"K_TAB":w=C;break;case"K_CAPS":ct=C;break;case"K_NUMLOCK":it=C;break;case"K_SCROLL":rt=C;break}if(C.sk!=null){for(I=0;I<C.sk.length;I++)V.indexOf(C.sk[I].nextlayer)==-1&&C.sk.splice(I--,1);C.sk.length==0&&(C.sk=null)}}Z.shiftKey=S,Z.capsKey=ct,Z.numKey=it,Z.scrollKey=rt,n!="desktop"&&o>0&&S!=null&&(S.sp=2,S.sk=null,S.text=i.modifierSpecials[a[o].id]?i.modifierSpecials[a[o].id]:"*Shift*")}return s},i.getLayerId=function(t){var e=b.modifierCodes,n="";return t==0?"default":(t&e.LCTRL&&(n=(n.length>0?n+"-":"")+"leftctrl"),t&e.RCTRL&&(n=(n.length>0?n+"-":"")+"rightctrl"),t&e.LALT&&(n=(n.length>0?n+"-":"")+"leftalt"),t&e.RALT&&(n=(n.length>0?n+"-":"")+"rightalt"),t&e.SHIFT&&(n=(n.length>0?n+"-":"")+"shift"),t&e.CTRL&&(n=(n.length>0?n+"-":"")+"ctrl"),t&e.ALT&&(n=(n.length>0?n+"-":"")+"alt"),n)},i.generateLayerIds=function(t){var e,n;t?(e=32,n=1):(e=8,n=16);for(var c=[],r=0;r<e;r++)c.push(i.getLayerId(r*n));return c},i.formatDefaultLayer=function(t,e,n,c){for(var r=t.id,l=0;l<t.row.length;l++)for(var s=t.row[l],o=s.key,a=0;a<o.length;a++){var B=o[a];switch(B.id){case"K_SHIFT":case"K_LSHIFT":case"K_RSHIFT":r.indexOf("shift")!=-1&&(B.sp=2),n!="desktop"&&(r!="default"?B.nextlayer="default":B.nextlayer="shift");break;case"K_LCTRL":case"K_LCONTROL":if(e){r.indexOf("leftctrl")!=-1&&(B.sp=2);break}case"K_RCTRL":case"K_RCONTROL":if(e){r.indexOf("rightctrl")!=-1&&(B.sp=2);break}case"K_CONTROL":r.indexOf("ctrl")!=-1&&(!e||r.indexOf("leftctrl")!=-1&&r.indexOf("rightctrl")!=-1)&&(B.sp=2);break;case"K_LALT":if(e){r.indexOf("leftalt")!=-1&&(B.sp=2);break}case"K_RALT":if(e){r.indexOf("rightalt")!=-1&&(B.sp=2);break}case"K_ALT":r.indexOf("alt")!=-1&&(!e||r.indexOf("leftalt")!=-1&&r.indexOf("rightalt")!=-1)&&(B.sp=2);break;case"K_oE2":(typeof c=="undefined"||!c)&&(n=="desktop"?(o.splice(a--,1),o[0].width=xl):o[a].sp=10);break}}},i.processLegacyDefinitions=function(t){for(var e=i.generateLayerIds(!1),n={},c=0;c<e.length;c++){for(var r=e[c],l=[],s=!1,o=0;o<65;o++){var a=o+65*c;l.push(t[a]),a<t.length&&t[a]!=""&&o!=i.dfltCodes.indexOf("K_SPACE")&&(s=!0)}s&&(n[r]=l)}return(typeof n.default=="undefined"||!n.default)&&(n.default=[""]),(typeof n.shift=="undefined"||!n.shift)&&(n.shift=[""]),n},i.dfltCodes=["K_BKQUOTE","K_1","K_2","K_3","K_4","K_5","K_6","K_7","K_8","K_9","K_0","K_HYPHEN","K_EQUAL","K_*","K_*","K_*","K_Q","K_W","K_E","K_R","K_T","K_Y","K_U","K_I","K_O","K_P","K_LBRKT","K_RBRKT","K_BKSLASH","K_*","K_*","K_*","K_A","K_S","K_D","K_F","K_G","K_H","K_J","K_K","K_L","K_COLON","K_QUOTE","K_*","K_*","K_*","K_*","K_*","K_oE2","K_Z","K_X","K_C","K_V","K_B","K_N","K_M","K_COMMA","K_PERIOD","K_SLASH","K_*","K_*","K_*","K_*","K_*","K_SPACE"],i.dfltText="`1234567890-=\xA7~~qwertyuiop[]\\~~~asdfghjkl;'~~~~~?zxcvbnm,./~~~~~ ~!@#$%^&*()_+\xA7~~QWERTYUIOP{}\\~~~ASDFGHJKL:\"~~~~~?ZXCVBNM<>?~~~~~ ",i.DEFAULT_RAW_SPEC={F:"Tahoma",BK:i.dfltText},i.modifierSpecials={leftalt:"*LAlt*",rightalt:"*RAlt*",alt:"*Alt*",leftctrl:"*LCtrl*",rightctrl:"*RCtrl*",ctrl:"*Ctrl*","ctrl-alt":"*AltGr*","leftctrl-leftalt":"*LAltCtrl*","rightctrl-rightalt":"*RAltCtrl*","leftctrl-leftalt-shift":"*LAltCtrlShift*","rightctrl-rightalt-shift":"*RAltCtrlShift*",shift:"*Shift*","shift-alt":"*AltShift*","shift-ctrl":"*CtrlShift*","shift-ctrl-alt":"*AltCtrlShift*","leftalt-shift":"*LAltShift*","rightalt-shift":"*RAltShift*","leftctrl-shift":"*LCtrlShift*","rightctrl-shift":"*RCtrlShift*"},i.dfltShiftToCaps={id:"T_*_MT_SHIFT_TO_CAPS",text:"*ShiftLock*",sp:1,nextlayer:"caps"},i.dfltShiftToDefault={id:"T_*_MT_SHIFT_TO_DEFAULT",text:"*Shift*",sp:1,nextlayer:"default"},i.dfltShiftToShift={id:"T_*_MT_SHIFT_TO_SHIFT",text:"*Shift*",sp:1,nextlayer:"shift"},i.dfltLayout={desktop:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:1,key:[{id:"K_BKQUOTE"},{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{id:"K_BKSP",text:"*BkSp*",sp:1,width:130}]},{id:2,key:[{id:"K_TAB",text:"*Tab*",sp:1,width:130},{id:"K_Q"},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{id:"K_BKSLASH"}]},{id:3,key:[{id:"K_CAPS",text:"*Caps*",sp:1,width:165},{id:"K_A"},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_ENTER",text:"*Enter*",sp:1,width:165}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:130},{id:"K_oE2"},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_RSHIFT",text:"*Shift*",sp:1,width:130}]},{id:5,key:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:170},{id:"K_LALT",text:"*Alt*",sp:1,width:160},{id:"K_SPACE",text:"",width:770},{id:"K_RALT",text:"*Alt*",sp:1,width:160},{id:"K_RCONTROL",text:"*Ctrl*",sp:1,width:170}]}]}]},tablet:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:0,key:[{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{sp:10,width:1}]},{id:1,key:[{id:"K_Q",pad:25},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{sp:10,width:1}]},{id:2,key:[{id:"K_A",pad:50},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_BKSLASH",width:90}]},{id:3,key:[{id:"K_oE2",width:90},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_BKQUOTE"},{sp:10,width:1}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:200,sk:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:50,nextlayer:"ctrl"},{id:"K_LCONTROL",text:"*LCtrl*",sp:1,width:50,nextlayer:"leftctrl"},{id:"K_RCONTROL",text:"*RCtrl*",sp:1,width:50,nextlayer:"rightctrl"},{id:"K_LALT",text:"*Alt*",sp:1,width:50,nextlayer:"alt"},{id:"K_LALT",text:"*LAlt*",sp:1,width:50,nextlayer:"leftalt"},{id:"K_RALT",text:"*RAlt*",sp:1,width:50,nextlayer:"rightalt"},{id:"K_ALTGR",text:"*AltGr*",sp:1,width:50,nextlayer:"ctrl-alt"}]},{id:"K_LOPT",text:"*Menu*",sp:1,width:150},{id:"K_SPACE",text:"",width:570},{id:"K_BKSP",text:"*BkSp*",sp:1,width:150},{id:"K_ENTER",text:"*Enter*",sp:1,width:200}]}]}]},phone:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:0,key:[{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{sp:10,width:1}]},{id:1,key:[{id:"K_Q",pad:25},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{sp:10,width:1}]},{id:2,key:[{id:"K_A",pad:50},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_BKSLASH",width:90}]},{id:3,key:[{id:"K_oE2",width:90},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_BKQUOTE"},{sp:10,width:1}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:200,sk:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:50,nextlayer:"ctrl"},{id:"K_LCONTROL",text:"*LCtrl*",sp:1,width:50,nextlayer:"leftctrl"},{id:"K_RCONTROL",text:"*RCtrl*",sp:1,width:50,nextlayer:"rightctrl"},{id:"K_LALT",text:"*Alt*",sp:1,width:50,nextlayer:"alt"},{id:"K_LALT",text:"*LAlt*",sp:1,width:50,nextlayer:"leftalt"},{id:"K_RALT",text:"*RAlt*",sp:1,width:50,nextlayer:"rightalt"},{id:"K_ALTGR",text:"*AltGr*",sp:1,width:50,nextlayer:"ctrl-alt"}]},{id:"K_LOPT",text:"*Menu*",width:150,sp:1},{id:"K_SPACE",width:570,text:""},{id:"K_BKSP",text:"*BkSp*",width:150,sp:1},{id:"K_ENTER",text:"*Enter*",width:200,sp:1}]}]}]}},i}();function Ue(i,t,e){e.enumerable=!0}var Rc={id:"string",text:"string",layer:"string",nextlayer:"string",font:"string",fontsize:"string",sp:"number",pad:"number",width:"number",sk:"subkeys",flick:"flicks",multitap:"subkeys",hint:"string",default:"boolean"},Ac=["n","ne","e","se","s","sw","w","nw"],Nc=function(){function i(){this.isMnemonic=!1}return Object.defineProperty(i.prototype,"baseKeyID",{get:function(){if(typeof this.id!="undefined")return this.id},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isPadding",{get:function(){return this.sp==10},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"coreID",{get:function(){if(typeof this.id!="undefined"){var t=this.id||"";return this.displayLayer!=this.layer&&(t=t+"+"+this.layer),t}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"elementID",{get:function(){if(typeof this.id!="undefined")return this.displayLayer+"-"+this.coreID},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"baseKeyEvent",{get:function(){return new ae(this._baseKeyEvent)},enumerable:!1,configurable:!0}),i.unicodeIDToText=function(t,e){if(!t||t.substring(0,2)!="U_")return null;for(var n="",c=t.substring(2).split("_"),r=0,l=c;r<l.length;r++){var s=l[r],o=parseInt(s,16);if(0<=o&&o<=31||128<=o&&o<=159||isNaN(o)){e&&e(s);continue}else n+=String.kmwFromCharCode(o)}return n||null},i.sanitize=function(t){typeof t.width=="string"&&(t.width=parseInt(t.width,10)),t.width||(t.width=z.DEFAULT_KEY_WIDTH),typeof t.pad=="string"&&(t.pad=parseInt(t.pad,10)),t.pad||(t.pad=z.DEFAULT_PAD),typeof t.sp=="string"&&(t.sp=Number.parseInt(t.sp,10)),t.sp||(t.sp=z.DEFAULT_KEY.sp);for(var e=0,n=Object.keys(Rc);e<n.length;e++){var c=n[e],r=Rc[c];switch(r){case"subkeys":var l=t[c];if(!Array.isArray(l))delete t[c];else for(var s=0;s<l.length;s++){var o=l[s];typeof o!="object"?l.splice(s--,1):z.sanitize(o)}break;case"flicks":var a=t[c];if(typeof a!="object")delete t[c];else for(var B=0,g=Ac;B<g.length;B++){var u=g[B],o=a[u];typeof o!="object"?delete a[u]:z.sanitize(o)}break;default:var F=t[c];typeof F!=r&&delete t[c]}}t.text||(t.text=z.DEFAULT_KEY.text)},i.polyfill=function(t,e,n,c,r){r||(r={hasFlicks:!1,hasLongpresses:!1,hasMultitaps:!1});var l=new i,s=Object.getPrototypeOf(l);for(var o in l)if(!t.hasOwnProperty(o)){var a=Object.getOwnPropertyDescriptor(s,o);a?Object.defineProperty(t,o,a):t[o]=l[o]}if(!t.text&&typeof t.id=="string"&&(t.text=z.unicodeIDToText(t.id)),t.sk){r.hasLongpresses=!0;for(var B=0,g=t.sk;B<g.length;B++){var u=g[B];dt.polyfill(u,e,n,c,r)}}if(t.multitap){r.hasMultitaps=!0;for(var F=0,I=t.multitap;F<I.length;F++){var y=I[F];dt.polyfill(y,e,n,c,r)}}if(t.flick){r.hasFlicks=!0;for(var Q in t.flick)dt.polyfill(t.flick[Q],e,n,c,r)}var h=t;h.displayLayer=c,h.layer=h.layer||c,i.determineHint(h,n.defaultHint),h.constructBaseKeyEvent(e,n,c)},i.determineHint=function(t,e){var n;if(t.hint){t.hintSrc=t;return}if(e!=null&&e.includes("flick-")){if(t.flick){var c=e.substring(6);!((n=t.flick[c])===null||n===void 0)&&n.text&&(t.hintSrc=t.flick[c])}return}switch(e){case"none":return;case"multitap":t.multitap&&(t.hintSrc=t.multitap[0]);return;case"flick":if(t.flick)for(var r=0,l=Ac;r<l.length;r++){var s=l[r];if(t.flick[s]){t.hintSrc=t.flick[s];return}}return;case"longpress":t.sk&&(t.hintSrc=t.sk[0]);return;case"dot":default:t.sk&&(t.hint="\u2022",t.hintSrc=t);return}},i.prototype.constructBaseKeyEvent=function(t,e,n){var c=this.layer||n||"",r=this.id?this.id.toUpperCase():null,l={Lmodifiers:b.getModifierState(c),Lstates:b.getStateFromLayer(c),Lcode:r?b.keyCodes[r]:0,LisVirtualKey:!0,vkCode:0,kName:r,kLayer:c,kbdLayer:n,kNextLayer:this.nextlayer,device:null,isSynthetic:!0},s=new ae(l);if(e.keyboard){var o=e.keyboard;o.isMnemonic&&!(e.isDefault&&e.formFactor!="desktop")?s.Lcode!=b.keyCodes.K_SPACE&&(s.vkCode=s.Lcode,this.isMnemonic=!0):s.vkCode=s.Lcode,o.definesPositionalOrMnemonic||(s.Lcode=Be._USKeyCodeToCharCode(s),s.LisVirtualKey=!1)}this._baseKeyEvent=s},i.DEFAULT_PAD=15,i.DEFAULT_RIGHT_MARGIN=15,i.DEFAULT_KEY_WIDTH=100,i.DEFAULT_KEY={text:"",width:i.DEFAULT_KEY_WIDTH,sp:0,pad:i.DEFAULT_PAD},(0,d.__decorate)([Ue],i.prototype,"baseKeyID",null),(0,d.__decorate)([Ue],i.prototype,"isPadding",null),(0,d.__decorate)([Ue],i.prototype,"coreID",null),(0,d.__decorate)([Ue],i.prototype,"elementID",null),(0,d.__decorate)([Ue],i.prototype,"baseKeyEvent",null),(0,d.__decorate)([Ue],i.prototype,"constructBaseKeyEvent",null),i}();var z=function(i){(0,d.__extends)(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.getSubkey=function(e){if(this.sk)for(var n=0,c=this.sk;n<c.length;n++){var r=c[n];if(r.coreID==e)return r}return null},t}(Nc);var dt=function(i){(0,d.__extends)(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t}(Nc);var Wc=function(){function i(){}return i.sanitize=function(t){for(var e=0,n=t.key;e<n.length;e++){var c=n[e];c==null?t.key.length=t.key.length-1:z.sanitize(c)}typeof t.id=="string"&&(t.id=Number.parseInt(t.id,10))},i.polyfill=function(t,e,n,c,r,l,s){for(var o=t.key,a=0;a<o.length;a++){var B=o[a];for(var g in z.DEFAULT_KEY)typeof B[g]!="string"&&typeof B[g]!="number"&&(B[g]=z.DEFAULT_KEY[g]);switch(B.sp){case 1:!i.SPECIAL_LABEL.test(B.text)&&B.text!=""&&(B.sp=3);break;case 2:!i.SPECIAL_LABEL.test(B.text)&&B.text!=""&&(B.sp=4);break}z.polyfill(B,e,n,c,s)}for(var u=function(U,p,X,G){U.proportionalPad=p,U.proportionalWidth=X,U.proportionalX=G+p+X/2},F=0,a=0;a<o.length-1;a++){var B=o[a];u(B,B.pad/r,B.width/r,F),F+=B.proportionalPad,F+=B.proportionalWidth}var I=z.DEFAULT_RIGHT_MARGIN/r;if(o.length>0){var y=o[o.length-1];if(o.length==1&&y.pad<0){var Q=y.width/r,h=1-(F+Q+I);u(y,h,Q,F)}else{var h=y.pad/r,Q=1-(F+h+I);u(y,h,Q,F)}}var C=new i;for(var B in C)t.hasOwnProperty(B)||(t[B]=C[B]);var x=t;x.proportionalY=l},i.prototype.populateKeyMap=function(t){this.key.forEach(function(e){e.coreID&&(t[e.coreID]=e)})},i.SPECIAL_LABEL=/\*\w+\*/,(0,d.__decorate)([Ue],i.prototype,"populateKeyMap",null),i}();var Hc=function(){function i(){}return i.sanitize=function(t){for(var e=0,n=t.row;e<n.length;e++){var c=n[e];Wc.sanitize(c)}},i.polyfill=function(t,e,n,c){t.aligned=!1;for(var r=t.row,l=0,s=0,o=r;s<o.length;s++){for(var a=o[s],B=0,g=a.key,u=0,F=g;u<F.length;u++){var I=F[u];B+=I.width+I.pad}B>l&&(l=B)}n.formFactor=="desktop"?l+=5:l+=z.DEFAULT_RIGHT_MARGIN;for(var y=t.row.length,Q=0;Q<y;Q++){var h=(Q+.5)/y;Wc.polyfill(t.row[Q],e,n,t.id,l,h,c)}var C=new i;for(var I in C)t.hasOwnProperty(I)||(t[I]=C[I]);var x=t;x.totalWidth=l,x.defaultKeyProportionalWidth=z.DEFAULT_KEY.width/l,x.rowProportionalHeight=1/y,x.keyMap=x.constructKeyMap()},i.prototype.constructKeyMap=function(){var t={};return this.row.forEach(function(e){e.populateKeyMap(t)}),t},i.prototype.getKey=function(t){t.indexOf(this.id+"-")==0&&(t=t.replace(this.id+"-",""));var e=t.split("::");if(e.length>1){var n=this.keyMap[e[0]];return n.getSubkey(e[1])}else return this.keyMap[t]},(0,d.__decorate)([Ue],i.prototype,"constructKeyMap",null),(0,d.__decorate)([Ue],i.prototype,"getKey",null),i}();var Rt=function(){function i(){this.hasFlicks=!1,this.hasLongpresses=!1,this.hasMultitaps=!1}return i.prototype.getLayer=function(t){return this.layerMap[t]},i.correctLayerEmptyRowBug=function(t){for(var e=0;e<t.length;e++){var n=t[e],c=n.row,r=void 0;for(r=c.length-1;r>=0;r--)(!Array.isArray(c[r].key)||c[r].key.length==0)&&c.splice(r,1)}},i.sanitize=function(t){i.correctLayerEmptyRowBug(t.layer);for(var e=0,n=t.layer;e<n.length;e++){var c=n[e];Hc.sanitize(c)}},i.polyfill=function(t,e,n){if(t==null)throw new Error("Cannot build an ActiveLayout for a null specification.");var c={hasFlicks:!1,hasLongpresses:!1,hasMultitaps:!1};this.sanitize(t);var r,l={},s=t.layer,o=new i;for(var a in o)t.hasOwnProperty(a)||(t[a]=o[a]);var B=t;for(B.keyboard=e,B.formFactor=n,r=0;r<s.length;r++)Hc.polyfill(s[r],e,B,c),l[s[r].id]=s[r];if(n!="desktop"&&!!t.layer.find(function(y){return y.id=="caps"})){var g=t.layer.find(function(y){return y.id=="default"}),u=t.layer.find(function(y){return y.id=="shift"}),F=g.getKey("K_SHIFT"),I=u==null?void 0:u.getKey("K_SHIFT");F&&I&&!F.multitap&&!I.multitap&&!F.sk&&!I.sk&&(c.hasMultitaps=!0,F.multitap=[(0,d.__assign)({},D.dfltShiftToCaps),(0,d.__assign)({},D.dfltShiftToDefault)],I.multitap=[(0,d.__assign)({},D.dfltShiftToCaps),(0,d.__assign)({},D.dfltShiftToShift)],F.multitap.forEach(function(y){return dt.polyfill(y,e,B,"default")}),I.multitap.forEach(function(y){return dt.polyfill(y,e,B,"shift")}))}return B.hasFlicks=c.hasFlicks,B.hasLongpresses=c.hasLongpresses,B.hasMultitaps=c.hasMultitaps,B.layerMap=l,B},(0,d.__decorate)([Ue],i.prototype,"getLayer",null),i}();var Ul=function(){function i(){this.stores={}}return i}(),we;(function(i){i[i.NOT_LOADED=void 0]="NOT_LOADED",i[i.POLYFILLED=1]="POLYFILLED",i[i.CALIBRATED=2]="CALIBRATED"})(we||(we={}));var pl=function(){function i(t){t?this.scriptObject=t:this.scriptObject=i.DEFAULT_SCRIPT_OBJECT,this.layoutStates={}}return i.prototype.process=function(t,e){return this.scriptObject.gs(t,e)},i.prototype.processNewContextEvent=function(t,e){return this.scriptObject.gn?this.scriptObject.gn(t,e):!1},i.prototype.processPostKeystroke=function(t,e){return this.scriptObject.gpk?this.scriptObject.gpk(t,e):!1},Object.defineProperty(i.prototype,"isHollow",{get:function(){return this.scriptObject==i.DEFAULT_SCRIPT_OBJECT},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"id",{get:function(){return this.scriptObject.KI},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this.scriptObject.KN},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"variableStores",{get:function(){var t=this.scriptObject.KVS,e={};if(Array.isArray(t))for(var n=0,c=t;n<c.length;n++){var r=c[n];e[r]=this.scriptObject[r]}return e},set:function(t){var e=this.scriptObject.KVS;if(Array.isArray(e))for(var n=0,c=e;n<c.length;n++){var r=c[n];typeof t[r]=="string"&&(this.scriptObject[r]=t[r])}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_legacyLayoutSpec",{get:function(){return this.scriptObject.KV},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_layouts",{get:function(){return this.scriptObject.KVKL},set:function(t){this.scriptObject.KVKL=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"compilerVersion",{get:function(){return new ne(this.scriptObject.KVER)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isMnemonic",{get:function(){return!!this.scriptObject.KM},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"definesPositionalOrMnemonic",{get:function(){return typeof this.scriptObject.KM!="undefined"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"helpText",{get:function(){return this.scriptObject.KH},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasScript",{get:function(){return!!this.scriptObject.KHF},enumerable:!1,configurable:!0}),i.prototype.embedScript=function(t){this.scriptObject.KHF(t)},Object.defineProperty(i.prototype,"oskStyling",{get:function(){return this.scriptObject.KCSS},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isCJK",{get:function(){var t;return typeof this.scriptObject.KLC!="undefined"?t=this.scriptObject.KLC:typeof this.scriptObject.LanguageCode!="undefined"&&(t=this.scriptObject.LanguageCode),t=="cmn"||t=="jpn"||t=="kor"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isRTL",{get:function(){return!!this.scriptObject.KRTL},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"modifierBitmask",{get:function(){return this.scriptObject.KMBM||b.modifierBitmasks.NON_CHIRAL},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isChiral",{get:function(){return!!(this.modifierBitmask&b.modifierBitmasks.IS_CHIRAL)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"desktopFont",{get:function(){return this.scriptObject.KV?this.scriptObject.KV.F:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cacheTag",{get:function(){var t=this.scriptObject._kmw;return t||(t=new Ul,this.scriptObject._kmw=t),t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"explodedStores",{get:function(){return this.cacheTag.stores},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"emulatesAltGr",{get:function(){var t=b.modifierCodes;if(!this.isChiral||this._legacyLayoutSpec==null)return!1;var e=this._legacyLayoutSpec.KLS;if(!e)return!1;var n=t.LCTRL|t.LALT,c=e[D.getLayerId(n)],r=e[D.getLayerId(t.SHIFT|n)];if(c!=null&&c!=e[D.getLayerId(t.RALT)]||r!=null&&r!=e[D.getLayerId(t.RALT|t.SHIFT)])return!1;var l=this.modifierBitmask;return(l&n)!=n||c==null&&r==null,!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"usesSupplementaryPlaneChars",{get:function(){var t=this.scriptObject;return t&&(t.KS&&t.KS==1||t.KN=="Hieroglyphic")},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"version",{get:function(){return this.scriptObject.KBVER||""},enumerable:!1,configurable:!0}),i.prototype.usesDesktopLayoutOnDevice=function(t){return this.scriptObject.KVKL?t.formFactor==v.FormFactor.Desktop:!0},i.prototype.notify=function(t,e,n){typeof this.scriptObject.KNS=="function"&&this.scriptObject.KNS(t,e,n)},i.prototype.findOrConstructLayout=function(t){if(this._layouts){if(this._layouts[t]!==void 0)return this._layouts[t];if(t==v.FormFactor.Phone&&this._layouts[v.FormFactor.Tablet])return this._layouts[v.FormFactor.Phone]=this._layouts[v.FormFactor.Tablet];if(t==v.FormFactor.Tablet&&this._layouts[v.FormFactor.Phone])return this._layouts[v.FormFactor.Tablet]=this._layouts[v.FormFactor.Phone]}var e=null;if(this._legacyLayoutSpec!=null&&this._legacyLayoutSpec.KLS)e=this._legacyLayoutSpec;else if(this._legacyLayoutSpec!=null&&this._legacyLayoutSpec.BK!=null){for(var n=this._legacyLayoutSpec.BK,c=0;c<n.length;c++)if(n[c].length>0){e=this._legacyLayoutSpec;break}}if(!e&&(this.helpText==""||t!=v.FormFactor.Desktop)&&(e={F:"Tahoma",BK:D.dfltText}),this._layouts||(this._layouts={}),e){var r=this._layouts[t]=D.buildDefaultLayout(e,this,t);return r.isDefault=!0,r}else return this._layouts[t]=null,null},i.prototype.layout=function(t){var e=this.findOrConstructLayout(t);return e?(this.layoutStates[t]==we.NOT_LOADED&&(e=Rt.polyfill(e,this,t),this.layoutStates[t]=we.POLYFILLED),e):null},i.prototype.refreshLayouts=function(){var t=[v.FormFactor.Desktop,v.FormFactor.Phone,v.FormFactor.Tablet],e=this;t.forEach(function(n){e.layoutStates[n]=we.NOT_LOADED})},i.prototype.markLayoutCalibrated=function(t){this.layoutStates[t]!=we.NOT_LOADED&&(this.layoutStates[t]=we.CALIBRATED)},i.prototype.getLayoutState=function(t){return this.layoutStates[t]},i.prototype.constructNullKeyEvent=function(t,e){e=e||{K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1};var n=ae.constructNullKeyEvent(t);return this.setSyntheticEventDefaults(n,e),n},i.prototype.constructKeyEvent=function(t,e,n){var c=t.baseKeyEvent;c.device=e,this.isMnemonic&&c.setMnemonicCode(t.layer.indexOf("shift")!=-1,n.K_CAPS),this.setSyntheticEventDefaults(c,n);var r={K_CAPS:b.stateBitmasks.CAPS,K_NUMLOCK:b.stateBitmasks.NUM_LOCK,K_SCROLL:b.stateBitmasks.SCROLL_LOCK},l=r[c.kName];return l&&(c.Lstates^=l,c.LmodifierChange=!0),c},i.prototype.setSyntheticEventDefaults=function(t,e){t.device.touchable||(t.Lstates=0,t.Lstates|=e.K_CAPS?b.modifierCodes.CAPS:b.modifierCodes.NO_CAPS,t.Lstates|=e.K_NUMLOCK?b.modifierCodes.NUM_LOCK:b.modifierCodes.NO_NUM_LOCK,t.Lstates|=e.K_SCROLL?b.modifierCodes.SCROLL_LOCK:b.modifierCodes.NO_SCROLL_LOCK),t.kName&&t.kName.substr(0,2)=="U_"&&(t.LisVirtualKey=!1),typeof t.Lcode=="undefined"&&(t.Lcode=this.getVKDictionaryCode(t.kName),t.Lcode||(t.Lcode=1)),(t.Lmodifiers&b.modifierBitmasks.ALT_GR_SIM)==b.modifierBitmasks.ALT_GR_SIM&&this.emulatesAltGr&&(t.Lmodifiers&=~b.modifierBitmasks.ALT_GR_SIM,t.Lmodifiers|=b.modifierCodes.RALT)},i.prototype.getVKDictionaryCode=function(t){if(!this.scriptObject.VKDictionary){var e=[];if(typeof this.scriptObject.KVKD=="string")for(var n=this.scriptObject.KVKD.split(" "),c=0;c<n.length;c++)e[n[c].toUpperCase()]=c+256;this.scriptObject.VKDictionary=e}var r=this.scriptObject.VKDictionary[t.toUpperCase()];return r||0},i.DEFAULT_SCRIPT_OBJECT={gs:function(t,e){return!1},KI:"",KN:"",KV:D.DEFAULT_RAW_SPEC,KM:0},i}(),$=pl;var gt={osk:b},ut=function(){function i(t,e){this.loadedKeyboard=null,this._jsGlobal=t,this.keymanGlobal=e,this.install()}return i.prototype.KR=function(t){if(this.loadedKeyboard)throw new Error("Unexpected state:  the most-recently loaded keyboard field was not properly reset.");this.loadedKeyboard=new $(t)},i.prototype.KLOAD=function(t,e,n){return n},i.prototype.install=function(){this._jsGlobal.KeymanWeb=this,this._jsGlobal.keyman=this.keymanGlobal},i.prototype.uninstall=function(){this._jsGlobal.KeymanWeb==this&&delete this._jsGlobal.KeymanWeb,this._jsGlobal.keyman==this.keymanGlobal&&delete this._jsGlobal.keyman},i}();var Ft=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this,e)||this;return c.cause=n,c}return t}(Error);var yn=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this,e)||this;return c.cause=n,c}return t}(Error);var Gl=function(){function i(t){this.uri=t}return i.prototype.missingError=function(t){var e="Cannot find the keyboard at ".concat(this.uri,".");return new yn(e,t)},i.prototype.scriptError=function(t){var e="Error registering the keyboard script at ".concat(this.uri,"; it may contain an error.");return new Ft(e,t)},i}(),ml=function(){function i(t){this.stub=t}return i.prototype.missingError=function(t){var e=this.stub,n="Cannot find the ".concat(e.name," keyboard for ").concat(e.langName," at ").concat(e.filename,".");return new yn(n,t)},i.prototype.scriptError=function(t){var e=this.stub,n="Error registering the ".concat(e.name," keyboard for ").concat(e.langName,"; keyboard script at ").concat(e.filename," may contain an error.");return new Ft(n,t)},i}(),Xl=function(){function i(t){this._harness=t}return Object.defineProperty(i.prototype,"harness",{get:function(){return this._harness},enumerable:!1,configurable:!0}),i.prototype.loadKeyboardFromPath=function(t){this.harness.install();var e=this.loadKeyboardInternal(t,new Gl(t));return e},i.prototype.loadKeyboardFromStub=function(t){this.harness.install();var e=this.loadKeyboardInternal(t.filename,new ml(t),t.id);return e},i}(),In=Xl;var Qn;(function(i){i.KEYBOARD="keyboard",i.LANGUAGE="language",i.LANGUAGE_KEYBOARD="languageKeyboard",i.BLANK="blank"})(Qn||(Qn={}));var ge=Qn;function hn(i,t){if(i)return{family:i.family,path:t,files:i.filename||i.source}}var Vl=function(){function i(t,e){if(typeof t!="string")if(t.KI||t.KL||t.KLC||t.KFont||t.KOskFont){var n=t;this.KI=n.KI,this.KN=n.KN,this.KL=n.KL,this.KLC=n.KLC,this.KFont=n.KFont,this.KOskFont=n.KOskFont,this._displayName=n instanceof i?n._displayName:n.displayName}else{var c=t;c.languages||(c.languages=c.language),this.KI=c.id,this.KN=c.name,this.KL=c.languages.name,this.KLC=c.languages.id,this.KFont=hn(c.languages.font,e),this.KOskFont=hn(c.languages.oskFont,e)}else this.KI=t,this.KLC=e}return Object.defineProperty(i,"spacebarTextMode",{get:function(){return typeof this.spacebarTextModeSrc=="string"?this.spacebarTextModeSrc:this.spacebarTextModeSrc()},set:function(t){this.spacebarTextModeSrc=t},enumerable:!1,configurable:!0}),i.fromMultilanguageAPIStub=function(t){var e=[];t.languages||(t.languages=t.language);for(var n=0,c=t.languages;n<c.length;n++){var r=c[n],l={id:t.id,name:t.name,languages:r};e.push(new i(l))}return e},Object.defineProperty(i.prototype,"id",{get:function(){return this.KI},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this.KN},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"langId",{get:function(){return this.KLC},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"langName",{get:function(){return this.KL},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"displayName",{get:function(){if(this._displayName)return this._displayName;var t=this.KN,e=this.KL;switch(i.spacebarTextMode){case ge.KEYBOARD:return t;case ge.LANGUAGE:return e;case ge.LANGUAGE_KEYBOARD:return t==e?e:e+" - "+t;case ge.BLANK:return"";default:return t}},set:function(t){this._displayName=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"textFont",{get:function(){return this.KFont},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"oskFont",{get:function(){return this.KOskFont},enumerable:!1,configurable:!0}),i.prototype.validateForOSK=function(){return this.KLC?this.displayName===void 0||i.spacebarTextMode!=ge.BLANK&&!this.displayName?new Error("A display name is missing for this keyboard and cannot be generated under current settings."):null:this.KI||this.KN?new Error("No language code was specified for use with the ".concat(this.KI||this.KN," keyboard")):new Error("No language code was specified for use with the corresponding keyboard")},i.prototype.validateForCustomKeyboard=function(){return!this.KI||!this.KN||!this.KL||!this.KLC?new Error("To use a custom keyboard, you must specify keyboard id, keyboard name, language and language code."):null},i.spacebarTextModeSrc=ge.KEYBOARD,i}(),Pe=Vl;var Cn=function(){function i(t,e){this.p=t,this.d=e,this.o=i.ordinalSeed++}return i.prototype.match=function(t,e){var n=this.p==t&&this.d==e;return n},i.prototype.set=function(){this.matched=1},i.prototype.reset=function(){this.matched=0},i.prototype.before=function(t){return this.o<t.o},i.prototype.clone=function(){var t=new i(this.p,this.d);return t.o=this.o,t},i.prototype.equal=function(t){return this.d==t.d&&this.p==t.d&&this.o==t.o},i.ordinalSeed=0,i.sortFunc=function(t,e){return t.p!=e.p?e.p-t.p:e.o-t.o},i}();var Tc=function(){function i(){this.dks=[]}return i.prototype.toSortedArray=function(){return this.dks=this.dks.sort(Cn.sortFunc),[].concat(this.dks)},i.prototype.clone=function(){var t=new i,e=this.toSortedArray();return t.dks=[],e.forEach(function(n){t.dks.push(n.clone())}),t},i.prototype.isMatch=function(t,e,n){if(this.dks.length==0)return!1;var c=t;e=c-e;for(var r=0;r<this.dks.length;r++)if(this.dks[r].match(e,n)&&!this.dks[r].matched)return this.dks[r].set(),!0;return this.resetMatched(),!1},i.prototype.add=function(t){this.dks=this.dks.concat(t)},i.prototype.remove=function(t){var e=this.dks.indexOf(t);this.dks.splice(e,1)},i.prototype.clear=function(){this.dks=[]},i.prototype.resetMatched=function(){for(var t=0,e=this.dks;t<e.length;t++){var n=e[t];n.reset()}},i.prototype.deleteMatched=function(){for(var t=0;t<this.dks.length;t++)this.dks[t].matched&&this.dks.splice(t--,1)},i.prototype.adjustPositions=function(t,e){if(e!=0)for(var n=0,c=this.dks;n<c.length;n++){var r=c[n];r.p>t&&(r.p+=e)}},i.prototype.equal=function(t){if(this.dks.length!=t.dks.length)return!1;for(var e=t.dks,n=[],c=function(a){var B=e.find(function(g){return a.equal(g)});if(!B)return{value:!1}},r=0,l=this.dks;r<l.length;r++){var s=l[r],o=c(s);if(typeof o=="object")return o.value}return n.length==e.length},i.prototype.count=function(){return this.dks.length},i}();var Ec=function(){function i(t){this.id=t}return i.prototype.set=function(t){throw new Error("System store with ID "+this.id+" may not be directly set.")},i}();var At=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this,e)||this;return c.handler=null,c._value=n,c}return Object.defineProperty(t.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),t.prototype.matches=function(e){return this._value==e},t.prototype.set=function(e){this.handler&&this.handler(this,e)||(this._value=e)},t}(Ec);var kc=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this,O.TSS_PLATFORM)||this;return n.kbdInterface=e,n}return t.prototype.matches=function(e){var n,c,r=e.split(" "),l=this.kbdInterface.activeDevice;for(n=0;n<r.length;n++)switch(c=r[n].toLowerCase(),c){case"touch":case"hardware":if(l.touchable!=(c=="touch"))return!1;break;case"macos":case"mac":c="macosx";case"macosx":case"windows":case"android":case"ios":case"linux":if(l.OS!=c)return!1;break;case"tablet":case"phone":case"desktop":if(l.formFactor!=c)return!1;break;case"web":if(l.browser=="native")return!1;break;case"native":case"chrome":case"firefox":case"safari":case"edge":case"opera":if(l.browser!=c)return!1;break;default:return!1}return!0},t}(Ec);function bn(i,t,e){var n=Math.min(i.length,t.length),c,r,l,s,o;for(e?(c=r=i.length-1,l=r-n,s=-1,o=t.length-i.length):(c=r=0,l=n,s=1,o=0);r!=l&&i.charAt(r)==t.charAt(r+o);r+=s);if(r!=c&&r!=l){var a=i.charCodeAt(r-s),B=i.charCodeAt(r),g=t.charCodeAt(r+o),u=e?Jt:St,F=e?St:Jt;if(u(a)&&(F(B)||F(g)))return r-s}return r}at();function Oe(i){var t;return i?i.insert===""&&i.deleteLeft===0&&((t=i.deleteRight)!==null&&t!==void 0?t:0)===0:!0}var Zl=function(){function i(t,e,n,c){this.insert=t,this.deleteLeft=e,this.deleteRight=n,this.erasedSelection=c}return i.nil=new i("",0,0,!1),i}();var fl=function(){function i(t,e,n,c){var r=this.token=i.tokenSeed++;this.keystroke=t,this.transform=e,this.alternates=c,this.preInput=n,this.transform.id=this.token,c&&c.forEach(function(l){l.sample.id=r})}return i.tokenSeed=0,i}();var Yc=function(){function i(){this._dks=new Tc}return Object.defineProperty(i.prototype,"isSynthetic",{get:function(){return!0},enumerable:!1,configurable:!0}),i.prototype.resetContext=function(){this.deadkeys().clear()},i.prototype.deadkeys=function(){return this._dks},i.prototype.hasDeadkeyMatch=function(t,e){return this.deadkeys().isMatch(this.getDeadkeyCaret(),t,e)},i.prototype.insertDeadkeyBeforeCaret=function(t){var e=new Cn(this.getDeadkeyCaret(),t);this.deadkeys().add(e)},i.prototype.adjustDeadkeys=function(t){this.deadkeys().adjustPositions(this.getDeadkeyCaret(),t)},i.prototype.setDeadkeys=function(t){this._dks=t.clone()},i.prototype.buildTransformFrom=function(t){var e=this.getTextBeforeCaret(),n=t.getTextBeforeCaret(),c=bn(n,e,!1),r=n.substring(c)._kmwLength(),l=e.substring(c),s=this.getTextAfterCaret(),o=t.getTextAfterCaret(),a=bn(o,s,!0),B=o.substring(0,a+1)._kmwLength();return new Zl(l,r,B,t.getSelectedText()&&!this.getSelectedText())},i.prototype.buildTranscriptionFrom=function(t,e,n,c){var r=this.buildTransformFrom(t);return new fl(e,r,M.from(t,n),c)},i.prototype.restoreTo=function(t){this.clearSelection(),this.setTextBeforeCaret(t.getTextBeforeCaret()),this.setTextAfterCaret(t.getTextAfterCaret()),this._dks=t._dks.clone()},i.prototype.apply=function(t){this.clearSelection(),t.deleteRight&&this.setTextAfterCaret(this.getTextAfterCaret()._kmwSubstr(t.deleteRight)),t.deleteLeft&&this.deleteCharsBeforeCaret(t.deleteLeft),t.insert&&this.insertTextBeforeCaret(t.insert),this._dks.clear()},i.prototype.setTextBeforeCaret=function(t){this.deleteCharsBeforeCaret(this.getTextBeforeCaret()._kmwLength()),this.insertTextBeforeCaret(t)},i.prototype.saveProperties=function(){},i.prototype.restoreProperties=function(){},i}(),xn=Yc,M=function(i){(0,d.__extends)(t,i);function t(e,n,c){var r=i.call(this)||this;r.selForward=!0,r.text=e||"";var l=r.text._kmwLength();return r.selStart=typeof n=="number"?n:l,r.selEnd=typeof c=="number"?c:r.selStart,r.selForward=r.selEnd>=r.selStart,r}return t.from=function(e,n){var c;if(e instanceof t){var r=e;c=new t(r.text,r.selStart,r.selEnd)}else{var l=e.getText(),s=l._kmwLength(),o=s,a=0;if(e.hasSelection()){var B=e.getTextBeforeCaret(),g=e.getTextAfterCaret();o=B._kmwLength(),a=s-g._kmwLength()}c=new t(l,o,a)}return c.setDeadkeys(e.deadkeys()),c},t.prototype.clearSelection=function(){this.text=this.getTextBeforeCaret()+this.getTextAfterCaret(),this.selEnd=this.selStart,this.selForward=!0},t.prototype.invalidateSelection=function(){},t.prototype.isSelectionEmpty=function(){return this.selStart==this.selEnd},t.prototype.hasSelection=function(){return!0},t.prototype.getDeadkeyCaret=function(){return this.selStart},t.prototype.setSelection=function(e,n){if(this.selStart=e,this.selEnd=typeof n=="number"?n:e,this.selForward=n>=e,!this.selForward){var c=this.selStart;this.selStart=this.selEnd,this.selEnd=c}},t.prototype.getTextBeforeCaret=function(){return this.text.kmwSubstr(0,this.selStart)},t.prototype.getSelectedText=function(){return this.text.kmwSubstr(this.selStart,this.selEnd-this.selStart)},t.prototype.getTextAfterCaret=function(){return this.text.kmwSubstr(this.selEnd)},t.prototype.getText=function(){return this.text},t.prototype.deleteCharsBeforeCaret=function(e){e>=0&&(e>this.selStart&&(e=this.selStart),this.adjustDeadkeys(-e),this.text=this.text.kmwSubstr(0,this.selStart-e)+this.text.kmwSubstr(this.selStart),this.selStart-=e,this.selEnd-=e)},t.prototype.insertTextBeforeCaret=function(e){this.adjustDeadkeys(e._kmwLength()),this.text=this.getTextBeforeCaret()+e+this.text.kmwSubstr(this.selStart),this.selStart+=e.kmwLength(),this.selEnd+=e.kmwLength()},t.prototype.handleNewlineAtCaret=function(){this.insertTextBeforeCaret("\n")},t.prototype.setTextAfterCaret=function(e){this.text=this.getTextBeforeCaret()+e},t.prototype.isEqual=function(e){return this.text==e.text&&this.selStart==e.selStart&&this.selEnd==e.selEnd&&this.deadkeys().equal(e.deadkeys())},t.prototype.doInputEvent=function(){},t}(Yc);var vl=function(){function i(){this.transcription=null,this.setStore={},this.saveStore={},this.variableStores={},this.triggersDefaultCommand=!1}return i.prototype.finalize=function(t,e,n){if(!this.transcription)throw"Cannot finalize a RuleBehavior with no transcription.";t.beepHandler&&this.beep&&t.beepHandler(e);for(var c in this.setStore){var r=t.keyboardInterface.systemStores[c];if(r)try{r.set(this.setStore[c])}catch(s){t.errorLogger&&t.errorLogger("Rule attempted to perform illegal operation - 'platform' may not be changed.")}else t.warningLogger&&t.warningLogger("Unknown store affected by keyboard rule: "+c)}if(t.keyboardInterface.applyVariableStores(this.variableStores),t.keyboardInterface.variableStoreSerializer)for(var c in this.saveStore)t.keyboardInterface.variableStoreSerializer.saveStore(t.activeKeyboard.id,c,this.saveStore[c]);if(this.triggersDefaultCommand){var l=this.transcription.keystroke;t.defaultRules.applyCommand(l,e)}t.warningLogger&&this.warningLog?t.warningLogger(this.warningLog):t.errorLogger&&this.errorLog&&t.errorLogger(this.errorLog)},i.prototype.mergeInDefaults=function(t){var e=this.transcription.keystroke,n=t.transcription.keystroke;if(e.Lcode!=n.Lcode||e.Lmodifiers!=n.Lmodifiers)throw"RuleBehavior default-merge not supported unless keystrokes are identical!";this.triggersDefaultCommand=this.triggersDefaultCommand||t.triggersDefaultCommand;var c=M.from(this.transcription.preInput,!1);c.apply(this.transcription.transform),c.apply(t.transcription.transform),this.transcription=c.buildTranscriptionFrom(this.transcription.preInput,e,!1,this.transcription.alternates)},i}(),ue=vl;var Ll=function(){function i(){}return i}();var Sl=function(){function i(){}return i.prototype.reset=function(){this._cache=[]},i.prototype.get=function(t,e){return typeof this._cache[t]=="undefined"||typeof this._cache[t][e]=="undefined"?null:this._cache[t][e]},i.prototype.set=function(t,e,n){typeof this._cache[t]=="undefined"&&(this._cache[t]=[]),this._cache[t][e]=n},i}(),Jl=function(){function i(){}return i.prototype.reset=function(){this._cache=[]},i.prototype.get=function(t,e){return typeof this._cache[t]=="undefined"||typeof this._cache[t][e]=="undefined"?null:this._cache[t][e]},i.prototype.set=function(t,e,n){typeof this._cache[t]=="undefined"&&(this._cache[t]=[]),this._cache[t][e]=n},i.prototype.clone=function(){var t=new i;return t._cache=this._cache,t},i}(),O;(function(i){i[i.TSS_LAYER=33]="TSS_LAYER",i[i.TSS_PLATFORM=31]="TSS_PLATFORM",i[i.TSS_NEWLAYER=42]="TSS_NEWLAYER",i[i.TSS_OLDLAYER=43]="TSS_OLDLAYER"})(O||(O={}));var wc=function(i){(0,d.__extends)(t,i);function t(e,n,c){c===void 0&&(c=null);var r=i.call(this,e,n)||this;return r.cachedContext=new Sl,r.cachedContextEx=new Jl,r._AnyIndices=[],r.systemStores={},r.systemStores[O.TSS_PLATFORM]=new kc(r),r.systemStores[O.TSS_LAYER]=new At(O.TSS_LAYER,"default"),r.systemStores[O.TSS_NEWLAYER]=new At(O.TSS_NEWLAYER,""),r.systemStores[O.TSS_OLDLAYER]=new At(O.TSS_OLDLAYER,""),r.variableStoreSerializer=c,r}return Object.defineProperty(t.prototype,"Codes",{get:function(){return b},enumerable:!1,configurable:!0}),t.prototype.saveFocus=function(){},t.prototype.registerKeyboard=function(e){var n=new $(e);this.loadedKeyboard=n},t.prototype.context=function(e,n,c){var r=this.cachedContext.get(e,n);if(r!==null)return r;var l=this.KC_(e,n,c);return this.cachedContext.set(e,n,l),l},t.prototype.KC_=function(e,n,c){var r="";return r=c.isSelectionEmpty()?c.getTextBeforeCaret():"",r._kmwLength()<e&&(r=Array(e-r._kmwLength()+1).join("\uFFFE")+r),r._kmwSubstr(-e)._kmwSubstr(0,n)},t.prototype.nul=function(e,n){var c=this.context(e+1,1,n);return c==="\uFFFE"},t.prototype.contextMatch=function(e,n,c,r){var l=this.context(e,r,n);return l===c?!0:(n.deadkeys().resetMatched(),!1)},t.prototype._BuildExtendedContext=function(e,n,c){var r=this.cachedContextEx.get(e,n);if(r!==null)return r;if(r=this.cachedContextEx.get(e,e),r===null){var l=c.deadkeys().toSortedArray(),s=0;for(r={valContext:[],deadContext:[]};r.valContext.length<e;){var o=c.getDeadkeyCaret(),a=o-s;if(l.length>0&&l[0].p>a){l.splice(0,1);continue}else if(l.length>0&&l[0].p==a)r.deadContext[e-r.valContext.length-1]=l[0],r.valContext=[l[0].d].concat(r.valContext),l.splice(0,1);else{var B=this.context(++s,1,c);r.valContext=[B].concat(r.valContext)}}this.cachedContextEx.set(e,e,r)}var g=r;g.valContext=g.valContext.slice(0,n);for(var u=0;u<g.valContext.length;u++)g[u]=="\uFFFE"&&(g.valContext.splice(0,1),g.deadContext.splice(0,1));return g.valContext.length==0&&(g.valContext=["\uFFFE"],g.deadContext=[]),this.cachedContextEx.set(e,n,g),g},t.prototype.fullContextMatch=function(e,n,c){var r=this._BuildExtendedContext(e,c.length,n);this.ruleContextEx=this.cachedContextEx.clone();for(var l=r.valContext,s=r.deadContext,o=!1,a="\uFFFE",B=function(h){throw new Error("Unexpected object in fullContextMatch specification: "+h)},g=0;g<c.length;g++)if(typeof c[g]=="string"){var u=c[g];if(u!==l[g]){o=!0;break}}else{var F=c[g];switch(F.t){case"d":F.d!==l[g]?o=!0:s[g].set();break;case"a":var I;typeof l[g]=="string"?I=l[g]:I={t:"d",d:l[g]};var y=this.any(g,I,F.a);F.n?F.n&&(y||l[g]===a)&&(o=!0):y?s[g]!==void 0&&s[g].set():o=!0;break;case"i":var Q=this._Index(F.i,F.o);Q!==void 0&&(typeof Q=="string"?Q:Q.d)!==l[g]?o=!0:s[g]!==void 0&&s[g].set();break;case"c":l[F.c-1]!==l[g]?o=!0:s[g]!==void 0&&s[g].set();break;case"n":l[g]!=a&&(o=!0);break;default:B(F)}}return o&&(n.deadkeys().resetMatched(),this._AnyIndices=[]),!o},t.prototype.isKeypress=function(e){return this.activeKeyboard.isMnemonic?!e.LisVirtualKey:!!Be._USKeyCodeToCharCode(e)},t.matchModifiersToRuleChirality=function(e,n){var c=b.modifierCodes.LALT|b.modifierCodes.RALT,r=b.modifierCodes.LCTRL|b.modifierCodes.RCTRL,l=e;if(!(n&c)){var s=l&c;s&&(l^=s|b.modifierCodes.ALT)}if(!(n&r)){var o=l&r;o&&(l^=o|b.modifierCodes.CTRL)}return l},t.prototype.keyMatch=function(e,n,c){var r=!1,l=e.Lcode==173?189:e.Lcode,s=this.activeKeyboard.modifierBitmask,o=s&b.modifierBitmasks.ALL,a=s&b.stateBitmasks.ALL,B=t.matchModifiersToRuleChirality(e.Lmodifiers,n);return e.vkCode>255&&(l=e.vkCode),e.LisVirtualKey||l>255?((n&16384)==16384||l>255)&&(r=c==l&&(n&o)==B,r=r&&this.stateMatch(e,n&a)):(n&16384)==0&&(r=l==c),r||this.activeTargetOutput.deadkeys().resetMatched(),r},t.prototype.stateMatch=function(e,n){return(n&e.Lstates)==n},t.prototype.keyInformation=function(e){var n=new Ll;return n.vk=e.LisVirtualKey,n.code=e.Lcode,n.modifiers=e.Lmodifiers,n},t.prototype.deadkeyMatch=function(e,n,c){return n.hasDeadkeyMatch(e,c)},t.prototype.beep=function(e){this.resetContextCache(),this.ruleBehavior.beep=!0},t.prototype._ExplodeStore=function(e){if(typeof e=="string"){var n=this.activeKeyboard.explodedStores;if(n[e])return n[e];for(var c=[],r=0;r<e._kmwLength();r++)c.push(e._kmwCharAt(r));return n[e]=c,c}else return e},t.prototype.any=function(e,n,c){if(n=="")return!1;c=this._ExplodeStore(c);for(var r=-1,l=0;l<c.length;l++)if(typeof c[l]=="string"){if(c[l]==n){r=l;break}}else if(c[l].d===n.d){r=l;break}return this._AnyIndices[e]=r,r>=0},t.prototype._Index=function(e,n){return e=this._ExplodeStore(e),this._AnyIndices[n-1]<e.length?e[this._AnyIndices[n-1]]:(console.warn("Unmatched contextual index() statement detected in rule with index "+n+"!"),"")},t.prototype.indexOutput=function(e,n,c,r){this.resetContextCache();var l=function(a){throw new Error("Unexpected object in fullContextMatch specification: "+a)},s=this._Index(n,c);if(s!=="")if(typeof s=="string")this.output(e,r,s);else if(s.t){var o=s;switch(o.t){case"b":this.beep(r);break;case"d":this.deadkeyOutput(e,r,s.d);break;default:l(o)}}else this.deadkeyOutput(e,r,s.d)},t.prototype.deleteContext=function(e,n){var c;if(e>0){c=this._BuildExtendedContext(e,e,n);for(var r=0,l=0;l<c.valContext.length;l++){var s=c.deadContext[l];s?(n.deadkeys().remove(s),e--):c.valContext[l]=="\uFFFE"&&r++}var o=c.valContext.length-r;e>o&&(e=o)}n.deadkeys().resetMatched(),this.output(e,n,"")},t.prototype.output=function(e,n,c){this.resetContextCache(),n.saveProperties(),n.clearSelection(),n.deadkeys().deleteMatched(),e>=0&&n.deleteCharsBeforeCaret(e),n.insertTextBeforeCaret(c),n.restoreProperties()},t.prototype.contextExOutput=function(e,n,c,r){this.resetContextCache(),e>=0&&this.output(e,n,"");var l=this.ruleContextEx.get(c,c),s=l.deadContext[r-1],o=l.valContext[r-1];if(s)n.insertDeadkeyBeforeCaret(s.d);else if(typeof o=="string")this.output(-1,n,o);else throw new Error("contextExOutput: should never be a numeric valContext with no corresponding deadContext")},t.prototype.deadkeyOutput=function(e,n,c){this.resetContextCache(),e>=0&&this.output(e,n,""),n.insertDeadkeyBeforeCaret(c)},t.prototype.ifStore=function(e,n,c){var r=!0,l=this.systemStores[e];return l&&(r=l.matches(n)),r},t.prototype.setStore=function(e,n,c){if(this.resetContextCache(),e==O.TSS_LAYER&&this.activeDevice.touchable)this.ruleBehavior.setStore[e]=n;else return!1},t.prototype.loadStore=function(e,n,c){if(this.resetContextCache(),this.variableStoreSerializer){var r=this.variableStoreSerializer.loadStore(e,n);return r[n]||c}else return c},t.prototype.saveStore=function(e,n){this.resetContextCache();var c=this.activeKeyboard;if(!c||typeof c.id=="undefined"||c.id=="")return!1;var r={};return r[e]=n,this.ruleBehavior?this.ruleBehavior.saveStore[e]=r:this.variableStoreSerializer.saveStore(this.activeKeyboard.id,e,r),!0},t.prototype.resetContextCache=function(){this.cachedContext.reset(),this.cachedContextEx.reset()},t.prototype.defaultBackspace=function(e){e.isSelectionEmpty()?this.output(1,e,""):this.output(0,e,"")},t.prototype.processNewContextEvent=function(e,n){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.processNewContextEvent.bind(this.activeKeyboard),e,n,!0)},t.prototype.processPostKeystroke=function(e,n){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.processPostKeystroke.bind(this.activeKeyboard),e,n,!0)},t.prototype.processKeystroke=function(e,n){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.process.bind(this.activeKeyboard),e,n,!1)},t.prototype.process=function(e,n,c,r){if(n)if(this.activeKeyboard){if(!e)throw"No callee for keystroke processing!"}else throw"No active keyboard for keystroke processing!";else throw"No target specified for keyboard output!";n.invalidateSelection(),n.deadkeys().resetMatched(),this.resetContextCache();var l=M.from(n,!0),s=this.activeKeyboard.variableStores;this.ruleBehavior=new ue,this.activeDevice=c.device,this.activeTargetOutput=n;var o=e(n,c);this.activeTargetOutput=null,this.ruleBehavior.transcription=n.buildTranscriptionFrom(l,c,r),this.ruleBehavior.variableStores=this.activeKeyboard.variableStores,this.activeKeyboard.variableStores=s,this.ruleBehavior.triggerKeyDefault=!o;var a=this.ruleBehavior;return this.ruleBehavior=null,a},t.prototype.applyVariableStores=function(e){this.activeKeyboard.variableStores=e},t.__publishShorthandAPI=function(){var e=this.prototype,n=function(c,r){e[r]&&(e[c]=e[r])};n("KSF","saveFocus"),n("KBR","beepReset"),n("KT","insertText"),n("KR","registerKeyboard"),n("KRS","registerStub"),n("KC","context"),n("KN","nul"),n("KCM","contextMatch"),n("KFCM","fullContextMatch"),n("KIK","isKeypress"),n("KKM","keyMatch"),n("KSM","stateMatch"),n("KKI","keyInformation"),n("KDM","deadkeyMatch"),n("KB","beep"),n("KA","any"),n("KDC","deleteContext"),n("KO","output"),n("KDO","deadkeyOutput"),n("KCXO","contextExOutput"),n("KIO","indexOutput"),n("KIFS","ifStore"),n("KSETS","setStore"),n("KLOAD","loadStore"),n("KSAVE","saveStore")},t.GLOBAL_NAME="KeymanWeb",t}(ut),yt=wc;(function(){wc.__publishShorthandAPI()})();var Oc=N(T(),1);var Rl=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this)||this;return c.stateKeys={K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1},c.modStateFlags=0,n||(n=t.DEFAULT_OPTIONS),c.contextDevice=e,c.baseLayout=n.baseLayout||t.DEFAULT_OPTIONS.baseLayout,c.keyboardInterface=n.keyboardInterface||new yt(_e(),gt),c.defaultRules=n.defaultOutputRules||t.DEFAULT_OPTIONS.defaultOutputRules,c}return Object.defineProperty(t.prototype,"activeKeyboard",{get:function(){return this.keyboardInterface.activeKeyboard},set:function(e){this.keyboardInterface.activeKeyboard=e,this.resetContext()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layerStore",{get:function(){return this.keyboardInterface.systemStores[O.TSS_LAYER]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newLayerStore",{get:function(){return this.keyboardInterface.systemStores[O.TSS_NEWLAYER]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldLayerStore",{get:function(){return this.keyboardInterface.systemStores[O.TSS_OLDLAYER]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layerId",{get:function(){return this.layerStore.value},set:function(e){this.layerStore.set(e)},enumerable:!1,configurable:!0}),t.prototype.defaultRuleBehavior=function(e,n,c){var r=M.from(n,c),l=new ue,s=!1,o="",a;if(e.isSynthetic||n.isSynthetic)if(s=!0,this.defaultRules.isCommand(e))l.triggersDefaultCommand=!0;else if((a=this.defaultRules.forSpecialEmulation(e))!=null)switch(a){case Je.Backspace:this.keyboardInterface.defaultBackspace(n);break;case Je.Enter:n.handleNewlineAtCaret();break;default:l.errorLog="Unexpected 'special emulation' character (\\u"+a.kmwCharCodeAt(0).toString(16)+") went unhandled!"}else s=!1;var B=this.activeKeyboard&&this.activeKeyboard.isMnemonic;if(!s)if((o=this.defaultRules.forAny(e,B))!=null)if(a=this.defaultRules.forSpecialEmulation(e),a==Je.Backspace)this.keyboardInterface.defaultBackspace(n);else{if(a||this.defaultRules.isCommand(e))return null;this.keyboardInterface.output(0,n,o)}else return null;if(l.errorLog)return l;var g=n.buildTranscriptionFrom(r,e,c);return l.transcription=g,l},t.prototype.processNewContextEvent=function(e,n){return this.activeKeyboard?this.keyboardInterface.processNewContextEvent(n,this.activeKeyboard.constructNullKeyEvent(e,this.stateKeys)):null},t.prototype.processPostKeystroke=function(e,n){return this.activeKeyboard?this.keyboardInterface.processPostKeystroke(n,this.activeKeyboard.constructNullKeyEvent(e,this.stateKeys)):null},t.prototype.processKeystroke=function(e,n){var c,r=n.getTextBeforeCaret().kmwLength()==0&&n.isSelectionEmpty();if(this.activeKeyboard&&e.Lcode!=0&&(c=this.keyboardInterface.processKeystroke(n,e)),r&&e.Lcode==b.keyCodes.K_BKSP&&c.triggerKeyDefault)c=this.defaultRuleBehavior(e,n,!1),c.triggerKeyDefault=!0,c.transcription.transform.deleteLeft=1;else if(!c||c.triggerKeyDefault){e.Lcode=e.vkCode||e.Lcode,this.keyboardInterface.activeTargetOutput=n;var l=this.defaultRuleBehavior(e,n,!1);l&&(c?c.mergeInDefaults(l):c=l,c.triggerKeyDefault=!1),this.keyboardInterface.activeTargetOutput=null}return c},t.prototype._UpdateVKShift=function(e){var n=0,c=["CAPS","NUM_LOCK","SCROLL_LOCK"],r=["K_CAPS","K_NUMLOCK","K_SCROLL"];if(!this.activeKeyboard)return!0;if(e){n=e.Lmodifiers,this.activeKeyboard.isChiral&&this.activeKeyboard.emulatesAltGr&&(this.modStateFlags&b.modifierBitmasks.ALT_GR_SIM)==b.modifierBitmasks.ALT_GR_SIM&&(n|=b.modifierBitmasks.ALT_GR_SIM,n&=~b.modifierCodes.RALT);for(var l=!1,s=0;s<c.length;s++)e.Lstates&b.stateBitmasks[c[s]]&&(this.stateKeys[r[s]]=!!(e.Lstates&b.modifierCodes[c[s]]),l=!0);l&&this.emit("statekeychange",this.stateKeys)}return this.updateStates(),this.activeKeyboard.isMnemonic&&this.stateKeys.K_CAPS&&(!e||!e.isModifier)&&(n^=b.modifierCodes.SHIFT),this.layerId=this.getLayerId(n),!0},t.prototype.updateStates=function(){for(var e=["CAPS","NUM_LOCK","SCROLL_LOCK"],n=["K_CAPS","K_NUMLOCK","K_SCROLL"],c=0;c<n.length;c++){var r=n[c],l=this.stateKeys[r],s=e[c],o="NO_"+e[c];l?(this.modStateFlags|=b.modifierCodes[s],this.modStateFlags&=~b.modifierCodes[o]):(this.modStateFlags&=~b.modifierCodes[s],this.modStateFlags|=b.modifierCodes[o])}},t.prototype.getLayerId=function(e){return D.getLayerId(e)},t.prototype.selectLayer=function(e){var n=e.kName,c=e.kNextLayer,r=this.activeKeyboard&&this.activeKeyboard.isChiral;if(typeof c=="number"&&(c=this.getLayerId(c*16)),!c)switch(n){case"K_LSHIFT":case"K_RSHIFT":case"K_SHIFT":c="shift";break;case"K_LCONTROL":case"K_LCTRL":if(r){c="leftctrl";break}case"K_RCONTROL":case"K_RCTRL":if(r){c="rightctrl";break}case"K_CTRL":c="ctrl";break;case"K_LMENU":case"K_LALT":if(r){c="leftalt";break}case"K_RMENU":case"K_RALT":if(r){c="rightalt";break}case"K_ALT":c="alt";break;case"K_ALTGR":r?c="leftctrl-rightalt":c="ctrl-alt";break;case"K_CURRENCIES":case"K_NUMERALS":case"K_SHIFTED":case"K_UPPER":case"K_LOWER":case"K_SYMBOLS":c="default";break}return c?(this.updateLayer(e,c),!0):!1},t.prototype.updateLayer=function(e,n){var c=this.layerId,r=c;if(n==c&&e.device.formFactor!=v.FormFactor.Desktop)return!1;var l=n,s;if(e.device.formFactor==v.FormFactor.Desktop){var o=["leftctrl","rightctrl","ctrl","leftalt","rightalt","alt","shift"];for(s=0;s<o.length;s++)l=l.replace(o[s]+"-",""),l=l.replace(o[s],"");if(c=="default"||c=="numeric"||c=="symbol"||c=="currency"||l!="")r=n;else{var a=b.getModifierState(r);for(s=0;s<o.length;s++)r=r.replace(o[s]+"-",""),r=r.replace(o[s],"");switch(n){case"shift":a^=b.modifierCodes.SHIFT;break;case"leftctrl":a^=b.modifierCodes.LCTRL;break;case"rightctrl":a^=b.modifierCodes.RCTRL;break;case"ctrl":a^=b.modifierCodes.CTRL;break;case"leftalt":a^=b.modifierCodes.LALT;break;case"rightalt":a^=b.modifierCodes.RALT;break;case"alt":a^=b.modifierCodes.ALT;break;default:r=n}r!="default"&&(r==""?r=this.getLayerId(a):r=this.getLayerId(a)+"-"+r)}r==""&&(r="default")}else r=n;var B=this.activeKeyboard.layout(e.device.formFactor);B.getLayer(r)?this.layerId=r:this.layerId="default";var g=b.getModifierState(this.layerId);this.modStateFlags=g|e.Lstates},t.prototype.doModifierPress=function(e,n,c){return this.activeKeyboard?e.isModifier?(this.activeKeyboard.notify(e.Lcode,n,c?1:0),e.device.touchable?!0:this._UpdateVKShift(e)):(e.LmodifierChange&&(this.activeKeyboard.notify(0,n,1),e.device.touchable||this._UpdateVKShift(e)),!1):!1},t.prototype.performNewContextEvent=function(e){var n=this.processNewContextEvent(this.contextDevice,e);return n&&n.finalize(this,e,!0),n},t.prototype.resetContext=function(e){this.layerId="default",e==null||e.resetContext(),this.keyboardInterface.resetContextCache(),e&&this.performNewContextEvent(e),this.contextDevice.touchable||this._UpdateVKShift(null)},t.prototype.setNumericLayer=function(e){if(this.activeKeyboard){var n=this.activeKeyboard.layout(e.formFactor);n.getLayer("numeric")&&(this.layerId="numeric")}},t.DEFAULT_OPTIONS={baseLayout:"us",defaultOutputRules:new ke},t}(Oc.default),Un=Rl;var Mc=function(i){return i.substring(i.length-1)!="/"?i+"/":i},Al=function(){function i(t,e){e=Mc(e),this.sourcePath=e,this.protocol=e.replace(/(.{3,5}:)(.*)/,"$1"),this.updateFromOptions(t)}return i.prototype.updateFromOptions=function(t){var e=this.sourcePath.replace(/(https?:\/\/)([^\/]*)(.*)/,"$1$2/");this._root=e,t.root!=""?this._root=this.fixPath(t.root):this._root=this.fixPath(e);var n=t.resources;n==""&&(n=this.sourcePath),this._resources=this.fixPath(n),this._keyboards=this.fixPath(t.keyboards),this._fonts=this.fixPath(t.fonts)},i.prototype.fixPath=function(t){return t.length==0||(t=Mc(t),t.replace(/^(http)s?:.*/,"$1")=="http"||t.replace(/^(file):.*/,"$1")=="file")?t:t.substring(0,2)=="//"?this.protocol+t:t.substring(0,1)=="/"?this.root+t.substring(1):this.sourcePath+t},Object.defineProperty(i.prototype,"fonts",{get:function(){return this._fonts},enumerable:!1,configurable:!0}),i.prototype.updateFontPath=function(t){this._fonts=this.fixPath(t)},Object.defineProperty(i.prototype,"root",{get:function(){return this._root},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"resources",{get:function(){return this._resources},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"keyboards",{get:function(){return this._keyboards},enumerable:!1,configurable:!0}),i}(),pn=Al;var Gn={root:"",resources:"",keyboards:"",fonts:""};var Wl=function(){function i(t){t.OS==v.OperatingSystem.Android?this.popupCanvasBackgroundColor="#999":this.popupCanvasBackgroundColor=i.prefersDarkMode()?"#0f1319":"#ffffff"}return i.prefersDarkMode=function(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches},i}(),Dc=Wl;var Wt=function(){function i(){this.detected=!1,this.touchable="ontouchstart"in window,this.OS="",this.formFactor="desktop",this.browser="",this.dyPortrait=0,this.dyLandscape=0,this.version="0",this.orientation=window.orientation}return i.prototype.getDPI=function(){var t=document.createElement("DIV"),e=t.style,n=96;return document.readyState!=="complete"||(t.id="calculateDPI",e.position="absolute",e.display="block",e.visibility="hidden",e.left="10px",e.top="10px",e.width="1in",e.height="10px",document.body.appendChild(t),n=typeof window.devicePixelRatio=="undefined"?t.offsetWidth:t.offsetWidth*window.devicePixelRatio,document.body.removeChild(t)),n},i.prototype.detect=function(){var t=!1;if(navigator&&navigator.userAgent){var e=navigator.userAgent;if(e.indexOf("iPad")>=0)this.OS="iOS",this.formFactor="tablet",this.dyPortrait=this.dyLandscape=0;else if(e.indexOf("iPhone")>=0)this.OS="iOS",this.formFactor="phone",this.dyPortrait=this.dyLandscape=25;else if(e.indexOf("Android")>=0){this.OS="Android",this.formFactor="phone",this.dyPortrait=75,this.dyLandscape=25;try{var n=new RegExp("(?:Android\\s+)(\\d+\\.\\d+\\.\\d+)");this.version=e.match(n)[1]}catch(I){}}else if(e.indexOf("Linux")>=0)this.OS="Linux";else if(e.indexOf("Macintosh")>=0){var c=/Intel Mac OS X (\d+(?:[_\.]\d+)+)/i,r=c.exec(e);if(!r)console.warn("KMW could not properly parse the user agent string.A suboptimal keyboard layout may result."),this.OS="MacOSX";else if(r.length>1&&r[1]){var l=r[1].replace("_","."),s=new ne(l);t=ne.MAC_POSSIBLE_IPAD_ALIAS.compareTo(s)<=0,this.OS="MacOSX"}}else e.indexOf("Windows NT")>=0&&(this.OS="Windows",e.indexOf("Touch")>=0&&(this.formFactor="phone"),typeof navigator.msMaxTouchPoints=="number"&&navigator.msMaxTouchPoints>0&&(this.touchable=!0))}var o=Math.min(screen.width,screen.height),a=Math.max(screen.width,screen.height),B=o/a;this.OS!="iOS"&&this.formFactor=="phone"&&(o>=600&&B>.5625||B>=.625)&&(this.formFactor="tablet");var g=navigator.platform=="Win32"||navigator.platform=="MacIntel";this.OS=="iOS"&&!("ongesturestart"in window)&&!g&&(this.OS="Android"),this.browser="web",(this.OS=="iOS"||this.OS.toLowerCase()=="macosx")&&(this.browser="safari");var u=/Firefox|Chrome|OPR|Safari|Edge/;if(u.test(navigator.userAgent)&&(navigator.userAgent.indexOf("Firefox")>=0&&"onmozorientationchange"in screen?this.browser="firefox":navigator.userAgent.indexOf("OPR")>=0?this.browser="opera":navigator.userAgent.indexOf(" Edge/")>=0?this.browser="edge":navigator.userAgent.indexOf("Chrome")>=0?this.browser="chrome":navigator.userAgent.indexOf("Safari")>=0&&(this.browser="safari")),t&&this.browser=="safari"&&window.TouchEvent){this.OS="iOS",this.formFactor="tablet",this.dyPortrait=this.dyLandscape=0;var F=screen.height/screen.width;F<1&&(F=1/F),F>1.6&&(this.formFactor="phone",this.dyPortrait=this.dyLandscape=25)}return this.colorScheme=Dc.prefersDarkMode()?"dark":"light",this.detected=!0,this.coreSpec},Object.defineProperty(i.prototype,"coreSpec",{get:function(){return new v(this.browser,this.formFactor,this.OS,this.touchable)},enumerable:!1,configurable:!0}),i}();var mn=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this)||this;if(c.applyCacheBusting=!1,!n){var r=new Wt;r.detect(),n=r.coreSpec}return c.sourcePath=e,c.hostDevice=n,c.deferForInitialization=new J,c}return t.prototype.initialize=function(e){var n=this;this._paths?this._paths.updateFromOptions(e):this._paths=new pn(e,this.sourcePath),typeof e.setActiveOnRegister=="boolean"?this.activateFirstKeyboard=e.setActiveOnRegister:this.activateFirstKeyboard=!0,this._spacebarText=e.spacebarText,Pe.spacebarTextMode=function(){return n.spacebarText}},t.prototype.finalizeInit=function(){this.deferForInitialization.resolve()},Object.defineProperty(t.prototype,"paths",{get:function(){return this._paths},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"spacebarText",{get:function(){return this._spacebarText},set:function(e){this._spacebarText!=e&&(this._spacebarText=e,this.emit("spacebartext",e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"softDevice",{get:function(){return this.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hardDevice",{get:function(){return un(this.hostDevice)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stubNamespacer",{get:function(){return this._stubNamespacer},set:function(e){this._stubNamespacer=e},enumerable:!1,configurable:!0}),t.prototype.debugReport=function(){return{hostDevice:this.hostDevice,initialized:this.deferForInitialization.isResolved}},t.prototype.onRuleFinalization=function(e,n){},t}(zc.default);var Xn=(0,d.__assign)({setActiveOnRegister:!0,spacebarText:ge.LANGUAGE_KEYBOARD},Gn);var Kc=N(T(),1);var Vn=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.pendingActivations=[],n.engineConfig=e,n}return Object.defineProperty(t.prototype,"predictionContext",{get:function(){return this._predictionContext},enumerable:!1,configurable:!0}),t.prototype.configure=function(e){this._resetContext=e.resetContext,this._predictionContext=e.predictionContext,this.keyboardCache=e.keyboardCache},t.prototype.insertText=function(e,n,c){var r=this.activeTarget;return r!=null?(n!=null&&e.output(0,r,n),typeof c!="undefined"&&c!==null&&e.deadkeyOutput(0,r,c),r.invalidateSelection(),!0):!1},t.prototype.resetContext=function(){this._resetContext(this.activeTarget),this.predictionContext.resetContext()},t.prototype.findAndPopActivation=function(e){var n;for(n=0;n<this.pendingActivations.length&&this.pendingActivations[n].target!=e;n++);return n==this.pendingActivations.length?null:this.pendingActivations.splice(n,1)[0]},t.prototype.deferredKeyboardActivation=function(e,n,c){return(0,d.__awaiter)(this,void 0,void 0,function(){var r,l;return(0,d.__generator)(this,function(s){switch(s.label){case 0:return r={target:c,keyboard:e,stub:n},this.findAndPopActivation(c),this.pendingActivations.push(r),[4,e];case 1:return s.sent(),l=this.findAndPopActivation(c),l==r?[2,r]:l?(this.pendingActivations.push(l),[2,null]):[2]}})})},t.prototype.activateKeyboard=function(e,n,c){return(0,d.__awaiter)(this,void 0,void 0,function(){var r,l,s,o,a;return(0,d.__generator)(this,function(B){switch(B.label){case 0:return r=!this.activeKeyboard,this.findAndPopActivation(this.currentKeyboardSrcTarget()),l=this.prepareKeyboardForActivation(e,n),s=this.currentKeyboardSrcTarget(),[4,l.keyboard];case 1:return o=B.sent(),o==null&&l.metadata?[2,!1]:(this.currentKeyboardSrcTarget()==s&&this.emit("beforekeyboardchange",l.metadata),a=null,o&&(a={keyboard:o,metadata:l.metadata}),this.activateKeyboardForTarget(a,s),this.currentKeyboardSrcTarget()==s&&(!r||!!o)&&this.emit("keyboardchange",this.activeKeyboard),[2,!0])}})})},t.prototype.prepareKeyboardForActivation=function(e,n){var c=this,r;n||(n="");var l=null;if(e?l=this.keyboardCache.getStub(e,n):n=="",!l){if(e)throw new Error("No matching stub has been registered.");return{keyboard:Promise.resolve(null),metadata:null}}if(((r=this.activeKeyboard)===null||r===void 0?void 0:r.metadata)&&e==this.activeKeyboard.metadata.id){var s=this.activeKeyboard.keyboard;return{keyboard:Promise.resolve(s),metadata:l}}var o;if(o=this.keyboardCache.getKeyboardForStub(l))return{keyboard:Promise.resolve(o),metadata:l};this.emit("beforekeyboardchange",l);var a=this.engineConfig.deferForInitialization.then(function(){var g=new J;c.emit("keyboardasyncload",l,g.corePromise);var u=c.keyboardCache.fetchKeyboardForStub(l),F=new Promise(function(y,Q){var h="Sorry, the ".concat(l.name," keyboard for ").concat(l.langName," is not currently available.");window.setTimeout(function(){return Q(new Error(h))},t.TIMEOUT_THRESHOLD)}),I=Promise.race([u,F]);return I.then(function(){g.resolve(null),F.catch(function(){})}),I.catch(function(y){throw g.resolve(y),y}),I}),B=this.deferredKeyboardActivation(a,l,this.currentKeyboardSrcTarget());return{keyboard:B.then(function(g){return(0,d.__awaiter)(c,void 0,void 0,function(){return(0,d.__generator)(this,function(u){return g?[2,a]:[2,Promise.resolve(null)]})})}),metadata:l}},t.TIMEOUT_THRESHOLD=1e4,t}(Kc.default);var _c=N(T(),1);var Hl=function(i){(0,d.__extends)(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t}(_c.default),Zn=Hl;function fn(i,t,e){var n=b.modifierCodes;if(t&&t.isMnemonic&&i.setMnemonicCode(!!(i.Lmodifiers&n.SHIFT),!!(i.Lmodifiers&n.CAPS)),t&&!t.isMnemonic){var c=Be.languageMap[e];c&&c["k"+i.Lcode]&&(i.Lcode=c["k"+i.Lcode]),!t.definesPositionalOrMnemonic&&!(i.Lmodifiers&b.modifierBitmasks.NON_LEGACY)&&!i.isModifier&&(i=new ae({Lcode:Be._USKeyCodeToCharCode(i),Lmodifiers:0,LisVirtualKey:!1,vkCode:i.Lcode,Lstates:i.Lstates,kName:"",device:i.device,isSynthetic:!1}))}return i}var Pc=N(T(),1),Ht="Keyboard_";function ee(i){return i.startsWith(Ht)?i:Ht+i}function me(i){return i.startsWith(Ht)?i.substring(Ht.length):i}var Nl=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.stubSetTable={},n.keyboardTable={},n.keyboardLoader=e,n}return t.prototype.getKeyboardForStub=function(e){return e?this.getKeyboard(e.KI):null},t.prototype.getKeyboard=function(e){if(!e)return null;var n=this.keyboardTable[ee(e)];return n instanceof Promise?null:n},Object.defineProperty(t.prototype,"defaultStub",{get:function(){function e(c){var r=Object.keys(c);if(r.length!=0)return c[r[0]]}var n=e(this.stubSetTable);if(n)return e(n)},enumerable:!1,configurable:!0}),t.prototype.addKeyboard=function(e){var n=ee(e.id);this.keyboardTable[n]=e,this.emit("keyboardadded",e)},t.prototype.fetchKeyboardForStub=function(e){return this.fetchKeyboard(e.KI)},t.prototype.isFetchingKeyboard=function(e){if(!e)throw new Error("Keyboard ID must be specified");e=ee(e);var n=this.keyboardTable[e];return n instanceof Promise},t.prototype.fetchKeyboard=function(e){var n=this;if(!e)throw new Error("Keyboard ID must be specified");if(!this.keyboardLoader)throw new Error("Cannot load keyboards; this cache was configured without a loader");e=ee(e);var c=this.keyboardTable[e];if(c instanceof $)return Promise.resolve(c);if(c instanceof Promise)return c;var r=this.getStub(e,null);if(!r)throw new Error("No stub for ".concat(me(e)," has been registered"));if(!r.filename)throw new Error("The registered stub for ".concat(me(e)," lacks a path to the main keyboard file"));var l=this.keyboardLoader.loadKeyboardFromStub(r);return this.keyboardTable[e]=l,l.then(function(s){s.scriptObject.KI=e,n.addKeyboard(s)}).catch(function(s){throw delete n.keyboardTable[e],s}),l},t.prototype.addStub=function(e){var n,c=ee(e.KI),r=this.stubSetTable[c]=(n=this.stubSetTable[c])!==null&&n!==void 0?n:{};r[e.KLC]=e,this.emit("stubadded",e)},t.prototype.findMatchingStub=function(e){return this.getStub(e.KI,e.KLC)},t.prototype.getStub=function(e,n){var c,r,l=n||"---";e instanceof $?r=e.id:r=e,r&&(r=ee(r));var s=(c=this.stubSetTable[r])!==null&&c!==void 0?c:{};if(l!="---")return s[l];var o=Object.keys(s);return o.length==0?null:s[o[0]]},t.prototype.forgetKeyboard=function(e,n){n===void 0&&(n=!1);var c=e instanceof $?e.id:ee(e);this.stubSetTable[c]&&delete this.stubSetTable[c],n&&this.keyboardTable[c]&&delete this.keyboardTable[c]},t.prototype.getStubList=function(){for(var e=[],n=Object.keys(this.stubSetTable),c=0,r=n;c<r.length;c++)for(var l=r[c],s=this.stubSetTable[l],o=Object.keys(s),a=0,B=o;a<B.length;a++){var g=B[a];e.push(s[g])}return e},t}(Pc.default),vn=Nl;var Ln=["World","Africa","Asia","Europe","South America","North America","Oceania","Central America","Middle East"],Sn=["un","af","as","eu","sa","na","oc","ca","me"],Tl=RegExp("^(([\\.]/)|([\\.][\\.]/)|(/))|(:)");function jc(i,t){return t=t||"",i&&!Tl.test(i)?t+i:i}var El=function(i){(0,d.__extends)(t,i);function t(e,n,c){var r=this;if(typeof e!="string")if(e.id!==void 0){var l=e;l.id=ee(l.id),r=i.call(this,l,c)||this,r.KF=jc(l.filename,n),r.mapRegion(l.languages)}else{var s=e;s.KI=ee(s.KI),r=i.call(this,s,c)||this,r.KF=jc(s.KF,n),r.KP=s.KP,r.KR=s.KR,r.KRC=s.KRC;return}else r=i.call(this,ee(e),n)||this;return r}return t.prototype.mapRegion=function(e){var n=e.region,c=0;if(typeof n=="number")n<1||n>9?c=0:c=n-1;else if(typeof n=="string"){for(var r=n.length==2?Sn:Ln,l=0;l<r.length;l++)if(n.toLowerCase()==r[l].toLowerCase()){c=l;break}}this.KR=Ln[c],this.KRC=Sn[c]},Object.defineProperty(t.prototype,"region",{get:function(){return this.KR},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"regionCode",{get:function(){return this.KRC},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"filename",{get:function(){return this.KF},enumerable:!1,configurable:!0}),t.toStubs=function(e,n,c){var r="";if(typeof e.language!="undefined"&&console.warn("The 'language' property for keyboard stubs has been deprecated.  Please use the 'languages' property instead."),e.languages||(e.languages=e.language),e?e.id?e.languages||(r="KeyboardStub has undefined languages"):r="KeyboardStub has undefined id":r="Stub undefined",r!="")return[{error:new Error(r)}];var l=[];Array.isArray(e.languages)?l=l.concat(e.languages):l.push(e.languages);var s=[];return l.forEach(function(o){var a=(0,d.__assign)((0,d.__assign)({},e),{languages:o,language:void 0}),B=new t(a,n,c);s.push(B)}),s},t.prototype.merge=function(e){this.KL||(this.KL=e.KL),this.KR||(this.KR=e.KR),this.KRC||(this.KRC=e.KRC),this.KN||(this.KN=e.KN),this.KF||(this.KF=e.KF),this.KFont||(this.KFont=e.KFont),this.KOskFont||(this.KOskFont=e.KOskFont),e._displayName&&(this._displayName||(this._displayName=e._displayName))},t.prototype.validateForCustomKeyboard=function(){return i.prototype.validateForCustomKeyboard.call(this)||!this.KF||!this.KR?new Error("To use a custom keyboard, you must specify file name, keyboard id, keyboard name, language, language code, and region."):null},t}(Pe),Fe=El;function It(i,t){if(t.length==0)return Promise.resolve(i);if(i.length==0)return Promise.reject(t);var e=i;return Promise.resolve(e.concat(t))}var qc=N(T(),1);var $c="The Cloud API request timed out.",Jn="Could not find a keyboard with that ID.",ei="The Cloud API failed to find an appropriate keyboard.",kl="Error occurred while registering keyboards: ",Yl=function(i){return i+" keyboard not found."},wl=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this)||this;return c.cloudResolutionPromises={},c.languageFetchStarted=!1,c.registerFromCloud=function(r){var l=r.timerid,s;try{s=c._registerCore(r)}catch(a){s=new Error(kl+a)}if(l){var o=c.cloudResolutionPromises[l];if(o)try{s instanceof Error?o.reject(s):o.resolve(s)}finally{delete c.cloudResolutionPromises[l]}else{c.emit("unboundregister",s);return}}else{c.emit("unboundregister",s);return}},c.requestEngine=e,c.pathConfig=n,c._languageListPromise=new J,c}return Object.defineProperty(t.prototype,"languageListPromise",{get:function(){var e=this;return this.languageFetchStarted||(this.languageFetchStarted=!0,this.keymanCloudRequest("",!0).catch(function(n){e.languageFetchStarted=!1,e._languageListPromise.reject(n),e._languageListPromise=new J})),this._languageListPromise.corePromise},enumerable:!1,configurable:!0}),t.prototype.keymanCloudRequest=function(e,n){var c=this,r="https://api.keyman.com/cloud/4.0/"+(arguments.length>1&&n?"languages":"keyboards"),l="?jsonp=keyman.register&languageidtype=bcp47&version="+ne.CURRENT.toString(),s=r+l+e,o=this.requestEngine.request(s),a=o.promise,B=o.queryId;return this.cloudResolutionPromises[B]=a,a.finally(function(){delete c.cloudResolutionPromises[B]}),a.corePromise},t.prototype._registerCore=function(e){var n=e.options,c=n.fontBaseUri;if(this.pathConfig.fonts!=""?c=this.pathConfig.fonts:this.pathConfig.updateFontPath(c),typeof e.error=="string"){var r="";if(typeof e.options.keyboardid=="string"){var l=e.options.keyboardid;r=l.substring(0,1).toUpperCase()+l.substring(1)}return new Error(Yl(r))}if(typeof n=="undefined"||typeof n.context=="undefined")return new Error(Jn);var s=[];if(n.context=="keyboard"){var o=void 0,a=e.keyboard;if(Array.isArray(a))for(o=0;o<a.length;o++)s=s.concat(t.registerLanguagesForKeyboard(a[o],n,o));else s=s.concat(t.registerLanguagesForKeyboard(a,n,0))}else if(n.context=="language"){var B=e.languages;return this._languageListPromise.resolve(B),B}return s},t.registerLanguagesForKeyboard=function(e,n,c){var r="";if(typeof e=="undefined")return[];if(typeof n.keyboardid=="string"&&(r=n.keyboardid.split(",")[c]),Array.isArray(e))if(e.length==1||r.substr(-1,1)=="$"||r==""){for(var l=[],s=0;s<e.length;s++)l=l.concat(this.registerLanguagesForKeyboard(e[s],n,c));return l}else{for(var o=0,s=0;s<e.length;s++){var a=e[s].id.toLowerCase();if(a=="us"&&(a="english"),Array.isArray(e[s].languages)){for(var B=e[s].languages,g=0;g<B.length;g++)if(a==B[g].name.toLowerCase()){o=s;break}}}return this.registerLanguagesForKeyboard(e[o],n,c)}else{var u=n.fontBaseUri||"",F=Fe.toStubs(e,n.keyboardBaseUri,u),I=r.split("@")[1];if(F.length==1&&typeof F[0].error!="undefined")throw F[0].error;return typeof I!="string"?F:(I=I.replace(/\$$/,""),[F.find(function(y){return y.KLC==I})])}},t.prototype.fetchCloudStubs=function(e){return(0,d.__awaiter)(this,void 0,void 0,function(){var n,c,r,l,s,o,a;return(0,d.__generator)(this,function(B){switch(B.label){case 0:if(e.length==0)return[2,Promise.resolve([])];for(n="&keyboardid=",c="",r=0;r<e.length;r++)n=n+c+e[r].toString(),c=",";l=[],B.label=1;case 1:return B.trys.push([1,3,,4]),[4,this.keymanCloudRequest(n,!1)];case 2:return s=B.sent(),[2,It(s,l)];case 3:return o=B.sent(),console.error(o),a={error:o},l.push(a),[2,Promise.reject(l)];case 4:return[2]}})})},t}(qc.default),Rn=wl;var Ol=function(){function i(t,e){this.id=t,this.language=e}return i.prototype.toString=function(){var t=this.id;return this.language?(t=t+"@"+this.language,this.version&&(t=t+"@"+this.version)):this.version&&(t=t+"@@"+this.version),t},i}();function An(i,t){return{keyboard:{id:i.id,name:i.name},error:typeof t=="string"?new Error(t):t}}function ti(i,t,e){var n=new Ol(i,t);return e&&(n.version=e),n}function ni(i,t,e){if(i.getStub(e.id,e.language)==null){for(var n=0;n<t.length;n++)if(t[n].id==e.id&&t[n].language==e.language)return!1;return!0}else return!1}var Ml=function(){function i(t,e,n){var c=this;this.pathConfig=n,this.cache=new vn(t),this.cloudQueryEngine=new Rn(e,this.pathConfig),this.cloudQueryEngine.on("unboundregister",function(r){Array.isArray(r)&&r.forEach(function(l){c.cache.addStub(l)})})}return i.prototype.addKeyboardArray=function(t){for(var e=this,n=[],c=[],r=[],l=[],s=[],o=0,a=t;o<a.length;o++){var B=a[o];if(typeof B=="string"&&B.length>0)l.push(B);else if(B.KI||B.KL||B.KLC||B.KFont||B.KOskFont)r.push(new Fe(B));else{var g=B;if(typeof g.language!="undefined"&&console.warn("The 'language' property for keyboard stubs has been deprecated.  Please use the 'languages' property instead."),g.languages||(g.languages=g.language),typeof g.languages=="undefined"){var u="To use keyboard '"+g.id+"', you must specify languages.";s.push(An(g,u))}else if(Array.isArray(g.languages))for(var F=Fe.toStubs(g,this.pathConfig.keyboards,this.pathConfig.fonts),I=0,y=F;I<y.length;I++){var Q=y[I];Q instanceof Fe?r.push(Q):s.push(Q)}else{var h=g;r.push(new Fe(h,this.pathConfig.keyboards,this.pathConfig.fonts))}}}for(var C=0,x=r;C<x.length;C++){var Q=x[C];if(Q.KF){var U=Q.validateForCustomKeyboard();U?s.push(An(Q,U)):n.push(Q)}else c.push(Q)}for(var p=[],X=0,G=c;X<G.length;X++){var V=G[X];if(!V.KI&&!V.KLC){s.push(An(V,"Cannot fetch keyboard information without a keyboard ID or language code."));continue}var L=ti(me(V.id),V.langId);ni(this.cache,p,L)&&p.push(L)}for(var m=0,S=l;m<S.length;m++){var E=S[m],H=E.split("@"),R=[""];H[0].toLowerCase()=="english"&&(H[0]="us"),H.length>1&&(R=H[1].split(","));for(var Y=0;Y<R.length;Y++)if(!(Y>0&&R[Y]=="")){var L=ti(H[0],R[Y],H[2]);ni(this.cache,p,L)&&p.push(L)}}n.forEach(function(Z){return e.cache.addStub(Z)});var A=this.cloudQueryEngine.fetchCloudStubs(p.map(function(Z){return Z.toString()}));return A.then(function(Z){for(var W=0,w=Z;W<w.length;W++){var Se=w[W];Se instanceof Fe?(e.cache.addStub(Se),n.push(Se)):s.push(Se)}return[].concat(s).concat(n)})},i.prototype.addLanguageKeyboards=function(t){return(0,d.__awaiter)(this,void 0,void 0,function(){var e,n,c,r,l,s,o,a,B,g,u,F=this;return(0,d.__generator)(this,function(I){switch(I.label){case 0:e=[],n=[],I.label=1;case 1:return I.trys.push([1,3,,4]),[4,this.cloudQueryEngine.languageListPromise];case 2:return n=I.sent(),[3,4];case 3:return c=I.sent(),console.error(c),e.push({error:c}),[2,e];case 4:for(r=n,l="",s=0;s<t.length;s++){for(o=t[s].toLowerCase(),a=o.substr(-1,1)=="$",a&&(o=o.substr(0,o.length-1)),B=!1,g=0;g<r.length;g++)if(o==r[g].name.toLowerCase()){l!=""&&(l=l+","),l=l+"@"+r[g].id,a&&(l=l+"$"),B=!0;break}B||(u={language:{name:o},error:new Error(this.alertLanguageUnavailable(o))},e.push(u))}return l==""?[2,Promise.reject(e)]:[2,this.cloudQueryEngine.keymanCloudRequest("&keyboardid="+l,!1).then(function(y){return(0,d.__awaiter)(F,void 0,void 0,function(){var Q,h,C,x;return(0,d.__generator)(this,function(U){switch(U.label){case 0:return[4,It(y,e)];case 1:for(Q=U.sent(),h=0,C=Q;h<C.length;h++)x=C[h],typeof x.error=="undefined"&&this.cache.addStub(x);return[2,Q]}})})},function(y){console.error(y);var Q={error:y};return e.push(Q),Promise.reject(e)})]}})})},i.prototype.fetchCloudCatalog=function(){return(0,d.__awaiter)(this,void 0,void 0,function(){var t,e,n=this;return(0,d.__generator)(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,this.cloudQueryEngine.keymanCloudRequest("",!1)];case 1:return t=c.sent(),t.forEach(function(r){return n.cache.addStub(r)}),[2,t];case 2:return e=c.sent(),[2,Promise.reject([{error:e}])];case 3:return[2]}})})},i.prototype.alertLanguageUnavailable=function(t){var e="No keyboards are available for "+t+". Does it have another language name?";return e},i}(),Wn=Ml;var Dl=function(){function i(){this.registeredModels={},this.languageModelMap={}}return i.prototype.modelForLanguage=function(t){return this.languageModelMap[t]},i.prototype.register=function(t){if(t.id=t.id.toLowerCase(),JSON.stringify(t)!=JSON.stringify(this.registeredModels[t.id])){this.registeredModels[t.id]=t;var e=this;t.languages.forEach(function(n){if(!n){console.warn("Null / undefined language codes are not permitted for registration.");return}e.languageModelMap[n]=t})}},i.prototype.unregister=function(t){var e;if(t=t.toLowerCase(),this.registeredModels[t])e=this.registeredModels[t],delete this.registeredModels[t];else return;var n=this;return e.languages.forEach(function(c){n.languageModelMap[c].id==t&&delete n.languageModelMap[c]}),e},i.prototype.isRegistered=function(t){return!!this.registeredModels[t.id.toLowerCase()]},i}(),Hn=Dl;function Nt(i){for(var t=[],e=0;e<i.length;e++)t.push(i[e]);return t}function k(i){var t=document.createElement(i);return t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.MozUserSelect="none",t}var ye=function(){function i(t,e){if(this.fontStyleDefinitions={},this.linkedSheets=[],this.fontPromises=[],!t){var n=document.getElementsByTagName("HEAD");n.length>0?t=n[0]:t=document.body}this.linkNode=t,this.doCacheBusting=e||!1}return Object.defineProperty(i.prototype,"sheets",{get:function(){return this.linkedSheets.map(function(t){return t.sheet})},enumerable:!1,configurable:!0}),i.prototype.linkStylesheet=function(t){if(!(!(t instanceof HTMLLinkElement)&&!t.innerHTML)){var e=new J;t instanceof HTMLLinkElement?t.onload=function(){return e.resolve()}:e.resolve(),this.linkedSheets.push({sheet:t,load:e}),this.linkNode.appendChild(t)}},i.prototype.allLoadedPromise=function(){return(0,d.__awaiter)(this,void 0,void 0,function(){var t;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return t=this.linkedSheets.map(function(n){return n.load.corePromise}),Promise.allSettled?[4,Promise.allSettled(t)]:[3,2];case 1:return e.sent(),[3,4];case 2:return[4,Promise.all(t)];case 3:e.sent(),e.label=4;case 4:return[2]}})})},i.prototype.addStyleSheetForFont=function(t,e,n){var c=this;if(!!t&&typeof t.files!="undefined"){var r=t.family,l,s,o="",a="",B=[];n||(n=v.OperatingSystem.Other);var g=this.fontStyleDefinitions[n]=this.fontStyleDefinitions[n]||{};if(g[r]){var u=g[r];u.parentNode||this.linkStylesheet(u);return}for(typeof t.files=="string"?B[0]=t.files:B=t.files,s=0;s<B.length;s++)B[s].toLowerCase().indexOf(".otf")>0&&(o=B[s]),B[s].toLowerCase().indexOf(".ttf")>0&&(o=B[s]),B[s].toLowerCase().indexOf(".woff")>0&&(a=B[s]);o!=""&&o.indexOf("/")<0&&(o=e+o),a!=""&&a.indexOf("/")<0&&(a=e+a);var F="@font-face {\nfont-family:"+t.family+";\nfont-style:normal;\nfont-weight:normal;\n";if(n==v.OperatingSystem.iOS?o!=""&&(this.doCacheBusting&&(o=this.cacheBust(o)),l="url('"+encodeURI(o)+"') format('truetype')"):(a!=""&&(l="url('"+encodeURI(a)+"') format('woff')"),o!=""&&(l="url('"+encodeURI(o)+"') format('truetype')")),!l)return null;F+="src:"+l+";",F=F+"\n}\n";var I=Ae(F);g[r]=I;var y=new FontFace(t.family,l),Q=function(){return c.fontPromises=c.fontPromises.filter(function(C){return C!=h})},h=y.load().then(Q).catch(Q);return this.fontPromises.push(h),this.linkStylesheet(I),I}},i.prototype.cacheBust=function(t){return t+"?v="+new Date().getTime()},i.prototype.linkExternalSheet=function(t,e){try{if(!e&&document.querySelector("link[href="+JSON.stringify(t)+"]")!=null)return null}catch(c){return null}var n=document.createElement("link");return n.type="text/css",n.rel="stylesheet",n.href=t,this.linkStylesheet(n),n},i.prototype.unlink=function(t){var e=this.linkedSheets.findIndex(function(c){return c.sheet==t});if(e>-1){var n=this.linkedSheets.splice(e,1);return n[0].load.resolve(),t.parentNode.removeChild(t),!0}return!1},i.prototype.unlinkAll=function(){for(var t=0,e=this.linkedSheets;t<e.length;t++){var n=e[t],c=n.sheet;c.parentNode&&c.parentNode.removeChild(c),n.load.resolve()}this.linkedSheets.splice(0,this.linkedSheets.length)},i}();function Ae(i){var t=document.createElement("style");return t.type="text/css",t.appendChild(document.createTextNode(i)),t}function le(){var i;return typeof window.orientation!="undefined"?i=window.orientation:typeof window.screen.orientation!="undefined"&&(i=window.screen.orientation.angle),i!==void 0?Math.abs(i/90)==1:!1}var ci=function(i){return i},zl=function(){function i(t){this.name=t}return i.prototype.load=function(t){return this.loadCookie(this.name,t||ci)},i.prototype.save=function(t,e){this.saveCookie(this.name,t,e||ci)},i.prototype._loadRawCookies=function(){var t={};if(typeof document.cookie!="undefined"&&document.cookie!="")for(var e=document.cookie.split(/;\s*/),n=0;n<e.length;n++){var c=e[n].split("=");c.length==2&&(t[c[0]]=c[1])}return t},i.prototype.loadCookie=function(t,e){var n={},c=this._loadRawCookies(),r=c[t];if(r)for(var l=decodeURIComponent(r).split(";"),s=0;s<l.length&&!(s==l.length-1&&!l[s]);s++){var o=l[s].split("=");if(o.length>1){var a=o[0],B=o[1];n[a]=e(B,a)}else n[o[0]]=""}return n},i.prototype.saveCookie=function(t,e,n){var c="";for(var r in e)c+=r+"="+n(e[r],r)+";";var l=new Date(new Date().valueOf()+1e3*60*60*24*30).toUTCString(),s=" path=/; expires="+l;document.cookie="".concat(t,"=").concat(encodeURIComponent(c),"; ").concat(s)},i}(),Ie=zl;function _(i){var t;if(!i)return 0;var e=i.offsetLeft?i.offsetLeft:0;if(t=i,t.offsetParent){for(;t.offsetParent;)t=t.offsetParent,e+=t.offsetLeft;var n=t.ownerDocument;t.style.position=="fixed"&&n&&n.scrollingElement&&(e+=n.scrollingElement.scrollLeft)}if(t&&t.ownerDocument&&i.ownerDocument!=window.document){var c=t.ownerDocument;if(c&&c.defaultView&&c.defaultView.frameElement)return e+_(c.defaultView.frameElement)-c.documentElement.scrollLeft}return e}function P(i){var t;if(!i)return 0;var e=i.offsetTop?i.offsetTop:0;if(t=i,t.ownerDocument&&t instanceof t.ownerDocument.defaultView.HTMLElement){for(;t.offsetParent;)t=t.offsetParent,e+=t.offsetTop;var n=t.ownerDocument;t.style.position=="fixed"&&n&&n.scrollingElement&&(e+=n.scrollingElement.scrollTop)}if(t&&t.ownerDocument&&i.ownerDocument!=window.document){var c=t.ownerDocument;if(c&&c.defaultView&&c.defaultView.frameElement)return e+P(c.defaultView.frameElement)}return e}var ii=function(i){(0,d.__extends)(t,i);function t(e,n){return i.call(this,"KeymanWeb_".concat(e,"_Option_").concat(n))||this}return t.prototype.load=function(){return i.prototype.load.call(this,decodeURIComponent)},t.prototype.save=function(e){i.prototype.save.call(this,e,encodeURIComponent)},t}(Ie),Nn=function(){function i(){}return i.prototype.loadStore=function(t,e){var n=new ii(t,e);return n.load()},i.prototype.saveStore=function(t,e,n){var c=new ii(t,e);c.save(n)},i}();var ri=function(i){(0,d.__extends)(t,i);function t(e,n,c){var r=i.call(this,e,n,new Nn)||this;return r.insertText=function(l,s){r.resetContextCache(),r.engine.contextManager.insertText(r,l,s)},r.KT=r.insertText,r.engine=n,r.stubNamespacer=c,r}return t.prototype.preserveID=function(e){var n;if(document.currentScript)n=document.currentScript.id;else{var c=document.getElementsByTagName("script"),r=c[c.length-1];n=r.id}if(n)n.indexOf(me(e.KI))!=-1?e.KI=n:console.error("Error when registering keyboard:  current SCRIPT tag's ID does not match!");else return},t.prototype.registerKeyboard=function(e){var n=this;i.prototype.registerKeyboard.call(this,e);var c=this.loadedKeyboard;this.preserveID(e),this.engine.config.deferForInitialization.then(function(){n.engine.keyboardRequisitioner.cache.isFetchingKeyboard(c.id)||(n.engine.keyboardRequisitioner.cache.addKeyboard(c),n.loadedKeyboard=null)})},t.prototype.registerStub=function(e){var n=this,c;this.stubNamespacer&&this.stubNamespacer(e);var r=function(){var s=n.engine.config.paths;return new Fe(e,s.keyboards,s.fonts)};if(!this.engine.config.deferForInitialization.isResolved)this.engine.config.deferForInitialization.then(function(){return n.engine.keyboardRequisitioner.cache.addStub(r())});else{var l=r();if(!((c=this.engine.keyboardRequisitioner)===null||c===void 0)&&c.cache.findMatchingStub(l))return 1;this.engine.keyboardRequisitioner.cache.addStub(l)}return null},t}(yt),Tn=ri;(function(){ri.__publishShorthandAPI()})();var li=function(i){(0,d.__extends)(t,i);function t(e,n){var c=this;return e&&e._jsGlobal!=window&&(e._jsGlobal.String=window.String),e?c=i.call(this,e)||this:c=i.call(this,new ut(window,gt))||this,c.performCacheBusting=n||!1,c}return t.prototype.loadKeyboardInternal=function(e,n,c){var r=this,l=new J;this.performCacheBusting&&(e=this.cacheBust(e));try{var s=this.harness._jsGlobal.document,o=s.createElement("script");c&&(o.id=c),s.head.appendChild(o),o.onerror=function(a){l.reject(n.missingError(a))},o.onload=function(){if(r.harness.loadedKeyboard){var a=r.harness.loadedKeyboard;r.harness.loadedKeyboard=null,l.resolve(a)}else l.reject(n.scriptError())},l.then(function(){o.remove()}).catch(function(){o.remove()}),o.src=e}catch(a){return Promise.reject(a)}return l.corePromise},t.prototype.cacheBust=function(e){return e+"?v="+new Date().getTime()},t}(In);function Tt(i,t){var e=new Map;return t.keys.forEach(function(n){var c=Math.abs(i.x-n.centerX),r=Math.abs(i.y-n.centerY),l,s;c>.5*n.width?(l=c-.5*n.width,c=.5):(l=0,c/=n.width),r>.5*n.height?(s=r-.5*n.height,r=.5):(s=0,r/=n.height),l*=t.kbdScaleRatio,l+=c*n.height,s+=r*n.height;var o=l*l+s*s;e.set(n.keySpec,o)}),e}function We(i){var t,e,n,c,r,l,s,o=new Map,a=0;Array.isArray(i)||(i=[i]);try{for(var B=(0,d.__values)(i),g=B.next();!g.done;g=B.next()){var u=g.value;try{for(var F=(n=void 0,(0,d.__values)(u.keys())),I=F.next();!I.done;I=F.next()){var y=I.value,Q=1/(Math.pow(u.get(y),2)+3e-5);a+=Q,o.set(y,(s=o.get(y))!==null&&s!==void 0?s:0+Q)}}catch(U){n={error:U}}finally{try{I&&!I.done&&(c=F.return)&&c.call(F)}finally{if(n)throw n.error}}}}catch(U){t={error:U}}finally{try{g&&!g.done&&(e=B.return)&&e.call(B)}finally{if(t)throw t.error}}var h=[];try{for(var C=(0,d.__values)(o.keys()),x=C.next();!x.done;x=C.next()){var y=x.value;h.push({keySpec:y,p:o.get(y)/a})}}catch(U){r={error:U}}finally{try{x&&!x.done&&(l=C.return)&&l.call(C)}finally{if(r)throw r.error}}return h.sort(function(U,p){return p.p-U.p})}var Kl=function(){function i(t,e,n){this.keySpec=n,this.centerX=n.proportionalX,this.centerY=e.proportionalY,this.width=n.proportionalWidth,this.height=t.rowProportionalHeight}return i}();function _l(i){return i.baseKeyID?b.isKnownOSKModifierKey(i.baseKeyID)?!1:!i.isPadding:!1}function si(i,t){return{keys:i.row.map(function(e){return e.key.map(function(n){return new Kl(i,e,n)})}).reduce(function(e,n){return e.concat(n)},[]).filter(function(e){return _l(e.keySpec)}),kbdScaleRatio:t}}var Pl=function(){function i(t,e,n){this.left=t.getTextBeforeCaret(),this.startOfBuffer=this.left._kmwLength()<=e.leftContextCodePoints,this.startOfBuffer||(this.left=this.left._kmwSubstr(-e.leftContextCodePoints)),this.right=t.getTextAfterCaret(),this.endOfBuffer=this.right._kmwLength()<=e.rightContextCodePoints,this.endOfBuffer||(this.right=this.right._kmwSubstr(0,e.rightContextCodePoints)),this.casingForm=n=="shift"?"initial":n=="caps"?"upper":null}return i.prototype.toMock=function(){var t=this.left._kmwLength();return new M(this.left+(this.right||""),t)},i.ENGINE_RULE_WINDOW={leftContextCodePoints:64,rightContextCodePoints:32},i}(),Xe=Pl;var di=N(T(),1);var jl=function(){function i(){this._promises=new Map}return Object.defineProperty(i.prototype,"length",{get:function(){return this._promises.size},enumerable:!1,configurable:!0}),i.prototype.make=function(t,e,n){if(this._promises.has(t))return n("Existing request with token ".concat(t));this._promises.set(t,{reject:n,resolve:e})},i.prototype.keep=function(t,e){var n=this._promises.get(t);if(!n)throw new Error("No promise associated with token: ".concat(t));var c=n.resolve;return this._promises.delete(t),c(e)},i.prototype.break=function(t,e){var n=this._promises.get(t);if(!n)throw new Error("No promise associated with token: ".concat(t));this._promises.delete(t),n.reject(e)},i}(),Qt=jl;var ql=function(){function i(t,e,n){this._worker=e,this._worker.onmessage=this.onMessage.bind(this),this._declareLMLayerReady=null,this._predictPromises=new Qt,this._wordbreakPromises=new Qt,this._acceptPromises=new Qt,this._revertPromises=new Qt,this._nextToken=Number.MIN_SAFE_INTEGER,this.sendConfig(t,!!n)}return i.prototype.sendConfig=function(t,e){this._worker.postMessage({message:"config",capabilities:t,testMode:e})},i.prototype.loadModel=function(t,e){var n=this;return e===void 0&&(e="file"),new Promise(function(c,r){n._declareLMLayerReady=c;var l={type:e};e=="file"?l.file=t:l.code=t,n._worker.postMessage({message:"load",source:l})})},i.prototype.unloadModel=function(){this._worker.postMessage({message:"unload"})},i.prototype.predict=function(t,e){var n=this,c=this._nextToken++;return new Promise(function(r,l){n._predictPromises.make(c,r,l),n._worker.postMessage({message:"predict",token:c,transform:t,context:e})})},i.prototype.wordbreak=function(t){var e=this,n=this._nextToken++;return new Promise(function(c,r){e._wordbreakPromises.make(n,c,r),e._worker.postMessage({message:"wordbreak",token:n,context:t})})},i.prototype.acceptSuggestion=function(t,e,n){var c=this,r=this._nextToken++;return new Promise(function(l,s){c._acceptPromises.make(r,l,s),c._worker.postMessage({message:"accept",token:r,suggestion:t,context:e,postTransform:n})})},i.prototype.revertSuggestion=function(t,e){var n=this,c=this._nextToken++;return new Promise(function(r,l){n._revertPromises.make(c,r,l),n._worker.postMessage({message:"revert",token:c,reversion:t,context:e})})},i.prototype.resetContext=function(t){this._worker.postMessage({message:"reset-context",context:t})},i.prototype.onMessage=function(t){var e=t.data;if(e.message==="error")console.error(e.log),e.error&&console.error(e.error);else if(e.message==="ready")this._declareLMLayerReady(t.data.configuration);else if(e.message==="suggestions")this._predictPromises.keep(e.token,e.suggestions);else if(e.message==="currentword")this._wordbreakPromises.keep(e.token,e.word);else if(e.message==="postaccept")this._acceptPromises.keep(e.token,e.reversion);else if(e.message==="postrevert")this._revertPromises.keep(e.token,e.suggestions);else throw new Error("Message not implemented: ".concat(e.message))},i.prototype.shutdown=function(){this._worker.terminate()},i}(),En=ql;function Et(i){return i}var oi='"use strict";/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){"use strict";var L=function(){try{var P={},E=Object.defineProperty,C=E(P,P,P)&&E}catch(M){}return C}(),_=function(P){if(this==null)throw TypeError();var E=String(this),C=E.length,M=P?Number(P):0;if(M!=M&&(M=0),!(M<0||M>=C)){var F=E.charCodeAt(M),R;return F>=55296&&F<=56319&&C>M+1&&(R=E.charCodeAt(M+1),R>=56320&&R<=57343)?(F-55296)*1024+R-56320+65536:F}};L?L(String.prototype,"codePointAt",{value:_,configurable:!0,writable:!0}):String.prototype.codePointAt=_}(),function(){if(!Array.from){var P=function(C){return C=C.charCodeAt(0),C>=55296&&C<=56319},E=function(C){return C=C.charCodeAt(0),C>=56320&&C<=57343},L=P,_=E;Array.from=function(C){if(Array.isArray(C))return C.slice();if(typeof C=="string"){for(var M=C.split(""),F=[],R;M.length>0;){var W=M.shift();P(W)&&E(M[0]||"")&&(W=W+M.shift(),console.log(W)),F.push(W)}return F}else throw"Unexpected + nonpolyfilled use of Array.from encountered; aborting"}}}(),Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(L){if(this==null)throw new TypeError("this is null or not defined");for(var _=Object(this),P=_.length>>>0,E=arguments[1],C=E>>0,M=C<0?Math.max(P+C,0):Math.min(C,P),F=arguments[2],R=F===void 0?P:F>>0,W=R<0?Math.max(P+R,0):Math.min(R,P);M<W;)_[M]=L,M++;return _}});/**\n* Array.prototype.findIndex() polyfill\n* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/findIndex\n* @license MIT\n*/Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(L){if(this==null)throw new TypeError(\'"this" is null or not defined\');var _=Object(this),P=_.length>>>0;if(typeof L!="function")throw new TypeError("predicate must be a function");for(var E=arguments[1],C=0;C<P;){var M=_[C];if(L.call(E,M,C,_))return C;C++}return-1},configurable:!0,writable:!0}),Array.prototype.includes||(Array.prototype.includes=function(L){return!!~this.indexOf(L)}),Object.keys||(Object.keys=function(){"use strict";var L=Object.prototype.hasOwnProperty,_=!{toString:null}.propertyIsEnumerable("toString"),P=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],E=P.length;return function(C){if(typeof C!="function"&&(typeof C!="object"||C===null))throw new TypeError("Object.keys called on non-object");var M=[],F,R;for(F in C)L.call(C,F)&&M.push(F);if(_)for(R=0;R<E;R++)L.call(C,P[R])&&M.push(P[R]);return M}}());var reduce=Function.bind.call(Function.call,Array.prototype.reduce),isEnumerable=Function.bind.call(Function.call,Object.prototype.propertyIsEnumerable),concat=Function.bind.call(Function.call,Array.prototype.concat),keys=Object.keys;Object.values||(Object.values=function(_){return reduce(keys(_),function(P,E){return concat(P,typeof E=="string"&&isEnumerable(_,E)?[_[E]]:[])},[])}),Object.entries||(Object.entries=function(_){return reduce(keys(_),function(P,E){return concat(P,typeof E=="string"&&isEnumerable(_,E)?[[E,_[E]]]:[])},[])}),self.Symbol||function(L,_){"use strict";typeof module=="object"&&typeof module.exports=="object"?module.exports=_(L):_(L)}(typeof window!="undefined"?window:self||global,function(L){"use strict";var _=Object.defineProperty,P=Object.defineProperties,E=0,C=[],M=Array.prototype.slice,F=typeof L.ES6=="object"?L.ES6:L.ES6={},R=Array.isArray,W=Object.prototype.toString,Ae=Array.prototype.push,me=function(){},we=function(h){return h},T=function(h){return typeof h=="function"},he=function(){},K=function(h,g){this._array=h,this._flag=g,this._nextIndex=0},X=function(h,g){this._string=h,this._flag=g,this._nextIndex=0},V=function(h){return h!==null&&(typeof h=="object"||typeof h=="function")},z=function(h,g){return P(h,{_description:{value:g},_isSymbol:{value:!0},_id:{value:E++}}),h},le=function(h,g){if(typeof h.length=="number"&&h.length>=0&&typeof g.length=="number"&&g.length>=0){var q=Math.floor(h.length),k=Math.floor(g.length),D=0;for(h.length=q+k;D<k;++D)g.hasOwnProperty(D)&&(h[q+D]=g[D])}},$=function(h,g){if(typeof h!="function"||typeof g!="function")throw new TypeError("Child and Parent must be function type");h.prototype=Object.create(g.prototype),h.prototype.constructor=h},I=function h(g){if(g=g===void 0?"":String(g),this instanceof h)throw new TypeError("Symbol is not a constructor");return z(Object.create(h.prototype),g)};P(I,{for:{value:function(h){h=String(h);for(var g,q=C.length,k=0;k<q;++k)if((g=C[k]).key===h)return g.symbol;return g={key:h,symbol:I(h)},C.push(g),g.symbol},writable:!0,configurable:!0},keyFor:{value:function(h){if(!F.isSymbol(h))throw new TypeError(String(h)+" is not a symbol");for(var g,q=C.length,k=0;k<q;++k)if((g=C[k]).symbol===h)return g.key},writable:!0,configurable:!0},hasInstance:{value:I("Symbol.hasInstance")},isConcatSpreadable:{value:I("Symbol.isConcatSpreadable")},iterator:{value:I("Symbol.iterator")},toStringTag:{value:I("Symbol.toStringTag")}}),I.prototype.toString=function(){return"@@_____"+this._id+"_____"},I.prototype.valueOf=function(){return this},_(he.prototype,I.iterator.toString(),{value:function(){return this},writable:!0,configurable:!0}),$(K,he),$(X,he),_(K.prototype,I.toStringTag.toString(),{value:"Array Iterator",configurable:!0}),_(X.prototype,I.toStringTag.toString(),{value:"String Iterator",configurable:!0}),K.prototype.next=function(){if(!(this instanceof K))throw new TypeError("Method Array Iterator.prototype.next called on incompatible receiver "+String(this));var h;return this._nextIndex===-1?{done:!0,value:void 0}:typeof this._array.length=="number"&&this._array.length>=0&&this._nextIndex<Math.floor(this._array.length)?(this._flag===1?h=[this._nextIndex,this._array[this._nextIndex]]:this._flag===2?h=this._array[this._nextIndex]:this._flag===3&&(h=this._nextIndex),this._nextIndex++,{done:!1,value:h}):(this._nextIndex=-1,{done:!0,value:void 0})},X.prototype.next=function(){if(!(this instanceof X))throw new TypeError("Method String Iterator.prototype.next called on incompatible receiver "+String(this));var h,g=new String(this._string);return this._nextIndex===-1?{done:!0,value:void 0}:this._nextIndex<g.length?(h=g[this._nextIndex],this._nextIndex++,{done:!1,value:h}):(this._nextIndex=-1,{done:!0,value:void 0})};var Y=function(h,g){this._target=h,this._values=[],this._thisArg=g};return Y.prototype.spread=function(){var h=this;return M.call(arguments).forEach(function(g){F.forOf(g,function(q){h._values.push(q)})}),h},Y.prototype.add=function(){var h=this;return M.call(arguments).forEach(function(g){h._values.push(g)}),h},Y.prototype.call=function(h){if(typeof this._target!="function")throw new TypeError("Target is not a function");return h=arguments.length<=0?this._thisArg:h,this._target.apply(h,this._values)},Y.prototype.new=function(){if(typeof this._target!="function")throw new TypeError("Target is not a constructor");var h,g;return h=Object.create(this._target.prototype),g=this._target.apply(h,this._values),V(g)?g:h},Y.prototype.array=function(){if(!R(this._target))throw new TypeError("Target is not a array");return Ae.apply(this._target,this._values),this._target},P(F,{isSymbol:{value:function(h){return h instanceof I&&function(g){return g._isSymbol===!0&&typeof g._id=="number"&&typeof g._description=="string"}(h)},writable:!0,configurable:!0},instanceOf:{value:function(h,g){if(!V(g))throw new TypeError("Right-hand side of \'instanceof\' is not an object");var q=g[I.hasInstance];if(q===void 0)return h instanceof g;if(typeof q!="function")throw new TypeError(typeof q+" is not a function");return q.call(g,h)},writable:!0,configurable:!0},forOf:{value:function(h,g,q){if(g=typeof g!="function"?me:g,typeof h[I.iterator]!="function")throw new TypeError("Iterable[Symbol.iterator] is not a function");var k,D=h[I.iterator]();if(typeof D.next!="function")throw new TypeError(".iterator.next is not a function");for(;;){if(k=D.next(),!V(k))throw new TypeError("Iterator result "+k+" is not an object");if(k.done)break;g.call(q,k.value)}},writable:!0,configurable:!0},spreadOperator:{value:function(h,g){if(typeof h!="function"&&!R(h))throw new TypeError("Spread operator only supports on array and function objects at this moment");return new Y(h,g)},writable:!0,configurable:!0}}),_(L,"Symbol",{value:I,writable:!0,configurable:!0}),_(Function.prototype,I.hasInstance.toString(),{value:function(h){return typeof this=="function"&&h instanceof this}}),_(Array.prototype,"concat",{value:function(){if(this===void 0||this===null)throw new TypeError("Array.prototype.concat called on null or undefined");var h=Object(this),g=M.call(arguments),q=[];return g.unshift(h),g.forEach(function(k){V(k)?k[I.isConcatSpreadable]!==void 0?k[I.isConcatSpreadable]?le(q,k):q.push(k):R(k)?le(q,k):q.push(k):q.push(k)}),q},writable:!0,configurable:!0}),_(Object.prototype,"toString",{value:function(){return this===void 0||this===null?W.call(this):typeof this[I.toStringTag]=="string"?"[object "+this[I.toStringTag]+"]":W.call(this)},writable:!0,configurable:!0}),_(Array.prototype,I.iterator.toString(),{value:function(){if(this===void 0||this===null)throw new TypeError("Cannot convert undefined or null to object");var h=Object(this);return new K(h,2)},writable:!0,configurable:!0}),_(Array,"from",{value:function(h,g,q){var k,D,U,Z=0;if(k=T(this)?this:Array,h==null)throw new TypeError("Cannot convert undefined or null to object");if(h=Object(h),g===void 0)g=we;else if(!T(g))throw new TypeError(g+" is not a function");if(h[I.iterator]===void 0){if(!(typeof h.length=="number"&&h.length>=0))return(U=new k(0)).length=0,U;for(D=Math.floor(h.length),(U=new k(D)).length=D;Z<D;++Z)U[Z]=g.call(q,h[Z])}else(U=new k).length=0,F.forOf(h,function(pe){U.length++,U[U.length-1]=g.call(q,pe)});return U},writable:!0,configurable:!0}),_(Array.prototype,"entries",{value:function(){if(this===void 0||this===null)throw new TypeError("Cannot convert undefined or null to object");var h=Object(this);return new K(h,1)},writable:!0,configurable:!0}),_(Array.prototype,"keys",{value:function(){if(this===void 0||this===null)throw new TypeError("Cannot convert undefined or null to object");var h=Object(this);return new K(h,3)},writable:!0,configurable:!0}),_(String.prototype,I.iterator.toString(),{value:function(){if(this===void 0||this===null)throw new TypeError("String.prototype[Symbol.iterator] called on null or undefined");return new X(String(this),0)},writable:!0,configurable:!0}),F}),function(){var L=Object.create,_=Object.defineProperty,P=Object.getOwnPropertyDescriptor,E=Object.getOwnPropertyNames,C=Object.getPrototypeOf,M=Object.prototype.hasOwnProperty,F=function(r,e){return function(){return e||(0,r[E(r)[0]])((e={exports:{}}).exports,e),e.exports}},R=function(r,e){for(var t in e)_(r,t,{get:e[t],enumerable:!0})},W=function(r,e,t,n){if(e&&typeof e=="object"||typeof e=="function")for(var i=E(e),a=0,l=i.length,o;a<l;a++)o=i[a],!M.call(r,o)&&o!==t&&_(r,o,{get:function(s){return e[s]}.bind(null,o),enumerable:!(n=P(e,o))||n.enumerable});return r},Ae=function(r,e,t){return W(r,e,"default"),t&&W(t,e,"default")},me=function(r,e,t){return t=r!=null?L(C(r)):{},W(e||!r||!r.__esModule?_(t,"default",{value:r,enumerable:!0}):t,r)},we=F({"../../../node_modules/tslib/tslib.js":function(r,e){var t,n,i,a,l;(function(o){var s=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(c){o(u(s,u(c)))}):typeof e=="object"&&typeof e.exports=="object"?o(u(s,u(e.exports))):o(u(s));function u(c,f){return c!==s&&(typeof Object.create=="function"?Object.defineProperty(c,"__esModule",{value:!0}):c.__esModule=!0),function(v,p){return c[v]=f?f(v,p):p}}})(function(o){var s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,c){u.__proto__=c}||function(u,c){for(var f in c)Object.prototype.hasOwnProperty.call(c,f)&&(u[f]=c[f])};t=function(u,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");s(u,c);function f(){this.constructor=u}u.prototype=c===null?Object.create(c):(f.prototype=c.prototype,new f)},n=Object.assign||function(u){for(var c,f=1,v=arguments.length;f<v;f++){c=arguments[f];for(var p in c)Object.prototype.hasOwnProperty.call(c,p)&&(u[p]=c[p])}return u},i=function(u,c){var f={label:0,sent:function(){if(d[0]&1)throw d[1];return d[1]},trys:[],ops:[]},v,p,d,m;return m={next:b(0),throw:b(1),return:b(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function b(y){return function(S){return A([y,S])}}function A(y){if(v)throw new TypeError("Generator is already executing.");for(;m&&(m=0,y[0]&&(f=0)),f;)try{if(v=1,p&&(d=y[0]&2?p.return:y[0]?p.throw||((d=p.return)&&d.call(p),0):p.next)&&!(d=d.call(p,y[1])).done)return d;switch(p=0,d&&(y=[y[0]&2,d.value]),y[0]){case 0:case 1:d=y;break;case 4:return f.label++,{value:y[1],done:!1};case 5:f.label++,p=y[1],y=[0];continue;case 7:y=f.ops.pop(),f.trys.pop();continue;default:if(d=f.trys,!(d=d.length>0&&d[d.length-1])&&(y[0]===6||y[0]===2)){f=0;continue}if(y[0]===3&&(!d||y[1]>d[0]&&y[1]<d[3])){f.label=y[1];break}if(y[0]===6&&f.label<d[1]){f.label=d[1],d=y;break}if(d&&f.label<d[2]){f.label=d[2],f.ops.push(y);break}d[2]&&f.ops.pop(),f.trys.pop();continue}y=c.call(u,f)}catch(S){y=[6,S],p=0}finally{v=d=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}},a=function(u){var c=typeof Symbol=="function"&&Symbol.iterator,f=c&&u[c],v=0;if(f)return f.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&v>=u.length&&(u=void 0),{value:u&&u[v++],done:!u}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")},l=function(u,c){var f=typeof Symbol=="function"&&u[Symbol.iterator];if(!f)return u;var v=f.call(u),p,d=[],m;try{for(;(c===void 0||c-- >0)&&!(p=v.next()).done;)d.push(p.value)}catch(b){m={error:b}}finally{try{p&&!p.done&&(f=v.return)&&f.call(v)}finally{if(m)throw m.error}}return d},o("__extends",t),o("__assign",n),o("__generator",i),o("__values",a),o("__read",l)})}}),T={};R(T,{tslib:function(){return he}}),Ae(T,me(we(),1));var he=me(we(),1);function K(){String.kmwFromCharCode=function(r){var e=[],t;for(t=0;t<arguments.length;t++){var n=Number(arguments[t]);if(!isFinite(n)||n<0||n>1114111||Math.floor(n)!==n)throw new RangeError("Invalid code point "+n);n<65536?e.push(n):(n-=65536,e.push((n>>10)+55296),e.push(n%1024+56320))}return String.fromCharCode.apply(void 0,e)},String.prototype.kmwCharCodeAt=function(r){var e=String(this),t=0;if(r<0||r>=e.length)return NaN;for(var n=0;n<r;n++)if(t=e.kmwNextChar(t),t===null)return NaN;var i=e.charCodeAt(t);if(i>=55296&&i<=56319&&e.length>t+1){var a=e.charCodeAt(t+1);if(a>=56320&&a<=57343)return(i-55296<<10)+(a-56320)+65536}return i},String.prototype.kmwIndexOf=function(r,e){var t=String(this),n=t.indexOf(r,e);if(n<0)return n;for(var i=0,a=0;a!==null&&a<n;a=t.kmwNextChar(a))i++;return i},String.prototype.kmwLastIndexOf=function(r,e){var t=String(this),n=t.lastIndexOf(r,e);if(n<0)return n;for(var i=0,a=0;a!==null&&a<n;a=t.kmwNextChar(a))i++;return i},String.prototype.kmwLength=function(){var r=String(this);if(r.length==0)return 0;for(var e=0,t=0;t!==null;e++)t=r.kmwNextChar(t);return e},String.prototype.kmwSlice=function(r,e){var t=String(this),n=t.kmwCodePointToCodeUnit(r),i=t.kmwCodePointToCodeUnit(e);return n===null||i===null?"":t.slice(n,i)},String.prototype.kmwSubstr=function(r,e){var t=String(this);r<0&&(r=t.kmwLength()+r),r<0&&(r=0);var n=t.kmwCodePointToCodeUnit(r),i=n;if(n===null)return"";if(arguments.length<2)i=t.length;else for(var a=0;a<e;a++)i=t.kmwNextChar(i);return i===null?t.substring(n):t.substring(n,i)},String.prototype.kmwSubstring=function(r,e){var t=String(this),n,i;if(typeof e=="undefined")n=t.kmwCodePointToCodeUnit(r),i=t.length;else{if(r>e){var a=r;r=e,e=a}n=t.kmwCodePointToCodeUnit(r),i=t.kmwCodePointToCodeUnit(e)}return(isNaN(n)||n===null)&&(n=0),(isNaN(i)||i===null)&&(i=t.length),t.substring(n,i)},String.prototype.kmwNextChar=function(r){var e=String(this);if(r===null||r<0||r>=e.length-1)return null;var t=e.charCodeAt(r);if(t>=55296&&t<=56319&&e.length>r+1){var n=e.charCodeAt(r+1);if(n>=56320&&n<=57343)return r==e.length-2?null:r+2}return r+1},String.prototype.kmwPrevChar=function(r){var e=String(this);if(r==null||r<=0||r>e.length)return null;var t=e.charCodeAt(r-1);if(t>=56320&&t<=57343&&r>1){var n=e.charCodeAt(r-2);if(n>=55296&&n<=56319)return r-2}return r-1},String.prototype.kmwCodePointToCodeUnit=function(r){if(r===null)return null;var e=String(this),t=0;if(r<0){t=e.length;for(var n=0;n>r;n--)t=e.kmwPrevChar(t);return t}if(r==e.kmwLength())return e.length;for(var n=0;n<r;n++)t=e.kmwNextChar(t);return t},String.prototype.kmwCodeUnitToCodePoint=function(r){var e=String(this);return r===null?null:r==0?0:r<0?e.substr(r).kmwLength():e.substr(0,r).kmwLength()},String.prototype.kmwCharAt=function(r){var e=String(this);return r>=0?e.kmwSubstr(r,1):""},String.prototype.kmwBMPNextChar=function(r){var e=String(this);return r<0||r>=e.length-1?null:r+1},String.prototype.kmwBMPPrevChar=function(r){var e=String(this);return r<=0||r>e.length?null:r-1},String.prototype.kmwBMPCodePointToCodeUnit=function(r){return r},String.prototype.kmwBMPCodeUnitToCodePoint=function(r){return r},String.prototype.kmwBMPLength=function(){var r=String(this);return r.length},String.prototype.kmwBMPSubstr=function(r,e){var t=String(this);return r>-1?t.substr(r,e):t.substr(t.length+r,-r)},String.kmwEnableSupplementaryPlane=function(r){var e=String.prototype;String._kmwFromCharCode=r?String.kmwFromCharCode:String.fromCharCode,e._kmwCharAt=r?e.kmwCharAt:e.charAt,e._kmwCharCodeAt=r?e.kmwCharCodeAt:e.charCodeAt,e._kmwIndexOf=r?e.kmwIndexOf:e.indexOf,e._kmwLastIndexOf=r?e.kmwLastIndexOf:e.lastIndexOf,e._kmwSlice=r?e.kmwSlice:e.slice,e._kmwSubstring=r?e.kmwSubstring:e.substring,e._kmwSubstr=r?e.kmwSubstr:e.kmwBMPSubstr,e._kmwLength=r?e.kmwLength:e.kmwBMPLength,e._kmwNextChar=r?e.kmwNextChar:e.kmwBMPNextChar,e._kmwPrevChar=r?e.kmwPrevChar:e.kmwBMPPrevChar,e._kmwCodePointToCodeUnit=r?e.kmwCodePointToCodeUnit:e.kmwBMPCodePointToCodeUnit,e._kmwCodeUnitToCodePoint=r?e.kmwCodeUnitToCodePoint:e.kmwBMPCodeUnitToCodePoint},String._kmwFromCharCode||String.kmwEnableSupplementaryPlane(!1)}K();var X={};R(X,{DummyModel:function(){return vt},PriorityQueue:function(){return k},QuoteBehavior:function(){return U},SENTINEL_CODE_UNIT:function(){return V},TrieModel:function(){return lt},applyTransform:function(){return z},buildMergedTransform:function(){return le},defaultApplyCasing:function(){return g},getLastPreCaretToken:function(){return pe},isHighSurrogate:function(){return $},isLowSurrogate:function(){return I},isSentinel:function(){return Y},tokenize:function(){return Z},transformToSuggestion:function(){return h},wordbreak:function(){return Oe}}),K();var V="\\uFDD0";function z(r,e){var t,n,i=e.left||"",a=i.kmwLength(),l=a<r.deleteLeft?a:r.deleteLeft,o=i.kmwSubstr(0,a-l)+(r.insert||""),s=e.right||"",u=s.kmwLength(),c=u<((t=r.deleteRight)!==null&&t!==void 0?t:0)?u:(n=r.deleteRight)!==null&&n!==void 0?n:0,f=s.kmwSubstr(c);return{left:o,right:f,startOfBuffer:e.startOfBuffer,endOfBuffer:e.endOfBuffer,casingForm:e.casingForm}}function le(r,e){var t=r.insert,n=e.deleteLeft;if(e.deleteLeft){var i=r.insert.kmwLength();i<=e.deleteLeft?(t="",n=e.deleteLeft-i):(t=r.insert.kmwSubstr(0,i-e.deleteLeft),n=0)}return{insert:t+e.insert,deleteLeft:r.deleteLeft+n,deleteRight:(r.deleteRight||0)+(e.deleteRight||0)}}function $(r){return typeof r=="string"&&(r=r.charCodeAt(0)),r>=55296&&r<=56319}function I(r){return typeof r=="string"&&(r=r.charCodeAt(0)),r>=56320&&r<=57343}function Y(r){return r==V}function h(r,e){var t={transform:r,transformId:r.id,displayAs:r.insert};return(e===0||e)&&(t.p=e),t}function g(r,e){switch(r){case"lower":return e.toLowerCase();case"upper":return e.toUpperCase();case"initial":var t=1;return e.length>1&&$(e.charAt(0))&&I(e.charCodeAt(1))&&(t=2),e.substring(0,t).toUpperCase().concat(e.substring(t))}}var q=function(){function r(e,t){if(typeof e!="function"){this.comparator=e.comparator,this.heap=[].concat(e.heap);return}var n=e;this.comparator=n,this.heap=(t!=null?t:[]).slice(0),this.heapify()}return r.leftChildIndex=function(e){return e*2+1},r.rightChildIndex=function(e){return e*2+2},r.parentIndex=function(e){return Math.floor((e-1)/2)},r.prototype.heapify=function(e,t){if(e==null||t==null){this.heapify(0,this.count-1);return}for(var n=[],i=-1,a=t;a>=e;a--){var l=r.parentIndex(a);this.siftDown(a)&&l<e&&i!=l&&(n.push(l),i=l)}for(i=-1;n.length>0;){var o=n.shift(),l=r.parentIndex(o);this.siftDown(o)&&l>=0&&i!=l&&(n.push(l),i=l)}},Object.defineProperty(r.prototype,"count",{get:function(){return this.heap.length},enumerable:!1,configurable:!0}),r.prototype.peek=function(){return this.heap[0]},r.prototype.enqueue=function(e){var t=this.heap.length;this.heap.push(e);for(var n=r.parentIndex,i=n(t);t!==0&&this.comparator(this.heap[t],this.heap[i])<0;){var a=this.heap[t];this.heap[t]=this.heap[i],this.heap[i]=a,t=i,i=n(t)}},r.prototype.enqueueAll=function(e){if(e.length!=0){var t=this.count;this.heap=this.heap.concat(e);var n=r.parentIndex(t);this.heapify(n>=0?n:0,r.parentIndex(this.count-1))}},r.prototype.dequeue=function(){if(this.count!=0){var e=this.heap[0],t=this.heap.pop();return this.heap.length>0&&(this.heap[0]=t,this.siftDown(0)),e}},r.prototype.siftDown=function(e){var t=r.leftChildIndex(e),n=r.rightChildIndex(e),i=e;if(t<this.heap.length&&this.comparator(this.heap[t],this.heap[i])<0&&(i=t),n<this.heap.length&&this.comparator(this.heap[n],this.heap[i])<0&&(i=n),i!=e){var a=this.heap[e];return this.heap[e]=this.heap[i],this.heap[i]=a,this.siftDown(i),!0}else return!1},r.prototype.toArray=function(){return this.heap.slice(0)},r}(),k=q,D;(function(r){r.noQuotes="no-quotes",r.useQuotes="use-quotes",r.default="default-quotes"})(D||(D={})),function(r){function e(t,n,i,a){if(a==r.default||!a)throw"Specified quote behavior may be ambiguous - default behavior not specified (may not be .default)";switch(t==r.default&&(t=a),t){case r.noQuotes:return n;case r.useQuotes:var l=i.quotesForKeepSuggestion,o=l.open,s=l.close;return o+n+s;default:throw"Unsupported quote behavior state detected; implementation missing!"}}r.apply=e}(D||(D={}));var U=D;function Z(r,e){e=e||{left:void 0,startOfBuffer:void 0,endOfBuffer:void 0};var t=r(e.left||"")||[],n=r(e.right||"")||[],i;if(t.length>0&&(i=t[t.length-1]),t.length>1){var a=t[t.length-2];if(a.end==i.start&&i.text=="\'"){var l={text:a.text+i.text,start:a.start,end:i.end,length:a.length+i.length};t.pop(),t.pop(),t.push(l),i=l}}var o={left:t.map(function(f){return f.text}),right:n.map(function(f){return f.text}),caretSplitsToken:!1};if(t.length>0&&n.length>0){var s=n[0],u=i.end!=e.left.length,c=s.start!=0;if(u||c)return o;r(i.text+s.text).length==1&&(o.caretSplitsToken=!0)}return o}function pe(r,e){var t=Z(r,e);return t.left.length>0?t.left.pop():""}function Oe(r,e){return pe(r,e)}var Pe={};R(Pe,{ascii:function(){return tt},default:function(){return ce},defaultWordbreaker:function(){return ce},placeholder:function(){return et}});function et(r){var e=0;return r.split(/\\s+/).map(function(t){var n={start:e,end:e+t.length,text:t,length:t.length};return e=n.end,n})}function tt(r){for(var e=/[A-Za-z0-9\']+/g,t=[],n;(n=e.exec(r))!==null;)t.push(new rt(n[0],n.index));return t}var rt=function(){function r(e,t){this.text=e,this.start=t}return Object.defineProperty(r.prototype,"length",{get:function(){return this.text.length},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"end",{get:function(){return this.start+this.text.length},enumerable:!1,configurable:!0}),r}(),nt=["Other","LF","Newline","CR","WSegSpace","Double_Quote","Single_Quote","MidNum","MidNumLet","Numeric","MidLetter","ALetter","ExtendNumLet","Format","Extend","Hebrew_Letter","ZWJ","Katakana","Regional_Indicator","sot","eot"],Me=[[0,0],[10,1],[11,2],[13,3],[14,0],[32,4],[33,0],[34,5],[35,0],[39,6],[40,0],[44,7],[45,0],[46,8],[47,0],[48,9],[58,10],[59,7],[60,0],[65,11],[91,0],[95,12],[96,0],[97,11],[123,0],[133,2],[134,0],[170,11],[171,0],[173,13],[174,0],[181,11],[182,0],[183,10],[184,0],[186,11],[187,0],[192,11],[215,0],[216,11],[247,0],[248,11],[728,0],[734,11],[768,14],[880,11],[885,0],[886,11],[888,0],[890,11],[894,7],[895,11],[896,0],[902,11],[903,10],[904,11],[907,0],[908,11],[909,0],[910,11],[930,0],[931,11],[1014,0],[1015,11],[1154,0],[1155,14],[1162,11],[1328,0],[1329,11],[1367,0],[1369,11],[1373,0],[1374,11],[1375,10],[1376,11],[1417,7],[1418,11],[1419,0],[1425,14],[1470,0],[1471,14],[1472,0],[1473,14],[1475,0],[1476,14],[1478,0],[1479,14],[1480,0],[1488,15],[1515,0],[1519,15],[1523,11],[1524,10],[1525,0],[1536,13],[1542,0],[1548,7],[1550,0],[1552,14],[1563,0],[1564,13],[1565,0],[1568,11],[1611,14],[1632,9],[1642,0],[1643,9],[1644,7],[1645,0],[1646,11],[1648,14],[1649,11],[1748,0],[1749,11],[1750,14],[1757,13],[1758,0],[1759,14],[1765,11],[1767,14],[1769,0],[1770,14],[1774,11],[1776,9],[1786,11],[1789,0],[1791,11],[1792,0],[1807,13],[1808,11],[1809,14],[1810,11],[1840,14],[1867,0],[1869,11],[1958,14],[1969,11],[1970,0],[1984,9],[1994,11],[2027,14],[2036,11],[2038,0],[2040,7],[2041,0],[2042,11],[2043,0],[2045,14],[2046,0],[2048,11],[2070,14],[2074,11],[2075,14],[2084,11],[2085,14],[2088,11],[2089,14],[2094,0],[2112,11],[2137,14],[2140,0],[2144,11],[2155,0],[2208,11],[2229,0],[2230,11],[2248,0],[2259,14],[2274,13],[2275,14],[2308,11],[2362,14],[2365,11],[2366,14],[2384,11],[2385,14],[2392,11],[2402,14],[2404,0],[2406,9],[2416,0],[2417,11],[2433,14],[2436,0],[2437,11],[2445,0],[2447,11],[2449,0],[2451,11],[2473,0],[2474,11],[2481,0],[2482,11],[2483,0],[2486,11],[2490,0],[2492,14],[2493,11],[2494,14],[2501,0],[2503,14],[2505,0],[2507,14],[2510,11],[2511,0],[2519,14],[2520,0],[2524,11],[2526,0],[2527,11],[2530,14],[2532,0],[2534,9],[2544,11],[2546,0],[2556,11],[2557,0],[2558,14],[2559,0],[2561,14],[2564,0],[2565,11],[2571,0],[2575,11],[2577,0],[2579,11],[2601,0],[2602,11],[2609,0],[2610,11],[2612,0],[2613,11],[2615,0],[2616,11],[2618,0],[2620,14],[2621,0],[2622,14],[2627,0],[2631,14],[2633,0],[2635,14],[2638,0],[2641,14],[2642,0],[2649,11],[2653,0],[2654,11],[2655,0],[2662,9],[2672,14],[2674,11],[2677,14],[2678,0],[2689,14],[2692,0],[2693,11],[2702,0],[2703,11],[2706,0],[2707,11],[2729,0],[2730,11],[2737,0],[2738,11],[2740,0],[2741,11],[2746,0],[2748,14],[2749,11],[2750,14],[2758,0],[2759,14],[2762,0],[2763,14],[2766,0],[2768,11],[2769,0],[2784,11],[2786,14],[2788,0],[2790,9],[2800,0],[2809,11],[2810,14],[2816,0],[2817,14],[2820,0],[2821,11],[2829,0],[2831,11],[2833,0],[2835,11],[2857,0],[2858,11],[2865,0],[2866,11],[2868,0],[2869,11],[2874,0],[2876,14],[2877,11],[2878,14],[2885,0],[2887,14],[2889,0],[2891,14],[2894,0],[2901,14],[2904,0],[2908,11],[2910,0],[2911,11],[2914,14],[2916,0],[2918,9],[2928,0],[2929,11],[2930,0],[2946,14],[2947,11],[2948,0],[2949,11],[2955,0],[2958,11],[2961,0],[2962,11],[2966,0],[2969,11],[2971,0],[2972,11],[2973,0],[2974,11],[2976,0],[2979,11],[2981,0],[2984,11],[2987,0],[2990,11],[3002,0],[3006,14],[3011,0],[3014,14],[3017,0],[3018,14],[3022,0],[3024,11],[3025,0],[3031,14],[3032,0],[3046,9],[3056,0],[3072,14],[3077,11],[3085,0],[3086,11],[3089,0],[3090,11],[3113,0],[3114,11],[3130,0],[3133,11],[3134,14],[3141,0],[3142,14],[3145,0],[3146,14],[3150,0],[3157,14],[3159,0],[3160,11],[3163,0],[3168,11],[3170,14],[3172,0],[3174,9],[3184,0],[3200,11],[3201,14],[3204,0],[3205,11],[3213,0],[3214,11],[3217,0],[3218,11],[3241,0],[3242,11],[3252,0],[3253,11],[3258,0],[3260,14],[3261,11],[3262,14],[3269,0],[3270,14],[3273,0],[3274,14],[3278,0],[3285,14],[3287,0],[3294,11],[3295,0],[3296,11],[3298,14],[3300,0],[3302,9],[3312,0],[3313,11],[3315,0],[3328,14],[3332,11],[3341,0],[3342,11],[3345,0],[3346,11],[3387,14],[3389,11],[3390,14],[3397,0],[3398,14],[3401,0],[3402,14],[3406,11],[3407,0],[3412,11],[3415,14],[3416,0],[3423,11],[3426,14],[3428,0],[3430,9],[3440,0],[3450,11],[3456,0],[3457,14],[3460,0],[3461,11],[3479,0],[3482,11],[3506,0],[3507,11],[3516,0],[3517,11],[3518,0],[3520,11],[3527,0],[3530,14],[3531,0],[3535,14],[3541,0],[3542,14],[3543,0],[3544,14],[3552,0],[3558,9],[3568,0],[3570,14],[3572,0],[3633,14],[3634,0],[3636,14],[3643,0],[3655,14],[3663,0],[3664,9],[3674,0],[3761,14],[3762,0],[3764,14],[3773,0],[3784,14],[3790,0],[3792,9],[3802,0],[3840,11],[3841,0],[3864,14],[3866,0],[3872,9],[3882,0],[3893,14],[3894,0],[3895,14],[3896,0],[3897,14],[3898,0],[3902,14],[3904,11],[3912,0],[3913,11],[3949,0],[3953,14],[3973,0],[3974,14],[3976,11],[3981,14],[3992,0],[3993,14],[4029,0],[4038,14],[4039,0],[4139,14],[4159,0],[4160,9],[4170,0],[4182,14],[4186,0],[4190,14],[4193,0],[4194,14],[4197,0],[4199,14],[4206,0],[4209,14],[4213,0],[4226,14],[4238,0],[4239,14],[4240,9],[4250,14],[4254,0],[4256,11],[4294,0],[4295,11],[4296,0],[4301,11],[4302,0],[4304,11],[4347,0],[4348,11],[4681,0],[4682,11],[4686,0],[4688,11],[4695,0],[4696,11],[4697,0],[4698,11],[4702,0],[4704,11],[4745,0],[4746,11],[4750,0],[4752,11],[4785,0],[4786,11],[4790,0],[4792,11],[4799,0],[4800,11],[4801,0],[4802,11],[4806,0],[4808,11],[4823,0],[4824,11],[4881,0],[4882,11],[4886,0],[4888,11],[4955,0],[4957,14],[4960,0],[4992,11],[5008,0],[5024,11],[5110,0],[5112,11],[5118,0],[5121,11],[5741,0],[5743,11],[5760,4],[5761,11],[5787,0],[5792,11],[5867,0],[5870,11],[5881,0],[5888,11],[5901,0],[5902,11],[5906,14],[5909,0],[5920,11],[5938,14],[5941,0],[5952,11],[5970,14],[5972,0],[5984,11],[5997,0],[5998,11],[6001,0],[6002,14],[6004,0],[6068,14],[6100,0],[6109,14],[6110,0],[6112,9],[6122,0],[6155,14],[6158,13],[6159,0],[6160,9],[6170,0],[6176,11],[6265,0],[6272,11],[6277,14],[6279,11],[6313,14],[6314,11],[6315,0],[6320,11],[6390,0],[6400,11],[6431,0],[6432,14],[6444,0],[6448,14],[6460,0],[6470,9],[6480,0],[6608,9],[6618,0],[6656,11],[6679,14],[6684,0],[6741,14],[6751,0],[6752,14],[6781,0],[6783,14],[6784,9],[6794,0],[6800,9],[6810,0],[6832,14],[6849,0],[6912,14],[6917,11],[6964,14],[6981,11],[6988,0],[6992,9],[7002,0],[7019,14],[7028,0],[7040,14],[7043,11],[7073,14],[7086,11],[7088,9],[7098,11],[7142,14],[7156,0],[7168,11],[7204,14],[7224,0],[7232,9],[7242,0],[7245,11],[7248,9],[7258,11],[7294,0],[7296,11],[7305,0],[7312,11],[7355,0],[7357,11],[7360,0],[7376,14],[7379,0],[7380,14],[7401,11],[7405,14],[7406,11],[7412,14],[7413,11],[7415,14],[7418,11],[7419,0],[7424,11],[7616,14],[7674,0],[7675,14],[7680,11],[7958,0],[7960,11],[7966,0],[7968,11],[8006,0],[8008,11],[8014,0],[8016,11],[8024,0],[8025,11],[8026,0],[8027,11],[8028,0],[8029,11],[8030,0],[8031,11],[8062,0],[8064,11],[8117,0],[8118,11],[8125,0],[8126,11],[8127,0],[8130,11],[8133,0],[8134,11],[8141,0],[8144,11],[8148,0],[8150,11],[8156,0],[8160,11],[8173,0],[8178,11],[8181,0],[8182,11],[8189,0],[8192,4],[8199,0],[8200,4],[8203,0],[8204,14],[8205,16],[8206,13],[8208,0],[8216,8],[8218,0],[8228,8],[8229,0],[8231,10],[8232,2],[8234,13],[8239,12],[8240,0],[8255,12],[8257,0],[8260,7],[8261,0],[8276,12],[8277,0],[8287,4],[8288,13],[8293,0],[8294,13],[8304,0],[8305,11],[8306,0],[8319,11],[8320,0],[8336,11],[8349,0],[8400,14],[8433,0],[8450,11],[8451,0],[8455,11],[8456,0],[8458,11],[8468,0],[8469,11],[8470,0],[8473,11],[8478,0],[8484,11],[8485,0],[8486,11],[8487,0],[8488,11],[8489,0],[8490,11],[8494,0],[8495,11],[8506,0],[8508,11],[8512,0],[8517,11],[8522,0],[8526,11],[8527,0],[8544,11],[8585,0],[9398,11],[9450,0],[11264,11],[11311,0],[11312,11],[11359,0],[11360,11],[11493,0],[11499,11],[11503,14],[11506,11],[11508,0],[11520,11],[11558,0],[11559,11],[11560,0],[11565,11],[11566,0],[11568,11],[11624,0],[11631,11],[11632,0],[11647,14],[11648,11],[11671,0],[11680,11],[11687,0],[11688,11],[11695,0],[11696,11],[11703,0],[11704,11],[11711,0],[11712,11],[11719,0],[11720,11],[11727,0],[11728,11],[11735,0],[11736,11],[11743,0],[11744,14],[11776,0],[11823,11],[11824,0],[12288,4],[12289,0],[12293,11],[12294,0],[12330,14],[12336,0],[12337,17],[12342,0],[12347,11],[12349,0],[12441,14],[12443,17],[12445,0],[12448,17],[12539,0],[12540,17],[12544,0],[12549,11],[12592,0],[12593,11],[12687,0],[12704,11],[12736,0],[12784,17],[12800,0],[13008,17],[13055,0],[13056,17],[13144,0],[40960,11],[42125,0],[42192,11],[42238,0],[42240,11],[42509,0],[42512,11],[42528,9],[42538,11],[42540,0],[42560,11],[42607,14],[42611,0],[42612,14],[42622,0],[42623,11],[42654,14],[42656,11],[42736,14],[42738,0],[42760,11],[42944,0],[42946,11],[42955,0],[42997,11],[43010,14],[43011,11],[43014,14],[43015,11],[43019,14],[43020,11],[43043,14],[43048,0],[43052,14],[43053,0],[43072,11],[43124,0],[43136,14],[43138,11],[43188,14],[43206,0],[43216,9],[43226,0],[43232,14],[43250,11],[43256,0],[43259,11],[43260,0],[43261,11],[43263,14],[43264,9],[43274,11],[43302,14],[43310,0],[43312,11],[43335,14],[43348,0],[43360,11],[43389,0],[43392,14],[43396,11],[43443,14],[43457,0],[43471,11],[43472,9],[43482,0],[43493,14],[43494,0],[43504,9],[43514,0],[43520,11],[43561,14],[43575,0],[43584,11],[43587,14],[43588,11],[43596,14],[43598,0],[43600,9],[43610,0],[43643,14],[43646,0],[43696,14],[43697,0],[43698,14],[43701,0],[43703,14],[43705,0],[43710,14],[43712,0],[43713,14],[43714,0],[43744,11],[43755,14],[43760,0],[43762,11],[43765,14],[43767,0],[43777,11],[43783,0],[43785,11],[43791,0],[43793,11],[43799,0],[43808,11],[43815,0],[43816,11],[43823,0],[43824,11],[43882,0],[43888,11],[44003,14],[44011,0],[44012,14],[44014,0],[44016,9],[44026,0],[44032,11],[55204,0],[55216,11],[55239,0],[55243,11],[55292,0],[64256,11],[64263,0],[64275,11],[64280,0],[64285,15],[64286,14],[64287,15],[64297,0],[64298,15],[64311,0],[64312,15],[64317,0],[64318,15],[64319,0],[64320,15],[64322,0],[64323,15],[64325,0],[64326,15],[64336,11],[64434,0],[64467,11],[64830,0],[64848,11],[64912,0],[64914,11],[64968,0],[65008,11],[65020,0],[65024,14],[65040,7],[65041,0],[65043,10],[65044,7],[65045,0],[65056,14],[65072,0],[65075,12],[65077,0],[65101,12],[65104,7],[65105,0],[65106,8],[65107,0],[65108,7],[65109,10],[65110,0],[65136,11],[65141,0],[65142,11],[65277,0],[65279,13],[65280,0],[65287,8],[65288,0],[65292,7],[65293,0],[65294,8],[65295,0],[65296,9],[65306,10],[65307,7],[65308,0],[65313,11],[65339,0],[65343,12],[65344,0],[65345,11],[65371,0],[65382,17],[65438,14],[65440,11],[65471,0],[65474,11],[65480,0],[65482,11],[65488,0],[65490,11],[65496,0],[65498,11],[65501,0],[65529,13],[65532,0],[65536,11],[65548,0],[65549,11],[65575,0],[65576,11],[65595,0],[65596,11],[65598,0],[65599,11],[65614,0],[65616,11],[65630,0],[65664,11],[65787,0],[65856,11],[65909,0],[66045,14],[66046,0],[66176,11],[66205,0],[66208,11],[66257,0],[66272,14],[66273,0],[66304,11],[66336,0],[66349,11],[66379,0],[66384,11],[66422,14],[66427,0],[66432,11],[66462,0],[66464,11],[66500,0],[66504,11],[66512,0],[66513,11],[66518,0],[66560,11],[66718,0],[66720,9],[66730,0],[66736,11],[66772,0],[66776,11],[66812,0],[66816,11],[66856,0],[66864,11],[66916,0],[67072,11],[67383,0],[67392,11],[67414,0],[67424,11],[67432,0],[67584,11],[67590,0],[67592,11],[67593,0],[67594,11],[67638,0],[67639,11],[67641,0],[67644,11],[67645,0],[67647,11],[67670,0],[67680,11],[67703,0],[67712,11],[67743,0],[67808,11],[67827,0],[67828,11],[67830,0],[67840,11],[67862,0],[67872,11],[67898,0],[67968,11],[68024,0],[68030,11],[68032,0],[68096,11],[68097,14],[68100,0],[68101,14],[68103,0],[68108,14],[68112,11],[68116,0],[68117,11],[68120,0],[68121,11],[68150,0],[68152,14],[68155,0],[68159,14],[68160,0],[68192,11],[68221,0],[68224,11],[68253,0],[68288,11],[68296,0],[68297,11],[68325,14],[68327,0],[68352,11],[68406,0],[68416,11],[68438,0],[68448,11],[68467,0],[68480,11],[68498,0],[68608,11],[68681,0],[68736,11],[68787,0],[68800,11],[68851,0],[68864,11],[68900,14],[68904,0],[68912,9],[68922,0],[69248,11],[69290,0],[69291,14],[69293,0],[69296,11],[69298,0],[69376,11],[69405,0],[69415,11],[69416,0],[69424,11],[69446,14],[69457,0],[69552,11],[69573,0],[69600,11],[69623,0],[69632,14],[69635,11],[69688,14],[69703,0],[69734,9],[69744,0],[69759,14],[69763,11],[69808,14],[69819,0],[69821,13],[69822,0],[69837,13],[69838,0],[69840,11],[69865,0],[69872,9],[69882,0],[69888,14],[69891,11],[69927,14],[69941,0],[69942,9],[69952,0],[69956,11],[69957,14],[69959,11],[69960,0],[69968,11],[70003,14],[70004,0],[70006,11],[70007,0],[70016,14],[70019,11],[70067,14],[70081,11],[70085,0],[70089,14],[70093,0],[70094,14],[70096,9],[70106,11],[70107,0],[70108,11],[70109,0],[70144,11],[70162,0],[70163,11],[70188,14],[70200,0],[70206,14],[70207,0],[70272,11],[70279,0],[70280,11],[70281,0],[70282,11],[70286,0],[70287,11],[70302,0],[70303,11],[70313,0],[70320,11],[70367,14],[70379,0],[70384,9],[70394,0],[70400,14],[70404,0],[70405,11],[70413,0],[70415,11],[70417,0],[70419,11],[70441,0],[70442,11],[70449,0],[70450,11],[70452,0],[70453,11],[70458,0],[70459,14],[70461,11],[70462,14],[70469,0],[70471,14],[70473,0],[70475,14],[70478,0],[70480,11],[70481,0],[70487,14],[70488,0],[70493,11],[70498,14],[70500,0],[70502,14],[70509,0],[70512,14],[70517,0],[70656,11],[70709,14],[70727,11],[70731,0],[70736,9],[70746,0],[70750,14],[70751,11],[70754,0],[70784,11],[70832,14],[70852,11],[70854,0],[70855,11],[70856,0],[70864,9],[70874,0],[71040,11],[71087,14],[71094,0],[71096,14],[71105,0],[71128,11],[71132,14],[71134,0],[71168,11],[71216,14],[71233,0],[71236,11],[71237,0],[71248,9],[71258,0],[71296,11],[71339,14],[71352,11],[71353,0],[71360,9],[71370,0],[71453,14],[71468,0],[71472,9],[71482,0],[71680,11],[71724,14],[71739,0],[71840,11],[71904,9],[71914,0],[71935,11],[71943,0],[71945,11],[71946,0],[71948,11],[71956,0],[71957,11],[71959,0],[71960,11],[71984,14],[71990,0],[71991,14],[71993,0],[71995,14],[71999,11],[72e3,14],[72001,11],[72002,14],[72004,0],[72016,9],[72026,0],[72096,11],[72104,0],[72106,11],[72145,14],[72152,0],[72154,14],[72161,11],[72162,0],[72163,11],[72164,14],[72165,0],[72192,11],[72193,14],[72203,11],[72243,14],[72250,11],[72251,14],[72255,0],[72263,14],[72264,0],[72272,11],[72273,14],[72284,11],[72330,14],[72346,0],[72349,11],[72350,0],[72384,11],[72441,0],[72704,11],[72713,0],[72714,11],[72751,14],[72759,0],[72760,14],[72768,11],[72769,0],[72784,9],[72794,0],[72818,11],[72848,0],[72850,14],[72872,0],[72873,14],[72887,0],[72960,11],[72967,0],[72968,11],[72970,0],[72971,11],[73009,14],[73015,0],[73018,14],[73019,0],[73020,14],[73022,0],[73023,14],[73030,11],[73031,14],[73032,0],[73040,9],[73050,0],[73056,11],[73062,0],[73063,11],[73065,0],[73066,11],[73098,14],[73103,0],[73104,14],[73106,0],[73107,14],[73112,11],[73113,0],[73120,9],[73130,0],[73440,11],[73459,14],[73463,0],[73648,11],[73649,0],[73728,11],[74650,0],[74752,11],[74863,0],[74880,11],[75076,0],[77824,11],[78895,0],[78896,13],[78905,0],[82944,11],[83527,0],[92160,11],[92729,0],[92736,11],[92767,0],[92768,9],[92778,0],[92880,11],[92910,0],[92912,14],[92917,0],[92928,11],[92976,14],[92983,0],[92992,11],[92996,0],[93008,9],[93018,0],[93027,11],[93048,0],[93053,11],[93072,0],[93760,11],[93824,0],[93952,11],[94027,0],[94031,14],[94032,11],[94033,14],[94088,0],[94095,14],[94099,11],[94112,0],[94176,11],[94178,0],[94179,11],[94180,14],[94181,0],[94192,14],[94194,0],[110592,17],[110593,0],[110948,17],[110952,0],[113664,11],[113771,0],[113776,11],[113789,0],[113792,11],[113801,0],[113808,11],[113818,0],[113821,14],[113823,0],[113824,13],[113828,0],[119141,14],[119146,0],[119149,14],[119155,13],[119163,14],[119171,0],[119173,14],[119180,0],[119210,14],[119214,0],[119362,14],[119365,0],[119808,11],[119893,0],[119894,11],[119965,0],[119966,11],[119968,0],[119970,11],[119971,0],[119973,11],[119975,0],[119977,11],[119981,0],[119982,11],[119994,0],[119995,11],[119996,0],[119997,11],[120004,0],[120005,11],[120070,0],[120071,11],[120075,0],[120077,11],[120085,0],[120086,11],[120093,0],[120094,11],[120122,0],[120123,11],[120127,0],[120128,11],[120133,0],[120134,11],[120135,0],[120138,11],[120145,0],[120146,11],[120486,0],[120488,11],[120513,0],[120514,11],[120539,0],[120540,11],[120571,0],[120572,11],[120597,0],[120598,11],[120629,0],[120630,11],[120655,0],[120656,11],[120687,0],[120688,11],[120713,0],[120714,11],[120745,0],[120746,11],[120771,0],[120772,11],[120780,0],[120782,9],[120832,0],[121344,14],[121399,0],[121403,14],[121453,0],[121461,14],[121462,0],[121476,14],[121477,0],[121499,14],[121504,0],[121505,14],[121520,0],[122880,14],[122887,0],[122888,14],[122905,0],[122907,14],[122914,0],[122915,14],[122917,0],[122918,14],[122923,0],[123136,11],[123181,0],[123184,14],[123191,11],[123198,0],[123200,9],[123210,0],[123214,11],[123215,0],[123584,11],[123628,14],[123632,9],[123642,0],[124928,11],[125125,0],[125136,14],[125143,0],[125184,11],[125252,14],[125259,11],[125260,0],[125264,9],[125274,0],[126464,11],[126468,0],[126469,11],[126496,0],[126497,11],[126499,0],[126500,11],[126501,0],[126503,11],[126504,0],[126505,11],[126515,0],[126516,11],[126520,0],[126521,11],[126522,0],[126523,11],[126524,0],[126530,11],[126531,0],[126535,11],[126536,0],[126537,11],[126538,0],[126539,11],[126540,0],[126541,11],[126544,0],[126545,11],[126547,0],[126548,11],[126549,0],[126551,11],[126552,0],[126553,11],[126554,0],[126555,11],[126556,0],[126557,11],[126558,0],[126559,11],[126560,0],[126561,11],[126563,0],[126564,11],[126565,0],[126567,11],[126571,0],[126572,11],[126579,0],[126580,11],[126584,0],[126585,11],[126589,0],[126590,11],[126591,0],[126592,11],[126602,0],[126603,11],[126620,0],[126625,11],[126628,0],[126629,11],[126634,0],[126635,11],[126652,0],[127280,11],[127306,0],[127312,11],[127338,0],[127344,11],[127370,0],[127462,18],[127488,0],[127995,14],[128e3,0],[130032,9],[130042,0],[917505,13],[917506,0],[917536,14],[917632,0],[917760,14],[918e3,0]];function ce(r,e){var t=ot(r,e);if(t.length==0)return[];for(var n=[],i=0;i<t.length-1;i++){var a=t[i],l=t[i+1],o=new We(r,a,l);at(o.text,e)?n.push(o):i==t.length-2&&(o=new We(r,l,l),n.push(o))}return n}var We=function(){function r(e,t,n){this._source=e,this.start=t,this.end=n}return Object.defineProperty(r.prototype,"text",{get:function(){return this._source.substring(this.start,this.end)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"length",{get:function(){return this.end-this.start},enumerable:!1,configurable:!0}),r}(),it=function(){function r(e,t,n,i,a,l){this.lookbehind=19,this.left=19,this.right=19,this.text=e,this.options=t,arguments.length==3?this.lookahead=this.wordbreakPropertyAt(n):(this.lookbehind=n,this.left=i,this.right=a,this.lookahead=l)}return r.prototype.next=function(e){var t=this.wordbreakPropertyAt(e);return new r(this.text,this.options,this.left,this.right,this.lookahead,t)},r.prototype.ignoringRight=function(e){var t=this.wordbreakPropertyAt(e);return new r(this.text,this.options,this.lookbehind,this.left,this.lookahead,t)},r.prototype.ignoringLookahead=function(e){var t=this.wordbreakPropertyAt(e);return new r(this.text,this.options,this.lookbehind,this.left,this.right,t)},r.prototype.wordbreakPropertyAt=function(e){return e<0?19:e>=this.text.length?20:Ue(this.text[e])?Ee(this.text[e]+this.text[e+1]):Ee(this.text[e],this.options)},r.prototype.match=function(e,t,n,i){var a,l,o,s,u=(a=e==null?void 0:e.includes(this.lookbehind))!==null&&a!==void 0?a:!0;return u=u&&((l=t==null?void 0:t.includes(this.left))!==null&&l!==void 0?l:!0),u=u&&((o=n==null?void 0:n.includes(this.right))!==null&&o!==void 0?o:!0),u&&((s=i==null?void 0:i.includes(this.lookahead))!==null&&s!==void 0?s:!0)},r.prototype.propertyMatch=function(e,t,n,i){var a=this,l=function(o){return Be(o,a.options)};return this.match(e==null?void 0:e.map(l),t==null?void 0:t.map(l),n==null?void 0:n.map(l),i==null?void 0:i.map(l))},r}();function at(r,e){return!r.split("").map(function(t){return Ee(t,e)}).every(function(t){return t===3||t===1||t===2||t===4})}function ot(r,e){var t,n,i;if(r.length===0)return[];e&&!e.rules&&(e.rules=[]);var a=[],l,o=0,s=new it(r,e,o),u=0;do{if(l=o,o=x(o),s=s.next(o),s.match(null,[19],null,null)){a.push(l);continue}if(s.match(null,null,[20],null)){a.push(l);break}if(!s.match(null,[3],[1],null)){var c=[2,3,1];if(s.match(null,c,null,null)){a.push(l);continue}if(s.match(null,null,c,null)){a.push(l);continue}if(!s.match(null,[4],[4],null)){for(var f=[13,14,16];s.match(null,null,f,null);)t=(0,T.__read)([o,x(o)],2),l=t[0],o=t[1],s=s.ignoringRight(o);if(s.right===20){a.push(l);break}for(;s.match(null,null,null,f);)o=x(o),s=s.ignoringLookahead(o);var v=[11,15],p=[8,6];if(e!=null&&e.rules){var d=!1;try{for(var m=(n=void 0,(0,T.__values)(e.rules)),b=m.next();!b.done;b=m.next()){var A=b.value;if(d=A.match(s),d){A.breakIfMatch&&a.push(l);break}}}catch(N){n={error:N}}finally{try{b&&!b.done&&(i=m.return)&&i.call(m)}finally{if(n)throw n.error}}if(d)continue}if(!s.match(null,v,v,null)){var y=[10].concat(p);if(!s.match(null,v,y,v)&&!s.match(v,y,v,null)&&!s.match(null,[15],[6],null)&&!s.match(null,[15],[5],[15])&&!s.match([15],[5],[15],null)&&!s.match(null,[9],[9],null)&&!s.match(null,v,[9],null)&&!s.match(null,[9],v,null)){var S=[7].concat(p);if(!s.match([9],S,[9],null)&&!s.match(null,[9],S,[9])&&!s.match(null,[17],[17],null)){var w=[17,9].concat(v);if(!s.match(null,w,[12],null)&&!s.match(null,[12],[12],null)&&!s.match(null,[12],w,null)){if(s.right===18){if(u+=1,u%2==1)continue}else u=0;a.push(l)}}}}}}}while(l<r.length);return a;function x(N){return N>=r.length?r.length:Ue(r[N])?N+2:N+1}}function Ue(r){var e=r.charCodeAt(0);return e>=55296&&e<=56319}function Ee(r,e){if(e!=null&&e.propertyMapping){var t=e.propertyMapping(r);if(t)return Be(t,e)}var n=r.codePointAt(0);return Ie(n,0,Me.length-1)}function Be(r,e){var t,n,i=function(l){return l.toLowerCase()==r.toLowerCase()},a=(n=(t=e==null?void 0:e.customProperties)===null||t===void 0?void 0:t.findIndex(i))!==null&&n!==void 0?n:-1;return a!=-1?-a-1:nt.findIndex(i)}function Ie(r,e,t){if(t<e)return 0;var n=e+~~((t-e)/2),i=Me[n],a=Me[n+1],l=a?a[0]:1/0;return r<i[0]?Ie(r,e,n-1):r>=l?Ie(r,n+1,t):i[1]}K();var Qe=12,ut=function(){function r(e,t){this.root=e,this.prefix=t}return r.prototype.children=function(){var e,t,n,i,a,l,o,s,u,c,f,v,p,d,m,b,A,y;return(0,T.__generator)(this,function(S){switch(S.label){case 0:if(e=this.root,e.type!="internal")return[3,9];t=function(w){var x,N,Q,ne,J,be,ke,ie,_e,ae,G,ve;return(0,T.__generator)(this,function(B){switch(B.label){case 0:if(x=e.children[w],!$(w))return[3,12];if(x.type!="internal")return[3,9];N=x,Q=function(oe){var ue;return(0,T.__generator)(this,function(se){switch(se.label){case 0:return ue=n.prefix+w+oe,[4,{char:w+oe,traversal:function(){return new r(N.children[oe],ue)}}];case 1:return se.sent(),[2]}})},B.label=1;case 1:B.trys.push([1,6,7,8]),ne=(G=void 0,(0,T.__values)(N.values)),J=ne.next(),B.label=2;case 2:return J.done?[3,5]:(be=J.value,[5,Q(be)]);case 3:B.sent(),B.label=4;case 4:return J=ne.next(),[3,2];case 5:return[3,8];case 6:return ke=B.sent(),G={error:ke},[3,8];case 7:try{J&&!J.done&&(ve=ne.return)&&ve.call(ne)}finally{if(G)throw G.error}return[7];case 8:return[3,11];case 9:return ie=x.entries[0].key,w=w+ie[n.prefix.length+1],_e=n.prefix+w,[4,{char:w,traversal:function(){return new r(x,_e)}}];case 10:B.sent(),B.label=11;case 11:return[3,16];case 12:return Y(w)?[2,"continue"]:[3,13];case 13:return w?[3,14]:[2,"continue"];case 14:return ae=n.prefix+w,[4,{char:w,traversal:function(){return new r(x,ae)}}];case 15:B.sent(),B.label=16;case 16:return[2]}})},n=this,S.label=1;case 1:S.trys.push([1,6,7,8]),i=(0,T.__values)(e.values),a=i.next(),S.label=2;case 2:return a.done?[3,5]:(l=a.value,[5,t(l)]);case 3:S.sent(),S.label=4;case 4:return a=i.next(),[3,2];case 5:return[3,8];case 6:return o=S.sent(),m={error:o},[3,8];case 7:try{a&&!a.done&&(b=i.return)&&b.call(i)}finally{if(m)throw m.error}return[7];case 8:return[2];case 9:s=this.prefix,u=e.entries.filter(function(w){return w.key!=s&&s.length<w.key.length}),c=function(w){var x;return(0,T.__generator)(this,function(N){switch(N.label){case 0:return x=w[s.length],$(x)&&(x=x+w[s.length+1]),[4,{char:x,traversal:function(){return new r(e,s+x)}}];case 1:return N.sent(),[2]}})},S.label=10;case 10:S.trys.push([10,15,16,17]),f=(0,T.__values)(u),v=f.next(),S.label=11;case 11:return v.done?[3,14]:(p=v.value.key,[5,c(p)]);case 12:S.sent(),S.label=13;case 13:return v=f.next(),[3,11];case 14:return[3,17];case 15:return d=S.sent(),A={error:d},[3,17];case 16:try{v&&!v.done&&(y=f.return)&&y.call(f)}finally{if(A)throw A.error}return[7];case 17:return[2]}})},Object.defineProperty(r.prototype,"entries",{get:function(){if(this.root.type=="leaf"){var e=this.prefix,t=this.root.entries.filter(function(i){return i.key==e});return t.map(function(i){return i.content})}else{var n=this.root.children[V];return n&&n.type=="leaf"?n.entries.map(function(i){return i.content}):[]}},enumerable:!1,configurable:!0}),r}(),st=function(){function r(e,t){t===void 0&&(t={}),this.languageUsesCasing=t.languageUsesCasing,this.applyCasing=t.applyCasing,this._trie=new ct(e.root,e.totalWeight,t.searchTermToKey||ht),this.breakWords=t.wordBreaker||ce,this.punctuation=t.punctuation}return r.prototype.configure=function(e){var t;return this.configuration={leftContextCodePoints:e.maxLeftContextCodePoints,rightContextCodePoints:(t=e.maxRightContextCodePoints)!==null&&t!==void 0?t:0}},r.prototype.toKey=function(e){return this._trie.toKey(e)},r.prototype.predict=function(e,t){if(!e.insert&&!t.left&&!t.right&&t.startOfBuffer&&t.endOfBuffer)return l(this._trie.firstN(Qe).map(function(o){var s=o.text,u=o.p;return{transform:{insert:s,deleteLeft:0},displayAs:s,p:u}}));var n=z(e,t),i=e.deleteLeft-e.insert.kmwLength(),a=pe(this.breakWords,n);return l(this._trie.lookup(a).map(function(o){var s=o.text,u=o.p;return h({insert:s,deleteLeft:i+a.kmwLength()},u)}));function l(o){var s,u,c=[];try{for(var f=(0,T.__values)(o),v=f.next();!v.done;v=f.next()){var p=v.value;c.push({sample:p,p:p.p})}}catch(d){s={error:d}}finally{try{v&&!v.done&&(u=f.return)&&u.call(f)}finally{if(s)throw s.error}}return c}},Object.defineProperty(r.prototype,"wordbreaker",{get:function(){return this.breakWords},enumerable:!1,configurable:!0}),r.prototype.traverseFromRoot=function(){return new ut(this._trie.root,"")},r}(),lt=st,ct=function(){function r(e,t,n){this.root=e,this.toKey=n,this.totalWeight=t}return r.prototype.lookup=function(e){var t=this.toKey(e),n=Ke(this.root,t);return n===null?[]:Ve(n,t,this.totalWeight)},r.prototype.firstN=function(e){return Ve(this.root,"",this.totalWeight,e)},r}();function Ke(r,e,t){if(t===void 0&&(t=0),r.type==="leaf"||t===e.length)return r;var n=e[t];return r.children[n]?Ke(r.children[n],e,t+1):null}function Ve(r,e,t,n){var i,a;n===void 0&&(n=Qe);var l=new k(function(b,A){return(A?A.weight:0)-(b?b.weight:0)}),o=[];if(r.type==="leaf")try{for(var s=(0,T.__values)(r.entries),u=s.next();!u.done;u=s.next()){var c=u.value;if(c.key.indexOf(e)==0){var f=c.content,v=c.weight;if(o.push({text:f,p:v/t}),o.length>=n)return o}}}catch(b){i={error:b}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(i)throw i.error}}else{l.enqueue(r);for(var p=void 0,d=function(){if(ft(p))if(p.type==="leaf")l.enqueueAll(p.entries);else{var b=p;l.enqueueAll(p.values.map(function(A){return b.children[A]}))}else if(o.push({text:p.content,p:p.weight/t}),o.length>=n)return{value:o}};p=l.dequeue();){var m=d();if(typeof m=="object")return m.value}}return o}function ft(r){return"type"in r}function ht(r){return r.normalize("NFD").replace(/[\\u0300-\\u036f]/g,"").toLowerCase()}var pt=function(){function r(e){e=e||{},this._futureSuggestions=e.futureSuggestions?e.futureSuggestions.slice():[],e.punctuation&&(this.punctuation=e.punctuation)}return r.prototype.configure=function(e){return this.configuration={leftContextCodePoints:e.maxLeftContextCodePoints,rightContextCodePoints:e.maxRightContextCodePoints},this.configuration},r.prototype.predict=function(e,t,n){var i=function(l){var o,s,u=[],c=l.length;try{for(var f=(0,T.__values)(l),v=f.next();!v.done;v=f.next()){var p=v.value;u.push({sample:p,p:1})}}catch(d){o={error:d}}finally{try{v&&!v.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}return u};if(n)return i(n);var a=this._futureSuggestions.shift();return a?i(a):[]},r}(),vt=pt,qe={};R(qe,{ClassicalDistanceCalculation:function(){return Ne},ContextTracker:function(){return ze},QUEUE_NODE_COMPARATOR:function(){return Se},SearchNode:function(){return Ge},SearchResult:function(){return He},SearchSpace:function(){return ee},TrackedContextState:function(){return Ce},TrackedContextSuggestion:function(){return gt},TrackedContextToken:function(){return re}});var Ne=function(){function r(e){if(this.diagonalWidth=2,this.inputSequence=[],this.matchSequence=[],e){var t=e.resolvedDistances.length;this.resolvedDistances=Array(t);for(var n=0;n<t;n++)this.resolvedDistances[n]=e.resolvedDistances[n].slice(0);this.inputSequence=e.inputSequence.slice(0),this.matchSequence=e.matchSequence.slice(0),this.diagonalWidth=e.diagonalWidth}else this.resolvedDistances=[]}return r.prototype.getTrueIndex=function(e,t,n){var i={row:e,col:t-e+n,sparse:!1};return(i.col<0||i.col>2*n)&&(i.sparse=!0),i},r.prototype.getCostAt=function(e,t,n){if(n===void 0&&(n=this.diagonalWidth),e<0||t<0)return e==-1&&t>=-1?t+1:t==-1&&e>=-1?e+1:Number.MAX_VALUE;var i=this.getTrueIndex(e,t,n);return i.sparse?Number.MAX_VALUE:this.resolvedDistances[i.row][i.col]},r.prototype.getFinalCost=function(){for(var e=this,t=e.getHeuristicFinalCost();t>e.diagonalWidth;)e=e.increaseMaxDistance(),t=e.getHeuristicFinalCost();return t},r.prototype.getHeuristicFinalCost=function(){return this.getCostAt(this.inputSequence.length-1,this.matchSequence.length-1)},r.prototype.hasFinalCostWithin=function(e){var t=this,n=t.getHeuristicFinalCost(),i=this.diagonalWidth;do{if(n<=e)return!0;if(i<e)t=t.increaseMaxDistance(),i++,n=t.getHeuristicFinalCost();else break}while(!0);return!1},r.prototype.editPath=function(e,t){e===void 0&&(e=this.inputSequence.length-1),t===void 0&&(t=this.matchSequence.length-1);var n=this.getCostAt(e,t),i=null,a=null,l=this.getCostAt(e,t-1),o=this.getCostAt(e-1,t),s=this.getCostAt(e-1,t-1),u=(0,T.__read)(r.getTransposeParent(this,e,t),2),c=u[0],f=u[1];if(c>=0&&f>=0){var v=1;if(i=["transpose-start"],c!=e-1){var p=e-c-1;i=i.concat(Array(p).fill("transpose-delete")),v+=p}else{var p=t-f-1;i=i.concat(Array(p).fill("transpose-insert")),v+=p}i.push("transpose-end"),this.getCostAt(c-1,f-1)!=n-v&&(i=null),a=[c-1,f-1]}return i||(s==n-1?(i=["substitute"],a=[e-1,t-1]):l==n-1?(i=["insert"],a=[e,t-1]):o==n-1?(i=["delete"],a=[e-1,t]):(i=["match"],a=[e-1,t-1])),a[0]>=0&&a[1]>=0?this.editPath(a[0],a[1]).concat(i):a[0]>-1?Array(a[0]+1).fill("delete").concat(i):a[1]>-1?Array(a[1]+1).fill("insert").concat(i):i},r.getTransposeParent=function(e,t,n){if(t<0||n<0||e.inputSequence[t].key==e.matchSequence[n].key)return[-1,-1];for(var i=-1,a=t-1;a>=0;a--)if(e.inputSequence[a].key==e.matchSequence[n].key){i=a;break}for(var l=-1,a=n-1;a>=0;a--)if(e.matchSequence[a].key==e.inputSequence[t].key){l=a;break}return[i,l]},r.initialCostAt=function(e,t,n,i,a){var l=e.inputSequence[t].key==e.matchSequence[n].key?0:1,o=e.getCostAt(t-1,n-1)+l,s=i||e.getCostAt(t,n-1)+1,u=a||e.getCostAt(t-1,n)+1,c=Number.MAX_VALUE;if(t>0&&n>0){var f=(0,T.__read)(r.getTransposeParent(e,t,n),2),v=f[0],p=f[1];c=e.getCostAt(v-1,p-1)+(t-v-1)+1+(n-p-1)}return Math.min(o,u,s,c)},r.prototype.getSubset=function(e,t){var n=new r(this);if(e>this.inputSequence.length||t>this.matchSequence.length)throw"Invalid dimensions specified for trim operation";n.inputSequence.splice(e),n.matchSequence.splice(t),n.resolvedDistances.splice(e);for(var i=this.getTrueIndex(e-1,t-1,this.diagonalWidth),a=i.col;a<=2*this.diagonalWidth;a++){var l=i.row-(a-i.col);if(l<0)break;if(a<0)n.resolvedDistances[l]=Array(2*n.diagonalWidth+1).fill(Number.MAX_VALUE);else{var o=2*this.diagonalWidth-a,s=n.resolvedDistances[l].splice(0,a+1),u=Array(o).fill(Number.MAX_VALUE);n.resolvedDistances[l]=s.concat(u)}}return n},r.forDiagonalOfAxis=function(e,t,n,i){for(var a=n-t<e?n-t+e:2*e,l=t-e,o=l<0?0:l,s=o-l;s<=a;s++)i(l+s,s)},r.prototype.addInputChar=function(e){var t=new r(this),n=t.inputSequence.length;t.inputSequence.push(e);var i=Array(2*t.diagonalWidth+1).fill(Number.MAX_VALUE);return t.resolvedDistances[n]=i,t.matchSequence.length==0||r.forDiagonalOfAxis(t.diagonalWidth,n,t.matchSequence.length-1,function(a,l){i[l]=r.initialCostAt(t,n,a)}),t},r.prototype.addMatchChar=function(e){var t=new r(this),n=t.matchSequence.length;return t.matchSequence.push(e),t.inputSequence.length==0||r.forDiagonalOfAxis(t.diagonalWidth,n,t.inputSequence.length-1,function(i,a){var l=t.resolvedDistances[i];l[2*t.diagonalWidth-a]=r.initialCostAt(t,i,n)}),t},r.prototype.increaseMaxDistance=function(){var e=new r(this);if(e.diagonalWidth++,e.inputSequence.length<1||e.matchSequence.length<1)return e;function t(o,s,u,c){var f=2*(e.diagonalWidth-1),v=u.length-1;f=f<v-o?f:v-o;for(var p=0;p<=f;p++)s==u[o+p].key&&c(o+p,p)}for(var n=function(o){var s=Number.MAX_VALUE,u=o-e.diagonalWidth;if(u>=0){var c=u==0?o+2:Number.MAX_VALUE;s=r.initialCostAt(e,o,u,c,void 0);var f=s;if(u<e.matchSequence.length-1){r.propagateUpdateFrom(e,o,u+1,f+1,0);var v=o+2;if(o+2<i.inputSequence.length){var p=e.inputSequence[o+1].key;t(u+3,p,e.matchSequence,function(S,w){r.propagateUpdateFrom(e,v,S,f+w+2,w)})}}}var d=Number.MAX_VALUE;if(u=o+e.diagonalWidth,u<e.matchSequence.length){var m=o==0?u+2:Number.MAX_VALUE;a=e.getCostAt(o,u-1,i.diagonalWidth)+1,d=r.initialCostAt(e,o,u,a,m);var b=d;if(o<e.inputSequence.length-1){r.propagateUpdateFrom(e,o+1,u,b+1,2*i.diagonalWidth);var A=u+2;if(u+2<i.matchSequence.length){var y=e.matchSequence[o+1].key;t(o+3,y,e.inputSequence,function(S,w){var x=2*(e.diagonalWidth-1)-w;r.propagateUpdateFrom(e,S,A,b+w+2,x)})}}}e.resolvedDistances[o]=[s].concat(e.resolvedDistances[o],d)},i=this,a,l=0;l<e.inputSequence.length;l++)n(l);return e},r.propagateUpdateFrom=function(e,t,n,i,a){if(i<e.resolvedDistances[t][a])e.resolvedDistances[t][a]=i;else return;var l=t<e.inputSequence.length-1,o=n<e.matchSequence.length-1;if(a<2*(e.diagonalWidth-1)&&o){var s=i+1;this.propagateUpdateFrom(e,t,n+1,s,a+1)}if(a>0&&l){var s=i+1;this.propagateUpdateFrom(e,t+1,n,s,a-1)}if(l&&o){var s=i+(e.inputSequence[t+1].key==e.matchSequence[n+1].key?0:1);this.propagateUpdateFrom(e,t+1,n+1,s,a);for(var u=-1,c=t+2;c<e.inputSequence.length;c++)if(e.inputSequence[c].key==e.matchSequence[n+1].key){u=c;break}for(var f=-1,c=n+2;c<e.matchSequence.length;c++)if(e.matchSequence[c].key==e.inputSequence[t+1].key){f=c;break}if(u>0&&f>0){var v=i+(u-t-2)+1+(f-n-2);this.propagateUpdateFrom(e,u,f,v,e.diagonalWidth-1+f-u)}}},Object.defineProperty(r.prototype,"mapKey",{get:function(){var e=this.inputSequence.map(function(n){return n.key}).join(""),t=this.matchSequence.map(function(n){return n.key}).join("");return e+V+t+V+this.diagonalWidth},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lastInputEntry",{get:function(){return this.inputSequence[this.inputSequence.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lastMatchEntry",{get:function(){return this.matchSequence[this.matchSequence.length-1]},enumerable:!1,configurable:!0}),r.computeDistance=function(e,t,n){n===void 0&&(n=1);var i=new r;n=n||1,i.diagonalWidth=n;for(var a=0;a<e.length;a++)i=i.addInputChar(e[a]);for(var l=0;l<t.length;l++)i=i.addMatchChar(t[l]);return i},r}(),Se=function(r,e){return r.currentCost-e.currentCost},Ge=function(){function r(e,t){if(this.toKey=function(i){return i},t=t||function(i){return i},e instanceof r){var n=e;this.calculation=n.calculation,this.currentTraversal=n.currentTraversal,this.priorInput=n.priorInput,this.toKey=n.toKey}else this.calculation=new Ne,this.currentTraversal=e,this.priorInput=[],this.toKey=t}return Object.defineProperty(r.prototype,"knownCost",{get:function(){return this.calculation.getHeuristicFinalCost()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputSamplingCost",{get:function(){if(this._inputCost!==void 0)return this._inputCost;var e=ee.MIN_KEYSTROKE_PROBABILITY;return this._inputCost=this.priorInput.map(function(t){return t.p>e?t.p:e}).reduce(function(t,n){return t-Math.log(n)},0),this._inputCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentCost",{get:function(){return ee.EDIT_DISTANCE_COST_SCALE*this.knownCost+this.inputSamplingCost},enumerable:!1,configurable:!0}),r.prototype.buildInsertionEdges=function(){var e,t,n=[];try{for(var i=(0,T.__values)(this.currentTraversal.children()),a=i.next();!a.done;a=i.next()){var l=a.value,o=l.traversal(),s={key:l.char,traversal:o},u=this.calculation.addMatchChar(s),c=new r(this);c.calculation=u,c.priorInput=this.priorInput,c.currentTraversal=o,n.push(c)}}catch(f){e={error:f}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r.prototype.buildDeletionEdges=function(e){var t,n,i=[];try{for(var a=(0,T.__values)(e),l=a.next();!l.done;l=a.next()){var o=l.value;if(o.p<e[0].p*Math.exp(-ee.EDIT_DISTANCE_COST_SCALE))break;var s=this.calculation,u=o.sample;u.deleteLeft&&(s=s.getSubset(s.inputSequence.length-u.deleteLeft,s.matchSequence.length));var c=this.priorInput.slice(0);c.push(o);for(var f=0;f<u.insert.length;f++){var v=u.insert[f];$(v)&&(f++,v=v+u.insert[f]);var p=this.toKey(v);p&&(s=s.addInputChar({key:p}))}var d=new r(this);d.calculation=s,d.priorInput=c,i.push(d)}}catch(m){t={error:m}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return i},r.prototype.buildSubstitutionEdges=function(e){var t,n,i,a,l=this.buildDeletionEdges(e),o=[];try{for(var s=(0,T.__values)(this.currentTraversal.children()),u=s.next();!u.done;u=s.next()){var c=u.value;try{for(var f=(i=void 0,(0,T.__values)(l)),v=f.next();!v.done;v=f.next()){var p=v.value,d=c.traversal(),m={key:c.char,traversal:d},b=p.calculation.addMatchChar(m),A=new r(this);A.calculation=b,A.priorInput=p.priorInput,A.currentTraversal=d,o.push(A)}}catch(y){i={error:y}}finally{try{v&&!v.done&&(a=f.return)&&a.call(f)}finally{if(i)throw i.error}}}}catch(y){t={error:y}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return o},Object.defineProperty(r.prototype,"mapKey",{get:function(){var e=this.priorInput.map(function(n){return"+"+n.sample.insert+"-"+n.sample.deleteLeft}).join(""),t=this.calculation.matchSequence.map(function(n){return n.key}).join("");return e+V+t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isFullReplacement",{get:function(){return this.knownCost&&this.knownCost==this.priorInput.length},enumerable:!1,configurable:!0}),r}(),Le=function(){function r(e,t){if(this.processed=[],typeof e=="number"){this.index=e,this.correctionQueue=new k(Se,t);return}else this.index=e.index,this.processed=[].concat(e.processed),this.correctionQueue=new k(e.correctionQueue)}return r.prototype.increaseMaxEditDistance=function(){var e=this.correctionQueue.toArray();e.forEach(function(t){t.calculation=t.calculation.increaseMaxDistance()}),this.correctionQueue=new k(Se,e)},r}(),He=function(){function r(e){this.resultNode=e}return Object.defineProperty(r.prototype,"inputSequence",{get:function(){return this.resultNode.priorInput},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"matchSequence",{get:function(){return this.resultNode.calculation.matchSequence},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"matchString",{get:function(){return this.matchSequence.map(function(e){return e.key}).join("")},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"knownCost",{get:function(){return this.resultNode.knownCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputSamplingCost",{get:function(){return this.resultNode.inputSamplingCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"totalCost",{get:function(){return this.resultNode.currentCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"finalTraversal",{get:function(){return this.resultNode.currentTraversal},enumerable:!1,configurable:!0}),r}(),ee=function(){function r(e){if(this.tierOrdering=[],this.inputSequence=[],this.minInputCost=[],this.returnedValues={},this.processedEdgeSet={},this.buildQueueSpaceComparator(),e instanceof r){this.inputSequence=[].concat(e.inputSequence),this.minInputCost=[].concat(e.minInputCost),this.rootNode=e.rootNode,this.completedPaths=[].concat(e.completedPaths),this.returnedValues=(0,T.__assign)({},e.returnedValues),this.processedEdgeSet=(0,T.__assign)({},e.processedEdgeSet),this.tierOrdering=e.tierOrdering.map(function(i){return new Le(i)}),this.selectionQueue=new k(this.QUEUE_SPACE_COMPARATOR,this.tierOrdering);return}var t=e;if(t){if(!t.traverseFromRoot)throw"The provided model does not implement the `traverseFromRoot` function, which is needed to support robust correction searching."}else throw"The LexicalModel parameter must not be null / undefined.";this.selectionQueue=new k(this.QUEUE_SPACE_COMPARATOR),this.rootNode=new Ge(t.traverseFromRoot(),t.toKey?t.toKey.bind(t):null),this.completedPaths=[this.rootNode];var n=new Le(0,[this.rootNode]);this.tierOrdering.push(n),this.selectionQueue.enqueue(n)}return r.prototype.buildQueueSpaceComparator=function(){var e=this;this.QUEUE_SPACE_COMPARATOR=function(t,n){var i=t.correctionQueue.peek(),a=n.correctionQueue.peek(),l=t.index,o=n.index,s=0,u=1;if(o<l){var c=o;o=l,l=c,u=-1}for(var f=l;f<o;f++)s=s+e.minInputCost[f];return i&&a?i.currentCost-a.currentCost+u*s:a?1:-1}},r.prototype.increaseMaxEditDistance=function(){this.tierOrdering.forEach(function(e){e.increaseMaxEditDistance()})},r.prototype.addInput=function(e){this.inputSequence.push(e),this.minInputCost.push(-Math.log(e[0].p));var t=[],n=this.completedPaths.map(function(a){var l=a.buildDeletionEdges(e),o=a.buildSubstitutionEdges(e);return l.concat(o)});this.completedPaths=[],this.returnedValues={},n.forEach(function(a){t=t.concat(a)});var i=new Le(this.tierOrdering.length,t);this.tierOrdering.push(i),this.selectionQueue.enqueue(i)},r.prototype.removeLastInput=function(){},r.prototype.hasNextMatchEntry=function(){var e=this.selectionQueue.peek();return e?e.correctionQueue.count>0:!1},r.prototype.handleNextNode=function(){if(!this.hasNextMatchEntry())return{type:"none"};var e=this.selectionQueue.dequeue(),t=e.correctionQueue.dequeue(),n={type:"intermediate",cost:t.currentCost};if(this.processedEdgeSet[t.mapKey])return this.selectionQueue.enqueue(e),n;this.processedEdgeSet[t.mapKey]=!0;var i=!1;if(t.knownCost>2)return n;t.knownCost==2&&(i=!0);for(var a=0,l=0;l<=e.index;l++)a+=this.minInputCost[l];if(t.currentCost>a+2.5*r.EDIT_DISTANCE_COST_SCALE)return n;if(!i){var o=t.buildInsertionEdges();e.correctionQueue.enqueueAll(o)}if(e.index==this.tierOrdering.length-1)return this.completedPaths.push(t),this.selectionQueue.enqueue(e),{type:"complete",cost:t.currentCost,finalNode:t};var s=this.tierOrdering[e.index+1],u=s.index,c=[];i||(c=t.buildDeletionEdges(this.inputSequence[u-1]));var f=t.buildSubstitutionEdges(this.inputSequence[u-1]);return s.correctionQueue.enqueueAll(c.concat(f)),this.selectionQueue=new k(this.QUEUE_SPACE_COMPARATOR,this.tierOrdering),n},r.prototype.getBestMatches=function(e){var t,n,i,a,l,o,s,u,c,f,v,p,d,m,b,A;return(0,T.__generator)(this,function(y){switch(y.label){case 0:if(t=this,n={},e==0?i=1/0:e==null||Number.isNaN(e)?i=r.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL:i=e,a=function(){function S(w,x){this.largestIntervals=[0],this.loopStart=this.start=Date.now(),this.maxExecutionTime=w,this.maxTrueTime=x}return S.prototype.startLoop=function(){this.loopStart=Date.now()},S.prototype.markIteration=function(){var w=Date.now(),x=w-this.loopStart;this.executionTime+=x,x&&x>this.largestIntervals[0]&&(this.largestIntervals.length>2?this.largestIntervals[0]=x:this.largestIntervals.push(x),this.largestIntervals.sort(),this.updateOutliers())},S.prototype.updateOutliers=function(){this.largestIntervals.length>2&&this.largestIntervals[2]>=2*(this.largestIntervals[0]+this.largestIntervals[1])&&(this.executionTime-=this.largestIntervals[2],this.largestIntervals.pop())},S.prototype.shouldTimeout=function(){var w=Date.now();return w-this.start>this.maxTrueTime?!0:this.executionTime>this.maxExecutionTime},S.prototype.resetOutlierCheck=function(){this.largestIntervals=[]},S}(),l=function(){function S(){this.currentCost=Number.MIN_SAFE_INTEGER,this.entries=[]}return S.prototype.checkAndAdd=function(w){var x=null;w.currentCost>this.currentCost&&(x=this.tryFinalize(),this.currentCost=w.currentCost);var N=w.calculation.matchSequence.map(function(Q){return Q.key}).join("");return t.returnedValues[N]||(t.returnedValues[N]=w),n[N]||(this.entries.push(new He(w)),n[N]=w),x},S.prototype.tryFinalize=function(){var w=null;return this.entries.length>0&&(w=this.entries,this.entries=[]),w},S}(),o=new l,s=new a(i*1.5,i),u=Object.values(this.returnedValues),!(u.length>0))return[3,6];c=new k(Se,u),s.startLoop(),y.label=1;case 1:return c.count>0?(f=c.dequeue(),f.isFullReplacement?[3,1]:(v=o.checkAndAdd(f),s.markIteration(),v?[4,v]:[3,3])):[3,4];case 2:y.sent(),y.label=3;case 3:return[3,1];case 4:return p=o.tryFinalize(),p?[4,p]:[3,6];case 5:y.sent(),y.label=6;case 6:s.resetOutlierCheck(),s.startLoop(),d=!1,y.label=7;case 7:m=void 0;do m=this.handleNextNode(),s.markIteration(),s.shouldTimeout()&&(d=!0);while(!d&&m.type=="intermediate");if(b=void 0,m.type=="none")return[3,10];if(m.type=="complete"){if(m.finalNode.isFullReplacement)return[3,10];b=o.checkAndAdd(m.finalNode)}return b?[4,b]:[3,9];case 8:y.sent(),y.label=9;case 9:if(!d&&this.hasNextMatchEntry())return[3,7];y.label=10;case 10:return A=o.tryFinalize(),A?[4,A]:[3,12];case 11:y.sent(),y.label=12;case 12:return[2,null]}})},r.EDIT_DISTANCE_COST_SCALE=5,r.MIN_KEYSTROKE_PROBABILITY=1e-4,r.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL=33,r}(),dt=function(){function r(){}return r.isWhitespace=function(e){var t=/^[\\u0009\\u000A\\u000D\\u0020\\u00a0\\u1680\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u200b\\u2028\\u2029\\u202f\\u205f\\u3000]+$/i;return e.insert.match(t)!=null},r.isBackspace=function(e){return e.insert==""&&e.deleteLeft>0&&!e.deleteRight},r.isEmpty=function(e){return e.insert==""&&e.deleteLeft==0&&!e.deleteRight},r}(),te=dt;function Xe(r,e){for(var t=[],n=0;n<r.kmwLength();n++){var i=r.kmwCharAt(n),a={insert:i,deleteLeft:0,id:e};t.push(a)}return t}var gt=function(){function r(){}return r}(),re=function(){function r(){this.transformDistributions=[],this.activeReplacementId=-1}return Object.defineProperty(r.prototype,"currentText",{get:function(){return this.replacementText===void 0||this.replacementText===null?this.raw:this.replacementText},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"replacement",{get:function(){var e=this.activeReplacementId;return this.replacements.find(function(t){return t.suggestion.id==e})},enumerable:!1,configurable:!0}),r.prototype.revert=function(){delete this.activeReplacementId},r}(),Ce=function(){function r(e){if(this.searchSpace=[],e instanceof r){var t=e;this.tokens=t.tokens.map(function(i){var a=new re;return a.raw=i.raw,a.replacements=[].concat(i.replacements),a.activeReplacementId=i.activeReplacementId,a.transformDistributions=[].concat(i.transformDistributions),i.replacementText&&(a.replacementText=i.replacementText),a}),this.indexOffset=0;var n=this.model=e.model;this.taggedContext=e.taggedContext,n!=null&&n.traverseFromRoot&&(this.searchSpace=e.searchSpace.map(function(i){return new ee(i)}))}else{var n=e;this.tokens=[],this.indexOffset=Number.MIN_SAFE_INTEGER,this.model=n,n&&n.traverseFromRoot&&(this.searchSpace=[new ee(n)])}}return Object.defineProperty(r.prototype,"head",{get:function(){return this.tokens[0]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tail",{get:function(){return this.tokens[this.tokens.length-1]},enumerable:!1,configurable:!0}),r.prototype.popHead=function(){this.tokens.splice(0,2),this.indexOffset-=1},r.prototype.pushTail=function(e){this.model&&this.model.traverseFromRoot?this.searchSpace=[new ee(this.model)]:this.searchSpace=[],this.tokens.push(e);var t=this;t.searchSpace.length>0&&e.transformDistributions.forEach(function(n){return t.searchSpace[0].addInput(n)})},r.prototype.pushWhitespaceToTail=function(e){e===void 0&&(e=null);var t=new re;t.transformDistributions=e?[e]:[],t.raw=null,this.tokens.push(t)},r.prototype.replaceTailForBackspace=function(e,t){this.tokens.pop();var n=Xe(e,t).map(function(a){return[{sample:a,p:1}]}),i=new re;i.raw=e,i.transformDistributions=n,this.pushTail(i)},r.prototype.updateTail=function(e,t){var n=this.tail;t=t||(t===""?"":n.raw),e&&e.length>0&&(n.transformDistributions.push(e),this.searchSpace&&this.searchSpace.forEach(function(i){return i.addInput(e)})),n.raw=t},r.prototype.toRawTokenization=function(){var e,t,n=[];try{for(var i=(0,T.__values)(this.tokens),a=i.next();!a.done;a=i.next()){var l=a.value;l.currentText!==null&&n.push(l.currentText)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r}(),yt=function(){function r(e){e===void 0&&(e=r.DEFAULT_ARRAY_SIZE),this.currentHead=0,this.currentTail=0,this.circle=Array(e)}return Object.defineProperty(r.prototype,"count",{get:function(){var e=this.currentHead-this.currentTail;return e<0&&(e=e+this.circle.length),e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxCount",{get:function(){return this.circle.length},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"oldest",{get:function(){if(this.count!=0)return this.item(0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"newest",{get:function(){if(this.count!=0)return this.item(this.count-1)},enumerable:!1,configurable:!0}),r.prototype.enqueue=function(e){var t=null,n=(this.currentHead+1)%this.maxCount;return n==this.currentTail&&(t=this.circle[this.currentTail],this.currentTail=(this.currentTail+1)%this.maxCount),this.circle[this.currentHead]=e,this.currentHead=n,t},r.prototype.dequeue=function(){if(this.currentTail==this.currentHead)return null;var e=this.circle[this.currentTail];return this.currentTail=(this.currentTail+1)%this.maxCount,e},r.prototype.popNewest=function(){if(this.currentTail==this.currentHead)return null;var e=this.circle[this.currentHead];return this.currentHead=(this.currentHead-1+this.maxCount)%this.maxCount,e},r.prototype.item=function(e){if(e>=this.count)throw"Invalid array index";var t=(this.currentTail+e)%this.maxCount;return this.circle[t]},r.DEFAULT_ARRAY_SIZE=5,r}(),ze=function(r){(0,T.__extends)(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.attemptMatchContext=function(t,n,i){var a=n.toRawTokenization(),l=Ne.computeDistance(a.map(function(Q){return{key:Q}}),t.map(function(Q){return{key:Q}}),1),o=l.editPath(),s=!1,u=!1;if(o.length>1){if(o[0]=="insert"&&!(o[1]=="substitute"&&o.length==2)||o[0].indexOf("transpose")>=0)return null;o[0]=="delete"&&(s=!0)}var c=o.length-1,f=!1;if(o[c]=="delete"||o[0].indexOf("transpose")>=0||(o[c]=="insert"?u=!0:c>0&&o[c-1]=="insert"&&o[c]=="substitute"&&(u=!0,f=!0),c>0&&o[c-1]=="delete"&&o[c]=="substitute"))return null;for(var v=1;v<o.length-(f?2:1);v++)if(o[v]!="match")return null;var p;u?(f&&(n.tail.replacementText=t[t.length-2]),p=new Ce(n)):p=i?new Ce(n):n;var d=i&&Array.isArray(i),m=d?i[0].sample:null;m&&m.insert==""&&m.deleteLeft==0&&!m.deleteRight&&(m=null);var b=m&&te.isWhitespace(m),A=m&&te.isBackspace(m),y=t[t.length-1];function S(){if(b&&o[c]=="match")return p;A?p.replaceTailForBackspace(y,m.id):p.updateTail(m?i:null,y)}if(o.length>1)if(s&&p.popHead(),u){var w=t[t.length-1],x=new re;x.raw=w,b||!m?(p.pushWhitespaceToTail(i!=null?i:[]),x.transformDistributions=[]):(p.pushWhitespaceToTail(),x.transformDistributions=i?[i]:[]),p.pushTail(x)}else S();else if(o[c]=="insert"){var N=new re;N.raw=t[0],N.transformDistributions=[i],p.pushTail(N)}else S();return p},e.modelContextState=function(t,n,i){var a=t.map(function(s){var u=new re;return u.raw=s,u.raw?u.transformDistributions=Xe(u.raw).map(function(c){return[{sample:c,p:1}]}):u.transformDistributions=[],u}),l=new Ce(i);for(a.length>0&&l.pushTail(a.splice(0,1)[0]);a.length>0;)l.pushWhitespaceToTail(),l.pushTail(a.splice(0,1)[0]);if(l.tokens.length==0){var o=new re;o.raw="",l.pushTail(o)}return l},e.prototype.analyzeState=function(t,n,i){if(!t.traverseFromRoot)throw"This lexical model does not provide adequate data for correction algorithms and context reuse";var a=Z(t.wordbreaker||ce,n);if(a.left.length>0)for(var l=this.count-1;l>=0;l--){var o=this.item(l),s=o.taggedContext;if(s&&i&&i.length>0){var u=z(i[0].sample,s);if(u.left!=n.left)continue}else if((s==null?void 0:s.left)!=n.left)continue;var c=e.attemptMatchContext(a.left,this.item(l),i);if(c)return this.newest!=c&&this.newest!=o&&this.enqueue(o),c.taggedContext=n,c!=this.item(l)&&this.enqueue(c),c}var f=e.modelContextState(a.left,i,t);return f.taggedContext=n,this.enqueue(f),f},e.prototype.clearCache=function(){for(;this.count>0;)this.dequeue()},e}(yt),mt=function(){function r(e,t){this.SUGGESTION_ID_SEED=0,this.testMode=!1,this.lexicalModel=e,e.traverseFromRoot&&(this.contextTracker=new ze),this.punctuation=r.determinePunctuationFromModel(e),this.testMode=!!t}return r.prototype.predictFromCorrections=function(e,t){var n,i,a=[],l=function(f){var v=o.lexicalModel.predict(f.sample,t),p=v.map(function(d){var m=f.sample,b=f.p;m.id!==void 0&&(d.sample.transformId=m.id);var A={sample:d.sample,p:d.p*b};return A},o);a=a.concat(p)},o=this;try{for(var s=(0,T.__values)(e),u=s.next();!u.done;u=s.next()){var c=u.value;l(c)}}catch(f){n={error:f}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return a},r.prototype.predict=function(e,t){var n,i,a,l,o=[],s=this.lexicalModel,u=this.punctuation;e instanceof Array?e.length==0&&e.push({sample:{insert:"",deleteLeft:0},p:1}):e=[{sample:e,p:1}];var c=e.sort(function(O,j){return j.p-O.p})[0].sample,f=te.isWhitespace(c),v=te.isBackspace(c),p=z(c,t),d=this.wordbreak(p),m=null,b=[],A,y=null;if(this.contextTracker){var w=this.contextTracker.analyzeState(this.lexicalModel,t,null);y=this.contextTracker.analyzeState(this.lexicalModel,p,te.isEmpty(c)?null:e);var x=y.searchSpace[0],N=0,Q=y.tokens,ne=Q.length,J=Q.length-w.tokens.length;ne==0||J>0?(N=0,te.isWhitespace(c)&&(A=c,t=p,w=y)):J<0?N=this.wordbreak(p).kmwLength()+c.deleteLeft:N=this.wordbreak(t).kmwLength();var be=Q[Q.length-1],ke=be.transformDistributions.length<=1,ie=void 0,_e=this.testMode?0:ee.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL;try{for(var ae=(0,T.__values)(x.getBestMatches(_e)),G=ae.next();!G.done;G=ae.next()){var ve=G.value,S=ve.map(function(j){var fe=j.matchString,Te;j.inputSequence.length>0?Te=j.inputSequence[j.inputSequence.length-1].sample:Te=c;var Tt={insert:fe,deleteLeft:N,id:c.id},$e=j.totalCost;return ke&&($e*=r.SINGLE_CHAR_KEY_PROB_EXPONENT),{sample:Tt,p:Math.exp(-$e)}},this),B=this.predictFromCorrections(S,t);B.length>0&&ie===void 0&&(ie=-Math.log(S[0].p)),b=b.concat(B);var oe=ve[0].totalCost;if(oe>=ie+8)break;if(b.length>=r.MAX_SUGGESTIONS){if(oe>=ie+4)break;if(b.sort(function(j,fe){return fe.p-j.p}),b[r.MAX_SUGGESTIONS-1].p>Math.exp(-oe))break}}}catch(O){n={error:O}}finally{try{G&&!G.done&&(i=ae.return)&&i.call(ae)}finally{if(n)throw n.error}}}else{var S=void 0;f?(S=[{sample:c,p:1}],A=c):S=e.map(function(O){var j=O.sample;return te.isWhitespace(j)&&!f||te.isBackspace(j)&&!v?null:O}),S=S.filter(function(O){return!!O}),b=this.predictFromCorrections(S,t)}var ue={},se=null;s.languageUsesCasing&&(se=this.detectCurrentCasing(p));var bt=this.wordbreak(t);try{for(var xe=(0,T.__values)(b),de=xe.next();!de.done;de=xe.next()){var H=de.value,ge=H.sample.displayAs,Re=ge==d;if(this.lexicalModel.languageUsesCasing&&(Re=Re||ge==this.lexicalModel.applyCasing("lower",d)),Re)if(m)m.p&&H.p&&(m.p+=H.p);else{var Fe=H.sample.transform,De={insert:d,deleteLeft:Fe.deleteLeft,deleteRight:Fe.deleteRight,id:Fe.id},kt=h(De,H.p);m=this.toAnnotatedSuggestion(kt,"keep",U.noQuotes),m.matchesModel=!0,m.transformId=H.sample.transformId}else{se&&se!="lower"&&(this.applySuggestionCasing(H.sample,bt,se),ge=H.sample.displayAs);var Ze=ue[ge];Ze?Ze.p+=H.p:ue[ge]=H}}}catch(O){a={error:O}}finally{try{de&&!de.done&&(l=xe.return)&&l.call(xe)}finally{if(a)throw a.error}}if(!m&&d!=""){var De=(0,T.__assign)({},c),Je=h(De,1);Je.displayAs=d,m=this.toAnnotatedSuggestion(Je,"keep"),m.matchesModel=!1}for(var _t in ue){var xt=ue[_t];o.push(xt)}o=o.sort(function(O,j){return j.p-O.p});var ye=o.splice(0,r.MAX_SUGGESTIONS).map(function(O){return O.sample.p&&(O.sample["lexical-p"]=O.sample.p,O.sample["correction-p"]=O.p/O.sample.p,O.sample.p=O.p),O.sample});m&&(ye=[m].concat(ye));var je=this;return ye.forEach(function(O){var j=je.tokenize(t);if(j&&j.caretSplitsToken?O.transform.insert+=u.insertAfterWord:t.right?u.insertAfterWord!=""&&t.right.indexOf(u.insertAfterWord)!=0&&(O.transform.insert+=u.insertAfterWord):O.transform.insert+=u.insertAfterWord,A){var fe=le(A,O.transform);fe.id=O.transformId;var Te=O;Te.transform=fe}O.id=je.SUGGESTION_ID_SEED,je.SUGGESTION_ID_SEED++}),y&&(y.tail.replacements=ye.map(function(O){return{suggestion:O,tokenWidth:1}})),ye},r.prototype.applySuggestionCasing=function(e,t,n){var i=t.kmwLength()-e.transform.deleteLeft;i>0&&(e.transform.deleteLeft+=i,e.transform.insert=t.kmwSubstr(0,i)+e.transform.insert),e.transform.insert=this.lexicalModel.applyCasing(n,e.transform.insert),e.displayAs=this.lexicalModel.applyCasing(n,e.displayAs)},r.prototype.toAnnotatedSuggestion=function(e,t,n){n===void 0&&(n=U.default);var i=U,a=i.noQuotes;return(t=="keep"||t=="revert")&&(a=i.useQuotes),{transform:e.transform,transformId:e.transformId,displayAs:i.apply(n,e.displayAs,this.punctuation,a),tag:t,p:e.p}},r.determinePunctuationFromModel=function(e){var t=St;if(!e.punctuation)return t;var n=e.punctuation,i=n.insertAfterWord;i!==""&&!i&&(i=t.insertAfterWord);var a=n.quotesForKeepSuggestion;a||(a=t.quotesForKeepSuggestion);var l=n.isRTL;return{insertAfterWord:i,quotesForKeepSuggestion:a,isRTL:l}},r.prototype.acceptSuggestion=function(e,t,n){var i=e.transform,a=t.left.kmwSubstr(-i.deleteLeft,i.deleteLeft),l=i.insert.kmwLength(),o={insert:a,deleteLeft:l},s=t;n&&(o=le(o,n),s=z(n,s));var u,c=this.tokenize(s);c?(c.left.length>0?u=c.left[c.left.length-1]:u="",u+=c.caretSplitsToken?c.right[0]:""):u=this.wordbreak(s);var f=h(o);f.displayAs=u;var v=this.toAnnotatedSuggestion(f,"revert");if(e.transformId!=null&&(v.transformId=-e.transformId),e.id!=null?v.id=-e.id:(v.id=-this.SUGGESTION_ID_SEED,this.SUGGESTION_ID_SEED++),this.contextTracker){var p=this.contextTracker.newest;p||(p=this.contextTracker.analyzeState(this.lexicalModel,t)),p.tail.activeReplacementId=e.id;var d=z(e.transform,t);this.contextTracker.analyzeState(this.lexicalModel,d)}return v},r.prototype.applyReversion=function(e,t){var n=this,i=function(){var u=z(e.transform,t),c=n.predict({insert:"",deleteLeft:0},u);return c.forEach(function(f){f.transformId=-e.transformId}),c};if(!this.contextTracker)return i();for(var a=!1,l=this.contextTracker.count-1;l>=0;l--){var o=this.contextTracker.item(l);if(o.tail.activeReplacementId==-e.id){a=!0;break}}if(!a)return i();for(;this.contextTracker.newest.tail.activeReplacementId!=-e.id;)this.contextTracker.popNewest();this.contextTracker.newest.tail.revert();var s=this.contextTracker.newest.tail.replacements.map(function(u){return u.suggestion});return s.forEach(function(u){u.transformId=-e.transformId}),s},r.prototype.wordbreak=function(e){var t=this.lexicalModel;if(t.wordbreaker||!t.wordbreak){var n=t.wordbreaker||ce;return Oe(n,e)}else return t.wordbreak(e)},r.prototype.tokenize=function(e){var t=this.lexicalModel;return t.wordbreaker?Z(t.wordbreaker,e):null},r.prototype.resetContext=function(e){this.contextTracker&&(this.contextTracker.clearCache(),this.contextTracker.analyzeState(this.lexicalModel,e,null))},r.prototype.detectCurrentCasing=function(e){var t,n=this.lexicalModel,i=this.wordbreak(e);if(!n.languageUsesCasing)throw"Invalid attempt to detect casing: languageUsesCasing is set to false";if(!n.applyCasing)throw"Invalid LMLayer state:  languageUsesCasing is set to true, but no applyCasing function exists";return e.casingForm=="upper"||e.casingForm=="initial"?e.casingForm:n.applyCasing("lower",i)==i?"lower":n.applyCasing("upper",i)==i?i.kmwLength()>1?"upper":"initial":n.applyCasing("initial",i)==i?"initial":(t=e.casingForm)!==null&&t!==void 0?t:null},r.MAX_SUGGESTIONS=12,r.SINGLE_CHAR_KEY_PROB_EXPONENT=16,r}(),wt=mt,St={quotesForKeepSuggestion:{open:"\\u201C",close:"\\u201D"},insertAfterWord:" "};K();var Ct=function(){function r(e){e===void 0&&(e={importScripts:null,postMessage:null}),this._testMode=!1,this._postMessage=e.postMessage||postMessage,this._importScripts=e.importScripts||importScripts,this.setupConfigState()}return r.prototype.error=function(e,t){this.cast("error",{log:e,error:t&&t.stack?t.stack:void 0})},r.prototype.onMessage=function(e){var t=e.data.message;if(!t)throw new Error("Missing required \'message\' property: ".concat(e.data));var n=e.data;if(n.message=="load"){var i=n,a=!1;if(this._currentModelSource&&i.source.type==this._currentModelSource.type&&(i.source.type=="file"&&i.source.file==this._currentModelSource.file||i.source.type=="raw"&&i.source.code==this._currentModelSource.code)&&(a=!0),a){typeof console!="undefined"&&console.warn("Duplicate model load message detected - squashing!");return}else this._currentModelSource=i.source}else n.message=="unload"&&(this._currentModelSource=null);this.state.handleMessage(n)},r.prototype.cast=function(e,t){var n=this._postMessage;n((0,T.__assign)({message:e},t))},r.prototype.loadModel=function(e){try{var t=e.configure(this._platformCapabilities);t.leftContextCodePoints||(t.leftContextCodePoints=t.leftContextCodeUnits),t.rightContextCodePoints||(t.rightContextCodePoints=t.rightContextCodeUnits),t.leftContextCodePoints||(t.leftContextCodePoints=this._platformCapabilities.maxLeftContextCodePoints),t.rightContextCodePoints||(t.rightContextCodePoints=this._platformCapabilities.maxRightContextCodePoints||0),e.languageUsesCasing&&!e.applyCasing&&(e.applyCasing=g);var n=this.transitionToReadyState(e);t.wordbreaksAfterSuggestions===void 0&&(t.wordbreaksAfterSuggestions=n.punctuation.insertAfterWord!=""),this.cast("ready",{configuration:t})}catch(i){this.error("loadModel failed!",i)}},r.prototype.loadModelFile=function(e){try{this._importScripts(e)}catch(t){this.error("Error occurred when attempting to load dictionary",t)}},r.prototype.unloadModel=function(){this.transitionToLoadingState()},r.prototype.setupConfigState=function(){var e=this;this.state={name:"unconfigured",handleMessage:function(t){if(t.message!=="config")throw new Error("invalid message; expected \'config\' but got ".concat(t.message));e._platformCapabilities=t.capabilities,e._testMode=!!t.testMode,e.transitionToLoadingState()}}},r.prototype.transitionToLoadingState=function(){var e=this;this.state={name:"modelless",handleMessage:function(t){if(t.message!=="load")throw new Error("invalid message; expected \'load\' but got ".concat(t.message));if(t.source.type=="file")e.loadModelFile(t.source.file);else{var n=t.source.code,i=new Function("LMLayerWorker","models","correction","wordBreakers",n);i(e,X,qe,Pe)}}}},r.prototype.transitionToReadyState=function(e){var t=this,n=new wt(e,this._testMode);return this.state={name:"ready",handleMessage:function(i){switch(i.message){case"predict":var a=i.transform,f=i.context,c=n.predict(a,f);t.cast("suggestions",{token:i.token,suggestions:c});break;case"wordbreak":var l=Oe(e.wordbreaker||ce,i.context);t.cast("currentword",{token:i.token,word:l});break;case"unload":t.unloadModel();break;case"accept":var o=i.suggestion,f=i.context,s=i.postTransform,u=n.acceptSuggestion(o,f,s);t.cast("postaccept",{token:i.token,reversion:u});break;case"revert":var u=i.reversion,f=i.context,c=n.applyReversion(u,f);t.cast("postrevert",{token:i.token,suggestions:c});break;case"reset-context":var f=i.context;n.resetContext(f);break;default:throw new Error("invalid message; expected one of {\'predict\', \'wordbreak\', \'accept\', \'revert\', \'reset-context\', \'unload\'} but got ".concat(i.message))}},compositor:n},n},r.install=function(e){var t=new r({postMessage:e.postMessage,importScripts:e.importScripts.bind(e)});return e.onmessage=t.onMessage.bind(t),t.self=e,e.LMLayerWorker=t,e.models=X,e.correction=qe,e.wordBreakers=Pe,t},r}(),Ye=Ct;typeof self!="undefined"&&"postMessage"in self&&"importScripts"in self?Ye.install(self):window.LMLayerWorker=Ye}();\n',ai="";var $l=function(){function i(){}return i.constructInstance=function(){return new Worker(this.asBlobURI(oi))},i.asBlobURI=function(t){var e=Et(t);e+="\n"+ai;var n=new Blob([e],{type:"text/javascript"});return URL.createObjectURL(n)},i}(),kn=$l;var Bi=function(){function i(t,e){this.suggestions=t,this.transcriptionID=e}return i}();var es=function(i){(0,d.__extends)(t,i);function t(e,n,c){c===void 0&&(c=!1);var r=i.call(this)||this;r._mayPredict=!0,r._mayCorrect=!0,r._state="inactive",r.recentTranscriptions=n;var l={maxLeftContextCodePoints:64,maxRightContextCodePoints:c?0:64};return e&&(r.lmEngine=new En(l,e)),r}return Object.defineProperty(t.prototype,"activeModel",{get:function(){return this.currentModel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isConfigured",{get:function(){return!!this.configuration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t.prototype.unloadModel=function(){this.lmEngine.unloadModel(),delete this.currentModel,delete this.configuration,this._state="inactive",this.emit("statechange","inactive")},t.prototype.loadModel=function(e){var n=this;if(!e)throw new Error("Null reference not allowed.");var c=e.path?"file":"raw",r=c=="file"?e.path:e.code;return this.currentModel=e,this.mayPredict&&(this._state="active",this.emit("statechange","active")),this.lmEngine.loadModel(r,c).then(function(l){n.configuration=l,n.mayPredict&&(n._state="configured",n.emit("statechange","configured"))}).catch(function(l){var s;l instanceof Error?s=l.message:s=String(l),console.error("Could not load model '"+e.id+"': "+s),n.currentModel=null,n._state="inactive",n.emit("statechange","inactive")})},t.prototype.invalidateContext=function(e,n){if(this.emit("invalidatesuggestions","context"),!this.currentModel||!this.configuration)return Promise.resolve([]);if(this.isActive){if(e){var c=e.buildTranscriptionFrom(e,null,!1);return this.predict_internal(c,!0,n)}}else return Promise.resolve([])},t.prototype.wordbreak=function(e,n){if(!this.isActive)return null;var c=new Xe(M.from(e,!1),this.configuration,n);return this.lmEngine.wordbreak(c)},t.prototype.predict=function(e,n){return!this.isActive||!this.currentModel||!this.configuration?null:(this.emit("invalidatesuggestions","new"),this.predict_internal(e,!1,n))},t.prototype.applySuggestion=function(e,n,c){var r=this;if(!n)throw"Accepting suggestions requires a destination OutputTarget instance.";if(!this.isConfigured)return console.warn("Could not apply suggestion; the corresponding model has been unloaded"),null;var l=this.getPredictionState(e.transformId);if(l){var s=M.from(l.preInput,!1);s.apply(e.transform);var o=s.buildTransformFrom(n);n.apply(o),this.emit("suggestionapplied",n);var a=M.from(l.preInput,!1);a.apply(l.transform);var B=new Xe(l.preInput,this.configuration,c()),g=this.lmEngine.acceptSuggestion(e,B,l.transform);return g=g.then(function(u){var F={transform:l.transform,transformId:-l.token,displayAs:u.displayAs,id:u.id,tag:u.tag};return r.predictFromTarget(n,c()),F}),g}else return console.warn("Could not apply the Suggestion!"),null},t.prototype.applyReversion=function(e,n){var c=this;if(!n)throw"Accepting suggestions requires a destination OutputTarget instance.";var r=this.getPredictionState(-e.transformId);if(!r){console.warn("Could not apply the Suggestion!");return}var l=M.from(r.preInput,!1);l.apply(e.transform);var s=l.buildTransformFrom(n);n.apply(s);var o=this.lmEngine.revertSuggestion(e,new Xe(r.preInput,this.configuration,null));return o.then(function(a){var B=new Bi(a,s.id);return c.emit("suggestionsready",B),c.currentPromise=null,a})},t.prototype.predictFromTarget=function(e,n){if(!e)return null;var c=e.buildTranscriptionFrom(e,null,!1);return this.predict(c,n)},t.prototype.predict_internal=function(e,n,c){var r=this;if(!e)return null;var l=new Xe(e.preInput,this.configuration,c);this.recordTranscription(e),n&&this.lmEngine.resetContext(l);var s=e.alternates;(!s||s.length==0)&&(s=[{sample:e.transform,p:1}]);var o=e.transform,a=this.currentPromise=this.lmEngine.predict(s,l);return a.then(function(B){if(a==r.currentPromise){var g=new Bi(B,o.id);r.emit("suggestionsready",g),r.currentPromise=null}return B})},t.prototype.recordTranscription=function(e){this.recentTranscriptions.save(e)},t.prototype.getPredictionState=function(e){return this.recentTranscriptions.get(e)},t.prototype.shutdown=function(){this.lmEngine.shutdown()},Object.defineProperty(t.prototype,"isActive",{get:function(){return this.canEnable()?(this.activeModel||!1)&&this._mayPredict:(this._mayPredict=!1,!1)},enumerable:!1,configurable:!0}),t.prototype.canEnable=function(){return!!this.lmEngine},Object.defineProperty(t.prototype,"mayPredict",{get:function(){return this._mayPredict},set:function(e){if(!!this.canEnable()){var n=this._mayPredict;if(this._mayPredict=e,n!=e&&this.activeModel){var c=e?"active":"inactive";this._state=c,this.emit("statechange",c),e&&this.isConfigured&&(this._state="configured",this.emit("statechange","configured"))}}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mayCorrect",{get:function(){return this._mayCorrect},set:function(e){this._mayCorrect=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordbreaksAfterSuggestions",{get:function(){return this.configuration.wordbreaksAfterSuggestions},enumerable:!1,configurable:!0}),t.prototype.tryAcceptSuggestion=function(e){return this.emit("tryaccept",e),!1},t.prototype.tryRevertSuggestion=function(){return this.emit("tryrevert"),!1},t}(di.default),Yn=es;var ts=10,wn=function(){function i(){this.map=new Map}return i.prototype.get=function(t){var e=this.map.get(t);return e&&this.save(e),e},i.prototype.save=function(t){var e=t.token>=0?t.token:-t.token;this.map.delete(e),this.map.set(e,t),this.map.size>ts&&this.map.delete(this.map.keys().next().value)},i}();var ns=function(){function i(t,e,n){if(this.contextCache=new wn,!t)throw new Error("device must be defined");n||(n=i.DEFAULT_OPTIONS),this.contextDevice=t,this.kbdProcessor=new Un(t,n),this.lngProcessor=new Yn(e,this.contextCache)}return Object.defineProperty(i.prototype,"languageProcessor",{get:function(){return this.lngProcessor},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"keyboardProcessor",{get:function(){return this.kbdProcessor},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"keyboardInterface",{get:function(){return this.keyboardProcessor.keyboardInterface},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"activeKeyboard",{get:function(){return this.keyboardInterface.activeKeyboard},set:function(t){this.keyboardInterface.activeKeyboard=t,this.resetContext()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"activeModel",{get:function(){return this.languageProcessor.activeModel},enumerable:!1,configurable:!0}),i.prototype.processKeyEvent=function(t,e){var n=t.srcKeyboard&&this.activeKeyboard!=t.srcKeyboard,c=this.activeKeyboard;try{if(n&&(this.keyboardInterface.activeKeyboard=t.srcKeyboard),t.baseTranscriptionToken){var r=this.contextCache.get(t.baseTranscriptionToken);r?(!Oe(r.transform)||!r.preInput.isEqual(M.from(e)))&&e.restoreTo(r.preInput):console.warn("The base context for the multitap could not be found")}return this._processKeyEvent(t,e)}finally{n&&(this.keyboardInterface.activeKeyboard=c)}},i.prototype._processKeyEvent=function(t,e){var n,c=t.device.formFactor,r=t.isSynthetic;if((c==v.FormFactor.Desktop||!this.activeKeyboard||this.activeKeyboard.usesDesktopLayoutOnDevice(t.device))&&r&&this.keyboardProcessor.selectLayer(t))return new ue;if(this.keyboardProcessor.doModifierPress(t,e,!r)&&!r)return new ue;if(this.languageProcessor.isActive){if((t.kName=="K_BKSP"||t.Lcode==b.keyCodes.K_BKSP)&&this.languageProcessor.tryRevertSuggestion())return new ue;if((t.kName=="K_SPACE"||t.Lcode==b.keyCodes.K_SPACE)&&this.languageProcessor.tryAcceptSuggestion("space"))return new ue}var l=M.from(e,!0),s=this.keyboardProcessor.layerId,o=this.keyboardProcessor.processKeystroke(t,e);t.kNextLayer&&this.keyboardProcessor.selectLayer(t);var a=b.isKnownOSKModifierKey(t.kName);Oe((n=o==null?void 0:o.transcription)===null||n===void 0?void 0:n.transform)&&t.kNextLayer&&(a=!0);var B=o!=null;if(B){var g=a?null:this.buildAlternates(o,t,l);o.finalize(this.keyboardProcessor,e,!1),g&&g.length>0&&(o.transcription.alternates=g)}else o=new ue,o.transcription=e.buildTranscriptionFrom(e,null,!1),o.triggersDefaultCommand=!0;this.contextCache.save(o.transcription);var u=o.setStore[O.TSS_LAYER]||t.kNextLayer;this.keyboardProcessor.newLayerStore.set(u?this.keyboardProcessor.layerId:""),this.keyboardProcessor.oldLayerStore.set(u?s:"");var F=this.keyboardProcessor.processPostKeystroke(this.contextDevice,e);return F&&F.finalize(this.keyboardProcessor,e,!0),o.predictionPromise=this.languageProcessor.predict(o.transcription,this.keyboardProcessor.layerId),o.triggersDefaultCommand||e.doInputEvent(),B?o:null},i.prototype.buildAlternates=function(t,e,n){var c,r,l;if(this.languageProcessor.isActive&&!t.triggersDefaultCommand){var s=e.keyDistribution,o=new Xe(n,Xe.ENGINE_RULE_WINDOW,this.keyboardProcessor.layerId),a=o.toMock();if(this.languageProcessor.isActive&&s&&e.kbdLayer){var B=Number.MAX_VALUE,g=_e(),u=void 0;g.performance&&g.performance.now&&(u=function(){return g.performance.now()},B=u()+16);var F=Math.exp(-5);s.sort(function(G,V){return V.p-G.p}),l=[];var I=0;try{for(var y=(0,d.__values)(s),Q=y.next();!Q.done;Q=y.next()){var h=Q.value;if(h.p<F){I+=h.p;break}else if(u&&u()>=B)break;var C=M.from(a,!1),x=h.keySpec;if(!x){console.warn("Internal error:  failed to properly filter set of keys for corrections");continue}var U=this.keyboardProcessor.activeKeyboard.constructKeyEvent(x,e.device,this.keyboardProcessor.stateKeys),p=this.keyboardProcessor.processKeystroke(U,C);if(p&&!p.beep&&h.p>0){var X=p.transcription.transform;X.id=t.transcription.token,l.push({sample:X,p:h.p}),I+=h.p}}}catch(G){c={error:G}}finally{try{Q&&!Q.done&&(r=y.return)&&r.call(y)}finally{if(c)throw c.error}}l.forEach(function(G){G.p/=I})}}return l},i.prototype.resetContext=function(t){this.keyboardProcessor.resetContext(t),this.languageProcessor.invalidateContext(t,this.keyboardProcessor.layerId)},i.DEFAULT_OPTIONS={baseLayout:"us"},i}(),On=ns;var gi=N(T(),1),cs=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this)||this;c.initNewContext=!0,c._currentSuggestions=[],c.recentAccept=!1,c.swallowPrediction=!1,c.doRevert=!1,c.recentRevert=!1,c.doTryAccept=function(l){!c.recentAccept&&c.selected?c.accept(c.selected):c.recentAccept&&l=="space"&&(c.recentAccept=!1)},c.doTryRevert=function(){c.doRevert?(c.doRevert=!1,c.recentAccept=!1):c.recentAccept&&(c.showRevert(),c.swallowPrediction=!0)},c.invalidateSuggestions=function(l){c.initNewContext=!1,(!c.swallowPrediction||l=="context")&&(c.recentAccept=!1,c.doRevert=!1,c.recentRevert=!1,l=="context"&&(c.swallowPrediction=!1,c.initNewContext=!0)),l!="new"&&c.clearSuggestions()},c.updateSuggestions=function(l){var s,o,a=l.suggestions;c._currentSuggestions=a,c.keepSuggestion=null;try{for(var B=(0,d.__values)(a),g=B.next();!g.done;g=B.next()){var u=g.value;u.tag=="keep"&&(c.keepSuggestion=u)}}catch(F){s={error:F}}finally{try{g&&!g.done&&(o=B.return)&&o.call(B)}finally{if(s)throw s.error}}c.keepSuggestion&&c._currentSuggestions.splice(c._currentSuggestions.indexOf(c.keepSuggestion),1),c.swallowPrediction?c.swallowPrediction=!1:(c.recentAccept=!1,c.doRevert=!1,c.recentRevert=!1),c.sendUpdateEvent()},c.onModelStateChange=function(l){(l=="configured"||l=="inactive")&&c.resetContext()},c.langProcessor=e,c.kbdProcessor=n;var r=function(){return c.currentTarget&&e.state=="configured"};return c.suggestionApplier=function(l){if(r())return e.applySuggestion(l,c.currentTarget,function(){return n.layerId})},c.suggestionReverter=function(l){r()&&e.applyReversion(l,c.currentTarget)},c.postApplicationHandler=function(){var l;n.newLayerStore.set(""),n.oldLayerStore.set(""),(l=n.processPostKeystroke(n.contextDevice,c.currentTarget))===null||l===void 0||l.finalize(n,c.currentTarget,!0)},c.connect(),c}return Object.defineProperty(t.prototype,"currentTarget",{get:function(){return this._currentTarget},enumerable:!1,configurable:!0}),t.prototype.setCurrentTarget=function(e){var n=this._currentTarget;return this._currentTarget=e,n!=e?this.resetContext():Promise.resolve([])},t.prototype.connect=function(){this.langProcessor.addListener("invalidatesuggestions",this.invalidateSuggestions),this.langProcessor.addListener("suggestionsready",this.updateSuggestions),this.langProcessor.addListener("tryaccept",this.doTryAccept),this.langProcessor.addListener("tryrevert",this.doTryRevert),this.langProcessor.addListener("statechange",this.onModelStateChange),this.langProcessor.addListener("suggestionapplied",this.postApplicationHandler)},t.prototype.disconnect=function(){this.langProcessor.removeListener("invalidatesuggestions",this.invalidateSuggestions),this.langProcessor.removeListener("suggestionsready",this.updateSuggestions),this.langProcessor.removeListener("tryaccept",this.doTryAccept),this.langProcessor.removeListener("tryrevert",this.doTryRevert),this.langProcessor.removeListener("statechange",this.onModelStateChange),this.langProcessor.removeListener("suggestionapplied",this.postApplicationHandler),this.clearSuggestions()},Object.defineProperty(t.prototype,"currentSuggestions",{get:function(){var e=[];return this.activateKeep()&&this.keepSuggestion&&this.keepSuggestion.matchesModel?e.push(this.keepSuggestion):this.doRevert&&e.push(this.revertSuggestion),e.concat(this._currentSuggestions)},enumerable:!1,configurable:!0}),t.prototype.acceptInternal=function(e){return e?e.tag=="revert"?(this.suggestionReverter(e),null):this.suggestionApplier(e):null},t.prototype.accept=function(e){var n=this;return this.selected=null,this.doRevert=!1,this.revertAcceptancePromise=this.acceptInternal(e),this.revertAcceptancePromise?(this.revertAcceptancePromise.then(function(c){c&&(n.revertSuggestion=c)}),this.recentAccept=!0,this.recentRevert=!1,this.swallowPrediction=!0,this.revertAcceptancePromise):(e&&e.tag=="revert"&&(this.recentAccept=!1,this.recentRevert=!0),Promise.resolve(null))},t.prototype.showRevert=function(){this.doRevert=!0,this.sendUpdateEvent()},t.prototype.clearSuggestions=function(){this.updateSuggestions({suggestions:[],transcriptionID:0})},t.prototype.activateKeep=function(){return!this.recentAccept&&!this.recentRevert&&!this.initNewContext},t.prototype.sendUpdateEvent=function(){this.emit("update",this.currentSuggestions)},t.prototype.resetContext=function(){var e=this.currentTarget;return e?this.langProcessor.invalidateContext(e,this.kbdProcessor.layerId):Promise.resolve([])},t}(gi.default),Mn=cs;var ui=function(){function i(t,e,n,c){this.Pelem=t,this.Peventname=e.toLowerCase(),this.Phandler=n,this.PuseCapture=c}return i.prototype.equals=function(t){return this.Pelem==t.Pelem&&this.Peventname==t.Peventname&&this.Phandler==t.Phandler&&this.PuseCapture==t.PuseCapture},i}(),Ve=function(){function i(){this.domEvents=[]}return i.prototype.attachDOMEvent=function(t,e,n,c){this.detachDOMEvent(t,e,n,c),t.addEventListener(e,n,!!c);var r=new ui(t,e,n,c);this.domEvents.push(r)},i.prototype.detachDOMEvent=function(t,e,n,c){t.removeEventListener(e,n,c);for(var r=new ui(t,e,n,c),l=0;l<this.domEvents.length;l++)if(this.domEvents[l].equals(r)){this.domEvents.splice(l,1);break}},i.prototype.shutdown=function(){for(var t=0,e=this.domEvents;t<e.length;t++){var n=e[t];this.detachDOMEvent(n.Pelem,n.Peventname,n.Phandler,n.PuseCapture)}},i}();var Dn=N(T(),1),kt=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return e instanceof Dn.default?(e.on=n.listenerRegistrationSpy("listeneradded",e,e.on),e.addListener=n.listenerRegistrationSpy("listeneradded",e,e.addListener),e.off=n.listenerRegistrationSpy("listenerremoved",e,e.off),e.removeListener=n.listenerRegistrationSpy("listenerremoved",e,e.off)):(e.addEventListener=n.listenerRegistrationSpy("listeneradded",e,e.addEventListener),e.removeEventListener=n.listenerRegistrationSpy("listenerremoved",e,e.removeEventListener)),n}return t.prototype.listenerRegistrationSpy=function(e,n,c){var r=this;return function(l,s){var o=c.apply(n,[l,s]);return r.emit(e,l),o}},t}(Dn.default);var Yt=function(){function i(){this.events={},this.currentEvents=[]}return i.prototype.addEventListener=function(t,e){return this._removeEventListener(t,e),this.events[t].push(e),!0},i.prototype.removeEventListener=function(t,e){return this._removeEventListener(t,e)},i.prototype._removeEventListener=function(t,e){typeof this.events[t]=="undefined"&&(this.events[t]=[]);for(var n=0;n<this.events[t].length;n++)if(this.events[t][n]==e)return this.events[t].splice(n,1),!0;return!1},i.prototype.callEvent=function(t,e){if(typeof this.events[t]=="undefined")return!0;if(this.currentEvents.indexOf(t)!=-1)return!1;this.currentEvents.push(t);for(var n=0;n<this.events[t].length;n++){var c=this.events[t][n],r=!1;try{r=c(e)}catch(l){console.error(l),r=!1}if(r===!1)return this.currentEvents.pop(),!1}return this.currentEvents.pop(),!0},i.prototype.listenerCount=function(t){var e=this.events[t];return e?e.length:0},i.prototype.shutdown=function(){this.events={}},i}();var is=function(){function i(t){t===void 0&&(t=!1),this.fileLocal=t}return i.prototype.request=function(t){var e=new J,n=window.setTimeout(function(){e.reject(new Error($c))},1e4),c="&timerid="+n,r=t+c,l=document.createElement("script");l.onload=function(s){window.clearTimeout(n),e.isResolved||e.reject(new Error(ei))},l.onerror=function(s,o,a,B,g){window.clearTimeout(n);var u=Jn;g&&(u=u+": "+g.message),e.reject(new Error(u))},this.fileLocal?l.src=t:l.src=r;try{document.body.appendChild(l)}catch(s){document.getElementsByTagName("head")[0].appendChild(l)}return e.finally(function(){clearTimeout(n)}),{promise:e,queryId:n}},i}(),Fi=is;function rs(){return typeof window.KeymanWeb_BaseLayout!="undefined"?window.KeymanWeb_BaseLayout:"us"}var ls=function(){function i(t,e,n,c){var r=this;this.legacyAPIEvents=new Yt,this.keyEventListener=function(s,o){var a,B=r.contextManager.activeTarget;if(!r.contextManager.activeKeyboard||!B){o&&o(null,null);return}if(r.core.languageProcessor.mayCorrect||(s.keyDistribution=[]),r.keyEventRefocus&&r.keyEventRefocus(),B.invalidateSelection(),B.deadkeys().deleteMatched(),s.isSynthetic){var g=r.osk.vkbd.layerId;g&&g!=r.core.keyboardProcessor.layerId&&(r.core.keyboardProcessor.layerId=g)}var u=r.core.processKeyEvent(s,B);u&&((a=u.transcription)===null||a===void 0?void 0:a.transform)&&r.config.onRuleFinalization(u,r.contextManager.activeTarget),o&&o(u,null)},this.config=e,this.contextManager=n;var l=c(this);l.baseLayout=rs(),this.interface=l.keyboardInterface,this.core=new On(e.hostDevice,t,l),this.core.languageProcessor.on("statechange",function(s){var o,a;(o=r.osk)===null||o===void 0||o.bannerController.selectBanner(s),(a=r.osk)===null||a===void 0||a.refreshLayout()}),this.core.keyboardProcessor.on("statekeychange",function(s){var o,a;(a=(o=r.osk)===null||o===void 0?void 0:o.vkbd)===null||a===void 0||a.updateStateKeys(s)}),this.contextManager.on("beforekeyboardchange",function(s){r.legacyAPIEvents.callEvent("beforekeyboardchange",{internalName:s==null?void 0:s.id,languageCode:s==null?void 0:s.langId})}),this.contextManager.on("keyboardchange",function(s){s||r.osk.startHide(!1);var o=function(){var a,B;r.refreshModel(),r.core.activeKeyboard=s==null?void 0:s.keyboard,r.legacyAPIEvents.callEvent("keyboardchange",{internalName:(a=s==null?void 0:s.metadata.id)!==null&&a!==void 0?a:"",languageCode:(B=s==null?void 0:s.metadata.langId)!==null&&B!==void 0?B:""})};r.osk?r.osk.batchLayoutAfter(function(){o(),r.osk.activeKeyboard=s,r.contextManager.resetContext(),r.osk.present()}):(o(),r.contextManager.resetContext())}),this.contextManager.on("keyboardasyncload",function(s){var o,a;r.config.hostDevice.touchable&&((o=r.osk)===null||o===void 0?void 0:o.activationModel)&&(r.osk.activationModel.enabled=!0),(a=r.osk)===null||a===void 0||a.startHide(!1)})}return i.prototype.init=function(t){return(0,d.__awaiter)(this,void 0,void 0,function(){var e,n,c,r=this;return(0,d.__generator)(this,function(l){return e=this.config,e.deferForInitialization.isResolved?[2,Promise.resolve()]:(e.initialize(t),String.kmwEnableSupplementaryPlane(!0),n=new li(this.interface,e.applyCacheBusting),this.keyboardRequisitioner=new Wn(n,new Fi,this.config.paths),this.modelCache=new Hn,c=this.keyboardRequisitioner.cache,this.contextManager.configure({resetContext:function(s){r.osk?r.osk.batchLayoutAfter(function(){r.core.resetContext(s)}):r.core.resetContext(s)},predictionContext:new Mn(this.core.languageProcessor,this.core.keyboardProcessor),keyboardCache:this.keyboardRequisitioner.cache}),this.config.on("spacebartext",function(){var s;(s=r.osk)===null||s===void 0||s.refreshLayout()}),c.on("stubadded",function(s){var o=function(){r.legacyAPIEvents.callEvent("keyboardregistered",{internalName:s.KI,language:s.KL,keyboardName:s.KN,languageCode:s.KLC,package:s.KP}),r.config.activateFirstKeyboard&&r.keyboardRequisitioner.cache.defaultStub==s&&r.contextManager.activateKeyboard(s.id,s.langId,!0)};r.config.deferForInitialization.isResolved?o():r.config.deferForInitialization.then(o)}),c.on("keyboardadded",function(s){var o=function(){r.legacyAPIEvents.callEvent("keyboardloaded",{keyboardName:s.id})};r.config.deferForInitialization.isResolved?o():r.config.deferForInitialization.then(o)}),this.keyboardRequisitioner.cache.on("keyboardadded",function(s){r.legacyAPIEvents.callEvent("keyboardloaded",{keyboardName:s.id})}),[2])})})},Object.defineProperty(i.prototype,"build",{get:function(){return Number.parseInt(Re.VERSION_PATCH,10)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"version",{get:function(){return Re.VERSION_RELEASE},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hardKeyboard",{get:function(){return this._hardKeyboard},set:function(t){this._hardKeyboard&&this._hardKeyboard.off("keyevent",this.keyEventListener),this._hardKeyboard=t,t.on("keyevent",this.keyEventListener)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"osk",{get:function(){return this._osk},set:function(t){var e;this._osk&&(this._osk.off("keyevent",this.keyEventListener),this.core.keyboardProcessor.layerStore.handler=this.osk.layerChangeHandler),this._osk=t,this.core.keyboardProcessor.contextDevice=(e=t==null?void 0:t.targetDevice)!==null&&e!==void 0?e:this.config.softDevice,t&&(this.contextManager.activeKeyboard&&(t.activeKeyboard=this.contextManager.activeKeyboard),t.on("keyevent",this.keyEventListener),this.core.keyboardProcessor.layerStore.handler=t.layerChangeHandler)},enumerable:!1,configurable:!0}),i.prototype.getDebugInfo=function(){var t,e,n,c,r,l,s,o,a,B,g,u,F,I,y=(t=this.contextManager)===null||t===void 0?void 0:t.activeKeyboard,Q={configReport:(e=this.config)===null||e===void 0?void 0:e.debugReport(),keyboard:{id:me((c=(n=y==null?void 0:y.metadata)===null||n===void 0?void 0:n.id)!==null&&c!==void 0?c:""),langId:((r=y==null?void 0:y.metadata)===null||r===void 0?void 0:r.langId)||"",version:(s=(l=y==null?void 0:y.keyboard)===null||l===void 0?void 0:l.version)!==null&&s!==void 0?s:""},model:{id:((a=(o=this.core)===null||o===void 0?void 0:o.activeModel)===null||a===void 0?void 0:a.id)||""},osk:{banner:(u=(g=(B=this.osk)===null||B===void 0?void 0:B.banner)===null||g===void 0?void 0:g.banner.type)!==null&&u!==void 0?u:"",layer:((I=(F=this.osk)===null||F===void 0?void 0:F.vkbd)===null||I===void 0?void 0:I.layerId)||""}};return Q},i.prototype.refreshModel=function(){var t=this.contextManager.activeKeyboard,e=this.modelCache.modelForLanguage(t==null?void 0:t.metadata.langId);return this.core.activeModel!=e&&(this.core.activeModel&&this.core.languageProcessor.unloadModel(),e)?this.core.languageProcessor.loadModel(e).then(function(){return e}):Promise.resolve(e)},i.prototype.addEventListener=function(t,e){this.legacyAPIEvents.addEventListener(t,e)},i.prototype.removeEventListener=function(t,e){this.legacyAPIEvents.removeEventListener(t,e)},i.prototype.shutdown=function(){var t;this.legacyAPIEvents.shutdown(),(t=this.osk)===null||t===void 0||t.shutdown()},i.prototype.addModel=function(t){var e;this.modelCache.register(t);var n=(e=this.contextManager.activeKeyboard)===null||e===void 0?void 0:e.metadata;return n&&t.languages.indexOf(n.langId)!=-1?this.refreshModel().then(function(){}):Promise.resolve()},i.prototype.removeModel=function(t){this.modelCache.unregister(t),this.core.activeModel&&this.core.activeModel.id==t&&this.core.languageProcessor.unloadModel()},i.prototype.setActiveKeyboard=function(t,e){return(0,d.__awaiter)(this,void 0,void 0,function(){return(0,d.__generator)(this,function(n){return[2,this.contextManager.activateKeyboard(t,e,!0)]})})},i.prototype.getActiveKeyboard=function(){var t,e;return(e=(t=this.contextManager.activeKeyboard)===null||t===void 0?void 0:t.metadata.id)!==null&&e!==void 0?e:""},i.prototype.getActiveLanguage=function(t){var e,n,c,r=(e=this.contextManager.activeKeyboard)===null||e===void 0?void 0:e.metadata;return t?(c=r==null?void 0:r.langName)!==null&&c!==void 0?c:"":(n=r==null?void 0:r.langId)!==null&&n!==void 0?n:""},i.prototype.isChiral=function(t){var e;if(t){if(typeof t=="string"){var n=this.keyboardRequisitioner.cache.getKeyboard(t);if(n)t=n;else throw new Error("Keyboard '".concat(t,"' has not been loaded."))}e=t}else e=this.core.activeKeyboard;return e.isChiral},i.prototype.resetContext=function(){this.contextManager.resetContext()},i.prototype.setNumericLayer=function(){this.core.keyboardProcessor.setNumericLayer(this.config.softDevice)},i}(),zn=ls;var Xr=N(T(),1);var Ii=N(T(),1);var Qe=function(){function i(t){var e=k("div");e.id=i.BANNER_ID,e.className=i.BANNER_CLASS,this.div=e,this.height=t,this.update()}return Object.defineProperty(i.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t>0?t:0,this.update()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this.update()},enumerable:!1,configurable:!0}),i.prototype.update=function(){var t=this.div.style,e=t.height,n=t.display;return this._height>0?(t.height=this._height+"px",t.display="block"):(t.height="0px",t.display="none"),e!==t.height||n!==t.display},i.prototype.appendStyleSheet=function(){},i.prototype.getDiv=function(){return this.div},i.prototype.configureForKeyboard=function(t,e){},i.DEFAULT_HEIGHT=37,i.BANNER_CLASS="kmw-banner-bar",i.BANNER_ID="kmw-banner-bar",i}();var f=function(){function i(t){var e=typeof t=="string"?i.parseLengthStyle(t):t;this.val=e.val,this.absolute=e.absolute,e.special&&(this.special=e.special)}return Object.defineProperty(i.prototype,"styleString",{get:function(){return this.absolute?this.val+"px":this.special?this.val+this.special:this.val*100+"%"},enumerable:!1,configurable:!0}),i.prototype.scaledBy=function(t){return new i({val:t*this.val,absolute:this.absolute})},i.inPixels=function(t){return new i({val:t,absolute:!0})},i.inPercent=function(t){return new i({val:t/100,absolute:!1})},i.forScalar=function(t){return new i({val:t,absolute:!1})},i.special=function(t,e){return new i({val:t,absolute:!1,special:e})},i.parseLengthStyle=function(t){if(t=="")return yi;var e=parseFloat(t);return isNaN(e)?(console.error("Could not properly parse specified length style info: '"+t+"'."),yi):t.indexOf("px")!=-1?{val:e,absolute:!0}:t.indexOf("pt")!=-1?{val:4*e/3,absolute:!0}:t.indexOf("%")!=-1?{val:e/100,absolute:!1}:t.indexOf("rem")!=-1?{val:e,absolute:!1,special:"rem"}:t.indexOf("em")!=-1?{val:e,absolute:!1,special:"em"}:{val:4*e/3,absolute:!0}},i}();var yi=new f("1em");var je=function(i){(0,d.__extends)(t,i);function t(){var e=i.call(this,0)||this;return e.type="blank",e}return t}(Qe);var Qi=function(){function i(){this._activeBannerHeight=Qe.DEFAULT_HEIGHT,this.events=new Ii.default,this.constructContainer()}return i.prototype.constructContainer=function(){var t=k("div");return t.id="keymanweb_banner_container",t.className="kmw-banner-container",this.bannerContainer=t},Object.defineProperty(i.prototype,"element",{get:function(){return this.bannerContainer},enumerable:!1,configurable:!0}),i.prototype.appendStyles=function(){this.currentBanner&&this.currentBanner.appendStyleSheet()},Object.defineProperty(i.prototype,"banner",{get:function(){return this.currentBanner},set:function(t){if(this.currentBanner){if(t==this.currentBanner)return;var e=this.currentBanner;this.currentBanner=t,this.bannerContainer.replaceChild(t.getDiv(),e.getDiv())}else this.currentBanner=t,t&&this.bannerContainer.appendChild(t.getDiv());t instanceof je||(t.height=this.activeBannerHeight),this.events.emit("bannerchange")},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this.currentBanner?this.currentBanner.height:0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"activeBannerHeight",{get:function(){return this._activeBannerHeight},set:function(t){this._activeBannerHeight=t,this.currentBanner&&!(this.currentBanner instanceof je)&&(this.currentBanner.height=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"layoutHeight",{get:function(){return f.inPixels(this.height)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){var t;return(t=this.currentBanner)===null||t===void 0?void 0:t.width},set:function(t){this.currentBanner&&(this.currentBanner.width=t)},enumerable:!1,configurable:!0}),i.prototype.refreshLayout=function(){var t,e;(e=(t=this.currentBanner).refreshLayout)===null||e===void 0||e.call(t)},i}();var hi=function(i){(0,d.__extends)(t,i);function t(e,n){var c=this;e.length>0?(c=i.call(this)||this,n&&(c.height=n)):c=i.call(this,0)||this,c.type="image",e.indexOf("base64")>=0?console.log("Loading img from base64 data"):console.log("Loading img with src '"+e+"'"),c.img=document.createElement("img"),c.img.setAttribute("src",e);var r=c.img.style;return r.width="100%",r.height="100%",c.getDiv().appendChild(c.img),console.log("Image loaded."),c}return t.prototype.setImagePath=function(e){this.img&&this.img.setAttribute("src",e)},t}(Qe);function pe(i,t){t instanceof Error?console.error("".concat(i,": ").concat(t.message,"\n\n").concat(t.stack)):(console.error(i),console.error(t))}var Ci=function(){function i(t){this.queue=[],this.defaultWaitFactory=t||function(){return de(0)}}return Object.defineProperty(i.prototype,"defaultWait",{get:function(){return this.defaultWaitFactory()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"ready",{get:function(){return this.queue.length==0&&!this.waitLock},enumerable:!1,configurable:!0}),i.prototype.triggerNextClosure=function(){return(0,d.__awaiter)(this,void 0,void 0,function(){var t,e,n;return(0,d.__generator)(this,function(c){switch(c.label){case 0:if(this.queue.length==0)return[2];t=this.queue.shift(),this.waitLock=Promise.resolve();try{e=t()}catch(r){pe("Error from queued closure",r)}e=e!=null?e:this.defaultWaitFactory(),this.waitLock=e,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,e];case 2:return c.sent(),[3,4];case 3:return n=c.sent(),pe("Async error from queued closure",n),[3,4];case 4:return this.waitLock=null,this.triggerNextClosure(),[2]}})})},i.prototype.runAsync=function(t){var e=this.ready;this.queue.push(t),e&&this.triggerNextClosure()},i}();function bi(i){return"targetX"in i&&"targetY"in i&&"t"in i}var He=function(){function i(t){if(this.rawLinearSums={x:0,y:0,t:0},this.coordArcSum=0,this._sampleCount=0,!!t)if(t instanceof i)Object.assign(this,t),this.rawLinearSums=(0,d.__assign)({},t.rawLinearSums);else if(bi(t))Object.assign(this,this.extend(t));else throw new Error("A constructor for this input pattern has not yet been implemented")}return i.prototype.extend=function(t){return this._extend(new i(this),t)},i.prototype._extend=function(t,e){t._initialSample||(t._initialSample=e,t.baseSample=e);var n=t.baseSample;this.followingSample=e;var c=e.targetX-n.targetX,r=e.targetY-n.targetY,l=e.t-n.t;if(t.rawLinearSums.x+=c,t.rawLinearSums.y+=r,t.rawLinearSums.t+=l,this.lastSample){var s=e.targetX-this.lastSample.targetX,o=e.targetY-this.lastSample.targetY,a=e.t-this.lastSample.t,B=s*s+o*o,g=Math.sqrt(B);t.coordArcSum+=g}return t._lastSample=e,t.sampleCount=this.sampleCount+1,t},i.prototype.deaccumulate=function(t){var e=new i(this);return this._deaccumulate(e,t)},i.prototype._deaccumulate=function(t,e){if(!e)return t;if(!e.followingSample||!e.lastSample)throw"Invalid argument:  stats missing necessary tracking variable.";for(var n in t.rawLinearSums){var c=n;t.rawLinearSums[c]-=e.rawLinearSums[c]}if(e.followingSample&&e.lastSample){var r=e.followingSample.targetX-e.lastSample.targetX,l=e.followingSample.targetY-e.lastSample.targetY,s=e.followingSample.t-e.lastSample.t,o=r*r+l*l,a=Math.sqrt(o);t.coordArcSum-=a,t.coordArcSum-=e.coordArcSum}return t.sampleCount-=e.sampleCount,t._initialSample=e.followingSample,t},i.prototype.translateCoordSystem=function(t){var e=new i(this);return this._translateCoordSystem(e,t)},i.prototype._translateCoordSystem=function(t,e){if(this.sampleCount==0)return t;var n=t.initialSample==t.lastSample;return t._initialSample=e(t.initialSample),t.baseSample=e(t.baseSample),t._lastSample=n?t._initialSample:e(t.lastSample),t},i.prototype.replaceInitialSample=function(t){var e=new i(this);return this._replaceInitialSample(e,t)},i.prototype._replaceInitialSample=function(t,e){if(this.sampleCount==0)throw new Error("no sample available to replace");var n=t.initialSample;if(t._initialSample=e,this.sampleCount>1){var c=e.targetX-n.targetX,r=e.targetY-n.targetY,l=e.t-n.t;t.rawLinearSums.x+=c,t.rawLinearSums.y+=r,t.rawLinearSums.t+=l;var s=c*c+r*r,o=Math.sqrt(s);t.coordArcSum+=o}else t._lastSample=e;return t},Object.defineProperty(i.prototype,"lastSample",{get:function(){return this._lastSample},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"lastTimestamp",{get:function(){var t;return(t=this.lastSample)===null||t===void 0?void 0:t.t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sampleCount",{get:function(){return this._sampleCount},set:function(t){this._sampleCount=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"initialSample",{get:function(){return this._initialSample},enumerable:!1,configurable:!0}),i.prototype.mappingConstant=function(t){if(!!this.baseSample)return t=="t"?this.baseSample.t:t=="x"?this.baseSample.targetX:t=="y"?this.baseSample.targetY:0},i.prototype.mean=function(t){return this.rawLinearSums[t]/this.sampleCount+this.mappingConstant(t)},Object.defineProperty(i.prototype,"netDistance",{get:function(){if(!this.lastSample||!this.initialSample)return 0;var t=this.lastSample.targetX-this.initialSample.targetX,e=this.lastSample.targetY-this.initialSample.targetY;return Math.sqrt(t*t+e*e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"duration",{get:function(){return!this.lastSample||!this.initialSample?0:this.lastSample.t-this.initialSample.t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"angle",{get:function(){if(!(this.sampleCount==1||!this.lastSample||!this.initialSample)&&!(this.netDistance<1)){var t=this.lastSample.targetX-this.initialSample.targetX,e=this.lastSample.targetY-this.initialSample.targetY,n=Math.acos(-e/this.netDistance);return t<0?2*Math.PI-n:n}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"angleInDegrees",{get:function(){return this.angle*180/Math.PI},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cardinalDirection",{get:function(){if(!(this.sampleCount==1||!this.lastSample||!this.initialSample)&&!(isNaN(this.angle)||this.angle===null||this.angle===void 0)){var t=["n","ne","e","se","s","sw","w","nw","n"],e=Math.ceil((this.angleInDegrees-22.5)/45);return t[e]}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"speed",{get:function(){return this.duration?this.netDistance/this.duration:0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rawDistance",{get:function(){return this.coordArcSum},enumerable:!1,configurable:!0}),i.prototype.toJSON=function(){return{angle:this.angle,cardinal:this.cardinalDirection,netDistance:this.netDistance,duration:this.duration,sampleCount:this.sampleCount,rawDistance:this.rawDistance}},i}();var xi=function(){function i(){}return i.prototype.getBoundingClientRect=function(){return new DOMRect(0,0,Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),Math.max(document.documentElement.clientHeight||0,window.innerHeight||0))},i}();var he=function(){function i(t,e){Array.isArray(t)&&(e=t,t=new xi),this.root=t,e=e||[0,0,0,0],this.updatePadding(e)}return Object.defineProperty(i.prototype,"edgePadding",{get:function(){return this._edgePadding},enumerable:!1,configurable:!0}),i.prototype.updatePadding=function(t){switch(t.length){case 1:var e=t[0];this._edgePadding={x:e,y:e,w:2*e,h:2*e};break;case 2:this._edgePadding={x:t[1],y:t[0],w:2*t[1],h:2*t[0]};break;case 3:this._edgePadding={x:t[1],y:t[0],w:2*t[1],h:t[0]+t[2]};break;case 4:this._edgePadding={x:t[3],y:t[0],w:t[1]+t[3],h:t[0]+t[2]};break;default:throw new Error("Invalid values for PaddedZoneSource's edgePadding - must be between 1 to 4 `number` values.")}},i.prototype.getBoundingClientRect=function(){var t=this.root.getBoundingClientRect();return new DOMRect(t.left+this.edgePadding.x,t.top+this.edgePadding.y,t.width-this.edgePadding.w,t.height-this.edgePadding.h)},i}();function wt(i){var t,e,n,c,r,l,s,o=(0,d.__assign)({},i);if(o.mouseEventRoot=(t=o.mouseEventRoot)!==null&&t!==void 0?t:o.targetRoot,o.touchEventRoot=(e=o.touchEventRoot)!==null&&e!==void 0?e:o.targetRoot,o.inputStartBounds=(n=o.inputStartBounds)!==null&&n!==void 0?n:o.targetRoot,o.maxRoamingBounds=(c=o.maxRoamingBounds)!==null&&c!==void 0?c:o.targetRoot,o.safeBounds=(r=o.safeBounds)!==null&&r!==void 0?r:new he([2]),o.itemIdentifier=(l=o.itemIdentifier)!==null&&l!==void 0?l:function(){return null},o.recordingMode=!!o.recordingMode,o.historyLength=((s=o.historyLength)!==null&&s!==void 0?s:0)>0?o.historyLength:0,i.paddedSafeBounds)delete o.safeBoundPadding;else{var a=i.safeBoundPadding;typeof a=="number"&&(a=[a]),a=a!=null?a:[3],o.paddedSafeBounds=new he(o.safeBounds,a)}return o}var Gi=N(T(),1);var Ui=N(T(),1);var Ot=function(i){(0,d.__extends)(t,i);function t(){var e=i.call(this)||this;return e._isComplete=!1,e._stats=new He,e}return Object.defineProperty(t.prototype,"stats",{get:function(){return this._stats},enumerable:!1,configurable:!0}),t.prototype.clone=function(){var e=new t;return e._isComplete=this._isComplete,e._wasCancelled=this._wasCancelled,e._stats=new He(this._stats),e},Object.defineProperty(t.prototype,"isComplete",{get:function(){return this._isComplete},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wasCancelled",{get:function(){return this._wasCancelled},enumerable:!1,configurable:!0}),t.prototype.translateCoordSystem=function(e){this._stats=this._stats.translateCoordSystem(e)},t.prototype.replaceInitialSample=function(e){this._stats=this._stats.replaceInitialSample(e)},t.prototype.extend=function(e){if(this._isComplete)throw new Error("Invalid state:  this GesturePath has already terminated.");this._stats=this._stats.extend(e),this.emit("step",e)},t.prototype.terminate=function(e){e===void 0&&(e=!1),!this._isComplete&&(this._wasCancelled=e,this._isComplete=!0,e?this.emit("invalidated"):this.emit("complete"),this.removeAllListeners())},t.prototype.toJSON=function(){return{stats:this.stats,wasCancelled:this.wasCancelled}},t}(Ui.default);var qe=function(i){(0,d.__extends)(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.samples=[],e}return t.prototype.clone=function(){var e=new t;return e.samples=[].concat(this.samples),e._isComplete=this._isComplete,e._wasCancelled=this._wasCancelled,e._stats=new He(this._stats),e},t.deserialize=function(e){var n=new t;n.samples=[].concat(e.coords.map(function(r){return(0,d.__assign)({},r)})),n._isComplete=!0,n._wasCancelled=e.wasCancelled;var c=n.samples.reduce(function(r,l){return r.extend(l)},new He);return n._stats=c,n},t.prototype.extend=function(e){if(this.isComplete)throw new Error("Invalid state:  this GesturePath has already terminated.");this.samples.push(e),i.prototype.extend.call(this,e)},t.prototype.translateCoordSystem=function(e){i.prototype.translateCoordSystem.call(this,e);for(var n=0;n<this.samples.length;n++)this.samples[n]=e(this.samples[n])},Object.defineProperty(t.prototype,"coords",{get:function(){return this.samples},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){for(var e={coords:[].concat(this.samples.map(function(l){return{targetX:l.targetX,targetY:l.targetY,t:l.t,item:l.item}})),wasCancelled:this.wasCancelled,stats:this.stats},n=0,c=e.coords;n<c.length;n++){var r=c[n];delete r.clientX,delete r.clientY,r.item===void 0&&delete r.item}return e},t}(Ot);var Ge=function(){function i(t,e,n,c){this.stateToken=null,this.rawIdentifier=t,this.isFromTouch=n,this._path=c?new c:new Ot,this.recognizerConfigStack=Array.isArray(e)?e:[e]}return Object.defineProperty(i.prototype,"path",{get:function(){return this._path},enumerable:!1,configurable:!0}),i.prototype.setGestureMatchInspector=function(t){if(this._matchInspectionClosure)throw new Error("Invalid state:  the match-inspection closure has already been set");this._matchInspectionClosure=t},i.prototype.update=function(t){this.path.extend(t),this._baseItem||(this._baseItem=t.item)},Object.defineProperty(i.prototype,"baseItem",{get:function(){return this._baseItem},set:function(t){this._baseItem=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentSample",{get:function(){return this.path.stats.lastSample},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"potentialModelMatchIds",{get:function(){return this._matchInspectionClosure(this)},enumerable:!1,configurable:!0}),i.prototype.constructSubview=function(t,e,n){return new se(this,this.recognizerConfigStack,t,e,n)},i.prototype.terminate=function(t){this.path.terminate(t)},Object.defineProperty(i.prototype,"isPathComplete",{get:function(){return this.path.isComplete},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"identifier",{get:function(){var t=this.isFromTouch?"touch":"mouse";return"".concat(t,":").concat(this.rawIdentifier)},enumerable:!1,configurable:!0}),i.prototype.pushRecognizerConfig=function(t){var e=(0,d.__assign)((0,d.__assign)({},t),{mouseEventRoot:this.recognizerConfigStack[0].mouseEventRoot,touchEventRoot:this.recognizerConfigStack[0].touchEventRoot});this.recognizerConfigStack.push(wt(e))},i.prototype.popRecognizerConfig=function(){if(this.recognizerConfigStack.length==1)throw new Error("Cannot 'pop' the original recognizer-configuration for this GestureSource.");return this.recognizerConfigStack.pop()},Object.defineProperty(i.prototype,"currentRecognizerConfig",{get:function(){return this.recognizerConfigStack[this.recognizerConfigStack.length-1]},enumerable:!1,configurable:!0}),i.prototype.toJSON=function(){var t={identifier:this.identifier,isFromTouch:this.isFromTouch,path:this.path.toJSON(),stateToken:this.stateToken};return t},i}();var se=function(i){(0,d.__extends)(t,i);function t(e,n,c,r,l){var s=this,o=0,a=e.path.stats.sampleCount;e instanceof t&&(o=e._baseStartIndex),s=i.call(this,e.rawIdentifier,n,e.isFromTouch,Object.getPrototypeOf(e.path).constructor)||this;var B=s._baseSource=e instanceof t?e._baseSource:e;s.stateToken=l!=null?l:e.stateToken;var g=function(Q){var h=s.recognizerTranslation,C=(0,d.__assign)((0,d.__assign)({},Q),{targetX:Q.targetX-h.x,targetY:Q.targetY-h.y});return s.stateToken&&(C.stateToken=s.stateToken),(s.stateToken!=B.stateToken||s.stateToken!=e.stateToken)&&(C.item=s.currentRecognizerConfig.itemIdentifier(C,null)),C},u=e.path.stats.lastSample;c?(s._baseStartIndex=o=Math.max(o+a-1,0),a=a>0?1:0):s._baseStartIndex=o,c?e.path.stats.sampleCount&&s._path.extend(e.path.stats.lastSample):s._path=e.path.clone(),s._path.translateCoordSystem(g),r?s._baseItem=e.baseItem:s._baseItem=u==null?void 0:u.item;var F=function(){return s.path.terminate(!1)},I=function(){return s.path.terminate(!0)},y=function(Q){i.prototype.update.call(s,g(Q))};return B.path.on("complete",F),B.path.on("invalidated",I),B.path.on("step",y),s.subviewDisconnector=function(){B.path.off("complete",F),B.path.off("invalidated",I),B.path.off("step",y)},B.isPathComplete&&(s.path.terminate(B.path.wasCancelled),s.disconnect()),s}return Object.defineProperty(t.prototype,"recognizerTranslation",{get:function(){if(this.recognizerConfigStack.length==1||!this.currentRecognizerConfig)return{x:0,y:0};var e=this.currentRecognizerConfig,n=e.targetRoot.getBoundingClientRect(),c=this.recognizerConfigStack[0].targetRoot.getBoundingClientRect();return{x:n.left-c.left,y:n.top-c.top}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"baseSource",{get:function(){return this._baseSource},enumerable:!1,configurable:!0}),t.prototype.disconnect=function(){this.subviewDisconnector&&(this.subviewDisconnector(),this.subviewDisconnector=null)},t.prototype.pushRecognizerConfig=function(e){throw new Error("Pushing and popping of recognizer configurations should only be called on the base GestureSource")},t.prototype.popRecognizerConfig=function(){throw new Error("Pushing and popping of recognizer configurations should only be called on the base GestureSource")},t.prototype.update=function(e){throw new Error("Updates should be provided through the base GestureSource.")},t.prototype.terminate=function(e){this.baseSource.terminate(e)},t}(Ge);var pi=function(i){(0,d.__extends)(t,i);function t(e,n,c){var r=i.call(this,e,n,c,qe)||this;return r.stateToken=null,r}return t.prototype.initPath=function(){return new qe},t.deserialize=function(e,n){var c=n!==void 0?n:this._jsonIdSeed++,r=e.isFromTouch,l=qe.deserialize(e.path),s=new t(c,null,r);return s._path=l,s},t}(Ge);var mi=function(i){(0,d.__extends)(t,i);function t(e){var n=this,c;return n=i.call(this)||this,n._activeTouchpoints=[],n.identifierMap={},n.config=e,n.sourceConstructor=!((c=e==null?void 0:e.recordingMode)!==null&&c!==void 0)||c?pi:Ge,n}return t.prototype.createTouchpoint=function(e,n){var c=t.IDENTIFIER_SEED++;this.identifierMap[e]=c;var r=new this.sourceConstructor(c,this.config,n);return r.stateToken=this.stateToken,r},t.prototype.fulfillInputStart=function(e){},t.prototype.maintainTouchpoints=function(e){e||(e=[]),this._activeTouchpoints.filter(function(n){return!e.includes(n)}).forEach(function(n){return n.terminate(!0)})},t.prototype.hasActiveTouchpoint=function(e){return this.identifierMap[e]!==void 0},t.prototype.getTouchpointWithId=function(e){var n=this.identifierMap[e];return this._activeTouchpoints.find(function(c){return c.rawIdentifier==n})},t.prototype.getConfigForId=function(e){return this.getTouchpointWithId(e).currentRecognizerConfig},t.prototype.getStateTokenForId=function(e){var n;return(n=this.getTouchpointWithId(e).stateToken)!==null&&n!==void 0?n:null},t.prototype.dropTouchpoint=function(e){var n=e.rawIdentifier;this._activeTouchpoints=this._activeTouchpoints.filter(function(s){return e!=s});for(var c=0,r=Object.keys(this.identifierMap);c<r.length;c++){var l=r[c];this.identifierMap[l]==n&&delete this.identifierMap[l]}},t.prototype.addTouchpoint=function(e){this._activeTouchpoints.push(e)},Object.defineProperty(t.prototype,"activeSources",{get:function(){return[].concat(this._activeTouchpoints)},enumerable:!1,configurable:!0}),t.IDENTIFIER_SEED=0,t}(Gi.default);function Kn(i,t,e){var n=i.targetRoot.getBoundingClientRect();return{clientX:t,clientY:e,targetX:t-n.left,targetY:e-n.top}}var Mt=function(i){(0,d.__extends)(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.buildSampleFor=function(e,n,c,r,l){var s,o,a=(0,d.__assign)((0,d.__assign)({},Kn(this.config,e,n)),{t:r,stateToken:(s=l==null?void 0:l.stateToken)!==null&&s!==void 0?s:this.stateToken}),B=(o=l==null?void 0:l.currentRecognizerConfig.itemIdentifier)!==null&&o!==void 0?o:this.config.itemIdentifier,g=B(a,c);return a.item=g,a},t.prototype.onInputStart=function(e,n,c,r){var l=this,s=this.createTouchpoint(e,r);s.update(n),this.addTouchpoint(s),s.path.on("invalidated",function(){l.dropTouchpoint(s)}),s.path.on("complete",function(){l.dropTouchpoint(s)});try{this.emit("pointstart",s)}catch(o){pe("Engine-internal error while initializing gesture matching for new source",o)}return s},t.prototype.onInputMove=function(e,n,c){if(!!e)try{e.update(n)}catch(r){pe("Error occurred while updating source",r)}},t.prototype.onInputMoveCancel=function(e,n,c){if(!!e)try{e.update(n),e.path.terminate(!0)}catch(r){pe("Error occurred while cancelling further input for source",r)}},t.prototype.onInputEnd=function(e,n){if(!!e)try{e.path.terminate(!1)}catch(c){pe("Error occurred while finalizing input for source",c)}},t}(mi);var Ne=function(){function i(){}return i.getCoordZoneBitmask=function(t,e){var n=e.getBoundingClientRect(),c=0;return c|=t.clientX<n.left?i.FAR_LEFT:0,c|=t.clientX>n.right?i.FAR_RIGHT:0,c|=t.clientY<n.top?i.FAR_TOP:0,c|=t.clientY>n.bottom?i.FAR_BOTTOM:0,c},i.inputStartOutOfBoundsCheck=function(t,e){return!!this.getCoordZoneBitmask(t,e.inputStartBounds)},i.inputStartSafeBoundProximityCheck=function(t,e){return this.getCoordZoneBitmask(t,e.paddedSafeBounds)},i.inputMoveCancellationCheck=function(t,e,n){if(n=n||0,this.getCoordZoneBitmask(t,e.maxRoamingBounds))return!0;var c=this.getCoordZoneBitmask(t,e.safeBounds);return!!(c&~n)},i.FAR_TOP=8,i.FAR_LEFT=4,i.FAR_BOTTOM=2,i.FAR_RIGHT=1,i}();var Xi=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this,e)||this;return n.hasActiveClick=!1,n.disabledSafeBounds=0,n.currentSource=null,n.activeIdentifier=0,n._mouseStart=function(c){return n.onMouseStart(c)},n._mouseMove=function(c){return n.onMouseMove(c)},n._mouseEnd=function(c){return n.onMouseEnd(c)},n}return Object.defineProperty(t.prototype,"eventRoot",{get:function(){return this.config.mouseEventRoot},enumerable:!1,configurable:!0}),t.prototype.registerEventHandlers=function(){this.eventRoot.addEventListener("mousedown",this._mouseStart,!0),this.eventRoot.addEventListener("mousemove",this._mouseMove,!1),this.eventRoot.addEventListener("mouseup",this._mouseEnd,!0)},t.prototype.unregisterEventHandlers=function(){this.eventRoot.removeEventListener("mousedown",this._mouseStart,!0),this.eventRoot.removeEventListener("mousemove",this._mouseMove,!1),this.eventRoot.removeEventListener("mouseup",this._mouseEnd,!0)},t.prototype.preventPropagation=function(e){e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,typeof e.stopImmediatePropagation=="function"?e.stopImmediatePropagation():typeof e.stopPropagation=="function"&&e.stopPropagation()},t.prototype.buildSampleFromEvent=function(e){return this.buildSampleFor(e.clientX,e.clientY,e.target,performance.now(),this.currentSource)},t.prototype.onMouseStart=function(e){var n=this;if(!!this.config.targetRoot.contains(e.target)){this.preventPropagation(e);var c=this.buildSampleFromEvent(e);Ne.inputStartOutOfBoundsCheck(c,this.config)||(this.disabledSafeBounds=Ne.inputStartSafeBoundProximityCheck(c,this.config));var r=this.onInputStart(this.activeIdentifier,c,e.target,!1);this.currentSource=r;var l=function(){n.currentSource=null};r.path.on("complete",l),r.path.on("invalidated",l)}},t.prototype.onMouseMove=function(e){var n=this.currentSource;if(!!n){var c=this.buildSampleFromEvent(e);if(!e.buttons){this.hasActiveClick&&(this.hasActiveClick=!1,this.onInputMoveCancel(n,c,e.target));return}this.preventPropagation(e);var r=n.currentRecognizerConfig;Ne.inputMoveCancellationCheck(c,r,this.disabledSafeBounds)?this.onInputMoveCancel(n,c,e.target):this.onInputMove(n,c,e.target)}},t.prototype.onMouseEnd=function(e){var n=this.currentSource;!n||(e.buttons||(this.hasActiveClick=!1),this.onInputEnd(n,e.target))},t}(Mt);function Vi(i){for(var t=[],e=0;e<i.length;e++)t.push(i.item(e));return t}var Zi=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this,e)||this;return n.eventDispatcher=new Ci,n.safeBoundMaskMap={},n.pendingSourcePromises=new Map,n.inputStartSignalMap=new Map,n._touchStart=function(c){return n.onTouchStart(c)},n._touchMove=function(c){return n.onTouchMove(c)},n._touchEnd=function(c){return n.onTouchEnd(c)},n}return Object.defineProperty(t.prototype,"eventRoot",{get:function(){return this.config.touchEventRoot},enumerable:!1,configurable:!0}),t.prototype.registerEventHandlers=function(){this.eventRoot.addEventListener("touchstart",this._touchStart,{capture:!0,passive:!1}),this.eventRoot.addEventListener("touchmove",this._touchMove,{capture:!1,passive:!1}),this.eventRoot.addEventListener("touchend",this._touchEnd,{capture:!0,passive:!1})},t.prototype.unregisterEventHandlers=function(){this.eventRoot.removeEventListener("touchstart",this._touchStart,!0),this.eventRoot.removeEventListener("touchmove",this._touchMove,!1),this.eventRoot.removeEventListener("touchend",this._touchEnd,!0)},t.prototype.preventPropagation=function(e){e.cancelable&&e.preventDefault(),typeof e.stopImmediatePropagation=="function"?e.stopImmediatePropagation():typeof e.stopPropagation=="function"&&e.stopPropagation()},t.prototype.dropTouchpoint=function(e){i.prototype.dropTouchpoint.call(this,e);for(var n=0,c=Object.keys(this.safeBoundMaskMap);n<c.length;n++){var r=c[n];this.getTouchpointWithId(Number.parseInt(r,10))==e&&delete this.safeBoundMaskMap[r]}},t.prototype.fulfillInputStart=function(e){var n=this.inputStartSignalMap.get(e);n&&(this.inputStartSignalMap.delete(e),n.resolve())},t.prototype.hasActiveTouchpoint=function(e){var n=i.prototype.hasActiveTouchpoint.call(this,e);return n||!!this.pendingSourcePromises.has(e)},t.prototype.buildSampleFromTouch=function(e,n,c){return this.buildSampleFor(e.clientX,e.clientY,e.target,n,c)},t.prototype.onTouchStart=function(e){var n=this;if(!!this.config.targetRoot.contains(e.target)){this.preventPropagation(e);var c=Vi(e.touches),r=Vi(e.changedTouches),l=c.filter(function(u){return r.findIndex(function(F){return u.identifier==F.identifier})==-1}),s=l.map(function(u){return n.pendingSourcePromises.get(u.identifier)});this.eventDispatcher.runAsync(function(){return(0,d.__awaiter)(n,void 0,void 0,function(){var u;return(0,d.__generator)(this,function(F){switch(F.label){case 0:return[4,Promise.all(s)];case 1:return u=F.sent(),this.maintainTouchpoints(u),[2,this.eventDispatcher.defaultWait]}})})});for(var o=new Map,a=0;a<e.changedTouches.length;a++){var B=e.changedTouches.item(a),g=new J;this.pendingSourcePromises.set(B.identifier,g),o.set(B.identifier,g)}this.eventDispatcher.runAsync(function(){for(var u=performance.now(),F=null,I=function(h){var C=e.changedTouches.item(h),x=C.identifier,U=n.buildSampleFromTouch(C,u,null);if(!Ne.inputStartOutOfBoundsCheck(U,n.config))n.safeBoundMaskMap[x]=Ne.inputStartSafeBoundProximityCheck(U,n.config);else{var p=o.get(x);return p.resolve(null),"continue"}F=n.onInputStart(x,U,e.target,!0);var X=o.get(x);X.resolve(F);var G=function(){n.pendingSourcePromises.get(x)==X&&n.pendingSourcePromises.delete(x)};F.path.on("complete",G),F.path.on("invalidated",G)},y=0;y<e.changedTouches.length;y++)I(y);if(F){var Q=new J;return n.inputStartSignalMap.set(F,Q),Q.corePromise}})}},t.prototype.onTouchMove=function(e){for(var n=this,c,r=0;r<e.touches.length;r++){var l=e.touches.item(r);if(this.hasActiveTouchpoint(l.identifier)){this.preventPropagation(e);break}}for(var s=new Map,r=0;r<e.touches.length;r++){var o=e.touches.item(r).identifier;s.set(o,(c=this.pendingSourcePromises.get(o))===null||c===void 0?void 0:c.corePromise)}this.eventDispatcher.runAsync(function(){return(0,d.__awaiter)(n,void 0,void 0,function(){var a;return(0,d.__generator)(this,function(B){switch(B.label){case 0:return[4,Promise.all(s.values())];case 1:return a=B.sent(),this.maintainTouchpoints(a),[2,this.eventDispatcher.defaultWait]}})})}),this.eventDispatcher.runAsync(function(){return(0,d.__awaiter)(n,void 0,void 0,function(){var a,B,g,u,F,I,y;return(0,d.__generator)(this,function(Q){switch(Q.label){case 0:a=performance.now(),B=0,Q.label=1;case 1:return B<e.touches.length?(g=e.touches.item(B),u=g.identifier,[4,s.get(u)]):[3,4];case 2:if(F=Q.sent(),!F||F.isPathComplete)return[3,3];I=F.currentRecognizerConfig,y=this.buildSampleFromTouch(g,a,F),Ne.inputMoveCancellationCheck(y,I,this.safeBoundMaskMap[u])?this.onInputMoveCancel(F,y,g.target):this.onInputMove(F,y,g.target),Q.label=3;case 3:return B++,[3,1];case 4:return[2,this.eventDispatcher.defaultWait]}})})})},t.prototype.onTouchEnd=function(e){for(var n=this,c,r=0;r<e.changedTouches.length;r++){var l=e.changedTouches.item(r);if(this.hasActiveTouchpoint(l.identifier)){this.preventPropagation(e);break}}for(var s=new Map,r=0;r<e.changedTouches.length;r++){var o=e.changedTouches.item(r).identifier,a=(c=this.pendingSourcePromises.get(o))===null||c===void 0?void 0:c.corePromise;s.set(o,a)}this.eventDispatcher.runAsync(function(){return(0,d.__awaiter)(n,void 0,void 0,function(){var B,g,u;return(0,d.__generator)(this,function(F){switch(F.label){case 0:B=0,F.label=1;case 1:return B<e.changedTouches.length?(g=e.changedTouches.item(B),[4,s.get(g.identifier)]):[3,4];case 2:if(u=F.sent(),!u||u.isPathComplete)return[3,3];this.onInputEnd(u,e.target),F.label=3;case 3:return B++,[3,1];case 4:return[2,this.eventDispatcher.defaultWait]}})})})},t}(Mt);var Ai=N(T(),1);var vi=N(T(),1);var fi=function(){function i(t,e,n){var c=this;if(!t||!e)throw new Error("A gesture-path source and contact-path model must be specified.");if(this.model=t,this.publishedPromise=new J,this.source=e,this.inheritedStats=n,this.lastStats=null,t.timer){var r=t.timer.inheritElapsed?Math.min(e.path.stats.duration,t.timer.duration):0;this.timerPromise=new Bt(t.timer.duration-r),this.publishedPromise.then(function(){c.timerPromise.resolve(!1)}),this.timerPromise.then(function(l){var s=e instanceof se?e.baseSource:e,o=performance.now();!s.isPathComplete&&s.currentSample.t!=o&&s.path.extend((0,d.__assign)((0,d.__assign)({},s.currentSample),{t:o})),l!=t.timer.expectedResult&&c.finalize(!1,"timer"),c.finalize(!0,"timer")})}}return Object.defineProperty(i.prototype,"promise",{get:function(){return this.publishedPromise.corePromise},enumerable:!1,configurable:!0}),i.prototype.finalize=function(t,e){if(this.publishedPromise.isFulfilled)return this._result;var n=this.model;n.validateItem&&t&&(t=n.validateItem(this.source.path.stats.lastSample.item,this.baseItem));var c;return t?c={type:n.pathResolutionAction,cause:e}:c={type:"reject",cause:e},this.publishedPromise.resolve(c),this._result=c,c},Object.defineProperty(i.prototype,"stats",{get:function(){return this.source.path.stats},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"baseItem",{get:function(){return this.source.baseItem},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"lastItem",{get:function(){return this.source.currentSample.item},enumerable:!1,configurable:!0}),i.prototype.update=function(){var t=this.model,e=this.source;if(e.path.wasCancelled)return this.finalize(!1,"path");if(t.itemChangeAction&&e.path.stats.sampleCount>0&&e.currentSample.item!=e.baseItem){var n=t.itemChangeAction=="resolve";return this.finalize(n,"item")}else{var n=t.pathModel.evaluate(e.path,this.lastStats,e.baseItem,this.inheritedStats)||"continue";return this.lastStats=e.path.stats,n!="continue"?this.finalize(n=="resolve","path"):e.path.isComplete?this.finalize(!1,"path"):{type:"continue"}}},i}();var _n=function(){function i(t,e){var n=this,c;if(this._isCancelled=!1,!t||!e)throw new Error("Construction of GestureMatcher requires a gesture-model spec and a source for related contact points.");if(!t.sustainTimer&&!e)throw new Error("If the provided gesture-model spec lacks a sustain timer, there must be an active contact point.");var r=e instanceof Ge?null:e,l=r?null:e;this.predecessor=r,this.publishedPromise=new J,this.model=t,t.sustainTimer&&(this.sustainTimerPromise=new Bt(t.sustainTimer.duration),this.sustainTimerPromise.then(function(Q){var h=t.sustainTimer.expectedResult==Q;n.finalize(h,"timer")})),this.pathMatchers=[];var s=l?[l]:r.sources,o=s.map(function(Q){return l&&Q==l?l:Q.isPathComplete?null:Q}).reduce(function(Q,h){return h?Q.concat(h):Q},[]);if(t.sustainTimer&&o.length>0){this.finalize(!1,"path");return}else!t.sustainTimer&&o.length==0&&this.finalize(!1,"path");for(var a=0;a<o.length;a++){var B=o[a],g=B;B instanceof se&&(B.disconnect(),g=B.baseSource);var u=t.contacts[a];if(!u)throw new Error('No contact model for inherited path: gesture "'.concat(t.id,"', entry ").concat(a));var F=(c=u==null?void 0:u.model.pathInheritance)!==null&&c!==void 0?c:"chop",I=!1,y=void 0;switch(F){case"reject":this.finalize(!1,"path");return;case"full":y=B.constructSubview(!1,!0),this.addContactInternal(y,B.path.stats,!0);continue;case"partial":I=!0;case"chop":y=B.constructSubview(!0,I),this.addContactInternal(y,B.path.stats,!0);break}}}return Object.defineProperty(i.prototype,"sources",{get:function(){var t=this;return this.pathMatchers.map(function(e,n){if(!t.model.contacts[n].resetOnInstantFulfill)return e.source}).filter(function(e){return!!e})},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"promise",{get:function(){return this.publishedPromise.corePromise},enumerable:!1,configurable:!0}),i.prototype.cancel=function(){this._isCancelled=!0,this._result||this.finalize(!1,"cancelled")},Object.defineProperty(i.prototype,"isCancelled",{get:function(){return this._isCancelled},enumerable:!1,configurable:!0}),i.prototype.finalize=function(t,e){var n,c;if(this.publishedPromise.isFulfilled)return this._result;try{var r=void 0;t?r=this.model.resolutionAction:(e!="cancelled"&&((n=this.model.rejectionActions)===null||n===void 0?void 0:n[e])&&(r=this.model.rejectionActions[e],r.item="none"),r=r||{type:"none",item:"none"});var l=void 0,s=(c=r.item)!==null&&c!==void 0?c:"current";switch(s){case"none":l=null;break;case"base":l=this.primaryPath.baseItem;break;case"current":l=this.primaryPath.currentSample.item;break}var o={matched:t,action:(0,d.__assign)((0,d.__assign)({},r),{item:l})};return this.publishedPromise.resolve(o),this._result=o,o}catch(a){this.publishedPromise.reject(a)}},i.prototype.finalizeSources=function(){if(!this._result)throw Error("Invalid state for source-finalization - the matcher's evaluation of the gesture model is not yet complete");for(var t=this._result.matched,e=0;e<this.pathMatchers.length;e++){var n=this.pathMatchers[e],c=this.model.contacts[e];n.source.isPathComplete||(t&&c.endOnResolve||!t&&c.endOnReject)&&n.source.terminate(!1)}},Object.defineProperty(i.prototype,"primaryPath",{get:function(){for(var t,e=Number.NEGATIVE_INFINITY,n=0,c=this.pathMatchers;n<c.length;n++){var r=c[n];r.model.itemPriority>e&&(e=r.model.itemPriority,t=r)}return!t&&this.predecessor?this.predecessor.primaryPath:t==null?void 0:t.source},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"baseItem",{get:function(){return this.primaryPath.baseItem},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentItem",{get:function(){return this.primaryPath.currentSample.item},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"allSourceIds",{get:function(){var t=this.sources.map(function(n){return n.identifier}),e=this.predecessor?this.predecessor.allSourceIds:[];return t=t.filter(function(n){return e.indexOf(n)==-1}),t.concat(e)},enumerable:!1,configurable:!0}),i.prototype.mayAddContact=function(){return this.pathMatchers.length<this.model.contacts.length},i.prototype.addContact=function(t){var e=this.pathMatchers.length;if(!this.mayAddContact())throw new Error("The specified gesture model does not support more than ".concat(e," contact points."));this.addContactInternal(t.constructSubview(!1,!0),null)},Object.defineProperty(i.prototype,"result",{get:function(){return this._result},enumerable:!1,configurable:!0}),i.prototype.addContactInternal=function(t,e,n){var c=this,r,l=this.pathMatchers.length,s=this.model.contacts[l],o=new fi(s.model,t,new He(e));this.pathMatchers.push(o);var a=null,B=null;if(!l&&this.predecessor&&this.model.sustainTimer){a=this.predecessor.primaryPath;var g=(r=this.model.sustainTimer.baseItem)!==null&&r!==void 0?r:"result",u=void 0;switch(g){case"none":B=null;break;case"base":B=this.predecessor.primaryPath.baseItem,u=this.predecessor.primaryPath.stateToken;break;case"result":B=this.predecessor.result.action.item,u=this.predecessor.primaryPath.currentSample.stateToken;break}t.baseItem=B!=null?B:t.baseItem,t.stateToken=u,t.currentSample.stateToken=u,t.currentRecognizerConfig&&(t.currentSample.item=t.currentRecognizerConfig.itemIdentifier(t.currentSample,null))}else B=this.primaryPath.baseItem,a=this.primaryPath;if(s.model.baseCoordReplacer){var F=t.path.stats,I=s.model.baseCoordReplacer(F,B);if(I){var y=(0,d.__assign)((0,d.__assign)({},Kn(t.currentRecognizerConfig,I.clientX,I.clientY)),{t:I.t||I.t===0?I.t:F.initialSample.t,item:B,stateToken:t.stateToken});t.path.replaceInitialSample(y)}}if(s.model.allowsInitialState){var Q=s.model.allowsInitialState(t.currentSample,a.currentSample,B,a.stateToken);if(!Q){this.pathMatchers.pop(),this.finalize(!1,"cancelled");return}}var h=o.update();if((h==null?void 0:h.type)=="reject"){this.finalize(!1,n?"cancelled":"path");return}o.promise.then(function(C){c.finalize(C.type=="resolve",C.cause)})},i.prototype.update=function(){var t=this;this.pathMatchers.forEach(function(e){try{e.update()}catch(n){console.error(n),t.finalize(!1,"cancelled")}})},i}();var Dt=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n._sourceSelector=[],n.potentialMatchers=[],n.sustainMode=!1,n.attemptSynchronousUpdate=function(){var c=n._sourceSelector.filter(function(s){return!s.source.isPathComplete}),r=c.map(function(s){return s.source.currentSample.t}),l=r[0];r.find(function(s){return l!=s})||n.potentialMatchers.forEach(function(s){return s.update()})},n.baseGestureSetId=e||"default",n}return t.prototype.potentialMatchersForSource=function(e){return this.potentialMatchers.filter(function(n){return n.allSourceIds.find(function(c){return c==e.identifier})})},t.prototype.cascadeTermination=function(){var e=this,n=this.potentialMatchers,c=n.filter(function(o){return!o.model.sustainWhenNested}),r=n.filter(function(o){return o.model.sustainWhenNested});this.potentialMatchers=r;var l=r.map(function(o){return o.allSourceIds}).reduce(function(o,a){for(var B=0,g=a;B<g.length;B++){var u=g[B];o.indexOf(u)==-1&&o.push(u)}return o},[]),s=this._sourceSelector.filter(function(o){return!l.find(function(a){return a==o.source.identifier})});return s.forEach(function(o){o.matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}});var a=e._sourceSelector.indexOf(o);a>-1&&e._sourceSelector.splice(a,1)}),c.forEach(function(o){return o.cancel()}),this.sustainMode=!0,this._sourceSelector.map(function(o){return o.source})},t.prototype.matchGesture=function(e,n){return(0,d.__awaiter)(this,void 0,void 0,function(){var c,r,l,s,o,a,B,g,u,F,I,y,Q,h,C,x,U,p,X,G,V=this;return(0,d.__generator)(this,function(L){switch(L.label){case 0:return c=e instanceof Ge,r=function(m){var S=m.sources.map(function(E){return E.baseSource});return S&&S.length>0?S:m.predecessor?r(m.predecessor):[]},l=c?[e instanceof se?e.baseSource:e]:r(e),s=c?e:null,o=c?null:e,this.pendingMatchSetup?(a=this.pendingMatchSetup,B=new J,this.pendingMatchSetup=B.corePromise,[4,a]):[3,2];case 1:L.sent(),this.pendingMatchSetup==B.corePromise&&(this.pendingMatchSetup=null),B.resolve(),L.label=2;case 2:return c&&s.path.on("invalidated",function(){V.dropSourcesWithIds([s.identifier])}),g=new J,u=l.map(function(m){var S={source:m,matchPromise:g,preserve:!0};return V._sourceSelector.push(S),S}),F=u.map(function(m){return m.matchPromise}),c?(I=this.potentialMatchers.filter(function(m){return m.mayAddContact()}),I.forEach(function(m){m.addContact(s),m.promise.then(V.matcherSelectionFilter(m,F))}),I.length>0?(y=this.stateToken,Q=new J,this.pendingMatchSetup=Q.corePromise,[4,de(0)]):[3,5]):[3,5];case 3:return L.sent(),[4,de(0)];case 4:if(L.sent(),this.pendingMatchSetup==Q.corePromise&&(this.pendingMatchSetup=null),Q.resolve(),h=this.stateToken,y!=h&&(C=s.currentSample,s.stateToken=h,C.stateToken=h,C.item=e.currentRecognizerConfig.itemIdentifier(C,null),s.baseItem=C.item),x=I.find(function(m){return m.result}),x&&x.allSourceIds.includes(e.identifier))return g.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),[2,{selectionPromise:g.corePromise}];L.label=5;case 5:if(u.forEach(function(m){m.preserve=!1}),this.sustainMode&&s)return g.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),[2,{selectionPromise:g.corePromise,sustainModeWithoutMatch:!0}];for(U=n.map(function(m){try{return new _n(m,s||o)}catch(S){return console.error(S),null}}).filter(function(m){return!!m}),U=U.filter(function(m){return!m.result||m.result.matched!==!1}),p=0,X=U;p<X.length;p++)G=X[p],G.promise.then(this.matcherSelectionFilter(G,F));return U.length>0?this.potentialMatchers=this.potentialMatchers.concat(U):g.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),this.potentialMatchers.sort(function(m,S){return S.model.resolutionPriority-m.model.resolutionPriority}),this.resetSourceHooks(),[2,{selectionPromise:g.corePromise}]}})})},t.prototype.resetSourceHooks=function(){var e=this,n=function(c){var r=c;r.path.off("step",e.attemptSynchronousUpdate),r.path.off("complete",e.attemptSynchronousUpdate),r.path.off("invalidated",e.attemptSynchronousUpdate),r.path.on("step",e.attemptSynchronousUpdate),r.path.on("complete",e.attemptSynchronousUpdate),r.path.on("invalidated",e.attemptSynchronousUpdate)};this._sourceSelector.forEach(function(c){return n(c.source)})},t.prototype.dropSourcesWithIds=function(e){for(var n=function(o){var a=c._sourceSelector.findIndex(function(g){return g.source.identifier==o});if(a>-1){var B=c._sourceSelector.splice(a,1)[0];B.matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"none",item:null}}})}},c=this,r=0,l=e;r<l.length;r++){var s=l[r];n(s)}},t.prototype.matchersForSource=function(e){return this.potentialMatchers.filter(function(n){return!!n.sources.find(function(c){return c.identifier==e.identifier})})},t.prototype.matcherSelectionFilter=function(e,n){var c=this;return function(r){return(0,d.__awaiter)(c,void 0,void 0,function(){var l,s,o,a,B,g,u,F,I,y=this;return(0,d.__generator)(this,function(Q){if(e.isCancelled?r={matched:!1,action:{type:"none",item:null}}:e.finalizeSources(),l=e.allSourceIds,s=l.map(function(h){return y._sourceSelector.find(function(C){return C.source.identifier==h})}).filter(function(h){return!!h}),o=this.potentialMatchers.indexOf(e),o==-1)return[2];if(this.potentialMatchers.splice(o,1),r.action.type=="none")return this.finalizeMatcherlessTrackers(s),[2];if(r.matched)for(B=function(h){var C=g.matchersForSource(h.source);g.potentialMatchers=g.potentialMatchers.filter(function(x){return!C.find(function(U){return x==U})}),C.forEach(function(x){x.cancel()}),g._sourceSelector=g._sourceSelector.filter(function(x){return!s.find(function(U){return x==U})}),h.matchPromise.resolve({matcher:e,result:r})},g=this,u=0,F=s;u<F.length;u++)I=F[u],B(I);else return a=function(h){if(y.sustainMode&&!h.sustainWhenNested){y.finalizeMatcherlessTrackers(s);return}var C=new _n(h,e);if(C.result&&C.result.matched==!1){y.finalizeMatcherlessTrackers(s);return}C.promise.then(y.matcherSelectionFilter(C,s.map(function(x){return x.matchPromise}))),y.potentialMatchers.push(C),y.resetSourceHooks()},this.emit("rejectionwithaction",{matcher:e,result:r},a),[2];return[2]})})}},t.prototype.finalizeMatcherlessTrackers=function(e){for(var n=this,c=e.map(function(o){return{tracker:o,pendingCount:n.potentialMatchers.filter(function(a){return!!a.allSourceIds.find(function(B){return o.source.identifier==B})}).length}}),r=0,l=c;r<l.length;r++){var s=l[r];s.pendingCount==0&&!s.tracker.preserve&&s.tracker.matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}})}},t}(vi.default);var Ji=N(T(),1);function $e(i,t){var e=i.gestures.find(function(n){return n.id==t});if(!e)throw new Error("Could not find spec for gesture with id '".concat(t,"'"));return e}function Li(i,t){var e=i.sets[t];if(!e)throw new Error("Could not find a defined gesture-set with id '".concat(t,"'"));var n=i.gestures.filter(function(r){return!!e.find(function(l){return r.id==l})}),c=e.filter(function(r){return!n.find(function(l){return l.id==r})});if(c.length>0)throw new Error("Set '".concat(t,"' cannot find definitions for gestures with ids ").concat(c));return n}var Si={gestures:[],sets:{default:[]}};var ss=function(){function i(t,e){var n,c,r=t.matcher,l=t.result;this.gestureSetId=e,this.matchedId=r==null?void 0:r.model.id,this.linkType=l.action.type,this.item=l.action.item,this.sources=r==null?void 0:r.sources,(n=this.sources)===null||n===void 0||n.forEach(function(s){return s.disconnect()}),(c=this.sources)===null||c===void 0||c.sort(function(s,o){return(r==null?void 0:r.primaryPath)==s?-1:(r==null?void 0:r.primaryPath)==o?1:0}),this.allSourceIds=(r==null?void 0:r.allSourceIds)||[]}return i}();var Ri=function(i){(0,d.__extends)(t,i);function t(e,n,c,r){var l=i.call(this)||this;return l.markedComplete=!1,l.selectionHandler=function(s){return(0,d.__awaiter)(l,void 0,void 0,function(){var o,a,B,g,u,F,I,y,Q,h,C,x,U,p=this,X,G,V,L,m,S,E,H,R,Y;return(0,d.__generator)(this,function(A){switch(A.label){case 0:return o=((X=this.pushedSelector)===null||X===void 0?void 0:X.baseGestureSetId)||((G=this.selector)===null||G===void 0?void 0:G.baseGestureSetId),a=new ss(s,o),s.matcher&&this.stageReports.push(a),B=(V=s.matcher)!==null&&V!==void 0?V:this.stageReports[this.stageReports.length-1],g=(L=B==null?void 0:B.sources.map(function(Z){return Z instanceof se?Z.baseSource:Z}))!==null&&L!==void 0?L:[],u=s.result.action.type,(u=="complete"||u=="none")&&(g.forEach(function(Z){Z.isPathComplete||Z.terminate(u=="none")}),!s.result.matched)?(this.markedComplete||(this.markedComplete=!0,this.emit("complete")),[2]):u=="complete"&&this.touchpointCoordinator&&this.pushedSelector?(F=(m=this.touchpointCoordinator)===null||m===void 0?void 0:m.sustainSelectorSubstack(this.pushedSelector),I=F.map(function(Z){var W=new J;return Z.path.on("invalidated",function(){return W.resolve()}),Z.path.on("complete",function(){return W.resolve()}),W.corePromise}),I.length>0&&s.result.action.awaitNested?[4,Promise.all(I)]:[3,3]):[3,4];case 1:return A.sent(),[4,de(0)];case 2:A.sent(),A.label=3;case 3:(S=this.touchpointCoordinator)===null||S===void 0||S.popSelector(this.pushedSelector),this.pushedSelector=null,A.label=4;case 4:return this.emit("stage",a,function(Z){Z.type=="pop"?g.forEach(function(W){return W.popRecognizerConfig()}):g.forEach(function(W){return W.pushRecognizerConfig(Z.config)})}),y=!1,this.touchpointCoordinator&&(y=!this.touchpointCoordinator.selectorStackIncludes(this.selector)),Q=os(s.result.action,this.gestureConfig,this.baseGestureSetId),y&&(Q=Q.filter(function(Z){return Z.sustainWhenNested})),Q.length>0?(u=="chain"&&s.result.action.selectionMode==((E=this.pushedSelector)===null||E===void 0?void 0:E.baseGestureSetId)||(this.pushedSelector&&(this.pushedSelector.off("rejectionwithaction",this.modelResetHandler),(H=this.touchpointCoordinator)===null||H===void 0||H.popSelector(this.pushedSelector),this.pushedSelector=null),u=="chain"&&(h=s.result.action.selectionMode,h&&(C=new Dt(h),C.on("rejectionwithaction",this.modelResetHandler),this.pushedSelector=C,(R=this.touchpointCoordinator)===null||R===void 0||R.pushSelector(C)))),x=(Y=this.pushedSelector)!==null&&Y!==void 0?Y:this.selector,U=x.matchGesture(s.matcher,Q),U.then(function(Z){return(0,d.__awaiter)(p,void 0,void 0,function(){var W;return(0,d.__generator)(this,function(w){switch(w.label){case 0:return W=this.selectionHandler,[4,Z.selectionPromise];case 1:return[2,W.apply(this,[w.sent()])]}})})})):this.markedComplete||(this.markedComplete=!0,this.emit("complete")),[2]}})})},l.modelResetHandler=function(s,o){var a=s.matcher.allSourceIds;if(!l.allSourceIds.find(function(B){return a.indexOf(B)==-1}))if(s.result.action.type=="replace")o($e(l.gestureConfig,s.result.action.replace));else throw new Error("Missed a case in implementation!")},l.stageReports=[],l.selector=c,l.selector.on("rejectionwithaction",l.modelResetHandler),l.once("complete",function(){var s;l.pushedSelector&&((s=l.touchpointCoordinator)===null||s===void 0||s.popSelector(l.pushedSelector),l.pushedSelector=null),l.selector.off("rejectionwithaction",l.modelResetHandler),l.selector.dropSourcesWithIds(l.allSourceIds),l.selector=null}),l.gestureConfig=n,l.touchpointCoordinator=r,Promise.resolve().then(function(){return l.selectionHandler(e)}),l}return Object.defineProperty(t.prototype,"allSourceIds",{get:function(){var e,n;return(n=(e=this.stageReports[this.stageReports.length-1])===null||e===void 0?void 0:e.allSourceIds)!==null&&n!==void 0?n:[]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"baseGestureSetId",{get:function(){var e,n;return(n=(e=this.selector)===null||e===void 0?void 0:e.baseGestureSetId)!==null&&n!==void 0?n:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"potentialModelMatchIds",{get:function(){if(!this.selector)return[];var e=[this.selector];this.pushedSelector&&e.push(this.pushedSelector);var n=this.stageReports[this.stageReports.length-1],c=n.sources,r=c.map(function(l){return e.map(function(s){return s.potentialMatchersForSource(l).map(function(o){return o.model.id})})}).reduce(function(l,s){return l.concat(s)}).reduce(function(l,s){for(var o=0,a=s;o<a.length;o++){var B=a[o];l.indexOf(B)==-1&&l.push(B)}return l},[]);return r},enumerable:!1,configurable:!0}),t.prototype.cancel=function(){var e=this.stageReports[this.stageReports.length-1].sources;e.forEach(function(n){return n.baseSource.isPathComplete||n.baseSource.terminate(!0)}),this.markedComplete||(this.markedComplete=!0,this.emit("complete"))},t.prototype.toJSON=function(){return this.stageReports},t}(Ji.default);function os(i,t,e){switch(i.type){case"none":case"complete":return[];case"replace":return[$e(t,i.replace)];case"chain":return[$e(t,i.next)];default:throw new Error("Unexpected case arose within `processGestureAction` method")}}var Wi=function(i){(0,d.__extends)(t,i);function t(e,n,c){var r=i.call(this)||this;if(r.selectorStack=[new Dt],r._activeSources=[],r._activeGestures=[],r._history=[],r.modelResetHandler=function(a,B){var g=a.matcher.allSourceIds;if(!r.activeGestures.find(function(u){return u.allSourceIds.find(function(F){return g.indexOf(F)!=-1})}))if(a.result.action.type=="replace")B($e(r.gestureModelDefinitions,a.result.action.replace));else throw new Error("Missed a case in implementation!")},r.onNewTrackedPath=function(a){return(0,d.__awaiter)(r,void 0,void 0,function(){var B,g,u,F,I,y,Q,h,C,x,U,p,X,G,V=this;return(0,d.__generator)(this,function(L){switch(L.label){case 0:this.addSimpleSourceHooks(a),B=this.gestureModelDefinitions,L.label=1;case 1:return g=this.currentSelector,F=g.matchGesture(a,Li(B,g.baseGestureSetId)),[4,F];case 2:return I=L.sent(),I.sustainModeWithoutMatch?(y=function(m){m.stateToken=V.stateToken,m.item=a.currentRecognizerConfig.itemIdentifier(m,null)},a.path instanceof qe&&a.path.coords.forEach(y),a.stateToken=this.stateToken,a.baseItem=a.path.stats.initialSample.item,y(a.path.stats.initialSample),y(a.path.stats.lastSample),[3,3]):(u=I.selectionPromise,[3,4]);case 3:if(g!=this.currentSelector)return[3,1];L.label=4;case 4:Q=this.currentSelector,a.setGestureMatchInspector(this.buildGestureMatchInspector(Q)),h=function(){V.recordHistory(a)};try{a.path.on("invalidated",h),this.emit("inputstart",a)}catch(m){pe("Error from 'inputstart' event listener",m)}return this.inputEngines.forEach(function(m){m.fulfillInputStart(a)}),[4,u];case 5:if(C=L.sent(),!C||C.result.matched==!1)return[2];for(x=C.matcher.allSourceIds,U=0,p=this._activeGestures;U<p.length;U++)if(X=p[U],X.allSourceIds.find(function(m){return!!x.find(function(S){return m==S})}))return[2];return G=new Ri(C,B,this.currentSelector,this),this._activeGestures.push(G),G.on("complete",function(){var m=V._activeGestures.indexOf(G);m!=-1&&V._activeGestures.splice(m,1)}),a.path.wasCancelled||(a.path.off("invalidated",h),G.on("complete",function(){return V.recordHistory(G)})),this.emit("recognizedgesture",G),[2]}})})},r.historyMax=c>0?c:0,r.gestureModelDefinitions=e,r.inputEngines=[],n)for(var l=0,s=n;l<s.length;l++){var o=s[l];r.addEngine(o)}return r.selectorStack[0].on("rejectionwithaction",r.modelResetHandler),r}return t.prototype.pushSelector=function(e){this.selectorStack.push(e),e.on("rejectionwithaction",this.modelResetHandler)},t.prototype.sustainSelectorSubstack=function(e){if(!e)return[];var n=this.selectorStack.indexOf(e);if(n==-1)return[];if(this.selectorStack.length<=1)throw new Error("May not force the original, base gesture selector into sustain mode.");for(var c=[],r=n;r<this.selectorStack.length;r++)e=this.selectorStack[r],c=c.concat(e.cascadeTermination());return c},t.prototype.popSelector=function(e){if(!!e){var n=this.selectorStack.indexOf(e);if(n!=-1){if(this.selectorStack.length<=1)throw new Error("May not pop the original, base gesture selector.");for(;n<this.selectorStack.length;)e=this.selectorStack[n],e.off("rejectionwithaction",this.modelResetHandler),this.selectorStack.splice(n,1);this.currentSelector.stateToken=this.stateToken}}},t.prototype.selectorStackIncludes=function(e){return this.selectorStack.includes(e)},Object.defineProperty(t.prototype,"currentSelector",{get:function(){return this.selectorStack[this.selectorStack.length-1]},enumerable:!1,configurable:!0}),t.prototype.buildGestureMatchInspector=function(e){var n=this;return function(c){var r=n.selectorStack.indexOf(e),l=n.selectorStack.slice(r);return l.map(function(s){return s.potentialMatchersForSource(c).map(function(o){return o.model.id})}).reduce(function(s,o){return s.concat(o)})}},t.prototype.addEngine=function(e){e.on("pointstart",this.onNewTrackedPath),this.inputEngines.push(e)},t.prototype.recordHistory=function(e){var n=this.historyMax;n>0&&(this._history.length==n&&this._history.shift(),this._history.push(e))},Object.defineProperty(t.prototype,"activeGestures",{get:function(){return[].concat(this._activeGestures)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeSources",{get:function(){return[].concat(this.inputEngines.map(function(e){return e.activeSources}).reduce(function(e,n){return e.concat(n)},[]))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"history",{get:function(){return this._history},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"historyJSON",{get:function(){var e=function(n,c){return n=="item"?c==null?void 0:c.id:c};return JSON.stringify(this.history,e,2)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stateToken",{get:function(){return this._stateToken},set:function(e){this._stateToken=e,this.inputEngines.forEach(function(n){return n.stateToken=e}),this.currentSelector.stateToken=e},enumerable:!1,configurable:!0}),t.prototype.addSimpleSourceHooks=function(e){var n=this;e.path.on("invalidated",function(){var c=n.activeGestures.find(function(l){return l.allSourceIds.includes(e.identifier)});c&&c.cancel();var r=n._activeSources.indexOf(e);n._activeSources=n._activeSources.splice(r,1)}),e.path.on("complete",function(){var c=n._activeSources.indexOf(e);n._activeSources=n._activeSources.splice(c,1)})},t}(Ai.default);var ht=function(i){(0,d.__extends)(t,i);function t(e,n){var c=this,r=wt(n);return e=e||Si,c=i.call(this,e,null,r.historyLength)||this,c.config=r,c.mouseEngine=new Xi(c.config),c.touchEngine=new Zi(c.config),c.mouseEngine.registerEventHandlers(),c.touchEngine.registerEventHandlers(),c.addEngine(c.mouseEngine),c.addEngine(c.touchEngine),c}return t.prototype.destroy=function(){this.activeGestures.forEach(function(e){return e.cancel()}),this.activeSources.forEach(function(e){return e.terminate(!0)}),this.mouseEngine.unregisterEventHandlers(),this.touchEngine.unregisterEventHandlers(),this.mouseEngine=null,this.touchEngine=null},t}(Wi);var Pn=["n","ne","e","se","s","sw","w","nw"],Hi=Math.PI,jn=function(){for(var i=new Map,t=Hi/4,e=0;e<Pn.length;e++)i.set(Pn[e],[t*e,1]);return i}();function zt(i){return Math.PI/4*Pn.indexOf(i)}function Ct(i,t){var e=zt(t),n=i.initialSample,c=i.lastSample.targetX-n.targetX,r=i.lastSample.targetY-n.targetY,l=Math.max(0,-r*Math.cos(e)),s=Math.max(0,c*Math.sin(e));return s+l}function as(i,t,e,n){return function(c){var r=zt(t),l=n.flick.triggerDist-n.flick.dirLockDist,s=Math.max(0,Ct(i.path.stats,t)-n.flick.dirLockDist),o=.7,a=Math.min(1,o*s/l),B=Math.sin(r)*a,g=-Math.cos(r)*a;e==null||e.scrollFlickPreview(B,g)}}var Kt=Math.PI/3,Bs=function(){function i(t,e,n,c,r,l){var s=this;this.directlyEmitsKeys=!0,this.sequence=t,this.gestureParams=r,this.baseSpec=c.key.spec,this.baseKeyDistances=n.getSimpleTapCorrectionDistances(t.stageReports[0].sources[0].path.stats.initialSample,this.baseSpec);var o=t.stageReports[0].sources[0].baseSource,a=o;t.on("complete",function(){l==null||l.cancel()}),this.sequence.on("stage",function(g){var u,F=a.path.stats;s.computedFlickDistribution=s.flickDistribution(F,!0);var I=s.computedFlickDistribution[0].keySpec;if(g.matchedId=="flick-restart"){a.path.replaceInitialSample(g.sources[0].path.stats.initialSample);return}if(g.matchedId=="flick-reset-centering"){a=o.constructSubview(!0,!0);return}else if(g.matchedId=="flick-reset-end"){s.emitKey(n,s.baseSpec,a.path.stats);return}else if(g.matchedId=="flick-reset"){s.flickScroller&&(s.flickScroller(a.currentSample),a.path.off("step",s.flickScroller)),s.lockedDir=null,s.lockedSelectable=null,a instanceof se&&a.disconnect();return}else if(g.matchedId=="flick-mid"){if(I==s.baseSpec)return;var y=Object.keys(s.baseSpec.flick).find(function(h){return s.baseSpec.flick[h]==I});s.lockedDir=y,s.lockedSelectable=I,s.flickScroller&&a.path.off("step",s.flickScroller),s.flickScroller=as(a,y,l,s.gestureParams),s.flickScroller(a.currentSample),a.path.on("step",s.flickScroller);return}var Q=(u=s.lockedSelectable)!==null&&u!==void 0?u:I;s.emitKey(n,Q,F)});var B=this.buildPopupRecognitionConfig(n);e({type:"push",config:B})}return i.prototype.emitKey=function(t,e,n){var c,r=Ct(n,this.lockedDir);r>this.gestureParams.flick.triggerDist?c=t.keyEventFromSpec(e):c=t.keyEventFromSpec(this.baseSpec),c.keyDistribution=this.currentStageKeyDistribution(this.baseKeyDistances),t.raiseKeyEvent(c,null)},i.prototype.buildPopupRecognitionConfig=function(t){var e={getBoundingClientRect:function(){var n=Number.MAX_SAFE_INTEGER;return new DOMRect(-n,-n,2*n,2*n)}};return(0,d.__assign)((0,d.__assign)({},t.gestureEngine.config),{maxRoamingBounds:e,safeBounds:e})},i.prototype.cancel=function(){},i.prototype.flickDistribution=function(t,e){var n=this.baseSpec.flick,c=[{spec:this.baseSpec,coord:[NaN,0]}];c=c.concat(Object.keys(n).map(function(u){return{spec:n[u],coord:jn.get(u)}}));var r=t.angle,l=this.gestureParams.flick.triggerDist,s=Math.min(l,e?l:t.netDistance),o=s/l,a=0,B=c.map(function(u){var F=0,I=u.coord;if(!isNaN(I[0])){var y=r-I[0],Q=2*Hi+I[0]-r;F=Math.min(y*y,Q*Q)}var h=Kt*(I[1]-o),C=h*h,x=1/(F+C+1e-6);return a+=x,{keySpec:u.spec,p:x}}),g=1/a;return B.forEach(function(u){return u.p*=g}),B.sort(function(u,F){return F.p-u.p})},i.prototype.currentStageKeyDistribution=function(t){var e=this.baseSpec,n=this.baseKeyDistances,c=this.computedFlickDistribution,r=n.get(e);if(!r){var l=c[0];return[{keySpec:l.keySpec,p:1}]}var s=c.findIndex(function(B){return B.keySpec==e}),o=c.splice(s,1)[0].p,a=We(n);return c.concat(a.map(function(B){return{keySpec:B.keySpec,p:B.p*o}}))},i}(),Ni=Bs;var qn={longpress:{permitsFlick:function(){return!0},flickDistStart:8,flickDistFinal:40,waitLength:500,noiseTolerance:10},multitap:{waitLength:300,holdLength:150},flick:{startDist:10,dirLockDist:25,triggerDist:40}};function Ti(i){var t=i.getBoundingClientRect();return{clientX:t.left+t.width/2,clientY:t.top+t.height/2}}function Ei(i){var t=Ti(i);return function(e){var n=e.lastSample.clientX-t.clientX,c=e.lastSample.clientY-t.clientY;return Math.sqrt(n*n+c*c)}}function bt(i){var t,e,n=i.key.spec;if(n.sk)return!1;var c=["K_SHIFT","K_ALT","K_CTRL","K_NUMERALS","K_SYMBOLS","K_CURRENCIES"];try{for(var r=(0,d.__values)(c),l=r.next();!l.done;l=r.next()){var s=l.value;if(n.id==s)return!0}}catch(o){t={error:o}}finally{try{l&&!l.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}if(n.nextlayer)switch(n.sp){case 1:case 2:case 3:case 4:return!0;default:return!1}else return!1}function $n(i,t){var e=function(u,F){if(!u)return!1;var I=u.key.spec;switch(F){case"modipress-start":return bt(u);case"special-key-start":return["K_LOPT","K_ROPT","K_BKSP"].indexOf(I.baseKeyID)!=-1;case"longpress":return!0;case"multitap-start":case"modipress-multitap-start":return i.hasMultitaps?!!I.multitap:!1;case"flick-start":return!!I.flick;default:return!0}},n=t.roamingEnabled||(t.roamingEnabled=!i.hasFlicks),c=te(n?fs(t):Di(t)),r=te(n?tc(t):zi(t)),l=te(Oi(t,!0,n));function s(u,F){u=te(u);var I=u.id;return typeof F=="number"&&(F=[F]),u.contacts.forEach(function(y,Q){var h;if(F.indexOf(Q)!=-1){var C=(h=y.model.allowsInitialState)!==null&&h!==void 0?h:function(){return!0};y.model=(0,d.__assign)((0,d.__assign)({},y.model),{allowsInitialState:function(x,U,p){return e(p,I)&&C(x,U,p)}})}}),u}var o=Qs(),a=Ls(),B=[s(l,0),s(Vs(t),0),Zs(t),c,r,s(o,0),hs(t),vs(),s(a,0),Ss(t),Rs(),Js(),s(As(t),0),Ws(t),Hs()],g=[l.id,c.id,a.id,o.id];return n?(B.push(s(Cs(t),0)),B.push(bs())):(B.push(s(Mi(t),0)),B.push(Us(t)),B.push(ps(t)),B.push(Gs(t)),B.push(xs(t)),B.push(ms()),B.push(Xs(t)),g.push("flick-start")),{gestures:B,sets:{default:g,modipress:g.filter(function(u){return u!=a.id}),none:[]}}}function ec(){return{itemPriority:0,pathResolutionAction:"reject",pathModel:{evaluate:function(i){return"resolve"}}}}function Ze(){return{itemPriority:0,pathResolutionAction:"resolve",pathModel:{evaluate:function(i){return"resolve"}}}}function ds(i){var t=i.flick;return{itemPriority:1,pathModel:{evaluate:function(e,n,c){var r=e.stats,l=c==null?void 0:c.key.spec;if(l&&l.sk){var s=l.flick,o=s.nw||s.n||s.ne;if(!o){var a=r.netDistance,B=r.angle,g=a*Math.cos(B);if(g>i.longpress.flickDistStart)return"reject"}}return r.netDistance>t.startDist?"resolve":null}},pathResolutionAction:"resolve",pathInheritance:"partial"}}function ki(i,t){var e,n,c=t.key.spec.flick,r=Object.keys(c),l,s=0;try{for(var o=(0,d.__values)(r),a=o.next();!a.done;a=o.next()){var B=a.value,g=Ct(i,B);g>s&&(s=g,l=B)}}catch(u){e={error:u}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return{dir:l,dist:s}}function gs(i){return{itemPriority:1,pathModel:{evaluate:function(t,e,n){var c=ki(t.stats,n),r=c.dir,l=c.dist;if(l>i.flick.dirLockDist){var s=t.stats.angle,o=zt(r),a=Math.abs(s-o),B=Math.abs(2*Math.PI+o-s);if(a<=Kt||B<=Kt)return"resolve"}else if(t.isComplete)return"reject"}},pathResolutionAction:"resolve",pathInheritance:"full"}}function us(i){return{itemPriority:1,pathModel:{evaluate:function(t,e,n,c){if(t.isComplete)return"resolve";var r=ki(c,n).dir;if(Ct(t.stats,r)<i.flick.dirLockDist)return"reject"}},pathResolutionAction:"resolve",pathInheritance:"full"}}function Fs(i,t,e){var n=i.longpress;return{itemPriority:0,pathResolutionAction:"resolve",timer:{duration:n.waitLength,expectedResult:!0},validateItem:function(c,r){return!!(r!=null&&r.key.spec.sk)},pathModel:{evaluate:function(c){var r,l,s=c.stats;if(t&&n.permitsFlick(s.lastSample.item)&&((l=((r=s.cardinalDirection)===null||r===void 0?void 0:r.indexOf("n"))!=-1)!==null&&l!==void 0?l:!1)){var o=s.netDistance,a=s.angle,B=o*Math.cos(a);if(B>n.flickDistFinal)return"resolve"}else if(e){if(s.rawDistance>n.noiseTolerance||s.lastSample.item!=s.initialSample.item)return"reject"}else if(s.lastSample.item!=s.initialSample.item)return"reject";return c.isComplete?"reject":null}}}}function Yi(){return{itemPriority:-1,pathResolutionAction:"resolve",pathModel:{evaluate:function(i){return"resolve"}}}}function ys(){return{itemPriority:-1,itemChangeAction:"resolve",pathResolutionAction:"resolve",pathModel:{evaluate:function(i){if(i.isComplete)return"reject"}}}}function wi(){return{itemPriority:-1,itemChangeAction:"resolve",pathResolutionAction:"resolve",pathModel:{evaluate:function(i){if(i.isComplete)return"resolve"}}}}function _t(i,t){var e,n=(e=i==null?void 0:i.roamingEnabled)!==null&&e!==void 0?e:!0;return{itemPriority:0,itemChangeAction:n?"reject":void 0,pathResolutionAction:"resolve",pathInheritance:!n&&t?"full":"chop",pathModel:{evaluate:function(c){if(c.isComplete&&!c.wasCancelled)return"resolve"}}}}function Is(){return{itemPriority:0,pathResolutionAction:"resolve",pathModel:{evaluate:function(i){if(i.isComplete&&!i.wasCancelled)return"resolve"}}}}function Qs(){return{id:"special-key-start",resolutionPriority:0,contacts:[{model:(0,d.__assign)({},Ze()),endOnResolve:!1}],resolutionAction:{type:"chain",next:"special-key-end",item:"current"}}}function hs(i){return{id:"special-key-end",resolutionPriority:0,contacts:[{model:(0,d.__assign)((0,d.__assign)({},_t(i)),{itemChangeAction:"resolve"}),endOnResolve:!0}],resolutionAction:{type:"complete",item:"none"}}}function Oi(i,t,e){var n={id:"longpress",resolutionPriority:4,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Fs(i,t,e)),{itemPriority:1,pathInheritance:"chop"}),endOnResolve:!1},{model:ec(),resetOnInstantFulfill:!0}],resolutionAction:{type:"chain",next:"subkey-select",selectionMode:"none",item:"none"}};return e?(0,d.__assign)((0,d.__assign)({},n),{rejectionActions:{path:{type:"replace",replace:"longpress-roam"},timer:{type:"replace",replace:"longpress-roam-restore"}}}):n}function Cs(i){var t=Oi(i,!1,!0);return(0,d.__assign)((0,d.__assign)({},t),{id:"longpress-roam"})}function bs(){return{id:"longpress-roam-restore",contacts:[{model:{pathModel:{evaluate:function(i){return null}},itemChangeAction:"reject",pathInheritance:"full",pathResolutionAction:"reject",itemPriority:0}}],resolutionPriority:-1,rejectionActions:{item:{type:"replace",replace:"longpress-roam"}},resolutionAction:{type:"chain",next:"longpress-roam"}}}function Mi(i){return{id:"flick-start",resolutionPriority:3,contacts:[{model:ds(i)}],resolutionAction:{type:"chain",item:"none",next:"flick-mid"}}}function xs(i){var t=Mi(i);return(0,d.__assign)((0,d.__assign)({},t),{contacts:[(0,d.__assign)((0,d.__assign)({},t.contacts[0]),{model:(0,d.__assign)((0,d.__assign)({},t.contacts[0].model),{baseCoordReplacer:function(e,n){var c=Ti(n),r=Ei(n),l=e.initialSample,s=r(e);if(s>i.flick.triggerDist)return c;var o=i.flick.dirLockDist;if(s<o)return l;var a=o/s,B=l.clientX-c.clientX,g=l.clientY-c.clientY;return{clientX:c.clientX+B*a,clientY:c.clientY+g*a}}})})],id:"flick-restart",sustainWhenNested:!0,rejectionActions:{path:{type:"replace",replace:"flick-reset-end"}}})}function Us(i){return{id:"flick-mid",resolutionPriority:0,contacts:[{model:gs(i),endOnReject:!0},{model:ec(),resetOnInstantFulfill:!0}],rejectionActions:{path:{type:"replace",replace:"flick-reset-end"}},resolutionAction:{type:"chain",item:"none",next:"flick-end"},sustainWhenNested:!0}}function ps(i){return{id:"flick-reset",resolutionPriority:1,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Ze()),{pathInheritance:"partial"})}],resolutionAction:{type:"chain",next:"flick-reset-centering"},sustainWhenNested:!0}}function Gs(i){return{id:"flick-reset-centering",resolutionPriority:1,contacts:[{model:{pathModel:{evaluate:function(t,e,n){e||(e=t.stats);var c=Ei(n),r=c(t.stats),l=c(e);if(l<r)return"resolve"}},itemPriority:0,pathResolutionAction:"resolve",pathInheritance:"full"}}],resolutionAction:{type:"chain",next:"flick-restart"},sustainWhenNested:!0}}function ms(){return{id:"flick-reset-end",resolutionPriority:1,contacts:[],sustainTimer:{duration:0,expectedResult:!0},resolutionAction:{type:"complete",item:"base"},sustainWhenNested:!0}}function Xs(i){return{id:"flick-end",resolutionPriority:0,contacts:[{model:us(i)},{model:Ze(),resetOnInstantFulfill:!0}],rejectionActions:{path:{type:"replace",replace:"flick-reset"}},resolutionAction:{type:"complete",item:"current"},sustainWhenNested:!0}}function Vs(i){return{id:"multitap-start",resolutionPriority:2,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Ze()),{itemPriority:1,pathInheritance:"reject",allowsInitialState:function(t,e,n){return t.item==n}})}],sustainTimer:{duration:i.multitap.waitLength,expectedResult:!1,baseItem:"base"},resolutionAction:{type:"chain",next:"multitap-end",item:"current"}}}function Zs(i){return{id:"multitap-end",resolutionPriority:2,contacts:[{model:(0,d.__assign)((0,d.__assign)({},_t(i)),{itemPriority:1,timer:{duration:i.multitap.holdLength,expectedResult:!1}}),endOnResolve:!0},{model:Ze(),resetOnInstantFulfill:!0}],rejectionActions:{timer:{type:"replace",replace:"simple-tap"}},resolutionAction:{type:"chain",next:"multitap-start",item:"none"}}}function Di(i){return{id:"initial-tap",resolutionPriority:1,contacts:[{model:(0,d.__assign)((0,d.__assign)({},_t(i)),{pathInheritance:"chop",itemPriority:1,timer:{duration:i.multitap.holdLength,expectedResult:!1}}),endOnResolve:!0},{model:Ze(),resetOnInstantFulfill:!0}],sustainWhenNested:!0,rejectionActions:{timer:{type:"replace",replace:"simple-tap"}},resolutionAction:{type:"chain",next:"multitap-start",item:"base"}}}function zi(i){return{id:"simple-tap",resolutionPriority:1,contacts:[{model:(0,d.__assign)((0,d.__assign)({},_t(i,!0)),{itemPriority:1}),endOnResolve:!0},{model:Ze(),resetOnInstantFulfill:!0}],sustainWhenNested:!0,resolutionAction:{type:"complete",item:"base"}}}function fs(i){var t=Di(i);return(0,d.__assign)((0,d.__assign)({},t),{rejectionActions:(0,d.__assign)((0,d.__assign)({},t.rejectionActions),{item:{type:"replace",replace:"initial-tap"}})})}function tc(i){var t=zi(i);return(0,d.__assign)((0,d.__assign)({},t),{rejectionActions:(0,d.__assign)((0,d.__assign)({},t.rejectionActions),{item:{type:"replace",replace:"simple-tap"}})})}function vs(){return{id:"subkey-select",resolutionPriority:0,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Is()),{pathInheritance:"full",itemPriority:1}),endOnResolve:!0,endOnReject:!0}],resolutionAction:{type:"complete",item:"current"},sustainWhenNested:!0}}function Ls(){return{id:"modipress-start",resolutionPriority:5,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Yi()),{allowsInitialState:function(i,t,e){return bt(e)},itemChangeAction:"reject",itemPriority:1})}],resolutionAction:{type:"chain",next:"modipress-hold",selectionMode:"modipress",item:"current"}}}function Ss(i){return{id:"modipress-hold",resolutionPriority:5,contacts:[{model:(0,d.__assign)((0,d.__assign)({},ys()),{itemChangeAction:"reject",pathInheritance:"full",timer:{duration:i.multitap.holdLength,expectedResult:!0,inheritElapsed:!0}})},{model:(0,d.__assign)({},Ze()),resetOnInstantFulfill:!0}],resolutionAction:{type:"chain",next:"modipress-end",selectionMode:"modipress",item:"none"},rejectionActions:{path:{type:"replace",replace:"modipress-end-multitap-transition"}}}}function Js(){return{id:"modipress-end-multitap-transition",resolutionPriority:5,contacts:[],sustainTimer:{duration:0,expectedResult:!0},resolutionAction:{type:"chain",next:"modipress-multitap-start",item:"none"}}}function Rs(){return{id:"modipress-end",resolutionPriority:5,contacts:[{model:(0,d.__assign)((0,d.__assign)({},wi()),{itemChangeAction:"reject",pathInheritance:"full"})}],resolutionAction:{type:"complete",item:"none",awaitNested:!0}}}function As(i){return{id:"modipress-multitap-start",resolutionPriority:6,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Yi()),{pathInheritance:"reject",allowsInitialState:function(t,e,n){return t.item!=n?!1:bt(n)},itemChangeAction:"reject",itemPriority:1})}],sustainTimer:{duration:i.multitap.waitLength,expectedResult:!1,baseItem:"base"},resolutionAction:{type:"chain",next:"modipress-multitap-end",selectionMode:"modipress",item:"current"}}}function Ws(i){return{id:"modipress-multitap-end",resolutionPriority:5,contacts:[{model:(0,d.__assign)((0,d.__assign)({},wi()),{itemChangeAction:"reject",pathInheritance:"full",timer:{duration:i.multitap.holdLength,expectedResult:!1}})},{model:(0,d.__assign)({},ec()),resetOnInstantFulfill:!0}],resolutionAction:{type:"chain",next:"modipress-multitap-start",item:"none"},rejectionActions:{timer:{type:"replace",replace:"modipress-multitap-lock-transition"},path:{type:"replace",replace:"modipress-multitap-lock-transition"}}}}function Hs(){return{id:"modipress-multitap-lock-transition",resolutionPriority:5,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Ze()),{pathResolutionAction:"resolve"})}],resolutionAction:{type:"chain",next:"modipress-end",selectionMode:"modipress",item:"none"}}}var Ki=(0,d.__assign)((0,d.__assign)({},te(tc(null))),{resolutionAction:{type:"complete",item:"current"}}),_i={gestures:[Ki],sets:{default:[Ki.id]}};function Pt(i){var t;return typeof i=="string"?t=i:(t=i.style.fontSize,t||(t=getComputedStyle(i).fontSize)),new f(t)}function Pi(i,t,e){if(i.touchable){var n=i.formFactor=="phone"?1.6*(e?.65:.6)*1.2:2;return f.special(n,"em")}else return t?f.inPixels(t/8):void 0}var xt;function jt(i,t,e){e={fontFamily:e.fontFamily,fontSize:e.fontSize},e.fontFamily||(e.fontFamily=getComputedStyle(document.body).fontFamily),(!e.fontSize||e.fontSize=="")&&(e.fontSize="1em");var n=e.fontFamily,c=Pt(e.fontSize),r;c.absolute?r=c.val+"px":r=c.val*t+"px",xt=xt!=null?xt:document.createElement("canvas");var l=xt.getContext("2d");l.font=r+" "+n;var s=l.measureText(i);return s}var Ns=10,ji=function(){function i(t,e){this.totalLength=0,this.baseCoord=t,this.curCoord=t,this.baseScrollLeft=e,this.totalLength=0}return i.prototype.updateTo=function(t){var e=this.curCoord;this.curCoord=t;var n=this.baseCoord.targetX-this.curCoord.targetX+this.baseScrollLeft;return this.totalLength+=Math.abs(this.curCoord.targetX-e.targetX),n},Object.defineProperty(i.prototype,"hasScrolled",{get:function(){return this.totalLength>Ns},enumerable:!1,configurable:!0}),i}();var qi="kmw-suggest-touched";var Ts="kmw-suggest-banner-scroller",$i=.666,er="swallow-fade-transition",Es=function(){function i(t,e){this.index=t,this.rtl=e!=null?e:!1,this.constructRoot();var n=this.display=k("span");n.className="kmw-suggestion-text",this.container.appendChild(n)}return Object.defineProperty(i.prototype,"computedStyle",{get:function(){return getComputedStyle(this.display)},enumerable:!1,configurable:!0}),i.prototype.constructRoot=function(){var t=this.div=k("div"),e=t.style;t.className="kmw-suggest-option",t.id=i.BASE_ID+this.index,this.div.suggestion=this;var n=this.container=document.createElement("div");n.className="kmw-suggestion-container";var c=100-Te.MARGIN*(Te.LONG_SUGGESTION_DISPLAY_LIMIT-1),r=c/Te.LONG_SUGGESTION_DISPLAY_LIMIT;n.style.minWidth=r+"%",t.appendChild(n)},i.prototype.matchKeyboardProperties=function(t){var e=this.div;if(t){t.KLC&&(e.lang=t.KLC);var n=t.KFont;n&&n.family&&n.family!=""&&(e.style.fontFamily=this.fontFamily=n.family)}},Object.defineProperty(i.prototype,"suggestion",{get:function(){return this._suggestion},enumerable:!1,configurable:!0}),i.prototype.update=function(t,e){this._suggestion=t;var n=this.generateSuggestionText(this.rtl);if(this.container.replaceChild(n,this.display),this.display=n,e.minWidth!==void 0&&(this._minWidth=e.minWidth),this._paddingWidth=e.paddingWidth,this._collapsedWidth=e.collapsedWidth,t&&t.displayAs){var c=jt(t.displayAs,e.emSize,e.styleForFont);this._textWidth=c.width}else this._textWidth=0;this.currentWidth=this.collapsedWidth,this.updateLayout()},i.prototype.updateLayout=function(){if(!this.suggestion&&this.index!=0){this.div.style.width="0px";return}else this.div.style.width="";var t=this.container.style;t.minWidth=this.collapsedWidth+"px",this.rtl?t.marginRight=this.collapsedWidth-this.expandedWidth+"px":t.marginLeft=this.collapsedWidth-this.expandedWidth+"px",this.updateFade()},i.prototype.updateFade=function(){var t=this;this.div.classList.add(er),window.requestAnimationFrame(function(){t.div.classList.remove(er)}),this.div.classList.add("kmw-hide-fade-".concat(this.rtl?"left":"right"));var e="kmw-hide-fade-".concat(this.rtl?"right":"left");this.expandedWidth-this.collapsedWidth?this.div.classList.remove(e):this.div.classList.add(e)},Object.defineProperty(i.prototype,"targetCollapsedWidth",{get:function(){return this._collapsedWidth},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"textWidth",{get:function(){return this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"paddingWidth",{get:function(){return this._paddingWidth},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"minWidth",{get:function(){return this._minWidth},set:function(t){this._minWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"expandedWidth",{get:function(){return this.minWidth>this.spanWidth?this.minWidth:this.spanWidth},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"spanWidth",{get:function(){var t,e,n=(t=this.textWidth)!==null&&t!==void 0?t:0;return n&&(n+=(e=this.paddingWidth)!==null&&e!==void 0?e:0),n},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"collapsedWidth",{get:function(){var t=this.spanWidth<this.targetCollapsedWidth?this.spanWidth:this.targetCollapsedWidth,e=t<this.expandedWidth?t:this.expandedWidth;return this.minWidth>e?this.minWidth:e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentWidth",{get:function(){return this.div.offsetWidth},set:function(t){t<this.collapsedWidth?t=this.collapsedWidth:t>this.expandedWidth&&(t=this.expandedWidth),this.rtl?this.container.style.marginRight="".concat(t-this.expandedWidth,"px"):this.container.style.marginLeft="".concat(t-this.expandedWidth,"px")},enumerable:!1,configurable:!0}),i.prototype.highlight=function(t){var e=this.div;t?e.classList.add(qi):e.classList.remove(qi)},i.prototype.isEmpty=function(){return!this._suggestion},i.prototype.generateSuggestionText=function(t){var e=this._suggestion,n,c=k("span");if(c.className="kmw-suggestion-text",e==null)return c;if(e.displayAs==null||e.displayAs=="")n="\xA0";else{var r=t?8238:8237;n=String.fromCharCode(r)+e.displayAs}return c.innerHTML=n,c},i.BASE_ID="kmw-suggestion-",i}();var Te=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this,n||Qe.DEFAULT_HEIGHT)||this;return c.type="suggestion",c.currentSuggestions=[],c.options=[],c.separators=[],c.isRTL=!1,c.onSuggestionUpdate=function(r){var l;c.currentSuggestions=r,(l=c.highlightAnimation)===null||l===void 0||l.cancel();for(var s=c.options[0].computedStyle,o={fontSize:s.fontSize,fontFamily:s.fontFamily},a=getComputedStyle(document.body).fontSize,B=Pt(a).val,g=getComputedStyle(c.options[0].container.firstChild),u=c.width/t.LONG_SUGGESTION_DISPLAY_LIMIT,F=new f(g.paddingLeft||"4px"),I=new f(g.paddingRight||"4px"),y={paddingWidth:F.val+I.val,emSize:B,styleForFont:o,collapsedWidth:u,minWidth:0},Q=0;Q<t.SUGGESTION_LIMIT;Q++){var h=c.options[Q];if(r.length>Q){var C=r[Q];h.update(C,y)}else h.update(null,y)}c.refreshLayout()},c.refreshLayout=function(){for(var r=[],l=0,s=Math.min(c.currentSuggestions.length,8),o=0;o<s;o++){var a=c.options[o];a.minWidth=0,l+=a.collapsedWidth,a.collapsedWidth<a.expandedWidth&&r.push(a)}if(s=s||1,l<c.width){for(var B=c.width*.01*(s-1),g=function(){var I=(c.width-l-B)/r.length;r.sort(function(C,x){return C.expandedWidth-x.expandedWidth});var y=r[0],Q=y.expandedWidth-y.collapsedWidth,h=Math.min(Q,I);h>0&&(r.forEach(function(C){return C.minWidth=C.collapsedWidth+h}),l+=h*r.length),r.splice(0,1)};l<c.width&&r.length>0;)g();for(var u=(c.width-l-B)/s,o=0;o<s;o++){var F=c.options[o];F.minWidth=F.collapsedWidth+u,F.updateLayout()}}for(var o=0;o<t.SUGGESTION_LIMIT-1;o++)c.separators[o].style.display=o<s-1?"":"none"},c.hostDevice=e,c.getDiv().className=c.getDiv().className+" "+t.BANNER_CLASS,c.container=document.createElement("div"),c.container.className=Ts,c.getDiv().appendChild(c.container),c.buildInternals(!1),c.gestureEngine=c.setupInputHandling(),c}return t.prototype.buildInternals=function(e){this.isRTL=e,this.options.length>0&&(this.options=[],this.separators=[]);for(var n=0;n<t.SUGGESTION_LIMIT;n++){var c=new Es(n,e);this.options[n]=c}for(var n=0;n<t.SUGGESTION_LIMIT;n++){var r=e?t.SUGGESTION_LIMIT-n-1:n;if(this.container.appendChild(this.options[r].div),e&&(this.container.scrollLeft=this.container.scrollWidth),n!=t.SUGGESTION_LIMIT-1){var l=k("div");l.className="kmw-banner-separator";var s=l.style;s.marginLeft="calc(".concat(t.MARGIN/2,"% - 0.5px)"),s.marginRight="calc(".concat(t.MARGIN/2,"% - 0.5px)"),this.container.appendChild(l),this.separators[r-(e?1:0)]=l}}},t.prototype.setupInputHandling=function(){var e=this,n=new he(this.getDiv(),[-Number.MAX_SAFE_INTEGER]);this.selectionBounds=new he(this.getDiv(),[-$i*this.height,-Number.MAX_SAFE_INTEGER]);var c={targetRoot:this.getDiv(),maxRoamingBounds:n,safeBounds:n,itemIdentifier:function(a,B){var g,u,F=e.selectionBounds.getBoundingClientRect();if(a.clientX<F.left||a.clientX>F.right||a.clientY<F.top||a.clientY>F.bottom)return null;var I=null,y=Number.MAX_VALUE;try{for(var Q=(0,d.__values)(e.options),h=Q.next();!h.done;h=Q.next()){var C=h.value,x=C.div.getBoundingClientRect();if(x.left<=a.clientX&&a.clientX<x.right)return C.suggestion?C:null;var U=(a.clientX<x.left?-1:1)*(a.clientX-x.left);U<y&&(y=U,I=C)}}catch(p){g={error:p}}finally{try{h&&!h.done&&(u=Q.return)&&u.call(Q)}finally{if(g)throw g.error}}return I.suggestion?I:null}},r=new ht(_i,c),l={source:null,scrollingHandler:null,suggestion:null},s=function(a){a.highlight(!0),e.highlightAnimation&&(e.highlightAnimation.cancel(),e.highlightAnimation.decouple()),e.highlightAnimation=new tr(e.container,a,!1),e.highlightAnimation.expand()},o=function(a){a.highlight(!1),e.highlightAnimation||(e.highlightAnimation=new tr(e.container,a,!1)),e.highlightAnimation.collapse()};return r.on("inputstart",function(a){if(l.source){a.terminate(!0);return}e.scrollState=new ji(a.currentSample,e.container.scrollLeft);var B=a.baseItem;l.source=a,l.scrollingHandler=function(u){var F,I=e.scrollState.updateTo(u);(F=e.highlightAnimation)===null||F===void 0||F.setBaseScroll(I);var y=u.item?B:null;y!=l.suggestion&&(l.suggestion&&o(l.suggestion),l.suggestion=y,y&&s(y))},l.suggestion=a.currentSample.item,l.suggestion&&s(l.suggestion);var g=function(){l.suggestion&&(o(l.suggestion),l.suggestion=null),l.source=null,l.scrollingHandler=null};a.path.on("complete",g),a.path.on("invalidated",g),a.path.on("step",l.scrollingHandler)}),r.on("recognizedgesture",function(a){a.once("stage",function(B){var g=B.item;g&&!e.scrollState.hasScrolled&&e.predictionContext.accept(g.suggestion).then(function(){e.container.scrollLeft=e.isRTL?e.container.scrollWidth:0}),e.scrollState=null})}),r},t.prototype.update=function(){var e,n=i.prototype.update.call(this);return(e=this.selectionBounds)===null||e===void 0||e.updatePadding([-$i*this.height,-Number.MAX_SAFE_INTEGER]),n},t.prototype.configureForKeyboard=function(e,n){var c=e.isRTL;this.container.textContent="",this.buildInternals(c),this.options.forEach(function(r){return r.matchKeyboardProperties(n)}),this.onSuggestionUpdate(this.currentSuggestions)},Object.defineProperty(t.prototype,"predictionContext",{get:function(){return this._predictionContext},set:function(e){this._predictionContext&&this._predictionContext.off("update",this.onSuggestionUpdate),this._predictionContext=e,e&&(e.on("update",this.onSuggestionUpdate),this.onSuggestionUpdate(e.currentSuggestions))},enumerable:!1,configurable:!0}),t.SUGGESTION_LIMIT=8,t.LONG_SUGGESTION_DISPLAY_LIMIT=3,t.MARGIN=1,t}(Qe);var tr=function(){function i(t,e,n){var c=this;this.setScrollOffset=function(){if(!!c.scrollContainer){var r=c.option.currentWidth-c.option.collapsedWidth,l=c.option.rtl,s=Math.max(c.rootScrollOffset-c.option.div.offsetLeft,0),o=Math.max(c.option.div.offsetLeft+c.option.collapsedWidth-(c.rootScrollOffset+c.scrollContainer.offsetWidth)),a=Math.max(l?o:s,0),B=Math.max(c.collapsedScrollOffset+(l?0:1)*r,0)+(l?0:-1)*a,g=Math.max(c.rootScrollOffset+(l?0:1)*r,0)+(l?0:-1)*a,u=l?Math.max(B,g):Math.min(B,g),F=Math.max(l?c.option.div.offsetLeft+c.option.currentWidth-(u+c.scrollContainer.offsetWidth):u-c.option.div.offsetLeft,0),I=Math.min(r,F),y=B+(l?1:-1)*I+(l?0:1)*a;if(c.scrollContainer.scrollLeft=y,c.pendingAnimation){var Q=c.scrollContainer.scrollLeft-y;c.option.currentWidth+=Q}}},this._expand=function(r){if(c.startTimestamp!==void 0){var l=r-c.startTimestamp,s=l>i.TRANSITION_TIME;s&&(l=i.TRANSITION_TIME);var o=c.option.expandedWidth-c.option.collapsedWidth,a=l/i.TRANSITION_TIME,B=o*a;c.option.currentWidth=B+c.option.collapsedWidth,s?c.clear():c.pendingAnimation=window.requestAnimationFrame(c._expand),c.setScrollOffset()}},this._collapse=function(r){if(c.startTimestamp!==void 0){var l=r-c.startTimestamp,s=l>i.TRANSITION_TIME;s&&(l=i.TRANSITION_TIME);var o=c.option.expandedWidth-c.option.collapsedWidth,a=1-l/i.TRANSITION_TIME,B=o*a;c.option.currentWidth=B+c.option.collapsedWidth,s?c.clear():c.pendingAnimation=window.requestAnimationFrame(c._collapse),c.setScrollOffset()}},this.scrollContainer=t,this.option=e,this.collapsedScrollOffset=t.scrollLeft,this.rootScrollOffset=t.scrollLeft}return i.prototype.setBaseScroll=function(t){this.collapsedScrollOffset=t,this.option.rtl?t>this.rootScrollOffset&&(this.rootScrollOffset=t):t<this.rootScrollOffset&&(this.rootScrollOffset=t),window.requestAnimationFrame(this.setScrollOffset)},i.prototype.decouple=function(){this.cancel(),this.scrollContainer=null},i.prototype.clear=function(){this.startTimestamp=null,window.cancelAnimationFrame(this.pendingAnimation),this.pendingAnimation=null},i.prototype.cancel=function(){this.clear(),this.option.currentWidth=this.option.collapsedWidth},i.prototype.expand=function(){this.clear(),this.startTimestamp=performance.now();var t=this.option.currentWidth-this.option.collapsedWidth,e=this.option.expandedWidth-this.option.collapsedWidth;t!=0&&(this.startTimestamp-=t/e*i.TRANSITION_TIME),this.pendingAnimation=window.requestAnimationFrame(this._expand)},i.prototype.collapse=function(){this.clear(),this.startTimestamp=performance.now();var t=this.option.expandedWidth-this.option.currentWidth,e=this.option.expandedWidth-this.option.collapsedWidth;t!=0&&(this.startTimestamp-=t/e*i.TRANSITION_TIME),this.pendingAnimation=window.requestAnimationFrame(this._collapse)},i.TRANSITION_TIME=250,i}();var nr=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;n.type="html";var c=n.getDiv(),r=document.createElement("div");return r.style.userSelect="none",r.style.height="100%",r.style.width="100%",c.appendChild(r),n.container=r.attachShadow?r.attachShadow({mode:"closed"}):r,n.container.innerHTML=e,n}return Object.defineProperty(t.prototype,"innerHTML",{get:function(){return this.container.innerHTML},set:function(e){this.container.innerHTML=e},enumerable:!1,configurable:!0}),t}(Qe);var nc=function(){function i(t,e,n){this.ImageBanner=hi,this.HTMLBanner=nr,this.hostDevice=e,this.container=t,this.predictionContext=n,this.inactiveBanner=new je}return Object.defineProperty(i.prototype,"inactiveBanner",{get:function(){return this._inactiveBanner},set:function(t){this._inactiveBanner=t!=null?t:new je,this.container.banner instanceof Te||(this.container.banner=this._inactiveBanner)},enumerable:!1,configurable:!0}),i.prototype.activateBanner=function(t){var e,n=this.container.banner;if(n instanceof Te&&(n.predictionContext=null),!t)this.container.banner=this.inactiveBanner;else{var c=e=new Te(this.hostDevice,this.container.activeBannerHeight);c.predictionContext=this.predictionContext,this.container.banner=c}},i.prototype.selectBanner=function(t){this.activateBanner(t=="active"||t=="configured"),this.keyboard&&this.container.banner.configureForKeyboard(this.keyboard,this.keyboardStub)},i.prototype.configureForKeyboard=function(t,e){this.keyboard=t,this.keyboardStub=e,this.container.banner.configureForKeyboard(t,e)},i.prototype.shutdown=function(){this.container.banner instanceof Te&&(this.container.banner.predictionContext=null)},i}();var ks=function(){function i(){var t=this.element=document.createElement("div");t.style.userSelect="none",t.className="kmw-osk-none"}return i.prototype.postInsert=function(){},i.prototype.updateState=function(){},i.prototype.refreshLayout=function(){},Object.defineProperty(i.prototype,"layoutHeight",{get:function(){return f.inPixels(0)},enumerable:!1,configurable:!0}),i}(),qt=ks;var Ys=function(){function i(t){this.kbd=t;var e=this.element=document.createElement("div");e.style.userSelect="none",e.className="kmw-osk-static",e.id=i.ID,e.innerHTML=t.helpText}return i.prototype.postInsert=function(){if(!this.element.parentElement||!document.getElementById(i.ID))throw new Error("The HelpPage root element has not yet been inserted into the DOM.");this.kbd.hasScript&&this.kbd.embedScript(this.element.parentElement)},i.prototype.updateState=function(){},i.prototype.refreshLayout=function(){},Object.defineProperty(i.prototype,"layoutHeight",{get:function(){return f.inPercent(100)},enumerable:!1,configurable:!0}),i.ID="kmw-osk-help-page",i}(),cr=Ys;var br=N(T(),1);var ws={"*Shift*":8,"*Enter*":5,"*Tab*":6,"*BkSp*":4,"*Menu*":11,"*Hide*":10,"*Alt*":25,"*Ctrl*":1,"*Caps*":3,"*ABC*":16,"*abc*":17,"*123*":19,"*Symbol*":21,"*Currency*":20,"*Shifted*":9,"*AltGr*":2,"*TabLeft*":7,"*LAlt*":86,"*RAlt*":87,"*LCtrl*":88,"*RCtrl*":89,"*LAltCtrl*":96,"*RAltCtrl*":97,"*LAltCtrlShift*":98,"*RAltCtrlShift*":99,"*AltShift*":100,"*CtrlShift*":101,"*AltCtrlShift*":102,"*LAltShift*":103,"*RAltShift*":104,"*LCtrlShift*":105,"*RCtrlShift*":112,"*LTREnter*":5,"*LTRBkSp*":4,"*RTLEnter*":113,"*RTLBkSp*":114,"*ShiftLock*":115,"*ShiftedLock*":116,"*ZWNJ*":117,"*ZWNJiOS*":117,"*ZWNJAndroid*":118,"*ZWNJGeneric*":121,"*Sp*":128,"*NBSp*":130,"*NarNBSp*":131,"*EnQ*":132,"*EmQ*":133,"*EnSp*":134,"*EmSp*":135,"*PunctSp*":140,"*ThSp*":141,"*HSp*":142,"*ZWSp*":129,"*ZWJ*":119,"*WJ*":120,"*CGJ*":122,"*LTRM*":144,"*RTLM*":145,"*SH*":161,"*HTab*":162},$t=ws;var Os=["default","shift","shift-on","special","special-on","","","","deadkey","blank","hidden"],Me=Os;function De(i,t){switch(i){case"*ZWNJ*":i=t.device.OS==v.OperatingSystem.Android?"*ZWNJAndroid*":"*ZWNJiOS*";break;case"*Enter*":i=t.isRTL?"*RTLEnter*":"*LTREnter*";break;case"*BkSp*":i=t.isRTL?"*RTLBkSp*":"*LTRBkSp*";break;default:}var e=57344+$t[i];return $t[i]?String.fromCharCode(e):i}var Ms=function(){function i(t,e){this.spec=t,this.layer=e}return i.prototype.setButtonClass=function(){var t,e=this.spec,n=this.btn,c=0;typeof e.dk=="string"&&e.dk=="1"&&(c=8),c=(t=e.sp)!==null&&t!==void 0?t:c,(c<0||c>10)&&(c=0),n.className="kmw-key kmw-key-"+Me[c]},i.prototype.setToggleState=function(t){var e;switch(e=this.spec.sp,Me[e]){case"shift":case"shift-on":t===void 0&&(t=Me[e]=="shift"),this.spec.sp=1+(t?1:0);break;case"special":case"special-on":t===void 0&&(t=Me[e]=="special"),this.spec.sp=3+(t?1:0);break;default:return}this.setButtonClass()},i.prototype.isFrameKey=function(){var t=this.spec.sp||0;switch(Me[t]){case"default":case"deadkey":return!1;default:return!0}},i.prototype.allowsKeyTip=function(){return this.isFrameKey()?!1:!this.btn.classList.contains("kmw-spacebar")},i.prototype.highlight=function(t){var e=this.btn.classList;t?e.contains(i.HIGHLIGHT_CLASS)||e.add(i.HIGHLIGHT_CLASS):e.remove(i.HIGHLIGHT_CLASS)},i.prototype.getIdealFontSize=function(t,e,n){if(!this._fontFamily)return new f("1em");n!=null||(n=1);var c=e.keyWidth,r=e.keyHeight,l=e.baseEmFontSize.scaledBy(e.layoutFontSize.val),s=this._fontSize;s.absolute||(s=l.scaledBy(s.val));var o={fontFamily:this._fontFamily,fontSize:s.styleString,height:e.keyHeight},a=jt(t,l.scaledBy(n).val,o),B=.9,g=.9,u=2,F;a.fontBoundingBoxAscent&&(F=a.fontBoundingBoxAscent+a.fontBoundingBoxDescent);var I=F!=null?F:0,y=c*B/(a.width+u),Q=I&&r?r*g/I:void 0,h=y;return Q&&Q<y&&(h=Q),f.forScalar(n*Math.min(h,1))},Object.defineProperty(i.prototype,"keyText",{get:function(){var t=this.spec,e="\xA0",n=null;return t.text==null||t.text==""?n=e:(n=t.text,n=="*Tab*"&&this.layer=="shift"&&(n="*TabLeft*")),n},enumerable:!1,configurable:!0}),i.prototype.generateKeyText=function(t){var e=this.spec,n=document.createElement("span"),c=n.style;n.className="kmw-key-text";var r=this.keyText,l=De(r,t);l!=r&&(r=l,e.font="SpecialOSK"),typeof e.font=="string"&&e.font!=""&&(c.fontFamily=e.font),typeof e.fontsize=="string"&&e.fontsize!=""&&(c.fontSize=e.fontsize);var s={fontSize:c.fontSize};return c.fontFamily?s.fontFamily=c.fontFamily:s.fontFamily=t.fontFamily,t.isRTL&&(r="\u200F"+r),n.innerText=r,n},i.prototype.resetFontPrecalc=function(){this._fontFamily=void 0,this._fontSize=void 0,this.label.style.fontSize=""},i.prototype.detectStyles=function(t){if(!(this.spec.sp==10||this.spec.sp==9)&&this._fontFamily===void 0){var e=getComputedStyle(this.label);if(!e.fontFamily)return;this._fontFamily=e.fontFamily;var n=new f(e.fontSize),c=t.layoutFontSize;if(c.absolute)this._fontSize=n;else{var r=t.baseEmFontSize,l=c.scaledBy(r.val),s=n.val/l.val;this._fontSize=f.forScalar(s)}}},i.prototype.refreshLayout=function(t){if(this.label)if(this.label.classList.contains("kmw-spacebar-caption")){var n=this.getIdealFontSize(this.keyText,t);this.label.style.setProperty("font-size",n.styleString,"important")}else{var e=this.label.textContent,n=this.getIdealFontSize(e,t);this.label.style.fontSize=n.styleString}},i.specialCharacters=$t,i.BUTTON_CLASSES=Me,i.HIGHLIGHT_CLASS="kmw-key-touched",i}(),Ee=Ms;var en=function(){function i(t,e){this.key=t,this.keyId=e}return i}();function tn(i,t){var e=i;for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n]);return e}function Ds(i){return i&&"key"in i&&i.key instanceof Ee}function nn(i){return Ds(i)?i:null}var zs=function(i){(0,d.__extends)(t,i);function t(e,n,c){var r=i.call(this,e,n)||this;return r.row=c,r}return t.prototype.getId=function(){return this.spec.elementID},t.prototype.getCoreId=function(){return this.spec.coreID},t.prototype.getBaseId=function(){return this.spec.baseKeyID},t.prototype.generateKeyCapLabel=function(){var e=b.keyCodes[this.spec.baseKeyID];switch(e){case 186:e=59;break;case 187:e=61;break;case 188:e=44;break;case 189:e=45;break;case 190:e=46;break;case 191:e=47;break;case 192:e=96;break;case 219:e=91;break;case 220:e=92;break;case 221:e=93;break;case 222:e=39;break;default:(e<48||e>90)&&(e=0)}var n=document.createElement("div");return n.className="kmw-key-label",e>0&&(n.innerText=String.fromCharCode(e)),n},t.prototype.processSubkeys=function(e,n){var c,r=e.subKeys=this.spec.sk;for(c=0;c<r.length;c++){if(r[c].sp==1||r[c].sp==2){var l=r[c].text;r[c].text=De(l,n)}r[c].layer||(r[c].layer=e.key.layer)}},t.prototype.construct=function(e){var n=this.spec,c=document.createElement("div");c.className="kmw-key-square";var r=document.createElement("div"),l=this.btn=tn(r,new en(this,n.id));this.setButtonClass();var s=this.capLabel=this.generateKeyCapLabel();l.appendChild(s),l.id=this.getId(),l.appendChild(this.label=this.generateKeyText(e)),typeof n.sk!="undefined"&&n.sk!=null?this.processSubkeys(l,e):l.subKeys=null;var o=this.generateHint(e);return l.appendChild(o),c.appendChild(l),this.preview=document.createElement("div"),this.preview.style.display="none",l.appendChild(this.preview),this.square=c},t.prototype.generateHint=function(e){var n=document.createElement("div");n.className="kmw-key-popup-icon";var c=this.spec.hintSrc;if(!c)return n;if(c.font&&c.font!="SpecialOSK"?n.style.fontFamily=c.font:n.classList.add("kmw-key-text"),c.fontsize){var r=new f(c.fontsize);n.style.fontSize=r.scaledBy(.5).styleString}var l=c==this.spec?this.spec.hint:c.text,s=De(l,e);return s=="\u2022"&&(n.style.fontWeight="bold"),l!=s&&(n.style.fontFamily="SpecialOSK"),n.textContent=s,n},t.prototype.setPreview=function(e){var n=this,c=this.preview;e?(this.previewHost=e,this.preview=this.previewHost.element):(this.previewHost=null,this.preview=document.createElement("div"),this.preview.style.display="none"),e==null||e.setCancellationHandler(function(){n.setPreview(null)}),this.btn.replaceChild(this.preview,c)},t.prototype.refreshLayout=function(e){i.prototype.refreshLayout.call(this,e);var n=e.baseEmFontSize;n.val<12?this.capLabel.style.fontSize="6px":this.capLabel.style.fontSize=f.forScalar(.5).styleString},Object.defineProperty(t.prototype,"displaysKeyCap",{get:function(){return this.capLabel&&this.capLabel.style.display=="block"},set:function(e){if(!this.capLabel)throw new Error("Key element not yet constructed; cannot display key cap");this.capLabel.style.display=e?"block":"none"},enumerable:!1,configurable:!0}),t}(Ee),ir=zs;var cn=.15,Ks=function(){function i(t,e,n){var c=this.element=document.createElement("div");c.className="kmw-key-row",this.heightFraction=1/e.row.length;var r=n.key;this.spec=n,this.keys=[];for(var l=0;l<r.length;l++){var s=r[l],o=new ir(s,e.id,this),a=o.construct(t);this.keys.push(o),c.appendChild(a)}}return Object.defineProperty(i.prototype,"displaysKeyCaps",{get:function(){if(this.keys.length>0)return this.keys[0].displaysKeyCap},set:function(t){var e,n;try{for(var c=(0,d.__values)(this.keys),r=c.next();!r.done;r=c.next()){var l=r.value;l.displaysKeyCap=t}}catch(s){e={error:s}}finally{try{r&&!r.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}},enumerable:!1,configurable:!0}),i.prototype.refreshLayout=function(t){var e=this.element.style,n=t.heightStyle.scaledBy(this.heightFraction);e.maxHeight=e.lineHeight=e.height=n.styleString;var c=t.heightStyle.absolute?n:f.forScalar(1),r=c.scaledBy(cn/2),l=c.scaledBy(1-cn);this.keys.forEach(function(s){var o=s.square,a=s.btn,B=o.style;B.height=B.minHeight=c.styleString;var g=a.style;g.top=r.styleString,g.height=g.lineHeight=g.minHeight=l.styleString})},i.prototype.buildKeyLayout=function(t,e){var n=t.widthStyle.scaledBy(e.spec.proportionalWidth),c=t.heightStyle.scaledBy(this.heightFraction).scaledBy(1-cn),r={keyWidth:n.val*(n.absolute?1:t.keyboardWidth),keyHeight:c.val*(c.absolute?1:t.keyboardHeight),baseEmFontSize:t.baseEmFontSize,layoutFontSize:t.layoutFontSize};return r},i.prototype.detectStyles=function(t){var e=this;this.keys.forEach(function(n){n.detectStyles(e.buildKeyLayout(t,n))})},i.prototype.refreshKeyLayouts=function(t){var e=this;this.keys.forEach(function(n){var c,r=n.btn,l=t.widthStyle,s=t.heightStyle,o=l.scaledBy(n.spec.proportionalWidth),a=l.scaledBy(n.spec.proportionalPad),B=s.scaledBy(e.heightFraction).scaledBy(1-cn),g=s.absolute?B.styleString:"100%",u=e.buildKeyLayout(t,n);(c=r.key)===null||c===void 0||c.refreshLayout(u),n.square.style.width=o.styleString,n.square.style.marginLeft=a.styleString,n.btn.style.width=l.absolute?o.styleString:"100%",n.square.style.height=g})},i}(),rr=Ks;var _s=function(){function i(t,e,n){this.spec=n;var c=this.element=document.createElement("div"),r=c.style;c.className="kmw-key-layer";var l=n.row.length;l>4&&t.device.formFactor=="phone"&&(c.className=c.className+" kmw-5rows"),r.fontFamily="font"in e?e.font:"",this.nextlayer=c.layer=n.id,typeof n.nextlayer=="string"&&(c.nextLayer=this.nextlayer=n.nextlayer);var s=n.row;this.rows=[];for(var o=0;o<s.length;o++){var a=new rr(t,n,s[o]);a.displaysKeyCaps=e.displayUnderlying,c.appendChild(a.element),this.rows.push(a)}if(t.device.touchable&&(this.globeKey=this.findKey("K_LOPT"),this.hideKey=this.findKey("K_ROPT")),this.spaceBarKey=this.findKey("K_SPACE"),this.capsKey=this.findKey("K_CAPS"),this.numKey=this.findKey("K_NUMLOCK"),this.scrollKey=this.findKey("K_SCROLL"),this.spaceBarKey){var B=this.spaceBarKey.label,g=this.spaceBarKey.btn;typeof g.className=="undefined"||g.className==""?g.className="kmw-spacebar":g.className.indexOf("kmw-spacebar")==-1&&(g.className+=" kmw-spacebar"),B.className!="kmw-spacebar-caption"&&(B.className="kmw-spacebar-caption")}}return Object.defineProperty(i.prototype,"rowHeight",{get:function(){return this._rowHeight},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"id",{get:function(){return this.spec.id},enumerable:!1,configurable:!0}),i.prototype.findKey=function(t){var e,n,c,r;try{for(var l=(0,d.__values)(this.rows),s=l.next();!s.done;s=l.next()){var o=s.value;try{for(var a=(c=void 0,(0,d.__values)(o.keys)),B=a.next();!B.done;B=a.next()){var g=B.value;if(g.getBaseId()==t)return g}}catch(u){c={error:u}}finally{try{B&&!B.done&&(r=a.return)&&r.call(a)}finally{if(c)throw c.error}}}}catch(u){e={error:u}}finally{try{s&&!s.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}return null},i.prototype.showLanguage=function(t){if(!!this.spaceBarKey)try{var e=this.spaceBarKey.label;this.spaceBarKey.spec.text=t,(e.innerText!=t||t=="")&&(e.innerText=t)}catch(n){}},i.prototype.refreshLayout=function(t){var e,n;this.rows.forEach(function(I){return I.detectStyles(t)});var c=t.keyboardHeight,r=this.rows.length,l=this._rowHeight=Math.floor(c/(r==0?1:r)),s=t.widthStyle.absolute;s&&(this.element.style.height=c+"px"),this.showLanguage(t.spacebarText);for(var o=0;o<r;o++){var a=this.rows[o],B=(r-o-1)*l+1;s&&(this.spec.row[o].proportionalY=(c-B-l/2)/c),a.refreshLayout(t),o==r-1&&(a.element.style.bottom="1px")}try{for(var g=(0,d.__values)(this.rows),u=g.next();!u.done;u=g.next()){var F=u.value;F.refreshKeyLayouts(t)}}catch(I){e={error:I}}finally{try{u&&!u.done&&(n=g.return)&&n.call(g)}finally{if(e)throw e.error}}},i}(),lr=_s;var Ps=.06,js=function(){function i(t,e,n){this.layers={},this._activeLayerId="default";var c=e.layout(n);this.spec=c;var r=this.element=document.createElement("div"),l=r.style;if(r.className="kmw-key-layer-group",c!=null){var s=c.fontsize;typeof s=="undefined"||s==null||s==""?l.fontSize="1em":l.fontSize=c.fontsize,l.width="100%",l.height="100%";var o,a,B,g;g=c.layer;var u=t.getDefaultKeyObject();for(u.fontsize=l.fontSize,o=0;o<g.length;o++){var F=g[o],I=new lr(t,c,F);this.layers[F.id]=I,I.element.style.display=F.id=="default"?"block":"none",r.appendChild(I.element)}}}return Object.defineProperty(i.prototype,"activeLayer",{get:function(){return this.activeLayerId?this.layers[this.activeLayerId]:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"activeLayerId",{get:function(){return this._activeLayerId},set:function(t){var e,n;this._activeLayerId=t;try{for(var c=(0,d.__values)(Object.keys(this.layers)),r=c.next();!r.done;r=c.next()){var l=r.value,s=this.layers[l],o=s.element;s.id==t?o.style.display="block":o.style.display="none"}}catch(a){e={error:a}}finally{try{r&&!r.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}},enumerable:!1,configurable:!0}),i.prototype.findNearestKey=function(t){if(!t)return null;var e=t.stateToken;if(!e)throw new Error("Layer id not set for input coordinate");var n=this.layers[e];if(!n)throw new Error("Layer id ".concat(e," could not be found"));return this.nearestKey(t,n)},i.prototype.blinkLayer=function(t){var e=this;if(typeof t=="string"){var n=t;if(t=this.layers[n],!t)throw new Error("Layer id ".concat(n," could not be found"))}var c=t;if(c.element.style.display!="block")for(var r in this.layers){if(this.layers[r].element.style.display=="block"){var l=this.layers[r];l.element.style.display="none"}this.layers[r].element.style.display="none"}c.element.style.display="block",Promise.resolve().then(function(){var s=e.layers[e._activeLayerId];(c.element.style.display=="block"||s.element.style.display!="block")&&(c.element.style.display="none",s.element.style.display="block")})},i.prototype.nearestKey=function(t,e){var n,c;if(e.rows.length==0)return null;var r={x:t.targetX/this.computedWidth,y:t.targetY/this.computedHeight};if(!isFinite(r.x)||!isFinite(r.y))return null;var l=Math.max(0,Math.min(e.rows.length-1,Math.floor(r.y*e.rows.length))),s=e.rows[l],o=null,a=Number.MAX_VALUE;try{for(var B=(0,d.__values)(s.keys),g=B.next();!g.done;g=B.next()){var u=g.value,F=u.spec;if(!(F.sp==9||F.sp==10)){var I=F.proportionalWidth/2,y=Math.abs(r.x-F.proportionalX);if(y-I<=0)return u.btn;var Q=y-I;Q<a&&(a=Q,o=u)}}}catch(h){n={error:h}}finally{try{g&&!g.done&&(c=B.return)&&c.call(B)}finally{if(n)throw n.error}}return a<=Ps?o.btn:null},i.prototype.resetPrecalcFontSizes=function(){var t,e,n,c,r,l;try{for(var s=(0,d.__values)(Object.values(this.layers)),o=s.next();!o.done;o=s.next()){var a=o.value;try{for(var B=(n=void 0,(0,d.__values)(a.rows)),g=B.next();!g.done;g=B.next()){var u=g.value;try{for(var F=(r=void 0,(0,d.__values)(u.keys)),I=F.next();!I.done;I=F.next()){var y=I.value;y.resetFontPrecalc()}}catch(Q){r={error:Q}}finally{try{I&&!I.done&&(l=F.return)&&l.call(F)}finally{if(r)throw r.error}}}}catch(Q){n={error:Q}}finally{try{g&&!g.done&&(c=B.return)&&c.call(B)}finally{if(n)throw n.error}}}}catch(Q){t={error:Q}}finally{try{o&&!o.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}this._heightPadding=void 0},i.prototype.refreshLayout=function(t){if(!(isNaN(t.keyboardWidth)||isNaN(t.keyboardHeight))){if(this.computedWidth=t.keyboardWidth,this.computedHeight=t.keyboardHeight,this._heightPadding===void 0){var e=getComputedStyle(this.element),n=parseInt(e.paddingTop,10)||0,c=parseInt(e.paddingBottom,10)||0;this._heightPadding=n+c}this.activeLayer&&this.activeLayer.refreshLayout(t)}},Object.defineProperty(i.prototype,"verticalPadding",{get:function(){var t;return(t=this._heightPadding)!==null&&t!==void 0?t:0},enumerable:!1,configurable:!0}),i}(),sr=js;var or="kmw-",ar="top",qs=function(){function i(t,e){var n=this;this.state=!1,this.orientation=ar,this.vkbd=t;var c=this.element=document.createElement("div");c.className="kmw-keytip",c.id="kmw-keytip",c.style.pointerEvents="none",c.style.display="none",c.appendChild(this.tip=document.createElement("div")),c.appendChild(this.cap=document.createElement("div")),this.tip.appendChild(this.preview=document.createElement("div")),this.tip.className="kmw-keytip-tip",this.cap.className="kmw-keytip-cap",this.constrain=e,this.reorient=function(r){n.orientation=r,n.show(n.key,n.state,n.previewHost)}}return i.prototype.show=function(t,e,n){var c=this,r,l=this.vkbd;if(e&&l.layerGroup.blinkLayer(t.key.spec.displayLayer),e&&t.offsetParent){var s=t.key.row.element,o=t.getClientRects()[0],a=s.getClientRects()[0],B=o.left-a.left,g=o.width,u=o.height,F=t.key.label,I=1.8,y=this.element.style,Q=l.topContainer,h=Q.getBoundingClientRect(),C=t.getBoundingClientRect(),x=void 0,U=this.orientation,p=C.bottom-h.top;x=p+(U=="top"?1:-1);var X=x-Math.floor(x),G=g+Math.ceil(g*.3)*2,V=Math.ceil(2.3*u)+X;U=="bottom"&&(x+=V-u),y.top="auto";var L=U=="top"?"bottom":"top";this.tip.classList.remove("".concat(or).concat(L)),this.tip.classList.add("".concat(or).concat(U)),y.bottom=Math.floor(h.height-x)+"px",y.textAlign="center",y.overflow="visible",y.width=G+"px",y.height=V+"px";var m=this.vkbd.currentLayer.element.style.fontFamily,S=getComputedStyle(l.element);y.fontFamily=t.key.spec.font||m||S.fontFamily;var E=parseInt(S.fontSize,10);if(E==Number.NaN&&(E=0),E!=0){var H={keyWidth:1.6*g,keyHeight:1.6*u,baseEmFontSize:l.getKeyEmFontSize(),layoutFontSize:new f(l.kbdDiv.style.fontSize)};y.fontSize=t.key.getIdealFontSize(t.key.keyText,H,I).styleString}var R=(G-g)/2;B<R?(this.cap.style.left="1px",B+=R-1):B>window.innerWidth-g-R?(this.cap.style.left=G-g-1+"px",B-=R-1):this.cap.style.left=R+"px",y.left=B-R+"px";var Y=getComputedStyle(this.element),A=h.height,Z=parseFloat(Y.bottom),W=parseFloat(Y.height),w=Math.ceil(V/2);this.cap.style.width=g+"px",this.tip.style.height=w+"px";var Se=3,ct=w-Se+"px";U=="top"?(this.cap.style.top=ct,this.cap.style.bottom=""):(this.cap.style.top="",this.cap.style.bottom=ct);var it=p-Math.floor(x)+V-(U=="top"?w:-Se*2);if(this.cap.style.height=it+"px",this.constrain&&W+Z>A){var rt=W+Z-A;y.height=V-rt+"px";var Ke=Math.max(0,V-rt-V/2+2);this.cap.style.height=Ke+"px"}else Z<0&&(y.bottom="0px",this.cap.style.height=Math.max(0,it+Z)+"px");if(y.display="block",this.previewHost==n)return;var lt=this.preview;this.previewHost&&this.previewHost.off("preferredOrientation",this.reorient),this.previewHost=n,n&&(this.previewHost.on("preferredOrientation",this.reorient),this.preview=this.previewHost.element,this.tip.replaceChild(this.preview,lt),n.setCancellationHandler(function(){return c.show(null,!1,null)}),n.on("startFade",function(){c.element.classList.remove("kmw-preview-fade"),c.element.offsetWidth,c.element.classList.add("kmw-preview-fade")}))}else{this.element.style.display="none",(r=this.previewHost)===null||r===void 0||r.off("preferredOrientation",this.reorient),this.previewHost=null;var Zt=this.preview;this.preview=document.createElement("div"),this.tip.replaceChild(this.preview,Zt),this.element.classList.remove("kmw-preview-fade"),this.orientation=ar}this.key=t,this.state=e},i}(),Br=qs;var cc="kmw-keypreview",$s="kmw-preview-overlay",eo="kmw-keytip",dr=function(){function i(t){this.state=!1,this.vkbd=t;var e=this.element=document.createElement("div");e.className=cc,e.id="kmw-keytip",e.style.pointerEvents="none",e.style.display="none",this.preview=document.createElement("div"),e.appendChild(this.preview)}return i.prototype.show=function(t,e,n){var c=this,r=this.vkbd,l=t==null?void 0:t.key.spec.displayLayer;if(e&&r.layerGroup.blinkLayer(l),e&&(t==null?void 0:t.offsetParent)){var s=this.vkbd.topContainer.getBoundingClientRect(),o=t.getBoundingClientRect(),a=l!=r.layerId?$s:"";this.element.className="".concat(cc," ").concat(t.className," ").concat(a),this.element.id="".concat(eo,"-").concat(t.id);var B=this.element.style,g=this.vkbd.currentLayer.element.style.fontFamily;if(B.fontFamily=t.key.spec.font||g,B.left=o.left-s.left+"px",B.top=o.top-s.top+"px",B.width=o.width+"px",B.height=o.height+"px",this.element.style.display="block",this.previewHost==n)return;var u=this.preview;this.previewHost=n,n&&(this.preview=this.previewHost.element,this.element.replaceChild(this.preview,u),n.setCancellationHandler(function(){return c.show(null,!1,null)}),n.on("startFade",function(){c.element.classList.remove("kmw-preview-fade"),c.element.offsetWidth,c.element.classList.add("kmw-preview-fade")}))}else{this.element.style.display="none",this.element.className=cc,this.previewHost=null;var F=this.preview;this.preview=document.createElement("div"),this.element.replaceChild(this.preview,F),this.element.classList.remove("kmw-preview-fade")}this.key=t,this.state=e},i}();function Ce(i){try{if(i=="desktop")return 1;var t=document.documentElement.clientWidth;if(screen.width>t)return 1;var e=screen.width;return le()?screen.width<screen.height&&(e=screen.height):screen.width>screen.height&&(e=screen.height),Math.round(100*e/t)/100}catch(n){return 1}}var gr=function(){function i(t,e){var n=this;this.directlyEmitsKeys=!0,this.hasModalVisualization=!1,this.deleteRepeater=function(){n.repeatClosure(),n.timerHandle=window.setTimeout(n.deleteRepeater,i.REPEAT_DELAY)},this.source=t;var c=t.stageReports[0].item;c.key.highlight(!0),this.repeatClosure=function(){e(),c.key.highlight(!0)},this.timerHandle=window.setTimeout(this.deleteRepeater,i.INITIAL_DELAY),this.source.on("complete",function(){window.clearTimeout(n.timerHandle),n.timerHandle=void 0,c.key.highlight(!1)})}return i.prototype.cancel=function(){this.deleteRepeater(),this.source.cancel()},i.prototype.currentStageKeyDistribution=function(){return null},i.INITIAL_DELAY=500,i.REPEAT_DELAY=100,i}();var to=function(i){(0,d.__extends)(t,i);function t(e,n){if(typeof n!="string"||n=="")throw"The 'layer' parameter for subkey construction must be properly defined.";return i.call(this,e,n)||this}return t.prototype.getId=function(){return"popup-"+this.spec.elementID},t.prototype.construct=function(e,n,c){var r=this.spec,l=document.createElement("div"),s=e.getDefaultKeyObject(),o=l.style;l.className="kmw-key-square-ex",c&&(o.marginTop="5px"),typeof r.width!="undefined"?o.width=r.width*n.offsetWidth/100+"px":o.width=n.offsetWidth+"px",o.height=n.offsetHeight+"px";var a=document.createElement("div"),B=this.btn=tn(a,new en(this,r.id));this.setButtonClass(),B.id=this.getId();var g=B.style;return g.height=o.height,g.lineHeight=n.style.lineHeight,g.width=o.width,g.position="absolute",B.appendChild(this.label=this.generateKeyText(e)),l.appendChild(B),this.square=l},t.prototype.allowsKeyTip=function(){return!1},t}(Ee),ur=to;var Fr=.2,no=1.2,Ir=3,co=5,yr=6+Ir,io=function(){function i(t,e,n,c,r){var l=this;this.directlyEmitsKeys=!0,this.shouldLockLayer=!1,this.baseKey=c,this.source=t,this.gestureParams=r,n.layerLocked&&(this.shouldLockLayer=!0),t.on("complete",function(){var X;(X=l.currentSelection)===null||X===void 0||X.key.highlight(!1),l.clear()}),t.on("stage",function(){var X=l.currentSelection;if(X){var G=n.keyEventFromSpec(X.key.spec);G.keyDistribution=l.currentStageKeyDistribution(),n.raiseKeyEvent(G,X)}});var s=t.stageReports[0].sources[0].constructSubview(!0,!1);s.path.on("step",function(X){var G,V;s.path.stats.netDistance>=4&&((G=l.currentSelection)===null||G===void 0||G.key.highlight(!1),(V=X.item)===null||V===void 0||V.key.highlight(!0),l.currentSelection=X.item)}),this.currentSelection=c,c.key.highlight(!0);var o=c.subKeys,a=this.element=document.createElement("div"),B;a.id="kmw-popup-keys";var g=a.style;g.fontFamily=n.fontFamily;var u=getComputedStyle(c);g.fontSize=u.fontSize,g.visibility="hidden";var F=o.length,I,y;for(I=Math.min(Math.ceil(F/9),2),y=Math.ceil(F/I),this.menuWidth=y*c.offsetWidth+y*co,g.width=this.menuWidth+"px",this.subkeys=[],B=0;B<F;B++){var Q=!1,h=Math.floor(B/y);I>1&&h>0&&(Q=!0);var C=c.key.layer;(typeof C!="string"||C=="")&&(C=n.layerId);var x=new ur(o[B],C),U=x.construct(n,c,Q);this.subkeys.push(U.firstChild),a.appendChild(U)}this.shim=document.createElement("div"),this.shim.id="kmw-popup-shim",n.device.formFactor==v.FormFactor.Phone&&this.selectDefaultSubkey(c,a),n.element.appendChild(this.element),n.topContainer.appendChild(this.shim),this.reposition(n);var p=this.buildPopupRecognitionConfig(n);e({type:"push",config:p})}return i.prototype.buildPopupRecognitionConfig=function(t){var e=this,n=this.element.getBoundingClientRect(),c=this.baseKey.getBoundingClientRect(),r=this.subkeys[0].style,l=Number.parseInt(r.height,10),s=-.666*l,o=3,a=c.bottom-n.bottom,B=new he(this.element,[s*o,s,-a<s?-a:s]),g={getBoundingClientRect:function(){var u=Number.MAX_SAFE_INTEGER;return new DOMRect(-u,-u,2*u,2*u)}};return{targetRoot:this.element,inputStartBounds:t.element,maxRoamingBounds:g,safeBounds:g,itemIdentifier:function(u,F){var I,y,Q=B.getBoundingClientRect(),h=null,C=Number.MAX_VALUE,x=Number.MAX_VALUE;if(u.clientX<Q.left||u.clientX>Q.right||u.clientY<Q.top||u.clientY>Q.bottom)return null;try{for(var U=(0,d.__values)(e.subkeys),p=U.next();!p.done;p=U.next()){var X=p.value,G=X.getBoundingClientRect(),V=Number.MAX_VALUE,L=Number.MAX_VALUE;if(G.left<=u.clientX&&u.clientX<G.right?V=0:V=G.left>=u.clientX?G.left-u.clientX:u.clientX-G.right,G.top<=u.clientY&&u.clientY<G.bottom?L=0:L=G.top>=u.clientY?G.top-u.clientY:u.clientY-G.bottom,V==0&&L==0)return X;(V<x||V==x&&L<C)&&(x=V,h=X,C=L)}}catch(m){I={error:m}}finally{try{p&&!p.done&&(y=U.return)&&y.call(U)}finally{if(I)throw I.error}}return h}}},i.prototype.reposition=function(t){var e=this.element,n=this.baseKey,c=t.topContainer,r=n.key.row.element,l=e.style,s=n.offsetParent?n.offsetParent.offsetLeft:0,o=n.offsetLeft+s+.5*(n.offsetWidth-e.offsetWidth),a=t.width-e.offsetWidth;o>a&&(o=a),o<0&&(o=0),l.left=o+"px";var B=c.getBoundingClientRect(),g=r.getBoundingClientRect();l.top=g.top-B.top-e.offsetHeight-Ir+"px",l.visibility="visible";var u=t.isEmbedded,F=getComputedStyle(e),I=parseFloat(F.top),y=0,Q=0;I<y&&u&&(Q=y-I,l.top=y+"px"),this.callout=this.addCallout(n,Q,t.element,t.topContainer,t.device.formFactor=="tablet")},i.prototype.addCallout=function(t,e,n,c,r){e=e||0;var l=getComputedStyle(this.element),s=Math.max(Number.parseInt(l.borderRadius),0),o=t.getBoundingClientRect(),a=c.getBoundingClientRect(),B=Math.floor(Number.parseInt(l.top,10)+Number.parseInt(l.height,10)+Number.parseInt(l.paddingTop,10)/2+Number.parseInt(l.paddingBottom,10)),g=Fr*(o.height-e),u=Fr*o.height,F=g+yr,I=F/(u+yr),y=o.bottom-a.top-B-1,Q=y<F?y:F;if(Q>0){var h=document.createElement("div"),C=h.style;h.id="kmw-popup-callout",n.appendChild(h),C.top=B+"px",C.borderTopWidth=Q+"px";var x=no*I,U=o.width*x,p=this.menuWidth-2*s,X=p<U?p:U,G=o.left-a.left-(X-o.width)/2,V=Math.max(0,G+X-(a.right-s)),L=Math.max(0,s-G);return C.left=o.left-a.left-(X-o.width)/2+L+"px",C.borderLeftWidth=X/2-L+"px",C.borderRightWidth=X/2-V+"px",h}else return null},i.prototype.selectDefaultSubkey=function(t,e){for(var n,c,r=t.subKeys,l=0;l<r.length;l++){var s=r[l],o=e.childNodes[l].firstChild;if(s.default){c=o;break}else if(!t.key||!t.key.spec)continue;s.elementID==t.key.spec.elementID&&(c=o)}c&&((n=this.currentSelection)===null||n===void 0||n.key.highlight(!1),this.currentSelection=c,c.key.highlight(!0))},Object.defineProperty(i.prototype,"hasModalVisualization",{get:function(){return this.element.style.visibility=="visible"},enumerable:!1,configurable:!0}),i.prototype.buildCorrectiveLayout=function(){var t=this.element.getBoundingClientRect(),e=t.width/t.height,n=this.subkeys.map(function(c){var r=c.getBoundingClientRect(),l={keySpec:c.key.spec,centerX:(r.right-r.width/2-t.left)/t.width,centerY:(r.bottom-r.height/2-t.top)/t.height,width:r.width/t.width,height:r.height/t.height};return l});return{keys:n,kbdScaleRatio:e}},i.prototype.currentStageKeyDistribution=function(){var t=this,e=this.source.stageReports[this.source.stageReports.length-1],n=this.source.stageReports[0],c=e.sources[0],r=c.currentSample,l=this.element.getBoundingClientRect(),s={x:r.targetX/l.width,y:r.targetY/l.height};s.x=s.x<0?0:s.x>1?1:s.x,s.y=s.y<0?0:s.y>1?1:s.y;var o=Tt(s,this.buildCorrectiveLayout()),a=o.get(r.item.key.spec),B=Math.min(c.path.stats.duration-n.sources[0].path.stats.duration,this.gestureParams.longpress.waitLength)/(2*this.gestureParams.longpress.waitLength),g=Math.min(c.path.stats.rawDistance,this.gestureParams.longpress.noiseTolerance*4)/(this.gestureParams.longpress.noiseTolerance*8),u=Math.min(B*B,g*g),F=a+u,I=new Map,y=this.subkeys.find(function(Q){return Q.keyId==t.baseKey.keyId});return y?I.set(y.key.spec,F):I.set(this.baseKey.key.spec,F),We([o,I])},i.prototype.cancel=function(){this.clear(),this.source.cancel()},i.prototype.clear=function(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.shim.parentNode&&this.shim.parentNode.removeChild(this.shim),this.callout&&this.callout.parentNode&&this.callout.parentNode.removeChild(this.callout)},i}(),ic=io;var ro=function(){function i(t,e,n){var c=this;this.directlyEmitsKeys=!0,this.shouldRestore=!1,this.hasModalVisualization=!1;var r=t.stageReports[0];this.originalLayer=r.sources[0].stateToken,this.source=t,this.completionCallback=function(){e.lockLayer(!1),c.shouldRestore&&(e.layerId=c.originalLayer,e.updateState()),n==null||n()},e.lockLayer(!0),t.on("stage",function(l){var s=l.matchedId;s.includes("modipress")&&s.includes("-end")?c.clear():s.includes("modipress")&&s.includes("-hold")&&(c.shouldRestore=!0)}),t.on("complete",function(){return c.cancel()})}return Object.defineProperty(i.prototype,"isLocked",{get:function(){return this.shouldRestore},enumerable:!1,configurable:!0}),i.prototype.setLocked=function(){this.shouldRestore=!0},Object.defineProperty(i.prototype,"completed",{get:function(){return this.completionCallback===null},enumerable:!1,configurable:!0}),i.prototype.clear=function(){var t=this.completionCallback;this.completionCallback=null,t==null||t()},i.prototype.cancel=function(){this.clear(),this.source.cancel()},i.prototype.currentStageKeyDistribution=function(t){return null},i}(),Ut=ro;var lo=function(){function i(t,e,n,c,r){var l=this;this.directlyEmitsKeys=!0,this.hasModalVisualization=!1,this.tapIndex=0,this.baseKey=n,this.baseContextToken=c,this.multitaps=[n.key.spec].concat(n.key.spec.multitap),this.sequence=t;var s=function(u){var F;(F=l.modipress)===null||F===void 0||F.clear();var I=new Ut(t,e,function(){l.modipress=e.activeModipress=null});l.modipress=e.activeModipress=I};this.originalLayer=e.layerId;var o=function(u){return(l.tapIndex+u)%l.multitaps.length},a=function(){r==null||r.setMultitapHint(l.multitaps[o(0)],l.multitaps[o(1)],e)};t.on("complete",function(){var u;(u=l.modipress)===null||u===void 0||u.cancel(),l.clear()});var B=function(u){var F;switch(u.matchedId){case"modipress-hold":l.clear(),t.off("stage",B);return;case"modipress-end-multitap-transition":case"modipress-multitap-end":case"modipress-end":case"multitap-end":case"simple-tap":return;case"modipress-multitap-lock-transition":(F=l.modipress)===null||F===void 0||F.setLocked();return;case"modipress-multitap-start":case"multitap-start":break;default:throw new Error("Unsupported gesture state encountered during multitap: ".concat(u.matchedId))}l.tapIndex=o(1);var I=l.multitaps[l.tapIndex];a();var y=e.keyEventFromSpec(I);y.baseTranscriptionToken=l.baseContextToken;var Q=u.sources[0].currentSample,h=e.getSimpleTapCorrectionDistances(Q,l.baseKey.key.spec);if(Q.stateToken!=e.layerId&&!u.matchedId.includes("modipress")){var C=e.layerGroup.findNearestKey((0,d.__assign)((0,d.__assign)({},Q),{stateToken:e.layerId})),x=h.get(C.key.spec);x==null&&console.warn("Could not find current layer's key"),h.delete(C.key.spec),h.set(Q.item.key.spec,x)}y.keyDistribution=l.currentStageKeyDistribution(h),y.kNextLayer||(y.kNextLayer=l.originalLayer),e.raiseKeyEvent(y,null),u.matchedId=="modipress-multitap-start"&&s(u)};t.on("stage",B);var g=t.stageReports[0];g.matchedId=="modipress-start"&&s(t.stageReports[0]),a()}return i.prototype.currentStageKeyDistribution=function(t){var e=this,n=We(t),c=n.findIndex(function(y){return y.keySpec==e.baseKey.key.spec});if(c==-1)return bt(this.baseKey)||console.warn("Could not find base key's probability for multitap correction"),n;for(var r=n.splice(c,1)[0].p,l=0,s=[],o=0;o<this.multitaps.length;o++){var a=this.multitaps[o],B=Math.abs(o-this.tapIndex)%this.multitaps.length,g=(o+this.multitaps.length-this.tapIndex)%this.multitaps.length,u=B<g?B:g,F=1/((1+u)*(1+u));l+=F,s.push({keySpec:a,p:F})}var I=r/l;return s.forEach(function(y){y.p=I*y.p}),n.concat(s).sort(function(y,Q){return Q.p-y.p})},i.prototype.cancel=function(){this.clear(),this.sequence.cancel()},i.prototype.clear=function(){},i}(),Qr=lo;var hr=N(T(),1);var pt=1.4142,rc=function(i){return Math.abs(i)<1e-10?0:i},Cr=function(i){(0,d.__extends)(t,i);function t(e,n,c,r){var l=this,s;l=i.call(this)||this,l.flickPreviews=new Map,l.orientation="top";var o=e.key.spec,a=l.flickEdgeLength=Math.max(c,r),B=l.div=document.createElement("div");B.className=B.id="kmw-gesture-preview",B.style.pointerEvents="none";var g=l.previewImgContainer=document.createElement("div");l.previewImgContainer.id="kmw-preview-img-container";var u=l.label=document.createElement("span");if(u.className="kmw-gesture-base-label kmw-key-text",u.id="kmw-gesture-base-label",g.appendChild(u),u.textContent=e.key.label.textContent,l.div.appendChild(l.previewImgContainer),o.flick){var F=o.flick||{};Object.keys(F).forEach(function(y){var Q=document.createElement("div");Q.className="kmw-flick-preview kmw-key-text",Q.textContent=F[y].text;var h=Q.style,C=jn.get(y),x=rc(-Math.sin(C[0])),U=rc(Math.cos(C[0]));h.width="100%",h.textAlign="center",x<0?h.right=-x*pt*a+"px":x>0?h.left=x*pt*a+"px":h.left="0px",h.height="100%",h.lineHeight="100%",U<0?h.bottom=-U*pt*a+"px":U>0?h.top=U*pt*a+"px":h.top="0px",l.flickPreviews.set(y,Q),g.appendChild(Q)})}var I=l.hintLabel=document.createElement("div");return I.className="kmw-key-popup-icon",n||(I.textContent=o==o.hintSrc?o.hint:(s=o.hintSrc)===null||s===void 0?void 0:s.text,I.style.fontWeight=I.textContent=="\u2022"?"bold":""),B.appendChild(I),l}return Object.defineProperty(t.prototype,"element",{get:function(){return this.div},enumerable:!1,configurable:!0}),t.prototype.refreshLayout=function(){var e=getComputedStyle(this.div),n=Number.parseInt(e.height,10);this.flickPreviews.forEach(function(c){c.style.lineHeight=c.style.height="".concat(n,"px")})},t.prototype.cancel=function(){var e;(e=this.onCancel)===null||e===void 0||e.call(this),this.onCancel=null},t.prototype.setCancellationHandler=function(e){this.onCancel=e},t.prototype.setMultitapHint=function(e,n,c){var r,l,s=De(e.text,c),o=De(n.text,c);this.label.textContent=s,this.hintLabel.textContent=o,this.label.style.fontFamily=s!=e.text?"SpecialOSK":(r=e.font)!==null&&r!==void 0?r:this.label.style.fontFamily,this.hintLabel.style.fontFamily=o!=n.text?"SpecialOSK":(l=n.font)!==null&&l!==void 0?l:this.hintLabel.style.fontFamily,this.emit("startFade"),this.clearFlick()},t.prototype.scrollFlickPreview=function(e,n){this.clearHint();var c=this.previewImgContainer.style,r=this.flickEdgeLength*pt;c.marginLeft="".concat(r*e,"px"),c.marginTop="".concat(r*n,"px");var l=rc(n)<0?"bottom":"top";this.orientation!=l&&(this.orientation=l,this.emit("preferredOrientation",l))},t.prototype.clearFlick=function(){this.previewImgContainer.style.marginTop="0px",this.previewImgContainer.style.marginLeft="0px",this.previewImgContainer.classList.add("kmw-flick-clear")},t.prototype.clearHint=function(){this.hintLabel.classList.add("kmw-hint-clear")},t.prototype.clearAll=function(){this.clearFlick()},t}(hr.default);var xr=Re.TIER!="stable"||Re.VERSION_ENVIRONMENT!="",so=xr?10:0,oo=function(i){(0,d.__extends)(t,i);function t(e){var n=this,c,r;n=i.call(this)||this,n.gestureParams=(0,d.__assign)({},qn),n.layerLocked=!1,n.layerIndex=0,n.isStatic=!1,n._fixedWidthScaling=!1,n._fixedHeightScaling=!0,n._borderWidth=0,n.stateKeys={K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1},n.activeGestures=[],n.activeModipress=null,n.repeatDelete=function(){this.deleting&&(this.modelKeyClick(this.deleteKey),this.deleting=window.setTimeout(this.repeatDelete,100))}.bind(n),n.config=e,n.config.device=e.device||e.hostDevice,n.config.isEmbedded=e.isEmbedded||!1,e.isStatic&&(n.isStatic=e.isStatic),n._fixedWidthScaling=n.device.touchable&&!n.isStatic,n._fixedHeightScaling=n.device.touchable&&!n.isStatic;var l=document.createElement("div");n.config.styleSheetManager=e.styleSheetManager||new ye(l);var s;if(e.keyboard)s=n.kbdLayout=e.keyboard.layout(e.device.formFactor),n.layoutKeyboardProperties=e.keyboardMetadata,n.isRTL=e.keyboard.isRTL;else{var o=D.buildDefaultLayout(null,null,e.device.formFactor);s=n.kbdLayout=Rt.polyfill(o,null,e.device.formFactor),n.layoutKeyboardProperties=null,n.isRTL=!1}"font"in s?n.fontFamily=s.font:n.fontFamily="";var a=e.device.formFactor;n.layoutKeyboard=e.keyboard,n.layoutKeyboard||(n.layoutKeyboard=new $(null)),n.layerGroup=new sr(n,n.layoutKeyboard,a),n.layoutKeyboard.markLayoutCalibrated(a),l.appendChild(n.layerGroup.element),n.kbdDiv=l,n.isStatic||(n.gestureEngine=n.constructGestureEngine()),l.classList.add(e.device.formFactor,"kmw-osk-inner-frame");var B=(r=(c=n.layoutKeyboard)===null||c===void 0?void 0:c.id.replace("Keyboard_",""))!==null&&r!==void 0?r:"",g=B.indexOf("::");g!=-1&&(B=B.substring(g+2));var u="kmw-keyboard-"+B;return n.element.classList.add(u),n}return Object.defineProperty(t.prototype,"layerId",{get:function(){var e,n;return(n=(e=this.layerGroup)===null||e===void 0?void 0:e.activeLayerId)!==null&&n!==void 0?n:"default"},set:function(e){var n=e!=this.layerId;if(this.layerGroup.layers[e])this.layerGroup.activeLayerId=e,this.gestureEngine&&(this.gestureEngine.stateToken=e);else throw new Error("Keyboard ".concat(this.layoutKeyboard.id," does not have a layer with id ").concat(e));n&&!this.deferLayout&&(this.updateState(),this.layerGroup.refreshLayout(this.constructLayoutParams()))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentLayer",{get:function(){var e;return(e=this.layerGroup)===null||e===void 0?void 0:e.activeLayer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lgKey",{get:function(){var e,n;return(n=(e=this.currentLayer)===null||e===void 0?void 0:e.globeKey)===null||n===void 0?void 0:n.btn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hkKey",{get:function(){var e,n;return(n=(e=this.currentLayer)===null||e===void 0?void 0:e.hideKey)===null||n===void 0?void 0:n.btn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"spaceBar",{get:function(){var e,n;return(n=(e=this.currentLayer)===null||e===void 0?void 0:e.spaceBarKey)===null||n===void 0?void 0:n.btn},enumerable:!1,configurable:!0}),t.prototype.constructGestureEngine=function(){var e=this,n=this.kbdLayout.layerMap.default.row.length,c={targetRoot:this.element,mouseEventRoot:document.body,maxRoamingBounds:new he(this.topContainer,[NaN]),itemIdentifier:function(a,B){return e.layerGroup.findNearestKey(a)},recordingMode:xr,historyLength:so};this.gestureParams.longpress.permitsFlick=function(a){var B=a==null?void 0:a.key.spec.flick;return!B||!(B.n||B.nw||B.ne)};var r=new ht($n(this.kbdLayout,this.gestureParams),c);r.stateToken=this.layerId;var l={},s=function(a){var B,g;try{for(var u=(0,d.__values)(Object.keys(l)),F=u.next();!F.done;F=u.next()){var I=F.value;if(I!=a){var y=l[I];y.source.terminate(!0)}}}catch(Q){B={error:Q}}finally{try{F&&!F.done&&(g=u.return)&&g.call(u)}finally{if(B)throw B.error}}},o=new Map;return r.on("inputstart",function(a){var B,g=e.highlightKey(a.currentSample.item,!0);g&&((B=e.gesturePreviewHost)===null||B===void 0||B.cancel(),e.gesturePreviewHost=g);var u=l[a.identifier]={source:a,roamingHighlightHandler:null,key:a.currentSample.item,previewHost:g},F=function(){de(0).then(function(){var I=u.previewHost;I&&(I.cancel(),e.gesturePreviewHost=null,u.previewHost=null),u.key&&(e.highlightKey(u.key,!1),u.key=null)})};u.roamingHighlightHandler=function(I){var y,Q=I.item,h=l[a.identifier].key;if(!e.kbdLayout.hasFlicks&&Q!=h){e.highlightKey(h,!1),(y=e.gesturePreviewHost)===null||y===void 0||y.cancel(),e.gesturePreviewHost=null,u.previewHost=null;var C=e.highlightKey(Q,!0);C&&(e.gesturePreviewHost=C,u.previewHost=C),l[a.identifier].key=Q}},a.path.on("invalidated",F),a.path.on("complete",F),a.path.on("step",u.roamingHighlightHandler)}),r.on("recognizedgesture",function(a){var B;(B=e.activeModipress)===null||B===void 0||B.setLocked(),a.on("complete",function(){var g,u,F;try{for(var I=(0,d.__values)(a.allSourceIds),y=I.next();!y.done;y=I.next()){var Q=y.value;!((F=l[Q])===null||F===void 0)&&F.previewHost&&(e.gesturePreviewHost=null,l[Q].previewHost.cancel()),delete l[Q]}}catch(h){g={error:h}}finally{try{y&&!y.done&&(u=I.return)&&u.call(I)}finally{if(g)throw g.error}}}),a.on("stage",function(g,u){var F,I,y=a.allSourceIds.map(function(A){var Z;return(Z=l[A])===null||Z===void 0?void 0:Z.previewHost}).find(function(A){return!!A}),Q=function(){y&&(y.cancel(),e.gesturePreviewHost=null)},h=o.get(a);!h&&y&&!g.matchedId.includes("flick")&&y.clearFlick();var C,x=function(A){var Z=function(w){w.key&&(e.highlightKey(w.key,!1),w.key=null),w.source.path.off("step",w.roamingHighlightHandler)};if(C=l[A],C)Z(C);else{var W=A;de(0).then(function(){var w=l[W];w&&Z(w)})}};try{for(var U=(0,d.__values)(g.allSourceIds),p=U.next();!p.done;p=U.next()){var X=p.value;x(X)}}catch(A){F={error:A}}finally{try{p&&!p.done&&(I=U.return)&&I.call(U)}finally{if(F)throw F.error}}var G=g.item,V=g.sources[0],L=V?V.currentSample:null,m=null;if(G&&!(h&&h[0].directlyEmitsKeys)){var S=void 0,E=e.getSimpleTapCorrectionDistances(V.currentSample,G.key.spec);h&&(S=h[0].currentStageKeyDistribution(E)),S||(S=We(E));var H=!e.layerLocked&&h&&h[0]instanceof ic&&h[0].shouldLockLayer;try{H&&e.lockLayer(!0),m=e.modelKeyClick(g.item,L,S)}finally{H&&e.lockLayer(!1)}}if(!(a.stageReports.length>1&&g.matchedId!="modipress-end")){var R=a.stageReports[0].item;if(g.matchedId=="special-key-start")G.key.spec.baseKeyID=="K_BKSP"?(Q(),h=[new gr(a,function(){return e.modelKeyClick(G,L)})]):G.key.spec.baseKeyID=="K_LOPT"&&(a.on("complete",function(){G.key.highlight(!1),e.emit("globekey",G,!1)}),s(V.identifier),G.key.highlight(!0));else if(g.matchedId.indexOf("longpress")>-1)Q(),h=[new ic(a,u,e,a.stageReports[0].sources[0].baseItem,e.gestureParams)];else if((R==null?void 0:R.key.spec.multitap)&&(g.matchedId=="initial-tap"||g.matchedId=="multitap"||g.matchedId=="modipress-start"))C.previewHost=null,a.on("complete",function(){Q()}),h=[new Qr(a,e,R,m.contextToken,y)];else if(g.matchedId.indexOf("flick")>-1)h=[new Ni(a,u,e,a.stageReports[0].sources[0].baseItem,e.gestureParams,y)];else if(g.matchedId.includes("modipress")&&g.matchedId.includes("-start"))if(Q(),e.layerLocked)console.warn("Unexpected state:  modipress start attempt during an active modipress");else{h||(h=[]);var Y=new Ut(a,e,function(){var A=h.indexOf(Y);A>-1&&h.splice(A,1),e.activeModipress=null});h.push(Y),e.activeModipress=Y}else Q();h&&(e.activeGestures=e.activeGestures.concat(h),o.set(a,h),a.on("complete",function(){var A=e.activeGestures.filter(function(Z){return h.includes(Z)});e.activeGestures=e.activeGestures.filter(function(Z){return!h.includes(Z)}),A.forEach(function(Z){Z instanceof Ut&&Z.cancel()})}))}})}),r},Object.defineProperty(t.prototype,"element",{get:function(){return this.kbdDiv},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"device",{get:function(){return this.config.device},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hostDevice",{get:function(){return this.config.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontRootPath",{get:function(){return this.config.pathConfig.fonts},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"styleSheetManager",{get:function(){return this.config.styleSheetManager},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"topContainer",{get:function(){return this.config.topContainer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmbedded",{get:function(){return this.config.isEmbedded},enumerable:!1,configurable:!0}),t.prototype.postInsert=function(){},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layoutWidth",{get:function(){if(this.usesFixedWidthScaling){var e=this.width;return e-=this._borderWidth*2,f.inPixels(e)}else return f.forScalar(1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layoutHeight",{get:function(){if(this.usesFixedHeightScaling){var e=this.height;return e-=this._borderWidth*2,f.inPixels(e)}else return f.forScalar(1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"internalHeight",{get:function(){return this.usesFixedHeightScaling?f.inPixels(this.layoutHeight.val-this._borderWidth*2-this.layerGroup.verticalPadding):f.forScalar(1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize||(this._fontSize=new f("1em")),this._fontSize},set:function(e){this._fontSize=e,this.kbdDiv.style.fontSize=e.styleString},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"usesFixedWidthScaling",{get:function(){return this._fixedWidthScaling},set:function(e){this._fixedWidthScaling=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"usesFixedHeightScaling",{get:function(){return this._fixedHeightScaling},set:function(e){this._fixedHeightScaling=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"usesFixedPositioning",{get:function(){for(var e=this.element;e;){if(getComputedStyle(e).position=="fixed")return!0;e=e.offsetParent}return!1},enumerable:!1,configurable:!0}),t.prototype.setSize=function(e,n,c){this._width=e,this._height=n,this.kbdDiv&&(this.kbdDiv.style.width=e?this._width+"px":"",this.kbdDiv.style.height=n?this._height+"px":"",!this.device.touchable&&n&&(this.fontSize=new f(this._height/8+"px")),c||this.refreshLayout())},t.prototype.getDefaultKeyObject=function(){var e=(0,d.__assign)({},z.DEFAULT_KEY);return z.polyfill(e,this.layoutKeyboard,this.kbdLayout,this.layerId),e},t.prototype.getTouchCoordinatesOnKeyboard=function(e){var n={x:e.targetX,y:e.targetY};return n.x/=this.layerGroup.element.offsetWidth,n.y/=this.kbdDiv.offsetHeight,n},t.prototype.getSimpleTapCorrectionDistances=function(e,n){var c=this.getTouchCoordinatesOnKeyboard(e),r=this.layerGroup.element,l=r.offsetWidth,s=this.kbdDiv.offsetHeight;if(!l||!s)return new Map;var o=l/s,a=si(this.kbdLayout.getLayer(this.layerId),o);return Tt(c,a)},t.prototype.keyTarget=function(e){var n=e;try{if(n){if(n.classList.contains("kmw-key"))return nn(n);if(n.parentNode&&n.parentNode.classList.contains("kmw-key"))return nn(n.parentNode);if(n.firstChild&&n.firstChild.classList.contains("kmw-key"))return nn(n.firstChild)}}catch(c){}return null},t.prototype.cancelDelete=function(){this.deleting&&window.clearTimeout(this.deleting),this.deleting=0},t.prototype.modelKeyClick=function(e,n,c){var r=this.initKeyEvent(e);return n&&(r.source=n),c&&(r.keyDistribution=c),this.raiseKeyEvent(r,e)},t.prototype.initKeyEvent=function(e){this.highlightKey(e,!1);var n=e.key?e.key.spec:null;return n?this.keyEventFromSpec(n):null},t.prototype.keyEventFromSpec=function(e){var n=this.layoutKeyboard.constructKeyEvent(e,this.device,this.stateKeys);return n.srcKeyboard=this.layoutKeyboard,n},t.prototype._UpdateVKShiftStyle=function(e){var n,c;e||(e=this.layerId);var r=this.layerGroup.layers[e];if(!!r&&(this.gestureEngine&&(this.gestureEngine.stateToken=e),!!(!((n=this.layoutKeyboard)===null||n===void 0)&&n.usesDesktopLayoutOnDevice(this.device)))){var l=["K_CAPS","K_NUMLOCK","K_SCROLL"],s=[r.capsKey,r.numKey,r.scrollKey];for(c=0;c<s.length;c++)s[c]!=null&&s[c].setToggleState(this.stateKeys[l[c]])}},t.prototype.updateStateKeys=function(e){for(var n in this.stateKeys)this.stateKeys[n]=e[n];this._UpdateVKShiftStyle()},t.prototype.highlightKey=function(e,n){if(!(!e||!e.key||e.className==""||e.className.indexOf("kmw-key-row")>=0)){var c=e.key.allowsKeyTip(),r=this.activeGestures.find(function(l){return l.hasModalVisualization});return n=r?!1:n,e.key.highlight(n),n&&c?this.gesturePreviewHost?null:this.showGesturePreview(e):null}},t.prototype.getKeyEmFontSize=function(){if(!this.fontSize)return new f("0px");if(this.device.formFactor=="desktop"){var e=.8;return this.fontSize.scaledBy(e)}else{var n=getComputedStyle(document.body).fontSize,c=new f(n),r=1;if(!this.isStatic){if(this.fontSize.absolute)return this.fontSize;r=this.fontSize.val}return c.scaledBy(r)}},t.prototype.updateState=function(){!this.currentLayer||(this.nextLayer=this.layerId,this.currentLayer.nextlayer&&(this.nextLayer=this.currentLayer.nextlayer),this.layerGroup.activeLayerId=this.layerId,this._UpdateVKShiftStyle())},t.prototype.refreshLayout=function(){if(!this.deferLayout){var e=this.device,n=1;e.OS==v.OperatingSystem.iOS&&!this.isEmbedded&&(n=n/Ce(this.device.formFactor));var c=this.kbdDiv.style;this.usesFixedHeightScaling&&this.height&&(c.height=c.maxHeight=this.height+"px"),c.fontSize=this.fontSize.scaledBy(n).styleString;var r=this.width&&this.height,l=getComputedStyle(this.kbdDiv),s=getComputedStyle(this.layerGroup.element),o=l.height!=""&&l.height!="auto",a=s.height!=""&&s.height!="auto";if(l.border&&(this._borderWidth=new f(l.borderWidth).val),r)this._computedWidth=this.width,this._computedHeight=this.height;else if(o)this._computedWidth=parseInt(l.width,10),this._computedHeight=parseInt(l.height,10);else if(a)this._computedWidth=parseInt(s.width,10),this._computedHeight=parseInt(s.height,10);else return;if(this.layerGroup.refreshLayout(this.constructLayoutParams()),!this.isStatic){var B=this.gestureEngine.config.maxRoamingBounds;B.updatePadding([-.333*this.currentLayer.rowHeight]),this.gestureParams.longpress.flickDistStart=.24*this.currentLayer.rowHeight,this.gestureParams.flick.startDist=.3*this.currentLayer.rowHeight,this.gestureParams.flick.dirLockDist=.35*this.currentLayer.rowHeight,this.gestureParams.flick.triggerDist=.75*this.currentLayer.rowHeight,this.gestureParams.longpress.flickDistFinal=.75*this.currentLayer.rowHeight}}},t.prototype.constructLayoutParams=function(){var e,n;return{keyboardWidth:this._computedWidth-2*this._borderWidth,keyboardHeight:this._computedHeight-2*this._borderWidth-this.layerGroup.verticalPadding,widthStyle:this.layoutWidth,heightStyle:this.internalHeight,baseEmFontSize:this.getKeyEmFontSize(),layoutFontSize:new f(this.layerGroup.element.style.fontSize),spacebarText:(n=(e=this.layoutKeyboardProperties)===null||e===void 0?void 0:e.displayName)!==null&&n!==void 0?n:"(System keyboard)"}},t.prototype.computedAdjustedOskHeight=function(e){if(!this.layerGroup)return e;var n=this.layerGroup.layers,c=0;for(var r in n){var l=n[r],s=l.rows.length,o=Math.floor(e/(s==0?1:s)),a=s*o;a>c&&(c=a)}var B=0,g=c+B;return g},t.prototype.appendStyleSheet=function(){var e=this,n=this.layoutKeyboard,c=this.layoutKeyboardProperties;this.styleSheet&&this.styleSheet.parentNode&&this.styleSheet.parentNode.removeChild(this.styleSheet);var r=c==null?void 0:c.textFont,l=c==null?void 0:c.oskFont;this.styleSheetManager.addStyleSheetForFont(r,this.fontRootPath,this.device.OS),this.styleSheetManager.addStyleSheetForFont(l,this.fontRootPath,this.device.OS),this.config.specialFont&&this.styleSheetManager.addStyleSheetForFont(this.config.specialFont,"",this.device.OS);var s=this.addFontStyle(r,l);n!=null&&typeof n.oskStyling=="string"&&(s=s+n.oskStyling),s&&(this.styleSheet=Ae(s),this.styleSheetManager.linkStylesheet(this.styleSheet)),this.styleSheetManager.allLoadedPromise().then(function(){e.layerGroup.resetPrecalcFontSizes(),e.refreshLayout()})},t.prototype.addFontStyle=function(e,n){var c="",r=function(l){return l.family.replace(/\u0022/g,"").replace(/,/g,'","')};return(e||n)&&(c='\n.kmw-key-text {\n  font-family: "'.concat(r(n||e),'";\n}\n\n.kmw-suggestion-text {\n  font-family: "').concat(r(e||n),'";\n}\n')),c},t.buildDocumentationKeyboard=function(e,n,c,r,l,s){var o,a,B=this;if(!e)return null;var g=typeof r=="undefined"?"desktop":r,u=typeof l=="undefined"?"default":l,F={};F.formFactor=g,g!="desktop"?(F.OS=v.OperatingSystem.iOS,F.touchable=!0):(F.OS=v.OperatingSystem.Windows,F.touchable=!1);var I=e.layout(g),y=new v("other",F.formFactor,F.OS,F.touchable),Q=new t({keyboard:e,keyboardMetadata:n,hostDevice:y,isStatic:!0,topContainer:null,pathConfig:c,styleSheetManager:null,specialFont:{family:"SpecialOSK",files:["".concat(c.resources,"/osk/keymanweb-osk.ttf")],path:""}});Q.layerGroup.element.className=Q.kbdDiv.className,Q.layerGroup.element.classList.add(F.formFactor+"-static");var h=Q.kbdDiv.childNodes[0],C=document.createElement("div");C.classList.add(F.OS.toLowerCase(),F.formFactor),I!=null?(Q.layerId=u,Q.layerGroup.activeLayerId=u,Q.setSize(800,s),Q.fontSize=Pi(y,s,!1),C.style.fontSize=Q.element.style.fontSize,Q.refreshLayout(),h.style.height=Q.kbdDiv.style.height,h.style.maxHeight=Q.kbdDiv.style.maxHeight):h.innerHTML="<p style='color:#c40; font-size:0.5em;margin:10px;'>No "+g+" layout is defined for "+e.name+".</p>",h.style.border="1px solid #ccc",Q.updateState();var x=function(){return(0,d.__awaiter)(B,void 0,void 0,function(){var m,S,E,H,R,Y,A;return(0,d.__generator)(this,function(Z){switch(Z.label){case 0:if(!document.contains(h))return[3,4];Z.label=1;case 1:return Z.trys.push([1,,3,4]),[4,Q.styleSheetManager.allLoadedPromise()];case 2:Z.sent(),m=Q.styleSheet,m&&h.appendChild(m),S=[].concat(Q.styleSheetManager.sheets);try{for(E=(0,d.__values)(S),H=E.next();!H.done;H=E.next())R=H.value,R!=m&&(R.href||(Q.styleSheetManager.unlink(R),document.head.appendChild(R)))}catch(W){Y={error:W}}finally{try{H&&!H.done&&(A=E.return)&&A.call(E)}finally{if(Y)throw Y.error}}return Q.refreshLayout(),Q.styleSheet=null,Q.shutdown(),[3,4];case 3:return U.disconnect(),[7];case 4:return[2]}})})},U=new MutationObserver(x);U.observe(document.body,{childList:!0,subtree:!0}),C.append(h);try{for(var p=(0,d.__values)(ve.STYLESHEET_FILES),X=p.next();!X.done;X=p.next()){var G=X.value,V="".concat(c.resources,"/osk/").concat(G),L=Q.styleSheetManager.linkExternalSheet(V,!0);L.parentNode.removeChild(L),C.appendChild(L)}}catch(m){o={error:m}}finally{try{X&&!X.done&&(a=p.return)&&a.call(p)}finally{if(o)throw o.error}}return Q.appendStyleSheet(),delete Q._width,delete Q._height,C},t.prototype.onHide=function(){this.hkKey&&this.highlightKey(this.hkKey,!1)},t.prototype.optionKey=function(e,n,c){n.indexOf("K_LOPT")>=0?this.emit("globekey",e,c):n.indexOf("K_ROPT")>=0&&c&&this.emit("hiderequested",e)},t.prototype.showGesturePreview=function(e){var n=this.keytip,c=this.constructLayoutParams(),r=c.keyboardWidth*e.key.spec.proportionalWidth,l=c.keyboardHeight/this.currentLayer.rows.length,s=new Cr(e,this.device.formFactor=="phone",r,l);if(n==null){var o=e.key;o.setPreview(s)}else n.show(e,!0,s);return s.refreshLayout(),s},t.prototype.createKeyTip=function(){if(this.keytip==null)if(this.device.formFactor=="phone"){var e=this.isEmbedded;this.keytip=new Br(this,e)}else this.keytip=new dr(this);this.keytip&&this.keytip.element&&this.element.appendChild(this.keytip.element)},t.prototype.createGlobeHint=function(){return this.config.embeddedGestureConfig.createGlobeHint?this.config.embeddedGestureConfig.createGlobeHint(this):null},t.prototype.shutdown=function(){var e;this.styleSheet&&this.styleSheet.parentNode&&this.styleSheet.parentNode.removeChild(this.styleSheet),this.activeGestures.forEach(function(n){return n.cancel()}),this.gestureEngine&&this.gestureEngine.destroy(),this.deleting&&window.clearTimeout(this.deleting),(e=this.keytip)===null||e===void 0||e.show(null,!1,null)},t.prototype.lockLayer=function(e){this.layerLocked=e},t.prototype.raiseKeyEvent=function(e,n){if(e.kName=="K_LOPT"||e.kName=="K_ROPT")return this.optionKey(n,e.kName,!0),{};var c={},r=function(l,s){var o,a;c.contextToken=(o=l==null?void 0:l.transcription)===null||o===void 0?void 0:o.token;var B=(a=l==null?void 0:l.transcription)===null||a===void 0?void 0:a.transform;c.alteredText=l&&(!B||Oe(B))};return this.layerLocked&&(e.kNextLayer=this.layerId),this.emit("keyevent",e,r),c},t.specialCharacters=Ee.specialCharacters,t}(br.default),fe=oo;var Ur=N(T(),1),pr=function(i){(0,d.__extends)(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t}(Ur.default),Gt=pr,mt=function(i){(0,d.__extends)(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"enabled",{get:function(){return!0},set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activate",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"conditionsMet",{get:function(){return!0},enumerable:!1,configurable:!0}),t}(pr);var ao=function(){function i(){this.map={}}return i.prototype.promiseForTouchpoint=function(t){return this.map[t]||(this.map[t]=new J),this.map[t]},i.prototype.maintainTouches=function(t){for(var e,n,c=Object.keys(this.map),r=0;r<t.length;r++){var l=c.indexOf(""+t.item(r).identifier);l!=-1&&c.splice(l,1)}try{for(var s=(0,d.__values)(c),o=s.next();!o.done;o=s.next()){var a=o.value;this.map[a].resolve(),delete this.map[a]}}catch(B){e={error:B}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}},i}(),Gr=ao;function mr(i){var t="osk/";return i.isEmbedded&&(t=""),"".concat(i.pathConfig.resources,"/").concat(t)}var Bo=function(i){(0,d.__extends)(t,i);function t(e){var n,c,r=i.call(this)||this;r.legacyEvents=new Yt,r.needsLayout=!0,r.touchEventPromiseManager=new Gr,r.activationListener=function(g){if(!r.mayDisable&&!r.activationModel.enabled){r.activationModel.off("activate",r.activationListener);try{r.activationModel.enabled=!0}finally{r.activationModel.on("activate",r.activationListener)}}r.commonCheckAndDisplay()},r.layerChangeHandler=function(g,u){var F,I;return r.vkbd&&r.vkbd._UpdateVKShiftStyle(u),(r.vkbd&&r.vkbd.layerId!=u||g.value!=u)&&((F=r.vkbd)===null||F===void 0?void 0:F.layerGroup.layers[u])&&!(!((I=r.vkbd)===null||I===void 0)&&I.layerLocked)&&(r.vkbd.layerId=u),!1},r._Visible=!1,r.config=e=(0,d.__assign)({},e),r.config.allowHideAnimations===void 0&&(r.config.allowHideAnimations=!0),r.config.device=e.device||e.hostDevice,r.config.isEmbedded=e.isEmbedded||!1,r.config.embeddedGestureConfig=e.embeddedGestureConfig||{},r.config.activator.on("activate",r.activationListener),r._Box=k("div"),r.kbdStyleSheetManager=new ye(r._Box,r.config.doCacheBusting||!1),r.uiStyleSheetManager=new ye(r._Box),r.bannerView=new Qi,r.bannerView.events.on("bannerchange",function(){return r.refreshLayout()}),r._Box.appendChild(r.bannerView.element),r._bannerController=new nc(r.bannerView,r.hostDevice,r.config.predictionContextManager),r.keyboardView=r._GenerateKeyboardView(null,null),r._Box.appendChild(r.keyboardView.element);var l=mr(r.config);try{for(var s=(0,d.__values)(t.STYLESHEET_FILES),o=s.next();!o.done;o=s.next()){var a=o.value,B="".concat(l).concat(a);r.uiStyleSheetManager.linkExternalSheet(B)}}catch(g){n={error:g}}finally{try{o&&!o.done&&(c=s.return)&&c.call(s)}finally{if(n)throw n.error}}return r.setBaseMouseEventListeners(),r.hostDevice.touchable&&r.setBaseTouchEventListeners(),r._Box.style.display="none",r}return Object.defineProperty(t.prototype,"keyCodes",{get:function(){return b.keyCodes},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"modifierCodes",{get:function(){return b.modifierCodes},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"modifierBitmasks",{get:function(){return b.modifierBitmasks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stateBitmasks",{get:function(){return b.stateBitmasks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"configuration",{get:function(){return this.config},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bannerController",{get:function(){return this._bannerController},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hostDevice",{get:function(){return this.config.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontRootPath",{get:function(){return this.config.pathConfig.fonts},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmbedded",{get:function(){return this.config.isEmbedded},enumerable:!1,configurable:!0}),t.prototype.setBaseMouseEventListeners=function(){var e=this;this._Box.onmouseenter=this._VKbdMouseEnter=function(n){e.mouseEnterPromise&&e.mouseEnterPromise.resolve(),e.mouseEnterPromise=new J,e.emit("pointerinteraction",e.mouseEnterPromise.corePromise)},this._Box.onmouseleave=this._VKbdMouseLeave=function(n){e.mouseEnterPromise.resolve(),e.mouseEnterPromise=null}},t.prototype.removeBaseMouseEventListeners=function(){this._Box.onmouseenter=null,this._Box.onmouseleave=null},t.prototype.setBaseTouchEventListeners=function(){var e=this,n=function(c){return c.cancelable&&c.preventDefault(),c.stopPropagation(),!1};this._boxBaseTouchEventCancel=function(c){return e.touchEventPromiseManager.maintainTouches(c.touches),n(c)},this._boxBaseTouchStart=function(c){for(var r=0;r<c.changedTouches.length;r++){var l=e.touchEventPromiseManager.promiseForTouchpoint(c.changedTouches[r].identifier);e.emit("pointerinteraction",l.corePromise)}return e.touchEventPromiseManager.maintainTouches(c.touches),n(c)},this._Box.addEventListener("touchstart",this._boxBaseTouchStart,!1),this._Box.addEventListener("touchmove",this._boxBaseTouchEventCancel,!1),this._Box.addEventListener("touchend",this._boxBaseTouchEventCancel,!1),this._Box.addEventListener("touchcancel",this._boxBaseTouchEventCancel,!1)},t.prototype.removeBaseTouchEventListeners=function(){!this._boxBaseTouchEventCancel||(this._Box.removeEventListener("touchstart",this._boxBaseTouchStart,!1),this._Box.removeEventListener("touchmove",this._boxBaseTouchEventCancel,!1),this._Box.removeEventListener("touchend",this._boxBaseTouchEventCancel,!1),this._Box.removeEventListener("touchcancel",this._boxBaseTouchEventCancel,!1),this._boxBaseTouchEventCancel=null,this._boxBaseTouchStart=null)},Object.defineProperty(t.prototype,"targetDevice",{get:function(){return this.config.device},set:function(e){this.allowsDeviceChange(e)?(this.config.device=e,this.loadActiveKeyboard()):console.error("May not change target device for this OSKView type.")},enumerable:!1,configurable:!0}),t.prototype.allowsDeviceChange=function(e){return!1},Object.defineProperty(t.prototype,"activationModel",{get:function(){return this.config.activator},set:function(e){if(!e)throw new Error("The activation model may not be set to null or undefined!");this.config.activator.off("activate",this.activationListener),e.on("activate",this.activationListener),this.config.activator=e,this.commonCheckAndDisplay()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mayDisable",{get:function(){var e;return!(this.hostDevice.touchable||!((e=this.activeKeyboard)===null||e===void 0)&&e.keyboard.isCJK)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"displayIfActive",{get:function(){return this.activationModel.enabled},enumerable:!1,configurable:!0}),t.prototype.commonCheckAndDisplay=function(){this.activationModel.activate&&this.activeKeyboard?this.present():this.startHide(!1)},Object.defineProperty(t.prototype,"vkbd",{get:function(){return this.keyboardView instanceof fe?this.keyboardView:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"banner",{get:function(){return this.bannerView},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"computedWidth",{get:function(){return this.needsLayout&&this.refreshLayout(),this._computedWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"computedHeight",{get:function(){return this.needsLayout&&this.refreshLayout(),this._computedHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"baseFontSize",{get:function(){var e;return((e=this.parsedBaseFontSize)===null||e===void 0?void 0:e.styleString)||""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parsedBaseFontSize",{get:function(){return this._baseFontSize||(this._baseFontSize=t.defaultFontSize(this.targetDevice,this.computedHeight,this.isEmbedded)),this._baseFontSize},enumerable:!1,configurable:!0}),t.defaultFontSize=function(e,n,c){if(e.touchable){var r=e.formFactor=="phone"?1.6*(c?.65:.6)*1.2:2;return f.special(r,"em")}else return n?f.inPixels(n/8):void 0},Object.defineProperty(t.prototype,"activeKeyboard",{get:function(){return this.keyboardData},set:function(e){var n;this.keyboardData=e,this.loadActiveKeyboard(),!((n=this.keyboardData)===null||n===void 0)&&n.keyboard.isCJK&&(this.activationModel.enabled=!0)},enumerable:!1,configurable:!0}),t.prototype.computeFrameHeight=function(){var e,n;return(((e=this.headerView)===null||e===void 0?void 0:e.layoutHeight.val)||0)+(((n=this.footerView)===null||n===void 0?void 0:n.layoutHeight.val)||0)},t.prototype.setSize=function(e,n,c){var r=!1,l,s;!e&&e!==0||!n&&n!==0||(Number.isFinite(e)?l=f.inPixels(e):l=new f(e),Number.isFinite(n)?s=f.inPixels(n):s=new f(n),e&&n&&(r=!this._width||!this._height,r=r||l.styleString!=this._width.styleString,r=r||s.styleString!=this._height.styleString,this._width=l,this._height=s),this.needsLayout=this.needsLayout||r,this.refreshLayoutIfNeeded(c))},t.prototype.setNeedsLayout=function(){this.needsLayout=!0},t.prototype.batchLayoutAfter=function(e){if(this.deferLayout){e();return}try{this.deferLayout=!0,this.vkbd&&(this.vkbd.deferLayout=!0),e()}finally{this.deferLayout=!1,this.vkbd&&(this.vkbd.deferLayout=!1),this.refreshLayout()}},t.prototype.refreshLayout=function(e){var n,c;if(!(!this.keyboardView||this.deferLayout)){var r=this.width&&this.height;if(!!r){var l=this.width.absolute&&this.height.absolute,s=getComputedStyle(this._Box),o=s.height!=""&&s.height!="auto";if(l)this._computedWidth=this.width.val,this._computedHeight=this.height.val;else if(o){var a=this._Box.parentElement;this._computedWidth=this.width.val*(this.width.absolute?1:a.offsetWidth),this._computedHeight=this.height.val*(this.height.absolute?1:a.offsetHeight)}else{console.warn("Unable to properly perform layout - specification uses a relative spec, thus relies upon insertion into the DOM for layout.");return}if(this.needsLayout=!1,this.banner.element.style.fontSize=this.baseFontSize,this.vkbd&&(this.vkbd.fontSize=this.parsedBaseFontSize),e||((n=this.headerView)===null||n===void 0||n.refreshLayout(),this.bannerView.width=this.computedWidth,this.bannerView.refreshLayout(),(c=this.footerView)===null||c===void 0||c.refreshLayout()),this.vkbd){var B=this.computedHeight-this.computeFrameHeight();this.bannerView.height>0&&(B-=this.bannerView.height+5),this.vkbd.setSize(this.computedWidth,B,e);var g=this._Box.style;g.width=g.maxWidth=this.computedWidth+"px",g.height=g.maxHeight=this.computedHeight+"px"}else{var g=this._Box.style;g.width="auto",g.height="auto",g.maxWidth=g.maxHeight=""}}}},t.prototype.refreshLayoutIfNeeded=function(e){this.needsLayout&&this.refreshLayout(e)},t.prototype.postKeyboardLoad=function(){this._Visible=!1,this.postKeyboardAdjustments(),this.displayIfActive&&this.present()},t.prototype.loadActiveKeyboard=function(){var e,n,c,r,l;this.setBoxStyling(),this.needsLayout=!0;var s=this.keyboardView,o=this.kbdStyleSheetManager;this.kbdStyleSheetManager=new ye(this._Box,this.config.doCacheBusting||!1);var a=this.keyboardView=this._GenerateKeyboardView((e=this.keyboardData)===null||e===void 0?void 0:e.keyboard,(n=this.keyboardData)===null||n===void 0?void 0:n.metadata);if(this._Box.replaceChild(a.element,s.element),a.postInsert(),(c=this.bannerController)===null||c===void 0||c.configureForKeyboard((r=this.keyboardData)===null||r===void 0?void 0:r.keyboard,(l=this.keyboardData)===null||l===void 0?void 0:l.metadata),s instanceof fe&&s.shutdown(),o.unlinkAll(),this.banner.appendStyles(),this.vkbd){this.vkbd.createKeyTip();var B=this.vkbd.createGlobeHint();B&&this._Box.appendChild(B.element),this.vkbd.appendStyleSheet()}this.postKeyboardLoad()},t.prototype._GenerateKeyboardView=function(e,n){var c=this.targetDevice;return this._Box.className="",e==null&&!c.touchable?new qt:e&&e.layout(c.formFactor)?this._GenerateVisualKeyboard(e,n):!e||!n?this._GenerateVisualKeyboard(null,null):new cr(e)},t.prototype._GenerateVisualKeyboard=function(e,n){var c=this,r=this.targetDevice,l=mr(this.config),s=new fe({keyboard:e,keyboardMetadata:n,device:r,hostDevice:this.hostDevice,topContainer:this._Box,styleSheetManager:this.kbdStyleSheetManager,pathConfig:this.config.pathConfig,embeddedGestureConfig:this.config.embeddedGestureConfig,isEmbedded:this.config.isEmbedded,specialFont:{family:"SpecialOSK",files:["".concat(l,"/keymanweb-osk.ttf")],path:""}});return s.on("keyevent",function(o,a){return c.emit("keyevent",o,a)}),s.on("globekey",function(o,a){return c.emit("globekey",o,a)}),s.on("hiderequested",function(o){c.doHide(!0),c.emit("hiderequested",o)}),this._Box.className=r.formFactor+" "+r.OS.toLowerCase()+" kmw-osk-frame",s},t.prototype.present=function(){if(!!this.mayShow()){if(this.keyboardView.updateState(),this._Box.style.display="block",this.refreshLayoutIfNeeded(),this._Visible=!0,this._Box.style.opacity="1",this._Box.style.visibility=="hidden"){var e=this;window.setTimeout(function(){e._Box.style.visibility="visible"},0)}this.setDisplayPositioning()}},t.prototype.startHide=function(e){if(!!this.mayHide(e)){e&&(this.activationModel.enabled=!!(this.keyboardData.keyboard.isCJK||this.hostDevice.touchable));var n=null;this._Box&&this.hostDevice.touchable&&!(this.keyboardView instanceof qt)&&this.config.allowHideAnimations?n=this.useHideAnimation():n=Promise.resolve(!0);var c=this;n.then(function(r){r&&c.finalizeHide()}),this.doHide(e)}},t.prototype.finalizeHide=function(){if(!(document.body.className.indexOf("osk-always-visible")>=0&&this.hostDevice.formFactor=="desktop")){if(this._Box){var e=this._Box.style;e.display="none",e.transition="",e.opacity="1",this._Visible=!1}this.vkbd&&this.vkbd.onHide()}},t.prototype.mayShow=function(){return!(!this.activationModel.conditionsMet||!this.keyboardView||this.keyboardView instanceof qt||!this.activationModel.enabled||!this._Box)},t.prototype.mayHide=function(e){return!(this.activationModel.conditionsMet&&!this.mayDisable||this.activationModel instanceof mt||!e&&this.hostDevice.formFactor=="desktop"&&document.body.className.indexOf("osk-always-visible")>=0)},t.prototype.useHideAnimation=function(){var e=this._Box.style,n=this;return new Promise(function(c){var r=function(){return n._Box.removeEventListener("transitionend",r,!1),n._Box.removeEventListener("webkitTransitionEnd",r,!1),n._Box.removeEventListener("transitioncancel",r,!1),n._Box.removeEventListener("webkitTransitionCancel",r,!1),n._animatedHideTimeout!=0&&window.clearTimeout(n._animatedHideTimeout),n._animatedHideTimeout=0,n._Visible&&n.activationModel.conditionsMet?(e.transition="",e.opacity="1",c(!1),!1):(c(!0),!0)},l=function(){n._Box.removeEventListener("transitionrun",l,!1),n._Box.removeEventListener("webkitTransitionRun",l,!1),n._Box.addEventListener("transitionend",r,!1),n._Box.addEventListener("webkitTransitionEnd",r,!1),n._Box.addEventListener("transitioncancel",r,!1),n._Box.addEventListener("webkitTransitionCancel",r,!1)};n._Box.addEventListener("transitionrun",l,!1),n._Box.addEventListener("webkitTransitionRun",l,!1),e.transition="opacity 0.5s linear 0",e.opacity="0",n._animatedHideTimeout=window.setTimeout(r,200)})},t.prototype.hideNow=function(){if(!(!this.mayHide(!1)||!this._Box)){this._animatedHideTimeout&&(window.clearTimeout(this._animatedHideTimeout),this._animatedHideTimeout=0);var e=this._Box.style;e.transition="",e.opacity="0",this.finalizeHide()}},t.prototype.shutdown=function(){this.removeBaseMouseEventListeners(),this.removeBaseTouchEventListeners();var e=this._Box;e.parentElement&&e.parentElement.removeChild(e),this.kbdStyleSheetManager.unlinkAll(),this.uiStyleSheetManager.unlinkAll(),this.bannerController.shutdown()},t.prototype.getRect=function(){var e={};return e.left=e.left=_(this._Box),e.top=e.top=P(this._Box),e.width=this.computedWidth,e.height=this.computedHeight,e},t.prototype.isEnabled=function(){return this.displayIfActive},t.prototype.isVisible=function(){return this._Visible},t.prototype.hide=function(){this.activationModel.enabled=!1,this.startHide(!0)},t.prototype.show=function(e){arguments.length>0?this.activationModel.enabled=e:this.activationModel.conditionsMet&&(this.activationModel.enabled=!this.activationModel.enabled)},t.prototype.doShow=function(e){this.legacyEvents.callEvent("show",e)},t.prototype.doHide=function(e){var n={HiddenByUser:e};this.legacyEvents.callEvent("hide",n)},t.prototype.addEventListener=function(e,n){this.legacyEvents.addEventListener(e,n)},t.prototype.removeEventListener=function(e,n){this.legacyEvents.removeEventListener(e,n)},t.STYLESHEET_FILES=["kmwosk.css","globe-hint.css"],t}(Xr.default),ve=Bo;var Vr=N(T(),1);var go=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.mouseCancellingHandler=function(c){return c.preventDefault(),c.cancelBubble=!0,!1},n._element=n.buildTitleBar(),n.helpEnabled=!1,n.configEnabled=!1,e&&(n.element.onmousedown=e.mouseDownHandler),n}return Object.defineProperty(t.prototype,"helpEnabled",{get:function(){return this._helpEnabled},set:function(e){this._helpEnabled=e,this._helpButton.style.display=e?"inline":"none"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"configEnabled",{get:function(){return this._configEnabled},set:function(e){this._configEnabled=e,this._configButton.style.display=e?"inline":"none"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layoutHeight",{get:function(){return t.DISPLAY_HEIGHT},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){return this._element},enumerable:!1,configurable:!0}),t.prototype.setPinCJKOffset=function(){this._unpinButton.style.left="15px"},t.prototype.showPin=function(e){this._unpinButton.style.display=e?"block":"none"},t.prototype.setTitle=function(e){this._caption.innerHTML=e},t.prototype.setTitleFromKeyboard=function(e){var n="<span style='font-weight:bold'>"+(e==null?void 0:e.name)+"</span>";this._caption.innerHTML=n},t.prototype.buildTitleBar=function(){var e=this,n=k("div");n.id="keymanweb_title_bar",n.className="kmw-title-bar";var c=this._caption=k("span");c.className="kmw-title-bar-caption",c.style.color="#fff",n.appendChild(c);var r=this._closeButton=this.buildCloseButton();return this._closeButton.onclick=function(){return e.emit("close"),!1},n.appendChild(r),r=this._helpButton=this.buildHelpButton(),this._helpButton.onclick=function(){return e.emit("help"),!1},n.appendChild(r),r=this._configButton=this.buildConfigButton(),this._configButton.onclick=function(){return e.emit("config"),!1},n.appendChild(r),r=this._unpinButton=this.buildUnpinButton(),this._unpinButton.onclick=function(){return e.emit("unpin"),!1},n.appendChild(r),n},t.prototype.buildCloseButton=function(){var e=k("div");return e.id="kmw-close-button",e.className="kmw-title-bar-image",e.onmousedown=this.mouseCancellingHandler,e},t.prototype.buildHelpButton=function(){var e=k("div");return e.id="kmw-help-image",e.className="kmw-title-bar-image",e.title="KeymanWeb Help",e.onmousedown=this.mouseCancellingHandler,e},t.prototype.buildConfigButton=function(){var e=k("div");return e.id="kmw-config-image",e.className="kmw-title-bar-image",e.title="KeymanWeb Configuration Options",e.onmousedown=this.mouseCancellingHandler,e},t.prototype.buildUnpinButton=function(){var e=k("div");return e.id="kmw-pin-image",e.className="kmw-title-bar-image",e.title="Pin the On Screen Keyboard to its default location on the active text box",e.onmousedown=this.mouseCancellingHandler,e},t.prototype.refreshLayout=function(){},t.DISPLAY_HEIGHT=f.inPixels(20),t}(Vr.default),lc=go;var Zr=N(T(),1);var uo=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.mouseCancellingHandler=function(c){return c.preventDefault(),c.cancelBubble=!0,!1},n._element=n.buildResizeBar(),e&&(n._resizeHandle.onmousedown=e.mouseDownHandler),n}return Object.defineProperty(t.prototype,"layoutHeight",{get:function(){return t.DISPLAY_HEIGHT},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){return this._element},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"handle",{get:function(){return this._resizeHandle},enumerable:!1,configurable:!0}),t.prototype.allowResizing=function(e){this._resizeHandle.style.display=e?"block":"none"},t.prototype.buildResizeBar=function(){var e=this,n=k("div");n.className="kmw-footer",n.onmousedown=this.mouseCancellingHandler;var c=k("div");c.className="kmw-footer-caption",c.innerHTML='<a href="https://keyman.com/developer/keymanweb/">KeymanWeb</a>',c.id="keymanweb-osk-footer-caption",c.addEventListener("dblclick",function(l){return e.emit("showbuild"),!1},!1),n.appendChild(c);var r=k("div");return r.className="kmw-footer-resize",n.appendChild(r),this._resizeHandle=r,n},t.prototype.refreshLayout=function(){},t.DISPLAY_HEIGHT=f.inPixels(16),t}(Zr.default),fr=uo;var vr=function(){function i(t,e,n){this.x=t,this.y=e,n&&(this.source=n)}return i.fromEvent=function(t){var e;if(window.TouchEvent&&t instanceof TouchEvent||t.changedTouches?e=t.changedTouches[0]:e=t,e.pageX)return new i(e.pageX,e.pageY,t);if(e.clientX){var n=e.clientX+document.body.scrollLeft,c=e.clientY+document.body.scrollTop;return new i(n,c,t)}else return new i(null,null,t)},i}(),Fo=function(){function i(t){this._VPreviousMouseMove=document.onmousemove,this._VPreviousMouseUp=document.onmouseup,this._VPreviousCursor=document.body.style.cursor,this._VPreviousMouseButton=typeof t.which=="undefined"?t.button:t.which}return i.prototype.restore=function(){document.onmousemove=this._VPreviousMouseMove,document.onmouseup=this._VPreviousMouseUp,document.body.style.cursor&&(document.body.style.cursor=this._VPreviousCursor)},i.prototype.matchesCausingClick=function(t){return this._VPreviousMouseButton==(typeof t.which=="undefined"?t.button:t.which)},i}(),yo=function(){function i(t){this.startHandler=this._VMoveMouseDown.bind(this),this.cursorType=t}return Object.defineProperty(i.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isActive",{get:function(){return!!this._mouseStartSnapshot},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"mouseDownHandler",{get:function(){return this.startHandler},enumerable:!1,configurable:!0}),i.prototype._VMoveMouseDown=function(t){return!t||!this._enabled?!0:(this._mouseStartSnapshot||(this._mouseStartSnapshot=new Fo(t)),this._startCoord=vr.fromEvent(t),document.onmousemove=this._VMoveMouseMove.bind(this),document.onmouseup=this._VMoveMouseUp.bind(this),document.body.style.cursor&&(document.body.style.cursor=this.cursorType),t.preventDefault(),t.cancelBubble=!0,this.onDragStart(),!1)},i.prototype._VMoveMouseMove=function(t){if(!t||!this.enabled)return!0;if(t.preventDefault(),t.cancelBubble=!0,this._mouseStartSnapshot.matchesCausingClick(t)){var e=vr.fromEvent(t),n=e.x-this._startCoord.x,c=e.y-this._startCoord.y;return this.onDragMove(n,c),!1}else return this._VMoveMouseUp(t)},i.prototype._VMoveMouseUp=function(t){return t?(this._mouseStartSnapshot.restore(),this._mouseStartSnapshot=null,t.preventDefault(),t.cancelBubble=!0,this.onDragRelease(),!1):!0},i}(),sc=yo;var Io=function(i){(0,d.__extends)(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e._enabled=!0,e.actValue=null,e}return Object.defineProperty(t.prototype,"activate",{get:function(){return this._enabled&&!!this.actValue},enumerable:!1,configurable:!0}),t.prototype.checkState=function(e){this.activate!=e&&this.emit("activate",this.activate)},Object.defineProperty(t.prototype,"enabled",{get:function(){return this._enabled},set:function(e){var n=this.activate;this._enabled=e,this.checkState(n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activationTrigger",{get:function(){return this.actValue},set:function(e){var n=this.activate,c=this.actValue;this.actValue=e,this.checkState(n),c!=e&&this.emit("triggerchange",e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"conditionsMet",{get:function(){return!!this.activationTrigger},enumerable:!1,configurable:!0}),t}(Gt),Xt=Io;var Lr=function(i){(0,d.__extends)(t,i);function t(){return i.call(this,"KeymanWeb_OnScreenKeyboard")||this}return t.prototype.loadWithDefaults=function(e){return(0,d.__assign)((0,d.__assign)({},e),this.load())},t.prototype.load=function(){var e=i.prototype.load.call(this,function(n,c){switch(c){case"version":return n;default:return Number.parseInt(n,10)}});return e.width||delete e.width,e.height||delete e.height,e},t.prototype.save=function(e){i.prototype.save.call(this,e)},t}(Ie);var Qo=function(i){(0,d.__extends)(t,i);function t(e){var n,c,r=this;e.activator=e.activator||new Xt,r=i.call(this,e)||this,r.userPositioned=!1,r.specifiedPosition=!1,r.noDrag=!1,r.layoutSerializer=new Lr,r.restorePosition=function(u){var F=this._Visible,I=new J;this.emit("dragmove",I.corePromise),this.loadPersistedLayout(),this.userPositioned=!1,u||(delete this.dfltX,delete this.dfltY),this.savePersistedLayout(),F&&this.present(),this.titleBar.showPin(!1),I.resolve(),this.doResizeMove()}.bind(r),r.typedActivationModel.on("triggerchange",function(){return r.setDisplayPositioning()}),document.body.appendChild(r._Box),r.titleBar=new lc(r.titleDragHandler),r.titleBar.on("help",function(){r.legacyEvents.callEvent("helpclick",{})}),r.titleBar.on("config",function(){r.legacyEvents.callEvent("configclick",{})}),r.titleBar.on("close",function(){return r.startHide(!0)}),r.titleBar.on("unpin",function(){return r.restorePosition(!0)}),r.resizeBar=new fr(r.resizeDragHandler),r.resizeBar.on("showbuild",function(){return r.emit("showbuild")}),r.headerView=r.titleBar,r._Box.insertBefore(r.headerView.element,r._Box.firstChild);var l=function(u){var F=r.headerView;if(F&&F instanceof lc)switch(u){case"configclick":F.configEnabled=r.legacyEvents.listenerCount("configclick")>0;break;case"helpclick":F.helpEnabled=r.legacyEvents.listenerCount("helpclick")>0;break;default:return}},s=new kt(r),o=new kt(r.legacyEvents);try{for(var a=(0,d.__values)([s,o]),B=a.next();!B.done;B=a.next()){var g=B.value;g.on("listeneradded",l),g.on("listenerremoved",l)}}catch(u){n={error:u}}finally{try{B&&!B.done&&(c=a.return)&&c.call(a)}finally{if(n)throw n.error}}return r.activeKeyboard&&r.postKeyboardAdjustments(),r.loadPersistedLayout(),r}return Object.defineProperty(t.prototype,"typedActivationModel",{get:function(){return this.activationModel},enumerable:!1,configurable:!0}),t.prototype._Unload=function(){this.keyboardView=null,this.bannerView=null,this._Box=null},t.prototype.setBoxStyling=function(){var e=this._Box.style;e.zIndex="9999",e.display="none",e.width="auto",e.position="absolute"},t.prototype.postKeyboardAdjustments=function(){!this.titleBar||(this.enableMoveResizeHandlers(),this.activeKeyboard&&this.titleBar.setTitleFromKeyboard(this.activeKeyboard.keyboard),this.vkbd?(this.footerView=this.resizeBar,this._Box.appendChild(this.footerView.element)):(this.footerView&&this._Box.removeChild(this.footerView.element),this.footerView=null),this.loadPersistedLayout(),this.setNeedsLayout())},t.prototype.isEnabled=function(){return this.displayIfActive},t.prototype.isVisible=function(){return this._Visible},t.prototype.savePersistedLayout=function(){var e=this.getPos(),n={visible:this.displayIfActive?1:0,userSet:this.userPositioned?1:0,left:e.left,top:e.top,_version:ne.CURRENT.toString()};this.vkbd&&(n.width=this.width.val,n.height=this.height.val),this.layoutSerializer.save(n)},t.prototype.loadPersistedLayout=function(){var e=this.layoutSerializer.loadWithDefaults({visible:1,userSet:0,left:-1,top:-1,_version:void 0,width:.3*screen.width,height:.15*screen.height});this.activationModel.enabled=e.visible==1,this.userPositioned=e.userSet==1,this.x=e.left,this.y=e.top;var n=e._version,c=n===void 0,r=e.width,l=e.height;r<.2*screen.width&&(r=.2*screen.width),l<.1*screen.height&&(l=.1*screen.height),r>.9*screen.width&&(r=.9*screen.width),l>.5*screen.height&&(l=.5*screen.height),(c||!n)&&(this.headerView&&this.headerView.layoutHeight.absolute&&(l+=this.headerView.layoutHeight.val),this.footerView&&this.footerView.layoutHeight.absolute&&(l+=this.footerView.layoutHeight.val)),this.setSize(r,l),(this.x==-1||this.y==-1||!this._Box)&&(this.userPositioned=!1),this.x<window.pageXOffset-.8*r&&(this.x=window.pageXOffset-.8*r),this.y<0&&(this.x=-1,this.y=-1,this.userPositioned=!1),this.userPositioned&&this._Box&&this.setPos({left:this.x,top:this.y})},t.prototype.getDefaultKeyboardHeight=function(){if(this.configuration.heightOverride)return this.configuration.heightOverride();var e=Math.floor(Math.min(screen.availHeight,screen.availWidth)/2),n=e;if(this.targetDevice.formFactor=="phone"){var c=Math.min(screen.height,screen.width),r=Math.max(screen.height,screen.width);le()?n=n*(r/c)/1.6:n=Math.floor(Math.max(screen.availHeight,screen.availWidth)/3)}return this.targetDevice.OS==v.OperatingSystem.iOS&&(n=n/Ce(this.targetDevice.formFactor)),n},t.prototype.getDefaultWidth=function(){if(this.configuration.widthOverride)return this.configuration.widthOverride();var e;if(this.targetDevice.OS==v.OperatingSystem.iOS)e=window.innerWidth;else if(this.targetDevice.OS==v.OperatingSystem.Android)try{e=document.documentElement.clientWidth}catch(n){e=screen.availWidth}else e=screen.width;return e},t.prototype.doResizeMove=function(e){this.legacyEvents.callEvent("resizemove",e)},t.prototype.setRect=function(e){if(!(this._Box==null||this.targetDevice.formFactor!="desktop")){var n=this._Box,c=n.style;if("left"in e&&(this.x=e.left-_(n)+n.offsetLeft,c.left=this.x+"px",this.dfltX=c.left),"top"in e&&(this.y=e.top-P(n)+n.offsetTop,c.top=this.y+"px",this.dfltY=c.top),this.vkbd!=null){var r=this.vkbd.kbdDiv,l=r.style;if("width"in e){var s=e.width-(n.offsetWidth-r.offsetWidth);s<.2*screen.width&&(s=.2*screen.width),s>.9*screen.width&&(s=.9*screen.width),l.width=s+"px",this.setSize(s,this.computedHeight,!0)}if("height"in e){var o=e.height-(n.offsetHeight-r.offsetHeight);o<.1*screen.height&&(o=.1*screen.height),o>.5*screen.height&&(o=.5*screen.height),l.height=o+"px",l.fontSize=o/8+"px",this.setSize(this.computedWidth,o,!0)}"nosize"in e&&(this.resizingEnabled=!e.nosize)}"nomove"in e&&(this.noDrag=e.nomove,this.movementEnabled=!this.noDrag),this.savePersistedLayout()}},t.prototype.getPos=function(){var e=this._Box,n={left:this._Visible?e.offsetLeft:this.x,top:this._Visible?e.offsetTop:this.y};return n},t.prototype.setPos=function(e){if(typeof this._Box!="undefined"){if(this.userPositioned){var n=e.left,c=e.top;typeof n!="undefined"&&(n<-.8*this._Box.offsetWidth&&(n=-.8*this._Box.offsetWidth),this.userPositioned&&(this._Box.style.left=n+"px",this.x=n)),typeof c!="undefined"&&(c<0&&(c=0),this.userPositioned&&(this._Box.style.top=c+"px",this.y=c))}this.titleBar.showPin(this.userPositioned)}},t.prototype.setDisplayPositioning=function(){var e=this._Box.style;if(e.position="absolute",this.activationModel.activate&&(e.display="block"),e.left="0px",this.specifiedPosition||this.userPositioned)e.left=this.x+"px",e.top=this.y+"px";else{var n=this.typedActivationModel.activationTrigger||null;this.dfltX?e.left=this.dfltX:typeof n!="undefined"&&n!=null&&(e.left=_(n)+"px"),this.dfltY?e.top=this.dfltY:typeof n!="undefined"&&n!=null&&(e.top=P(n)+n.offsetHeight+"px")}this.specifiedPosition=!1},t.prototype.presentAtPosition=function(e,n){!this.mayShow()||(this.specifiedPosition=e>=0||n>=0,this.specifiedPosition&&(this.x=e,this.y=n),this.specifiedPosition=this.specifiedPosition||this.userPositioned,this.present())},t.prototype.present=function(){if(!!this.mayShow()){this.titleBar.showPin(this.userPositioned),i.prototype.present.call(this);var e={};e.x=this._Box.offsetLeft,e.y=this._Box.offsetTop,e.userLocated=this.userPositioned,this.doShow(e)}},t.prototype.startHide=function(e){i.prototype.startHide.call(this,e),e&&this.savePersistedLayout()},t.prototype.show=function(e){e!==void 0?i.prototype.show.call(this,e):i.prototype.show.call(this),this.savePersistedLayout()},t.prototype.userLocated=function(){return this.userPositioned},Object.defineProperty(t.prototype,"movementEnabled",{get:function(){return this.titleDragHandler.enabled},set:function(e){this.titleDragHandler.enabled=e,this.titleBar.showPin(e&&this.userPositioned)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resizingEnabled",{get:function(){return this.resizeDragHandler.enabled},set:function(e){this.resizeDragHandler.enabled=e,this.resizeBar.allowResizing(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isBeingMoved",{get:function(){return this.titleDragHandler.isActive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isBeingResized",{get:function(){return this.resizeDragHandler.isActive},enumerable:!1,configurable:!0}),t.prototype.enableMoveResizeHandlers=function(){this.titleDragHandler.enabled=!this.noDrag,this.resizeDragHandler.enabled=!0},Object.defineProperty(t.prototype,"titleDragHandler",{get:function(){var e=this;return this._moveHandler?this._moveHandler:(this._moveHandler=new(function(n){(0,d.__extends)(c,n);function c(){return n.call(this,"move")||this}return c.prototype.onDragStart=function(){this.startX=e._Box.offsetLeft,this.startY=e._Box.offsetTop,e.activeKeyboard.keyboard.isCJK&&e.titleBar.setPinCJKOffset(),this.dragPromise&&this.dragPromise.resolve(),this.dragPromise=new J,e.emit("dragmove",this.dragPromise.corePromise)},c.prototype.onDragMove=function(r,l){e.titleBar.showPin(!0),e.userPositioned=!0,e._Box.style.left=this.startX+r+"px",e._Box.style.top=this.startY+l+"px";var s=e.getRect();e.setSize(s.width,s.height,!0),e.x=s.left,e.y=s.top},c.prototype.onDragRelease=function(){e.vkbd&&(e.vkbd.currentKey=null),this.dragPromise.resolve(),this.dragPromise.then(function(){e.userPositioned=!0,e.doResizeMove(),e.savePersistedLayout()}),this.dragPromise=null},c}(sc)),this._moveHandler)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resizeDragHandler",{get:function(){var e=this;return this._resizeHandler?this._resizeHandler:(this._resizeHandler=new(function(n){(0,d.__extends)(c,n);function c(){return n.call(this,"se-resize")||this}return c.prototype.onDragStart=function(){this.startWidth=e.computedWidth,this.startHeight=e.computedHeight,this.dragPromise&&this.dragPromise.resolve(),this.dragPromise=new J,e.emit("resizemove",this.dragPromise.corePromise)},c.prototype.onDragMove=function(r,l){var s=this.startWidth+r,o=this.startHeight+l;s<.2*screen.width&&(s=.2*screen.width),o<.1*screen.height&&(o=.1*screen.height),s>.9*screen.width&&(s=.9*screen.width),o>.5*screen.height&&(o=.5*screen.height),e.setSize(s,o,!0)},c.prototype.onDragRelease=function(){e.vkbd&&(e.vkbd.currentKey=null),e.vkbd&&(this.startWidth=e.computedWidth,this.startHeight=e.computedHeight),e.refreshLayout(),this.dragPromise.resolve(),this.dragPromise.then(function(){e.doResizeMove(),e.savePersistedLayout()}),this.dragPromise=null},c}(sc)),this._resizeHandler)},enumerable:!1,configurable:!0}),t}(ve),et=Qo;var ho=function(i){(0,d.__extends)(t,i);function t(e){var n=this;return e.isEmbedded?e.activator=e.activator||new mt:e.activator=e.activator||new Xt,n=i.call(this,e)||this,n.isResizing=!1,n.restorePosition=function(c){}.bind(n),document.body.appendChild(n._Box),n}return t.prototype._Unload=function(){this.keyboardView=null,this.bannerView=null,this._Box=null},t.prototype.setBoxStyling=function(){var e=this._Box.style;e.zIndex="9999",e.display="none",e.width="100%",e.position="fixed"},t.prototype.refreshLayout=function(e){if(!this.isResizing){try{this.isResizing=!0,this.doResize()}finally{this.isResizing=!1}i.prototype.refreshLayout.call(this,e)}},t.prototype.doResize=function(){if(this.vkbd){var e=this.getDefaultKeyboardHeight();this.setSize(this.getDefaultWidth(),e+this.banner.height)}},t.prototype.postKeyboardAdjustments=function(){this.doResize()},t.prototype.getDefaultKeyboardHeight=function(){var e,n,c=this.targetDevice;if(this.configuration.heightOverride)return this.configuration.heightOverride();var r=(e=document==null?void 0:document.documentElement)===null||e===void 0?void 0:e.clientWidth,l=(n=document==null?void 0:document.documentElement)===null||n===void 0?void 0:n.clientHeight;if(typeof r=="undefined"&&(r=Math.min(screen.height,screen.width),l=Math.max(screen.height,screen.width),le())){var s=r;r=l,l=s}var o=Math.floor(Math.min(l,r)/2),a=o;return c.formFactor=="phone"&&(le()?a=Math.floor(l/1.6):a=Math.floor(l/2.4)),this.targetDevice.OS==v.OperatingSystem.iOS&&(a=a/Ce(this.targetDevice.formFactor)),a},t.prototype.getDefaultWidth=function(){var e,n=this.targetDevice;if(this.configuration.widthOverride)return this.configuration.widthOverride();var c;return c=(e=document==null?void 0:document.documentElement)===null||e===void 0?void 0:e.clientWidth,typeof c=="undefined"&&(this.targetDevice.OS==v.OperatingSystem.iOS?c=window.innerWidth:n.OS==v.OperatingSystem.Android?c=screen.availWidth:c=screen.width),c},t.prototype.setRect=function(e){},t.prototype.getPos=function(){var e=this._Box,n={left:this._Visible?e.offsetLeft:this.x,top:this._Visible?e.offsetTop:this.y};return n},t.prototype.setPos=function(e){},t.prototype.setDisplayPositioning=function(){var e=this._Box.style;this.vkbd&&(e.position="fixed",e.left=e.bottom="0px",e.border="none",e.borderTop="1px solid gray")},t.prototype.present=function(){i.prototype.present.call(this),this.legacyEvents.callEvent("show",{})},t}(ve),oc=ho;var Co=function(i){(0,d.__extends)(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.flag=!0,e}return Object.defineProperty(t.prototype,"enabled",{get:function(){return this.flag},set:function(e){this.activate=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activate",{get:function(){return this.flag},set:function(e){this.flag!=e&&(this.flag=e,this.emit("activate",e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"conditionsMet",{get:function(){return!0},enumerable:!1,configurable:!0}),t}(Gt),ac=Co;var bo=function(i){(0,d.__extends)(t,i);function t(e){var n=this;return e.activator=e.activator||new ac,n=i.call(this,e)||this,n.restorePosition=function(c){}.bind(n),n}return Object.defineProperty(t.prototype,"element",{get:function(){return this._Box},enumerable:!1,configurable:!0}),t.prototype._Unload=function(){this.keyboardView=null,this.bannerView=null,this._Box=null},t.prototype.setBoxStyling=function(){var e=this._Box.style;e.display="none",e.position="relative"},t.prototype.postKeyboardAdjustments=function(){},t.prototype.getDefaultKeyboardHeight=function(){return this.keyboardView instanceof fe?this.keyboardView.height:this.computedHeight},t.prototype.getDefaultWidth=function(){return this.computedWidth},t.prototype.setRect=function(e){},t.prototype.getPos=function(){var e=this._Box,n={left:this._Visible?e.offsetLeft:void 0,top:this._Visible?e.offsetTop:void 0};return n},t.prototype.setPos=function(e){},t.prototype.present=function(){i.prototype.present.call(this),this.legacyEvents.callEvent("show",{})},t.prototype.setDisplayPositioning=function(){},t.prototype.allowsDeviceChange=function(e){return!0},t}(ve),Bc=bo;var Fc={};Gc(Fc,{AnchoredOSKView:function(){return gc},FloatingOSKView:function(){return uc},InlinedOSKView:function(){return xo}});function dc(i){return{hostDevice:i.config.hostDevice,pathConfig:i.config.paths,predictionContextManager:i.contextManager.predictionContext,isEmbedded:!1}}var gc=function(i){(0,d.__extends)(t,i);function t(e,n){var c=(0,d.__assign)((0,d.__assign)({},dc(e)),n||{});return i.call(this,c)||this}return t}(oc),uc=function(i){(0,d.__extends)(t,i);function t(e,n){var c=(0,d.__assign)((0,d.__assign)({},dc(e)),n||{});return i.call(this,c)||this}return t}(et),xo=function(i){(0,d.__extends)(t,i);function t(e,n){var c=(0,d.__assign)((0,d.__assign)({},dc(e)),n||{});return i.call(this,c)||this}return t}(Bc);var Sr=N(T(),1),Uo=function(i){(0,d.__extends)(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.events=new Sr.default,e.changed=!1,e}return t.prototype.focus=function(){var e=this.getElement();e.focus&&e.focus()},t.prototype.isForcingScroll=function(){return!1},t.prototype.dispatchInputEventOn=function(e){var n;window.InputEvent&&(n=new InputEvent("input",{bubbles:!0,cancelable:!1})),e&&n&&e.dispatchEvent(n)},t}(xn),ce=Uo;var po=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.root=e,n._cachedSelectionStart=-1,n}return Object.defineProperty(t.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),t.isSupportedType=function(e){return e=="email"||e=="search"||e=="text"||e=="url"},t.prototype.getElement=function(){return this.root},t.prototype.clearSelection=function(){this.getCaret(),this.root.value=this.root.value._kmwSubstring(0,this.processedSelectionStart)+this.root.value._kmwSubstring(this.processedSelectionEnd),this.setCaret(this.processedSelectionStart)},t.prototype.isSelectionEmpty=function(){return this.root.selectionStart==this.root.selectionEnd},t.prototype.hasSelection=function(){return!0},t.prototype.invalidateSelection=function(){this._cachedSelectionStart=-1},t.prototype.getCaret=function(){return this.root.selectionStart!=this._cachedSelectionStart&&(this._cachedSelectionStart=this.root.selectionStart,this.processedSelectionStart=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionStart),this.processedSelectionEnd=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionEnd)),this.root.selectionDirection=="forward"?this.processedSelectionEnd:this.processedSelectionStart},t.prototype.getDeadkeyCaret=function(){return this.getCaret()},t.prototype.setCaret=function(e){this.setSelection(e,e,"none")},t.prototype.setSelection=function(e,n,c){var r=this.root.value._kmwCodePointToCodeUnit(e),l=this.root.value._kmwCodePointToCodeUnit(n);this.root.setSelectionRange(r,l,c),this.processedSelectionStart=e,this.processedSelectionEnd=n,this.forceScroll(),this.root.setSelectionRange(r,l,c)},t.prototype.forceScroll=function(){var e=this.getElement(),n=e.selectionStart,c=e.selectionEnd;this._activeForcedScroll=!0;try{e.blur(),e.focus()}finally{e.selectionStart=n,e.selectionEnd=c,this._activeForcedScroll=!1}},t.prototype.isForcingScroll=function(){return this._activeForcedScroll},t.prototype.getSelectionDirection=function(){return this.root.selectionDirection},t.prototype.getTextBeforeCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(0,this.processedSelectionStart)},t.prototype.getSelectedText=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionStart,this.processedSelectionEnd)},t.prototype.setTextBeforeCaret=function(e){this.getCaret();var n=this.processedSelectionEnd-this.processedSelectionStart,c=this.getSelectionDirection(),r=e._kmwLength();this.root.value=e+this.getText()._kmwSubstring(this.processedSelectionStart),this.setSelection(r,r+n,c)},t.prototype.setTextAfterCaret=function(e){var n=this.getCaret(),c=this.getSelectionDirection();this.root.value=this.getTextBeforeCaret()+e,this.setSelection(this.processedSelectionStart,this.processedSelectionEnd,c)},t.prototype.getTextAfterCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionEnd)},t.prototype.getText=function(){return this.root.value},t.prototype.deleteCharsBeforeCaret=function(e){if(e>0){var n=this.getTextBeforeCaret(),c=this.processedSelectionStart;e>c&&(e=c),this.adjustDeadkeys(-e),this.setTextBeforeCaret(n.kmwSubstring(0,c-e)),this.setCaret(c-e)}},t.prototype.insertTextBeforeCaret=function(e){if(!!e){var n=this.getCaret(),c=this.getTextBeforeCaret(),r=this.getText()._kmwSubstring(this.processedSelectionStart);this.adjustDeadkeys(e._kmwLength()),this.root.value=c+e+r,this.setCaret(n+e._kmwLength())}},t.prototype.handleNewlineAtCaret=function(){var e=this.root;e&&(e.type=="search"||e.type=="submit")?(e.disabled=!1,e.form.submit()):this.events.emit("unhandlednewline",e)},t.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},t}(ce),tt=po;var Go=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.root=e,n._cachedSelectionStart=-1,n}return Object.defineProperty(t.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getElement=function(){return this.root},t.prototype.clearSelection=function(){this.getCaret(),this.root.value=this.root.value._kmwSubstring(0,this.processedSelectionStart)+this.root.value._kmwSubstring(this.processedSelectionEnd),this.setCaret(this.processedSelectionStart)},t.prototype.isSelectionEmpty=function(){return this.root.selectionStart==this.root.selectionEnd},t.prototype.hasSelection=function(){return!0},t.prototype.invalidateSelection=function(){this._cachedSelectionStart=-1},t.prototype.getCaret=function(){return this.root.selectionStart!=this._cachedSelectionStart&&(this._cachedSelectionStart=this.root.selectionStart,this.processedSelectionStart=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionStart),this.processedSelectionEnd=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionEnd)),this.root.selectionDirection=="forward"?this.processedSelectionEnd:this.processedSelectionStart},t.prototype.getDeadkeyCaret=function(){return this.getCaret()},t.prototype.setCaret=function(e){this.setSelection(e,e,"none")},t.prototype.setSelection=function(e,n,c){var r=this.root.value._kmwCodePointToCodeUnit(e),l=this.root.value._kmwCodePointToCodeUnit(n);this.root.setSelectionRange(r,l,c),this.processedSelectionStart=e,this.processedSelectionEnd=n,this.forceScroll(),this.root.setSelectionRange(r,l,c)},t.prototype.forceScroll=function(){var e=this.getElement(),n=e.selectionStart,c=e.selectionEnd;this._activeForcedScroll=!0;try{e.blur(),e.focus()}finally{e.selectionStart=n,e.selectionEnd=c,this._activeForcedScroll=!1}},t.prototype.isForcingScroll=function(){return this._activeForcedScroll},t.prototype.getSelectionDirection=function(){return this.root.selectionDirection},t.prototype.getTextBeforeCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(0,this.processedSelectionStart)},t.prototype.setTextBeforeCaret=function(e){this.getCaret();var n=this.processedSelectionEnd-this.processedSelectionStart,c=this.getSelectionDirection(),r=e._kmwLength();this.root.value=e+this.getText()._kmwSubstring(this.processedSelectionStart),this.setSelection(r,r+n,c)},t.prototype.setTextAfterCaret=function(e){var n=this.getCaret(),c=this.getSelectionDirection();this.root.value=this.getTextBeforeCaret()+e,this.setSelection(this.processedSelectionStart,this.processedSelectionEnd,c)},t.prototype.getTextAfterCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionEnd)},t.prototype.getSelectedText=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionStart,this.processedSelectionEnd)},t.prototype.getText=function(){return this.root.value},t.prototype.deleteCharsBeforeCaret=function(e){if(e>0){var n=this.getTextBeforeCaret(),c=this.processedSelectionStart;e>c&&(e=c),this.adjustDeadkeys(-e),this.setTextBeforeCaret(n.kmwSubstring(0,c-e)),this.setCaret(c-e)}},t.prototype.insertTextBeforeCaret=function(e){if(!!e){var n=this.getCaret(),c=this.getTextBeforeCaret(),r=this.getText()._kmwSubstring(this.processedSelectionStart);this.adjustDeadkeys(e._kmwLength()),this.root.value=c+e+r,this.setCaret(n+e._kmwLength())}},t.prototype.handleNewlineAtCaret=function(){this.insertTextBeforeCaret("\n")},t.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},t}(ce),yc=Go;var Ic=function(){function i(t,e){this.node=t,this.offset=e}return i}(),Qc=function(){function i(t,e){this.start=t,this.end=e}return i}(),be=function(){function i(t,e){this.cmd=t,this.stateType=e}return i}(),mo=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;if(n.root=e,e.contentWindow&&e.contentWindow.document&&e.contentWindow.document.designMode=="on")n.doc=e.contentWindow.document,n.docRoot=e.contentWindow.document.documentElement;else throw"Specified IFrame is not in design-mode!";return n}return Object.defineProperty(t.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getElement=function(){return this.root},t.prototype.focus=function(){this.doc.defaultView.focus()},t.prototype.isSelectionEmpty=function(){return this.hasSelection()?this.doc.getSelection().isCollapsed:!0},t.prototype.hasSelection=function(){var e=this.doc.getSelection(),n=document.getSelection();return n.anchorNode==e.anchorNode&&n.focusNode==e.focusNode,!0},t.prototype.clearSelection=function(){if(this.hasSelection()){var e=this.doc.getSelection();e.isCollapsed||e.deleteFromDocument()}else console.warn("Attempted to clear an unowned Selection!")},t.prototype.invalidateSelection=function(){},t.prototype.getCarets=function(){var e=this.doc.getSelection(),n=e.anchorNode.compareDocumentPosition(e.focusNode);if(e.isCollapsed){var c=new Ic(e.anchorNode,e.anchorOffset);return new Qc(c,c)}else{var r=new Ic(e.anchorNode,e.anchorOffset),l=new Ic(e.focusNode,e.focusOffset);return r.node==l.node&&(n=l.offset-r.offset>0?2:4),n&2?new Qc(r,l):new Qc(l,r)}},t.prototype.getDeadkeyCaret=function(){return this.getTextBeforeCaret().kmwLength()},t.prototype.getTextBeforeCaret=function(){if(!this.hasSelection())return this.getText();var e=this.getCarets().start;return e.node.nodeType!=3?"":e.node.textContent.substr(0,e.offset)},t.prototype.getSelectedText=function(){return""},t.prototype.getTextAfterCaret=function(){if(!this.hasSelection())return"";var e=this.getCarets().end;return e.node.nodeType!=3?"":e.node.textContent.substr(e.offset)},t.prototype.getText=function(){return this.docRoot.innerText},t.prototype.deleteCharsBeforeCaret=function(e){if(!(!this.hasSelection()||e<=0)){var n=this.getCarets().start;if(e>n.offset&&(e=n.offset),n.node.nodeType!=3){console.warn("Deletion of characters requested without available context!");return}var c=this.doc.createRange(),r=n.offset-n.node.nodeValue.substr(0,n.offset)._kmwSubstr(-e).length;c.setStart(n.node,r),c.setEnd(n.node,n.offset),this.adjustDeadkeys(-e),c.deleteContents()}},t.prototype.insertTextBeforeCaret=function(e){if(!!this.hasSelection()){var n=this.getCarets().start,c=e._kmwLength(),r=this.doc.getSelection();if(c!=0){this.adjustDeadkeys(c);var l=this.root.ownerDocument.createRange();if(n.node.nodeType==3){var s=n.node;s.insertData(n.offset,e),l.setStart(s,n.offset+e.length)}else{var o=this.doc.createTextNode(e),a=this.doc.createRange();a.setStart(n.node,n.offset),a.collapse(!0),a.insertNode(o),l.setStart(o,e.length)}l.collapse(!0),r.removeAllRanges();try{r.addRange(l)}catch(B){n.node.parentElement.scrollIntoView(),r.addRange(l)}r.collapseToEnd()}}},t.prototype.handleNewlineAtCaret=function(){},t.prototype.setTextAfterCaret=function(e){if(!!this.hasSelection()){var n=this.getCarets().end,c=e._kmwLength(),r=this.doc.getSelection();if(c!=0)if(n.node.nodeType==3){var l=n.node;l.replaceData(n.offset,l.length,e)}else{var s=n.node.ownerDocument.createTextNode(e),o=this.root.ownerDocument.createRange();o.setStart(n.node,n.offset),o.collapse(!0),o.insertNode(s)}}},t.prototype.saveProperties=function(){var e=[new be("backcolor",1),new be("fontname",1),new be("fontsize",1),new be("forecolor",1),new be("bold",0),new be("italic",0),new be("strikethrough",0),new be("subscript",0),new be("superscript",0),new be("underline",0)];this.doc.defaultView&&e.push(new be("hilitecolor",1));for(var n=0;n<e.length;n++){var c=e[n];c.stateType==1?c.cache=this.doc.queryCommandValue(c.cmd):c.cache=this.doc.queryCommandState(c.cmd)}this.commandCache=e},t.prototype.restoreProperties=function(e){this.commandCache||console.error("No command cache exists to restore!");for(var n=0;n<this.commandCache.length;n++){var c=this.commandCache[n];c.stateType==1?this.doc.queryCommandValue(c.cmd)!=c.cache&&(e&&e(),this.doc.execCommand(c.cmd,!1,c.cache)):this.doc.queryCommandState(c.cmd)!=c.cache&&(e&&e(),this.doc.execCommand(c.cmd,!1,null))}},t.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},t}(ce),ie=mo;var hc=function(){function i(t,e){this.node=t,this.offset=e}return i}(),Cc=function(){function i(t,e){this.start=t,this.end=e}return i}(),Xo=function(i){(0,d.__extends)(t,i);function t(e){var n=this;if(e.isContentEditable)n=i.call(this)||this,n.root=e;else throw"Specified element is not already content-editable!";return n}return Object.defineProperty(t.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getElement=function(){return this.root},t.prototype.isSelectionEmpty=function(){return this.hasSelection()?this.root.ownerDocument.getSelection().isCollapsed:!0},t.prototype.hasSelection=function(){var e=this.root.ownerDocument.getSelection();return!(this.root!=e.anchorNode&&!this.root.contains(e.anchorNode)||this.root!=e.focusNode&&!this.root.contains(e.focusNode))},t.prototype.clearSelection=function(){if(this.hasSelection()){var e=this.root.ownerDocument.getSelection();e.isCollapsed||e.deleteFromDocument()}else console.warn("Attempted to clear an unowned Selection!")},t.prototype.invalidateSelection=function(){},t.prototype.getCarets=function(){var e=this.root.ownerDocument.getSelection(),n=e.anchorNode.compareDocumentPosition(e.focusNode);if(e.isCollapsed){var c=new hc(e.anchorNode,e.anchorOffset);return new Cc(c,c)}else{var r=new hc(e.anchorNode,e.anchorOffset),l=new hc(e.focusNode,e.focusOffset);return r.node==l.node&&(n=l.offset-r.offset>0?2:4),n&2?new Cc(r,l):new Cc(l,r)}},t.prototype.getDeadkeyCaret=function(){return this.getTextBeforeCaret().kmwLength()},t.prototype.getTextBeforeCaret=function(){if(!this.hasSelection())return this.getText();var e=this.getCarets().start;return e.node.nodeType!=3?"":e.node.textContent.substr(0,e.offset)},t.prototype.getSelectedText=function(){return""},t.prototype.getTextAfterCaret=function(){if(!this.hasSelection())return"";var e=this.getCarets().end;return e.node.nodeType!=3?"":e.node.textContent.substr(e.offset)},t.prototype.getText=function(){return this.root.innerText},t.prototype.deleteCharsBeforeCaret=function(e){if(!(!this.hasSelection()||e<=0)){var n=this.getCarets().start;if(e>n.offset&&(e=n.offset),n.node.nodeType!=3){console.warn("Deletion of characters requested without available context!");return}var c=this.root.ownerDocument.createRange(),r=n.offset-n.node.nodeValue.substr(0,n.offset)._kmwSubstr(-e).length;c.setStart(n.node,r),c.setEnd(n.node,n.offset),this.adjustDeadkeys(-e),c.deleteContents()}},t.prototype.insertTextBeforeCaret=function(e){if(!!this.hasSelection()){var n=this.getCarets().start,c=e._kmwLength(),r=this.root.ownerDocument.getSelection();if(c!=0){this.adjustDeadkeys(c);var l=this.root.ownerDocument.createRange();if(n.node.nodeType==3){var s=n.node;s.insertData(n.offset,e),l.setStart(s,n.offset+e.length)}else{var o=n.node.ownerDocument.createTextNode(e),a=this.root.ownerDocument.createRange();a.setStart(n.node,n.offset),a.collapse(!0),a.insertNode(o),l.setStart(o,e.length)}l.collapse(!0),r.removeAllRanges();try{r.addRange(l)}catch(B){n.node.parentElement.scrollIntoView(),r.addRange(l)}r.collapseToEnd()}}},t.prototype.handleNewlineAtCaret=function(){},t.prototype.setTextAfterCaret=function(e){if(!!this.hasSelection()){var n=this.getCarets().end,c=e._kmwLength(),r=this.root.ownerDocument.getSelection();if(c!=0)if(n.node.nodeType==3){var l=n.node;l.replaceData(n.offset,l.length,e)}else{var s=n.node.ownerDocument.createTextNode(e),o=this.root.ownerDocument.createRange();o.setStart(n.node,n.offset),o.collapse(!0),o.insertNode(s)}}},t.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},t}(ce),rn=Xo;function j(i,t){var e;if(!i)return!1;if(i.Window)return t=="Window";if(i.defaultView)e=i.defaultView[t];else if(i.ownerDocument)e=i.ownerDocument.defaultView[t];else if(i.target){var n=i;this.instanceof(n.target,"Window")?e=n.target[t]:this.instanceof(n.target,"Document")?e=n.target.defaultView[t]:this.instanceof(n.target,"HTMLElement")&&(e=n.target.ownerDocument.defaultView[t])}return e?i instanceof e:!1}function ln(i){if(j(i,"HTMLInputElement"))return new tt(i);if(j(i,"HTMLTextAreaElement"))return new yc(i);if(j(i,"HTMLIFrameElement")){var t=i;return t.contentWindow&&t.contentWindow.document&&t.contentWindow.document.designMode=="on"?new ie(t):i.isContentEditable?new rn(i):null}else if(i.isContentEditable)return new rn(i);return null}var nt=function(){function i(){var t=this;this.pending=!1;var e=this.bg=document.createElement("div"),n=this.lb=document.createElement("div"),c=this.lt=document.createElement("div"),r=this.gr=document.createElement("div"),l=this.bx=document.createElement("div");e.className="kmw-wait-background",n.className="kmw-wait-box",this.dismiss=null,c.className="kmw-wait-text",r.className="kmw-wait-graphic",l.className="kmw-alert-close",n.onmousedown=n.onclick=function(s){l.style.display=="block"&&(e.style.display="none",t.dismiss&&t.dismiss())},n.addEventListener("touchstart",n.onclick,!1),e.onmousedown=e.onclick=function(s){s.preventDefault(),s.stopPropagation()},e.addEventListener("touchstart",e.onclick,!1),n.appendChild(l),n.appendChild(c),n.appendChild(r),e.appendChild(n),document.body.appendChild(e)}return Object.defineProperty(i.prototype,"rootElement",{get:function(){return this.bg},enumerable:!1,configurable:!0}),i.prototype.wait=function(t){var e=this,n=this.bg;typeof n=="undefined"||n==null||(t?(this.pending=!0,window.setTimeout(function(){e.pending&&(window.scrollTo(0,0),e.bx.style.display="none",e.lt.className="kmw-wait-text",e.lt.innerHTML=t,e.gr.style.display="block",n.style.display="block")},1e3)):this.pending&&(this.lt.innerHTML="",this.pending=!1,n.style.display="none"))},i.prototype.alert=function(t,e){var n=this.bg;this.bx.style.display="block",this.lt.className="kmw-alert-text",this.lt.innerHTML=t,this.gr.style.display="none",n.style.display="block",this.dismiss=arguments.length>1?e:null},i.prototype.shutdown=function(){this.bg.parentNode.removeChild(this.bg)},i}();function Vt(){return document.readyState==="complete"?Promise.resolve():new Promise(function(i,t){var e=function(){window.removeEventListener("load",e),i()};window.addEventListener("load",e)})}var Jr=function(i){(0,d.__extends)(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.initialize=function(e){var n=this;this._options?this._options=(0,d.__assign)((0,d.__assign)({},this._options),e):this._options=(0,d.__assign)({},e),i.prototype.initialize.call(this,e),this._options=e,this._ui=e.ui,this._attachType=e.attachType,Vt().then(function(){var c;e.useAlerts&&!n.alertHost?n._alertHost=new nt:!e.useAlerts&&n.alertHost&&((c=n._alertHost)===null||c===void 0||c.shutdown(),n._alertHost=null)})},Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attachType",{get:function(){return this._attachType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alertHost",{get:function(){return this._alertHost},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"signalUser",{set:function(e){(!e||e!=this.alertHost)&&this.alertHost.shutdown(),this._alertHost=e},enumerable:!1,configurable:!0}),t.prototype.debugReport=function(){var e=i.prototype.debugReport.call(this);return e.attachType=this.attachType,e.ui=this._ui,e.keymanEngine="app/browser",e},t.prototype.onRuleFinalization=function(e,n){var c=e.transcription.transform;Oe(c)||n instanceof ce&&(n.changed=!0)},t}(mn);var Rr=(0,d.__assign)({ui:"",attachType:"",useAlerts:!0},Xn);var bc=function(){function i(t,e,n){this.interface=t,this.keyboard=e}return i}();function Le(i){var t=i==null?void 0:i.target;return xe(t)}function xe(i){var t;if(i==null)return null;if(i.body&&(i=i.body),i.nodeType==3&&(i=i.parentNode),j(i,"HTMLInputElement")){var e=i.type.toLowerCase();if(!(e=="text"||e=="search"))return null}return(t=i._kmwAttachment)===null||t===void 0?void 0:t.interface}var Ar=N(T(),1);var xc=function(i){(0,d.__extends)(t,i);function t(e,n){var c=this;if(!e)throw new Error("Cannot attach to a null/undefined document");return c=i.call(this)||this,c.baseFont="",c.appliedFont="",c.embeddedPageContexts=[],c._inputList=[],c._sortedInputs=[],c._InputModeObserverCore=function(r){c.disableInputModeObserver();try{for(var l=0,s=r;l<s.length;l++){var o=s[l],a=o.target;!c.isAttached(a)||(a._kmwAttachment.inputMode=a.inputMode,c.device.touchable&&(a.inputMode="none"))}}finally{c.enableInputModeObserver()}},c._EnablementMutationObserverCore=function(r){for(var l=0;l<r.length;l++){var s=r[l],o=s.oldValue?s.oldValue.indexOf("kmw-disabled")>=0:!1,a=s.target.className.indexOf("kmw-disabled")>=0;if(o&&!a?c._EnableControl(s.target):!o&&a&&c._DisableControl(s.target),!a&&s.attributeName=="readonly"){var B=s.oldValue?s.oldValue!=null:!1,g=s.target;if(g instanceof g.ownerDocument.defaultView.HTMLInputElement||g instanceof g.ownerDocument.defaultView.HTMLTextAreaElement){var u=g.readOnly;B&&!u?c._EnableControl(s.target):!B&&u&&c._DisableControl(s.target)}}}},c._AutoAttachObserverCore=function(r){for(var l=[],s=[],o=0;o<r.length;o++){for(var a=r[o],B=0;B<a.addedNodes.length;B++)l=l.concat(c._GetDocumentEditables(a.addedNodes[B]));for(B=0;B<a.removedNodes.length;B++)s=s.concat(c._GetDocumentEditables(a.removedNodes[B]))}for(var g=0;g<l.length;g++)c.isKMWInput(l[g])&&c._MutationAdditionObserved(l[g]);for(g=0;g<s.length;g++){var u=!1,F=s[g];if(F instanceof F.ownerDocument.defaultView.HTMLIFrameElement){for(var I=0;I<c.embeddedPageContexts.length;I++)if(c.embeddedPageContexts[I].options.owner==F){c.embeddedPageContexts[I].shutdown(),c.embeddedPageContexts.splice(I,1),u=!0;break}if(!u){for(var y=0;y<c._inputList.length;y++)if(c._inputList[y]==F){c.detachFromControl(F),c._inputList[y]==F&&c._inputList.splice(y,1);break}}}else c.isKMWInput(F)&&c._MutationRemovalObserved(F)}(l.length||s.length)&&(c.device.touchable?c.device.touchable&&window.setTimeout(function(){c.listInputs()},1):c.listInputs())},c._MutationAdditionObserved=function(r){if(r instanceof r.ownerDocument.defaultView.HTMLIFrameElement){var l=function(){window.setTimeout(function(){c.attachToControl(r)},1)};r.addEventListener("load",l)}else c.attachToControl(r)},c._MutationRemovalObserved=function(r){c.detachFromControl(r)},c.options=n,c.document=e,c.stylesheetManager=new ye(c.document.body),c}return Object.defineProperty(t.prototype,"device",{get:function(){return this.options.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return this.document.defaultView},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"inputList",{get:function(){var e=this.embeddedPageContexts.map(function(n){return n.inputList}).reduce(function(n,c){return n.concat(c)},[]);return[].concat(this._inputList).concat(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sortedInputs",{get:function(){return this._sortedInputs},enumerable:!1,configurable:!0}),t.prototype.install=function(e){this.manualAttach=e,this.baseFont=this.getBaseFont(),this.manualAttach||(this._SetupDocument(this.document.documentElement),this.listInputs()),this.options.owner||this.initMutationObservers(this.document,e)},t.prototype.setupElementAttachment=function(e){if(!e._kmwAttachment){var n=ln(e);n||j(e,"HTMLIFrameElement")||console.warn("Could not create processing interface for newly-attached element!"),e._kmwAttachment=new bc(n,null,this.device.touchable)}},t.prototype.clearElementAttachment=function(e){e._kmwAttachment=null},t.prototype.isKMWInput=function(e){if(e instanceof e.ownerDocument.defaultView.HTMLTextAreaElement)return!0;if(e instanceof e.ownerDocument.defaultView.HTMLInputElement){if(tt.isSupportedType(e.type))return!0}else if(e instanceof e.ownerDocument.defaultView.HTMLIFrameElement)try{if(e.contentWindow){var n=e.contentWindow.document;if(n)return!(this.device.touchable&&n.designMode.toLowerCase()=="on")}else return!!e._kmwAttachment}catch(c){console.warn("Error during attachment to / detachment from iframe: "),console.warn(c)}else if(e.isContentEditable)return!0;return!1},t.prototype.isAttached=function(e){if(e._kmwAttachment)return!0;if(j(e,"HTMLIFrameElement")){var n=e;if(n.contentDocument==this.document)return!0;for(var c=0,r=this.embeddedPageContexts;c<r.length;c++){var l=r[c];if(l.isAttached(e))return!0}}return!1},t.prototype.isKMWDisabled=function(e){var n=e.className;return e.readOnly?!0:!!(n&&n.indexOf("kmw-disabled")>=0)},t.prototype.enableInputElement=function(e){var n;this.isKMWDisabled(e)||(e instanceof e.ownerDocument.defaultView.HTMLIFrameElement?this._AttachToIframe(e):(this.setupElementAttachment(e),e._kmwAttachment.inputMode=(n=e.inputMode)!==null&&n!==void 0?n:"text",this.disableInputModeObserver(),e.inputMode="none",this.enableInputModeObserver(),e.classList.add("keymanweb-font"),this._inputList.push(e),this.emit("enabled",e)))},t.prototype.disableInputElement=function(e){var n;if(!!e)if(e.ownerDocument.defaultView&&e instanceof e.ownerDocument.defaultView.HTMLIFrameElement||e instanceof HTMLIFrameElement)this._DetachFromIframe(e);else{if(this.isAttached(e)){var c=(n=e._kmwAttachment)===null||n===void 0?void 0:n.inputMode;this.disableInputModeObserver(),e.inputMode=c,this.enableInputModeObserver()}var r=e.className.indexOf("keymanweb-font");r>=0&&(e.className=e.className.replace("keymanweb-font","").trim());var l=this.inputList.indexOf(e);l>-1&&this._inputList.splice(l,1),this.emit("disabled",e)}},t.prototype.enableTouchElement=function(e){return this.isKMWDisabled(e)?(this.emit("disabled",e),!1):(this.isAttached(e)||this.setupElementAttachment(e),this.enableInputElement(e),!0)},t.prototype.disableTouchElement=function(e){if(this.isAttached(e)){var n=e._kmwAttachment.inputMode;this.disableInputModeObserver(),e.inputMode=n,this.enableInputModeObserver()}},t.prototype._AttachToIframe=function(e){var n=this;try{var c=e.contentWindow.document;if(c){if(c.designMode.toLowerCase()=="on")this.setupElementAttachment(e),c.body._kmwAttachment=e._kmwAttachment,this._inputList.push(e),this.emit("enabled",e);else if(this.embeddedPageContexts.filter(function(l){return l.document==c}).length==0){var r=new t(c,(0,d.__assign)((0,d.__assign)({},this.options),{owner:e}));this.embeddedPageContexts.push(r),r.on("enabled",function(l){return n.emit("enabled",l)}),r.on("disabled",function(l){return n.emit("disabled",l)}),r.install(this.manualAttach)}}}catch(l){}},t.prototype._DetachFromIframe=function(e){var n=this,c=function(){n.clearElementAttachment(e);var o=n._inputList.indexOf(e);o!=-1&&n._inputList.splice(o,1),n.emit("disabled",e)};try{var r=e.contentWindow.document;if(r){if(r.designMode.toLowerCase()=="on")r.body._kmwAttachment=null,c();else for(var l=0;l<this.embeddedPageContexts.length;l++)if(this.embeddedPageContexts[l].document==r){var s=this.embeddedPageContexts.splice(l,1)[0];s._ClearDocument(r.body),s.shutdown(),this.embeddedPageContexts.splice(l,1);break}}}catch(o){e._kmwAttachment&&c()}},t.prototype.attachToControl=function(e){var n=this.device.touchable;this.isAttached(e)&&!(e instanceof e.ownerDocument.defaultView.HTMLIFrameElement)||(this.isKMWInput(e)?this.isKMWDisabled(e)?this.emit("disabled",e):n?this.enableTouchElement(e):this.enableInputElement(e):n&&this.emit("disabled",e))},t.prototype.detachFromControl=function(e){!(this.isAttached(e)||e instanceof e.ownerDocument.defaultView.HTMLIFrameElement)||(this.isKMWInput(e)&&(this.isKMWDisabled(e)||this._DisableControl(e)),this.clearElementAttachment(e))},t.prototype._DisableControl=function(e){(this.isAttached(e)||e instanceof e.ownerDocument.defaultView.HTMLIFrameElement)&&(this.device.touchable&&this.disableTouchElement(e),this.listInputs(),this.disableInputElement(e))},t.prototype._EnableControl=function(e){this.isAttached(e)?(this.device.touchable?this.enableTouchElement(e):this.enableInputElement(e),this.listInputs()):j(e,"HTMLIFrameElement")&&this._AttachToIframe(e)},t.prototype.disableControl=function(e){this.isAttached(e)||console.warn("KeymanWeb is not attached to element "+e);var n=e.className;n.indexOf("kmw-disabled")<0&&(e.className=n?n+" kmw-disabled":"kmw-disabled")},t.prototype.enableControl=function(e){!this.isAttached(e)&&!j(e,"HTMLIFrameElement")&&console.warn("KeymanWeb is not attached to element "+e);var n=e.className,c=n.indexOf("kmw-disabled");c>=0&&(e.className=n.replace("kmw-disabled","").trim())},t.prototype.listInputs=function(){for(var e=[],n=document.getElementsByTagName("input"),c=document.getElementsByTagName("textarea"),r=0;r<n.length;r++)tt.isSupportedType(n[r].type)&&n[r].className.indexOf("kmw-disabled")<0&&e.push({ip:n[r],x:_(n[r]),y:P(n[r])});for(var r=0;r<c.length;r++)c[r].className.indexOf("kmw-disabled")<0&&e.push({ip:c[r],x:_(c[r]),y:P(c[r])});e.sort(function(s,o){return s.y!=o.y?s.y-o.y:s.x-o.x});for(var l=[],r=0;r<e.length;r++)l.push(e[r].ip);this._sortedInputs=l},t.prototype.findNeighboringInput=function(e,n){var c,r=this.sortedInputs;if(r.length==0)return null;for(c=0;c<r.length&&r[c]!=e;c++);return c==r.length&&!n&&c--,c=n?c-1:c+1,c=c>=r.length?c-r.length:c,c=c<0?c+r.length:c,r[c]},t.prototype._GetDocumentEditables=function(e){var n=[];if(e.ownerDocument&&e instanceof e.ownerDocument.defaultView.HTMLElement){var c=e.ownerDocument.defaultView;(e instanceof c.HTMLInputElement||e instanceof c.HTMLTextAreaElement||e instanceof c.HTMLIFrameElement)&&n.push(e)}if(e.getElementsByTagName){var r=function(l){return Nt(e.getElementsByTagName(l))};n=n.concat(r("INPUT"),r("TEXTAREA"),r("IFRAME"))}return e.querySelectorAll&&(n=n.concat(Nt(e.querySelectorAll("[contenteditable]")))),e.ownerDocument&&e instanceof e.ownerDocument.defaultView.HTMLElement&&e.isContentEditable&&n.push(e),n},t.prototype._SetupDocument=function(e){for(var n=this._GetDocumentEditables(e),c=0;c<n.length;c++)this.attachToControl(n[c])},t.prototype._ClearDocument=function(e){for(var n=this._GetDocumentEditables(e),c=0;c<n.length;c++)this.detachFromControl(n[c])},t.prototype.initMutationObservers=function(e,n){if(typeof MutationObserver=="function"){var c=e.querySelector("body"),r;n||(r={childList:!0,subtree:!0},this.attachmentObserver=new MutationObserver(this._AutoAttachObserverCore),this.attachmentObserver.observe(c,r)),r={subtree:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["class","readonly"]},this.enablementObserver=new MutationObserver(this._EnablementMutationObserverCore),this.enablementObserver.observe(c,r),this.inputModeObserver=new MutationObserver(this._InputModeObserverCore),this.enableInputModeObserver()}else console.warn("Your browser is outdated and does not support MutationObservers, a web feature needed by KeymanWeb to support dynamically-added elements.")},t.prototype.enableInputModeObserver=function(){var e,n=document.querySelector("body"),c={subtree:!0,attributes:!0,attributeFilter:["inputmode"]};(e=this.inputModeObserver)===null||e===void 0||e.observe(n,c)},t.prototype.disableInputModeObserver=function(){var e;(e=this.inputModeObserver)===null||e===void 0||e.disconnect()},t.prototype.getBaseFont=function(){var e=document.getElementsByTagName("input"),n=document.getElementsByTagName("textarea"),c=0,r,l="Arial,sans-serif";if(e.length==0&&n.length==0)c=0;else if(e.length>0&&n.length==0)c=1;else if(e.length==0&&n.length>0)c=2;else{var s=e[0],o=n[0];s.offsetTop<o.offsetTop?c=1:s.offsetTop>o.offsetTop?c=2:s.offsetLeft<o.offsetLeft?c=1:s.offsetLeft>o.offsetLeft&&(c=2)}switch(c){case 0:r=l;break;case 1:r=getComputedStyle(e[0]).fontFamily||"";break;case 2:r=getComputedStyle(n[0]).fontFamily||"";break}return(typeof r=="undefined"||r=="monospace")&&(r=l),r},t.prototype.buildAttachmentFontStyle=function(e){var n=e,c=this.baseFont;n&&typeof n.family!="undefined"&&(c=n.family),c=c.replace(/\u0022/g,"");var r=new RegExp("\\s?"+c+",?"),l=this.appliedFont.replace(/\u0022/g,"");l=l.replace(r,""),l=l.replace(/,$/,""),l==""?l=c:l=c+","+l,l='"'+l.replace(/\,\s?/g,'","')+'"';var s=".keymanweb-font{\nfont-family:"+l+" !important;\n}\n";return this.appliedFont=l,s},t.prototype.setAttachmentFont=function(e,n,c){this.stylesheetManager.unlinkAll(),this.stylesheetManager.addStyleSheetForFont(e,n,c),this.stylesheetManager.linkStylesheet(Ae(this.buildAttachmentFontStyle(e)))},t.prototype.shutdown=function(){var e,n,c,r;try{(e=this.enablementObserver)===null||e===void 0||e.disconnect(),(n=this.attachmentObserver)===null||n===void 0||n.disconnect(),(c=this.inputModeObserver)===null||c===void 0||c.disconnect(),(r=this.stylesheetManager)===null||r===void 0||r.unlinkAll(),this.inputModeObserver=null,this.embeddedPageContexts.forEach(function(a){try{a.shutdown()}catch(B){}});for(var l=0,s=this.inputList;l<s.length;l++){var o=s[l];try{this.detachFromControl(o)}catch(a){this.emit("disabled",o)}}this._inputList=[]}catch(a){console.error("Error occurred during shutdown"),console.error(a)}},t}(Ar.default);var Wr=N(T(),1),Vo=function(){function i(t,e){this.activationPending=t,this.activated=e}return i}();var Hr=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n._maintainingFocus=!1,n.restoringFocus=!1,n._IgnoreNextSelChange=0,n.isTargetForcingScroll=e,n}return Object.defineProperty(t.prototype,"maintainingFocus",{get:function(){return this._maintainingFocus},set:function(e){var n=this._maintainingFocus;this._maintainingFocus=e,n&&!e&&this.emit("maintainingfocusend")},enumerable:!1,configurable:!0}),t.prototype.getUIState=function(){return new Vo(this.maintainingFocus,this.restoringFocus)},t.prototype.setMaintainingFocus=function(e){this.maintainingFocus=!!e},t.prototype.setFocusTimer=function(){this.focusing=!0,this.focusTimer=window.setTimeout(function(){this.focusing=!1}.bind(this),50)},t}(Wr.default);function Nr(i,t){var e=t!=null&&t.isRTL?"rtl":"ltr";i&&(i instanceof i.ownerDocument.defaultView.HTMLInputElement||i instanceof i.ownerDocument.defaultView.HTMLTextAreaElement?i.value.length==0&&(i.dir=e):typeof i.textContent=="string"&&i.textContent.length==0&&(i.dir=e))}var Zo=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this,e)||this;return c.cookieManager=new Ie("KeymanWeb_Keyboard"),c.focusAssistant=new Hr(function(){var r;return(r=c.activeTarget)===null||r===void 0?void 0:r.isForcingScroll()}),c.domEventTracker=new Ve,c._ControlFocus=function(r){var l=Le(r);return l&&c.setActiveTarget(l,!0),!0},c._ControlBlur=function(r){if(c.focusAssistant._IgnoreNextSelChange)return c.focusAssistant._IgnoreNextSelChange--,r.cancelBubble=!0,r.stopPropagation(),!0;if(c.focusAssistant.isTargetForcingScroll())return r.cancelBubble=!0,r.stopPropagation(),!0;var l=Le(r);if(l==null)return!0;c.lastActiveTarget&&c._BlurKeyboardSettings(c.lastActiveTarget.getElement());var s=c.activeTarget;c.currentTarget=null,(s||c.lastActiveTarget)&&(c.mostRecentTarget=l),c.focusAssistant.restoringFocus=!1;var o=c.activeKeyboard,a=c.focusAssistant.maintainingFocus;return!a&&o&&o.keyboard.notify(0,l,0),s&&!c.activeTarget&&c.emit("targetchange",null),c.apiEvents.callEvent("controlblurred",{target:l.getElement(),event:r,isActivating:a}),c.doChangeEvent(l),c.resetContext(),!0},c._Click=function(r){return c.resetContext(),!0},c.nonKMWTouchHandler=function(r){c.focusAssistant.focusing=!1,clearTimeout(c.focusAssistant.focusTimer),c.forgetActiveTarget()},c._eventsObj=n,c.page=new xc(window.document,{hostDevice:c.engineConfig.hostDevice}),c.focusAssistant.on("maintainingfocusend",function(){!c.activeTarget&&c.mostRecentTarget&&c.emit("targetchange",c.activeTarget)}),c}return Object.defineProperty(t.prototype,"apiEvents",{get:function(){return this._eventsObj()},enumerable:!1,configurable:!0}),t.prototype.initialize=function(){var e=this;this.on("keyboardasyncload",function(n,c){var r;(r=e.engineConfig.alertHost)===null||r===void 0||r.wait("Installing keyboard<br/>"+n.name),c.then(function(){var l;(l=e.engineConfig.alertHost)===null||l===void 0||l.wait()})}),this.engineConfig.deferForInitialization.then(function(){var n=e.engineConfig.hostDevice,c=function(r){return r.stopPropagation()};e.page.on("enabled",function(r){if(!(r._kmwAttachment.interface instanceof ie))n.touchable&&(e.domEventTracker.detachDOMEvent(r,"touchstart",e.nonKMWTouchHandler),e.domEventTracker.attachDOMEvent(r,"touchmove",c,!1),e.domEventTracker.attachDOMEvent(r,"touchend",c,!1)),e.domEventTracker.attachDOMEvent(r,"focus",e._ControlFocus),e.domEventTracker.attachDOMEvent(r,"blur",e._ControlBlur),e.domEventTracker.attachDOMEvent(r,"click",e._Click);else{var l=r.contentWindow.document;n.browser=="firefox"?(e.domEventTracker.attachDOMEvent(l,"focus",e._ControlFocus),e.domEventTracker.attachDOMEvent(l,"blur",e._ControlBlur)):(e.domEventTracker.attachDOMEvent(l.body,"focus",e._ControlFocus),e.domEventTracker.attachDOMEvent(l.body,"blur",e._ControlBlur))}r.ownerDocument.activeElement==r&&e.setActiveTarget(xe(r),!0)}),e.page.on("disabled",function(r){var l;if(!j(r,"HTMLIFrameElement"))n.touchable&&e.domEventTracker.attachDOMEvent(r,"touchstart",e.nonKMWTouchHandler,!1),e.domEventTracker.detachDOMEvent(r,"focus",e._ControlFocus),e.domEventTracker.detachDOMEvent(r,"blur",e._ControlBlur),e.domEventTracker.detachDOMEvent(r,"click",e._Click);else{var s=r.contentWindow.document;n.browser=="firefox"?(e.domEventTracker.detachDOMEvent(s,"focus",e._ControlFocus),e.domEventTracker.detachDOMEvent(s,"blur",e._ControlBlur)):(e.domEventTracker.detachDOMEvent(s.body,"focus",e._ControlFocus),e.domEventTracker.detachDOMEvent(s.body,"blur",e._ControlBlur))}var o=(l=e.mostRecentTarget)===null||l===void 0?void 0:l.getElement();o&&o==r&&e.forgetActiveTarget()}),e.page.install(e.engineConfig.attachType=="manual")})},Object.defineProperty(t.prototype,"activeTarget",{get:function(){var e=this.focusAssistant.maintainingFocus;return this.currentTarget||(e?this.mostRecentTarget:null)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastActiveTarget",{get:function(){return this.mostRecentTarget},enumerable:!1,configurable:!0}),t.prototype.deactivateCurrentTarget=function(){var e=this.activeTarget||this.lastActiveTarget;e&&this.page.isAttached(e.getElement())&&this._BlurKeyboardSettings(e.getElement()),this.activeTarget||this.setActiveTarget(null,!0)},t.prototype.forgetActiveTarget=function(){this.focusAssistant.maintainingFocus=!1,this.focusAssistant.restoringFocus=!1;var e=this.activeTarget||this.mostRecentTarget;e&&this._BlurKeyboardSettings(e.getElement()),this.setActiveTarget(null,!0),e==this.lastActiveTarget&&(this.mostRecentTarget=null)},t.prototype.setActiveTarget=function(e,n){var c,r=this.mostRecentTarget,l=this.activeTarget;if(e==l){l&&(this.currentTarget=l);return}var s=!!r;if(this.currentTarget=this.mostRecentTarget=e,this.predictionContext.setCurrentTarget(e),this.focusAssistant.restoringFocus?this._BlurKeyboardSettings(e.getElement()):e&&this._FocusKeyboardSettings(e.getElement(),!s),this._CommonFocusHelper(e))return!0;var o=e==null?void 0:e.getElement();if(e instanceof ie&&(o=e.docRoot),o&&o.ownerDocument&&o instanceof o.ownerDocument.defaultView.HTMLElement&&Nr(o,(c=this.activeKeyboard)===null||c===void 0?void 0:c.keyboard),e!=l&&this.emit("targetchange",e),n){var a=r==null?void 0:r.getElement();r instanceof ie&&(a=r.docRoot),o?this.apiEvents.callEvent("controlfocused",{target:o,activeControl:a}):a&&this.apiEvents.callEvent("controlblurred",{target:a,event:null,isActivating:this.focusAssistant.maintainingFocus})}},Object.defineProperty(t.prototype,"activeKeyboard",{get:function(){return this._activeKeyboard},enumerable:!1,configurable:!0}),t.prototype.restoreLastActiveTarget=function(){!this.mostRecentTarget||(this.focusAssistant.restoringFocus=!0,this.mostRecentTarget.focus(),this.focusAssistant.restoringFocus=!1)},t.prototype.insertText=function(e,n,c){this.restoreLastActiveTarget();var r=this.activeTarget;return r==null&&this.mostRecentTarget&&(r=this.activeTarget),r!=null?i.prototype.insertText.call(this,e,n,c):!1},t.prototype.currentKeyboardSrcTarget=function(){var e=this.currentTarget||this.mostRecentTarget;return this.isTargetKeyboardIndependent(e)?e:null},t.prototype.isTargetKeyboardIndependent=function(e){var n=e==null?void 0:e.getElement()._kmwAttachment;return!!((n==null?void 0:n.keyboard)||(n==null?void 0:n.keyboard)==="")},t.prototype.activateKeyboardForTarget=function(e,n){var c,r,l=n==null?void 0:n.getElement()._kmwAttachment;if(l?(l.keyboard=(c=e==null?void 0:e.metadata.id)!==null&&c!==void 0?c:"",l.languageCode=(r=e==null?void 0:e.metadata.langId)!==null&&r!==void 0?r:""):this.globalKeyboard=e,this.currentKeyboardSrcTarget()==n){this._activeKeyboard=e;var s=e==null?void 0:e.metadata;this.page.setAttachmentFont(s==null?void 0:s.KFont,this.engineConfig.paths.fonts,this.engineConfig.hostDevice.OS)}},t.prototype.setKeyboardForTarget=function(e,n,c){if(e instanceof ie){console.warn("'keymanweb.setKeyboardForControl' cannot set keyboard on iframes.");return}var r=e.getElement()._kmwAttachment,l=this.currentKeyboardSrcTarget()==e;if(r){if(r.keyboard=n||null,r.languageCode=c||null,l||this.currentKeyboardSrcTarget()==e){var s=this.globalKeyboard.metadata;this.activateKeyboard(r.keyboard||s.id,r.languageCode||s.langId,!0)}}else return},t.prototype.getKeyboardStubForTarget=function(e){if(this.isTargetKeyboardIndependent(e)){var n=e.getElement()._kmwAttachment;return this.keyboardCache.getStub(n.keyboard,n.languageCode)}else return this.globalKeyboard.metadata},t.prototype.getFallbackStubKey=function(){var e={id:"",langId:""};return this.engineConfig.hostDevice.touchable&&this.keyboardCache.defaultStub||e},t.prototype.activateKeyboard=function(e,n,c){var r,l,s,o,a,B;return(0,d.__awaiter)(this,void 0,void 0,function(){var g,u,F,I,y,Q=this;return(0,d.__generator)(this,function(h){switch(h.label){case 0:c||(c=!1),g=this.currentKeyboardSrcTarget(),e||(e=this.getFallbackStubKey().id,n=this.getFallbackStubKey().langId),h.label=1;case 1:return h.trys.push([1,3,,7]),[4,i.prototype.activateKeyboard.call(this,e,n,c)];case 2:return u=h.sent(),(r=this.engineConfig.alertHost)===null||r===void 0||r.wait(),c&&!g&&this.cookieManager.save({current:"".concat(e,":").concat(n)}),g==this.currentKeyboardSrcTarget()&&(Nr((l=this.currentTarget)===null||l===void 0?void 0:l.getElement(),this.keyboardCache.getKeyboard(e)),this.page.setAttachmentFont((o=(s=this.activeKeyboard)===null||s===void 0?void 0:s.metadata)===null||o===void 0?void 0:o.KFont,this.engineConfig.paths.fonts,this.engineConfig.hostDevice.OS),this.restoreLastActiveTarget()),[2,u];case 3:return F=h.sent(),I=function(){return(0,d.__awaiter)(Q,void 0,void 0,function(){var C;return(0,d.__generator)(this,function(x){switch(x.label){case 0:return C=this.getFallbackStubKey(),C.id==e?[3,2]:[4,this.activateKeyboard(C.id,C.langId,!0).catch(function(){})];case 1:x.sent(),x.label=2;case 2:return[2]}})})},(a=this.engineConfig.alertHost)===null||a===void 0||a.wait(),y=(F==null?void 0:F.message)||"Sorry, the "+e+" keyboard for "+n+" is not currently available.",F instanceof Ft?console.error(F||y):console.warn(F||y),this.engineConfig.alertHost?((B=this.engineConfig.alertHost)===null||B===void 0||B.alert(y,I),[3,6]):[3,4];case 4:return[4,I()];case 5:h.sent(),h.label=6;case 6:throw F;case 7:return[2]}})})},t.prototype._BlurKeyboardSettings=function(e,n,c){var r,l=this.activeKeyboard?this.activeKeyboard.keyboard.id:"",s=(r=this.activeKeyboard)===null||r===void 0?void 0:r.metadata.langId;n!==void 0&&c!==void 0&&(l=n,s=c),e&&e._kmwAttachment.keyboard!=null?(e._kmwAttachment.keyboard=l,e._kmwAttachment.languageCode=s):this.globalKeyboard=this.activeKeyboard},t.prototype._FocusKeyboardSettings=function(e,n){var c,r=e._kmwAttachment,l=this.globalKeyboard;r.keyboard!=null?this.activateKeyboard(r.keyboard,r.languageCode,!0):!n&&(l==null?void 0:l.metadata)!=((c=this._activeKeyboard)===null||c===void 0?void 0:c.metadata)&&this.activateKeyboard(l==null?void 0:l.metadata.id,l==null?void 0:l.metadata.langId,!0)},t.prototype._CommonFocusHelper=function(e){var n,c=this.focusAssistant,r=(n=this.activeKeyboard)===null||n===void 0?void 0:n.keyboard;return c.restoringFocus||(e==null||e.deadkeys().clear(),r==null||r.notify(0,e,1)),!c.restoringFocus&&this.mostRecentTarget!=e&&(c.maintainingFocus=!1),c.restoringFocus=!1,this.resetContext(),!1},t.prototype.doChangeEvent=function(e){if(e.changed){var n=new Event("change",{bubbles:!0,cancelable:!1});e.getElement().dispatchEvent(n)}e.changed=!1},t.prototype.getSavedKeyboardRaw=function(){var e=new Ie("KeymanWeb_Keyboard"),n=e.load(decodeURIComponent);return typeof n.current!="string"||n.current=="Keyboard_us:eng"?"Keyboard_us:en":n.current},t.prototype.getSavedKeyboard=function(){for(var e=this.getSavedKeyboardRaw(),n=this.keyboardCache.getStubList(),c,r=0;r<n.length;r++)if(c=n[r].KI+":"+n[r].KLC,c==e)return c;for(var r=0;r<n.length;r++)if(c=n[r].KI+":"+n[r].KLC,c=="Keyboard_us:en")return c;return n.length>0?n[0].KI+":"+n[0].KLC:"Keyboard_us:en"},t.prototype.restoreSavedKeyboard=function(e){var n=e,c=n.split(":");c.length<2&&(c[1]="");var r=this.keyboardCache.getStub(c[0],c[1])||this.keyboardCache.defaultStub;r&&this.activateKeyboard(c[0],c[1])},t.prototype.shutdown=function(){this.page.shutdown(),this.domEventTracker.shutdown()},t}(Vn),Tr=Zo;var fo=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.contextManager=e,n}return t.prototype.isCommand=function(e){var n=this.codeForEvent(e);switch(n){case b.keyCodes.K_TAB:case b.keyCodes.K_TABBACK:case b.keyCodes.K_TABFWD:return!0;default:return i.prototype.isCommand.call(this,e)}},t.prototype.applyCommand=function(e,n){var c=this,r=this.codeForEvent(e),l=function(s){var o,a=c.contextManager,B=(o=a.activeTarget)===null||o===void 0?void 0:o.getElement(),g=a.page.findNeighboringInput(B,s);g==null||g.focus()};switch(r){case b.keyCodes.K_TAB:l((e.Lmodifiers&b.modifierCodes.SHIFT)!=0);break;case b.keyCodes.K_TABBACK:l(!0);break;case b.keyCodes.K_TABFWD:l(!1);break}i.prototype.applyCommand.call(this,e,n)},t}(ke),Er=fo;function Uc(i){return i.keyCode?i.keyCode:i.which?i.which:null}function sn(i,t,e){if(i.cancelBubble===!0)return null;var n=Uc(i);if(n==null)return null;var c=t.modStateFlags,r=0,l=!1,s=!1,o=b.keyCodes;switch(n){case o.K_CTRL:case o.K_LCTRL:case o.K_RCTRL:case o.K_CONTROL:case o.K_LCONTROL:case o.K_RCONTROL:l=!0;break;case o.K_LMENU:case o.K_RMENU:case o.K_ALT:case o.K_LALT:case o.K_RALT:s=!0;break}r|=i.getModifierState("Shift")?16:0;var a=b.modifierCodes;i.getModifierState("Control")&&(r|=i.location!=0&&l?i.location==1?a.LCTRL:a.RCTRL:c&3),i.getModifierState("Alt")&&(r|=i.location!=0&&s?i.location==1?a.LALT:a.RALT:c&12);var B=0;B|=i.getModifierState("CapsLock")?a.CAPS:a.NO_CAPS,B|=i.getModifierState("NumLock")?a.NUM_LOCK:a.NO_NUM_LOCK,B|=i.getModifierState("ScrollLock")?a.SCROLL_LOCK:a.NO_SCROLL_LOCK,r|=B;var g=t.modStateFlags!=r;t.modStateFlags=r;var u=a.RALT|a.LCTRL;(c&u)==u&&(r&u)!=u&&(r&=~u),r&a.RALT&&(r&=~a.LCTRL);var F=b.modifierBitmasks,I=t.activeKeyboard,y;I&&I.isChiral?(y=r&F.CHIRAL,I.emulatesAltGr&&(y&F.ALT_GR_SIM)==F.ALT_GR_SIM&&(y^=F.ALT_GR_SIM,y|=a.RALT)):y=r&16|(r&(a.LCTRL|a.RCTRL)?32:0)|(r&(a.LALT|a.RALT)?64:0),y|=i.metaKey?a.META:0,e.browser==v.Browser.Firefox&&Be.browserMap.FF["k"+n]&&(n=Be.browserMap.FF["k"+n]);var Q=new ae({device:e,kName:"",Lcode:n,Lmodifiers:y,Lstates:B,LmodifierChange:g,isSynthetic:!1}),h=typeof i.charCode!="undefined"&&i.charCode!=null&&(i.charCode==0||(y&111)!=0);Q.LisVirtualKey=h||i.type!="keypress",Q=fn(Q,I,t.baseLayout);var C=new ae(Q);return C.source=i,C}var vo=function(i){(0,d.__extends)(t,i);function t(e,n,c){var r=i.call(this)||this;r.domEventTracker=new Ve,r.swallowKeypress=!1,r._KeyDown=function(o){var a,B=r.contextManager.activeKeyboard,g=Le(o);if(!g||B==null)return!0;var u=g.getElement();return((a=u==null?void 0:u.getAttribute("class"))===null||a===void 0?void 0:a.indexOf("kmw-disabled"))>=0?!0:r.keyDown(o)},r._KeyPress=function(o){var a,B=Le(o);return!B||((a=r.contextManager.activeKeyboard)===null||a===void 0?void 0:a.keyboard)==null?!0:r.keyPress(o)},r._KeyUp=function(o){var a=Le(o),B=sn(o,r.processor,r.hardDevice);if(B==null||a==null)return!0;var g=a.getElement();if(B.Lcode==13){var u=!1;if(j(g,"HTMLTextAreaElement")&&(u=!0),!u){if(g instanceof g.ownerDocument.defaultView.HTMLInputElement)if(g.form&&(g.type=="search"||g.type=="submit"))g.form.submit();else{var F=r.contextManager.page.findNeighboringInput(g,!1);F.focus()}return!0}}return r.keyUp(o)},r.hardDevice=e,r.contextManager=c,r.processor=n;var l=c.page,s=r.domEventTracker;return l.on("enabled",function(o){var a=xe(o);if(!(a instanceof ie))s.attachDOMEvent(o,"keypress",r._KeyPress),s.attachDOMEvent(o,"keydown",r._KeyDown),s.attachDOMEvent(o,"keyup",r._KeyUp);else{var B=a.getElement().contentDocument;s.attachDOMEvent(B.body,"keydown",r._KeyDown),s.attachDOMEvent(B.body,"keypress",r._KeyPress),s.attachDOMEvent(B.body,"keyup",r._KeyUp)}}),l.on("disabled",function(o){var a=xe(o);if(!(a instanceof ie))s.detachDOMEvent(o,"keypress",r._KeyPress),s.detachDOMEvent(o,"keydown",r._KeyDown),s.detachDOMEvent(o,"keyup",r._KeyUp);else{var B=a.getElement().contentDocument;s.detachDOMEvent(B.body,"keydown",r._KeyDown),s.detachDOMEvent(B.body,"keypress",r._KeyPress),s.detachDOMEvent(B.body,"keyup",r._KeyUp)}}),r}return t.prototype.keyDown=function(e){var n=this;this.swallowKeypress=!1;var c=sn(e,this.processor,this.hardDevice);if(c==null)return!0;var r={LeventMatched:!1};return this.emit("keyevent",c,function(l,s){r.LeventMatched=l&&!l.triggerKeyDefault,r.LeventMatched?(e&&e.preventDefault&&(e.preventDefault(),e.stopPropagation()),n.swallowKeypress=!!c.Lcode,c.Lcode==8&&(n.swallowKeypress=!1)):n.swallowKeypress=!1}),!r.LeventMatched},t.prototype.keyUp=function(e){var n=sn(e,this.processor,this.hardDevice);if(n==null)return!0;var c=Le(e);return this.processor.doModifierPress(n,c,!1)},t.prototype.keyPress=function(e){var n,c=sn(e,this.processor,this.hardDevice);if(c==null||c.LisVirtualKey)return!0;if(!(!((n=this.contextManager.activeKeyboard)===null||n===void 0)&&n.keyboard.isMnemonic))return!this.swallowKeypress||c.Lcode<32||this.hardDevice.browser==v.Browser.Safari&&c.Lcode>63232&&c.Lcode<63744;var r={};return this.swallowKeypress||this.emit("keyevent",c,function(l,s){r.preventDefaultKeystroke=!!l}),this.swallowKeypress||r.preventDefaultKeystroke?(this.swallowKeypress=!1,e&&e.preventDefault&&(e.preventDefault(),e.stopPropagation()),!1):(this.swallowKeypress=!1,!0)},t.prototype.shutdown=function(){this.domEventTracker.shutdown()},t}(Zn),kr=vo;var Yr=function(){function i(){this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight}return i.prototype.equals=function(t){return this.innerWidth==t.innerWidth&&this.innerHeight==t.innerHeight},i}(),wr=function(){function i(t){this.idlePermutationCounter=i.IDLE_PERMUTATION_CAP,this.keyman=t}return i.prototype.resolve=function(){var t=this,e,n=this.keyman.osk;(e=this.keyman.touchLanguageMenu)===null||e===void 0||e.hide(),this.keyman.touchLanguageMenu=null,n.setNeedsLayout(),this.oskVisible&&n.present(),this.isActive=!1,this.updateTimer&&(window.clearInterval(this.updateTimer),this.rotState=null);var c=this.keyman.contextManager.activeTarget;c&&window.setTimeout(function(){t.keyman.ensureElementVisibility(c.getElement())},0)},i.prototype.initNewRotation=function(){this.oskVisible=this.keyman.osk.isVisible(),this.keyman.osk.hideNow(),this.isActive=!0},i.prototype.init=function(){var t=this,e=this.keyman.config.hostDevice.OS,n=this.keyman.util;e=="ios"?(n.attachDOMEvent(window,"orientationchange",function(){return t.iOSEventHandler(),!1}),n.attachDOMEvent(window,"resize",function(){return t.iOSEventHandler(),!1})):e=="android"&&("onmozorientationchange"in screen?n.attachDOMEvent(screen,"mozorientationchange",function(){return t.initNewRotation(),!1}):n.attachDOMEvent(window,"orientationchange",function(){return t.initNewRotation(),!1}),n.attachDOMEvent(window,"resize",function(){return t.resolve(),!1}))},i.prototype.iOSEventHandler=function(){this.isActive||(this.initNewRotation(),this.rotState=new Yr,this.updateTimer=window.setInterval(this.iOSEventUpdate.bind(this),i.UPDATE_INTERVAL)),this.idlePermutationCounter=0},i.prototype.iOSEventUpdate=function(){var t=new Yr;this.rotState.equals(t)?++this.idlePermutationCounter==i.IDLE_PERMUTATION_CAP&&this.resolve():(this.rotState=t,this.idlePermutationCounter=0)},i.IDLE_PERMUTATION_CAP=15,i.UPDATE_INTERVAL=20,i}();var Or=function(){function i(t,e){var n=this;this.domEventTracker=new Ve,this.suppressFocusCheck=function(c){return n.focusAssistant.isTargetForcingScroll()&&(c.stopPropagation(),c.cancelBubble=!0),!0},this.pageFocusHandler=function(){var c;return!n.focusAssistant.maintainingFocus&&((c=n.engine.osk)===null||c===void 0?void 0:c.vkbd)&&(n.engine.contextManager.deactivateCurrentTarget(),n.engine.contextManager.resetContext()),!1},this.touchStartActivationHandler=function(c){var r,l,s=n.engine.osk;if(!s)return!1;var o=n.engine.config.hostDevice;if(n.deactivateOnRelease=!0,n.touchY=c.touches[0].screenY,n.deactivateOnScroll=!1,o.OS=="android"&&o.browser=="chrome"){if(typeof s._Box=="undefined"||typeof s._Box.style=="undefined")return!1;var a=c.target.parentElement;if(typeof a!="undefined"&&a!=null&&(((r=a.getAttribute("class"))===null||r===void 0?void 0:r.indexOf("kmw-key-"))>=0||typeof a.parentElement!="undefined"&&a.parentElement!=null&&(a=a.parentElement,((l=a.getAttribute("class"))===null||l===void 0?void 0:l.indexOf("kmw-key-"))>=0)))return!1;n.deactivateOnScroll=!0}return!1},this.touchMoveActivationHandler=function(c){n.deactivateOnScroll&&(n.focusAssistant.focusing=!1,n.engine.contextManager.deactivateCurrentTarget());var r=c.touches[0].screenY,l=n.touchY;return(r-l>5||l-r<5)&&(n.deactivateOnRelease=!1),!1},this.touchEndActivationHandler=function(c){return n.deactivateOnRelease&&!n.engine.touchLanguageMenu&&!n.focusAssistant.focusing&&n.engine.contextManager.deactivateCurrentTarget(),n.deactivateOnRelease=!1,!1},this._WindowLoad=function(){document.body.scrollTop=0,typeof document.documentElement!="undefined"&&(document.documentElement.scrollTop=0)},this._WindowUnload=function(){n.engine.shutdown()},this.window=t,this.engine=e,this.attachHandlers(),e.config.hostDevice.touchable&&(this.buildPageTrailer(),this.rotationProcessor=new wr(this.engine),this.rotationProcessor.init())}return i.prototype.buildPageTrailer=function(){var t=this.mobilePageTrailer=document.createElement("div"),e=t.style;e.width="100%",e.height=screen.width/2+"px",document.body.appendChild(t)},Object.defineProperty(i.prototype,"focusAssistant",{get:function(){return this.engine.contextManager.focusAssistant},enumerable:!1,configurable:!0}),i.prototype.attachHandlers=function(){var t=this.domEventTracker,e=this.engine.config.hostDevice,n=this.window.document.body;t.attachDOMEvent(this.window,"focus",this.pageFocusHandler,!1),t.attachDOMEvent(this.window,"blur",this.pageFocusHandler,!1),t.attachDOMEvent(n,"focus",this.suppressFocusCheck,!0),t.attachDOMEvent(n,"blur",this.suppressFocusCheck,!0),e.touchable&&(t.attachDOMEvent(n,"touchstart",this.touchStartActivationHandler,!1),t.attachDOMEvent(n,"touchmove",this.touchMoveActivationHandler,!1),t.attachDOMEvent(n,"touchend",this.touchEndActivationHandler,!1)),t.attachDOMEvent(window,"load",this._WindowLoad,!1),t.attachDOMEvent(window,"unload",this._WindowUnload,!1),t.attachDOMEvent(document,"keyup",this.engine.hotkeyManager._Process,!1)},i.prototype.shutdown=function(){var t,e=this.domEventTracker,n=this.engine.config.hostDevice,c=this.window.document.body;e.detachDOMEvent(this.window,"focus",this.pageFocusHandler,!1),e.detachDOMEvent(this.window,"blur",this.pageFocusHandler,!1),e.detachDOMEvent(c,"focus",this.suppressFocusCheck,!0),e.detachDOMEvent(c,"blur",this.suppressFocusCheck,!0),n.touchable&&(e.detachDOMEvent(c,"touchstart",this.touchStartActivationHandler,!1),e.detachDOMEvent(c,"touchmove",this.touchMoveActivationHandler,!1),e.detachDOMEvent(c,"touchend",this.touchEndActivationHandler,!1),(t=this.mobilePageTrailer)===null||t===void 0||t.parentElement.removeChild(this.mobilePageTrailer)),e.detachDOMEvent(window,"load",this._WindowLoad,!1),e.detachDOMEvent(window,"unload",this._WindowUnload,!1),e.detachDOMEvent(document,"keyup",this.engine.hotkeyManager._Process,!1)},i}();function oe(i){var t=document.createElement(i);return t.style.userSelect="none",t.style.MozUserSelect="none",t.style.KhtmlUserSelect="none",t.style.UserSelect="none",t.style.WebkitUserSelect="none",t}function ze(i,t){try{if(i&&typeof window.getComputedStyle!="undefined")return window.getComputedStyle(i,"").getPropertyValue(t)}catch(e){}return""}var Mr=function(){function i(t){this.keyman=t,this.scrolling=!1,this.shim=this.constructShim()}return i.prototype.constructShim=function(){var t=this,e=this,n=oe("div"),c=this.keyman.osk;return n.id="kmw-language-menu-background",n.addEventListener("touchstart",function(r){if(r.preventDefault(),e.hide(),r.touches.length>2){var l=r.touches[1].pageX,s=r.touches[1].pageY,o=c.vkbd.spaceBar;l>o.offsetLeft&&l<o.offsetLeft+o.offsetWidth&&s>o.offsetTop&&s<o.offsetTop+o.offsetHeight&&t.keyman.osk.emit("showbuild")}},!1),n},i.prototype.show=function(){var t=this.keyman.config.hostDevice,e=this.keyman.keyboardRequisitioner.cache.getStubList(),n=e.length;if(!(n<1)){var c=this.lgList=oe("div");this.lgList.id="kmw-language-menu";var r=this;document.body.appendChild(this.shim);var l=oe("div"),s=l.style,o=oe("div"),a=o.style;l.id="kmw-menu-scroll-container",o.id="kmw-menu-scroller","WebkitOverflowScrolling"in s&&(s.WebkitOverflowScrolling="touch"),l.appendChild(o),c.appendChild(l);var B,g,u=oe("div");for(u.id="kmw-menu-index",B=1;B<=26;B++)g=oe("p"),g.innerHTML=String.fromCharCode(B+64),u.appendChild(g);u.addEventListener("touchstart",function(X){r.scrollToLanguage(X,l,o)},!1),u.addEventListener("touchend",function(X){X.stopPropagation()},!1),c.appendChild(u),c.addEventListener("scroll",function(X){r.scrolling=!0},!1),l.addEventListener("scroll",function(X){l.scrollTop<1&&(l.scrollTop=1),l.scrollTop>l.scrollHeight-l.offsetHeight-1&&(l.scrollTop=l.scrollHeight-l.offsetHeight-1)},!1),this.activeLgNo=this.addLanguages(o,e);var F=o.childNodes.length-1;if(this.lgList.style.visibility="hidden",document.body.appendChild(this.lgList),t.OS=="android"&&"devicePixelRatio"in window&&(this.lgList.style.fontSize=2/window.devicePixelRatio+"em"),t.OS=="android"&&t.formFactor=="tablet"&&"devicePixelRatio"in window){var I=parseInt(ze(c,"width"),10),y=c.style;isNaN(I)||(y.width=y.maxWidth=2*I/window.devicePixelRatio+"px"),I=parseInt(ze(l,"width"),10),y=l.style,isNaN(I)||(y.width=y.maxWidth=2*I/window.devicePixelRatio+"px"),I=parseInt(ze(o,"width"),10),y=o.style,isNaN(I)||(y.width=y.maxWidth=2*I/window.devicePixelRatio+"px")}this.adjust(0);var Q=u.childNodes[1].offsetTop-u.childNodes[0].offsetTop,h=Math.floor(c.offsetHeight/26),C=Math.round(100*h/Q)/100,x=C>.6?1:2;for(C>1.25&&(C=1.25),B=0;B<26;B++){var U=u.childNodes[B].style;x==2&&B%2==1?U.display="none":(U.fontSize=C*x+"em",U.lineHeight=h*x+"px")}var p=l.offsetWidth;l.scrollHeight>l.offsetHeight+3?p=p+u.offsetWidth:u.style.display="none",c.style.width=p+"px",this.lgList.style.visibility="",this.scrollToIndex(this.activeLgNo,l,o)}},i.prototype.adjust=function(t){var e=this.keyman.osk,n=this.keyman.config.hostDevice,c=this.lgList,r=c.firstChild,l=r.firstChild,s=0,o=c.style,a=c.childNodes[1],B=window.innerHeight-e.vkbd.lgKey.offsetHeight-16,g=l.childNodes.length+t-1,u=l.firstChild.firstChild.offsetHeight,F=g*u;n.OS=="ios"&&(n.formFactor=="phone"?(s=le()?36:0,B=(window.innerHeight-s-16)*Ce(n.formFactor)):n.formFactor=="tablet"&&(s=le()?16:0,B=B-s)),o.left=_(e.vkbd.lgKey)+"px",F>B&&(F=B),o.height=F+"px",o.bottom="0px",a.style.height=r.style.height=o.height},i.prototype.scrollToLanguage=function(t,e,n){t.stopImmediatePropagation(),t.stopPropagation(),t.preventDefault();var c=t.touches[0].target;if(c.nodeName=="P"){var r,l,s=c.innerHTML.charCodeAt(0),o=n.childNodes;try{for(r=0;r<o.length-1&&(l=o[r].firstChild.innerHTML.toUpperCase().charCodeAt(0),!(l>=s));r++);}catch(a){}this.scrollToIndex(r,e,n)}},i.prototype.scrollToIndex=function(t,e,n){var c,r=.5;try{c=n.firstChild.getBoundingClientRect().height*(t-r)+1,e.scrollTop=c}catch(l){c=0}try{e.scrollTop<0&&(e.scrollTop=0),e.scrollTop>e.scrollHeight-e.offsetHeight-1&&(e.scrollTop=e.scrollHeight-e.offsetHeight-1)}catch(l){}},i.prototype.addLanguages=function(t,e){var n,c=e.length,r=this.keyman.config.hostDevice,l,s,o,a=[];for(s=0;s<c;s++)o=e[s].KL,a.indexOf(o)==-1&&a.push(o);a.sort();var B=Math.round(100/Ce(r.formFactor))/100,g,u,F,I,y=-1,Q=function(){for(g=oe("div"),g.className="kbd-list-closed",u=oe("p"),u.kList=[],s=0;s<c;s++)e[s].KL==a[l]&&u.kList.push(e[s]);r.OS=="ios"&&(u.style.fontSize=B+"em"),g.appendChild(u),t.appendChild(g),a[l]==((n=h.keyman.contextManager.activeKeyboard)===null||n===void 0?void 0:n.metadata.langName)&&(y=l);var U=h;if(u.kList.length>1)for(u.className="kbd-list",u.innerHTML=a[l]+"...",u.scrolled=!1,u.ontouchend=function(p){p.stopPropagation(),p.target.scrolled?p.target.scrolled=!1:this.parentNode.className=this.parentNode.className=="kbd-list-closed"?"kbd-list-open":"kbd-list-closed",U.adjust(this.parentNode.className=="kbd-list-closed"?0:this.kList.length)},u.addEventListener("touchstart",function(p){p.stopPropagation()},!1),u.addEventListener("touchmove",function(p){p.target.scrolled=!0,p.stopPropagation()},!1),F=0;F<u.kList.length;F++)I=oe("p"),I.className="kbd-list-entry",r.OS=="ios"&&(I.style.fontSize=B+"em"),h.addKeyboard(u.kList[F],I,!1),g.appendChild(I);else u.innerHTML=a[l],u.className="kbd-single-entry",h.addKeyboard(u.kList[0],u,!0);l==y&&(u.className=u.className+" current")},h=this;for(l=0;l<a.length;l++)Q();var C=oe("div");C.id="kmw-menu-footer";var x=function(U){U.cancelable&&U.preventDefault(),U.stopPropagation()};return C.addEventListener("touchstart",x,!1),C.addEventListener("touchmove",x,!1),C.addEventListener("touchend",x,!1),t.appendChild(C),y},i.prototype.addKeyboard=function(t,e,n){var c=this;e.kn=t.KI,e.kc=t.KLC,e.innerHTML=n?t.KL:t.KN.replace(" Keyboard","");var r=this,l=function(){if(c.originalBodyStyle){console.error("Unexpected state:  `originalBodyStyle` was not cleared by a previous `unlockBodyScroll()` call");return}c.originalBodyStyle={};var u=c.originalBodyStyle,F=document.body.style;return u.overflowY=F.overflowY,u.height=F.height,F.overflowY="hidden",F.height="100%",!0},s=function(){if(!c.originalBodyStyle){console.error("Unexpected state:  `originalBodyStyle` is unset; cannot restore original body style");return}var u=c.originalBodyStyle,F=document.body.style;F.overflowY=u.overflowY,F.height=u.height,c.originalBodyStyle=null},o=function(u){u.stopPropagation(),this.className.indexOf("selected")<=0&&(this.className=this.className+" selected"),r.scrolling=!1,r.y0=u.touches[0].pageY,l()},a=function(u){u.stopImmediatePropagation();var F=r.lgList.childNodes[0],I=F.scrollHeight-F.offsetHeight,y,Q;if(typeof u.pageY!="undefined")y=u.pageY;else if(typeof u.touches!="undefined")y=u.touches[0].pageY;else return;if(Q=y-r.y0,Q<0)F.scrollTop>=I-1&&(r.y0=y);else if(Q>0)F.scrollTop<2&&(r.y0=y);else return;return(Q<-5||Q>5)&&(r.scrolling=!0,this.className=this.className.replace(/\s*selected/,""),r.y0=y),!0},B=function(u){return typeof u.stopImmediatePropagation!="undefined"?u.stopImmediatePropagation():u.stopPropagation(),r.scrolling?this.className=this.className.replace(/\s*selected/,""):(r.keyman.contextManager.focusAssistant.setFocusTimer(),r.lgList.style.display="none",r.keyman.contextManager.activateKeyboard(this.kn,this.kc,!0),r.keyman.contextManager.restoreLastActiveTarget(),r.hide()),s(),!0},g=function(u){s()};e.onmspointerdown=o,e.addEventListener("touchstart",o,!1),e.onmspointermove=a,e.addEventListener("touchmove",a,!1),e.onmspointerout=B,e.addEventListener("touchend",B,!1),e.addEventListener("touchcancel",g,!1)},i.prototype.hide=function(){var t=this,e=this.keyman.osk;this.lgList&&(e.vkbd.highlightKey(e.vkbd.lgKey,!1),this.lgList.style.visibility="hidden",window.setTimeout(function(){t.shim.parentElement&&(document.body.removeChild(t.shim),document.body.removeChild(t.lgList))},500)),this.keyman.touchLanguageMenu=null},i}();function Dr(i,t,e){var n=this,c=e.focusAssistant;t.on("globekey",function(r,l){l&&t.hostDevice.touchable&&(i.touchLanguageMenu=new Mr(i),i.touchLanguageMenu.show()),t.vkbd&&t.vkbd.highlightKey(r,!1)}),t.on("hiderequested",function(r){t&&(t.startHide(!0),e.forgetActiveTarget())}),t.addEventListener("hide",function(r){var l;r!=null&&r.HiddenByUser&&((l=e.activeTarget)===null||l===void 0||l.focus())}),t.on("showbuild",function(){var r;(r=i.config.alertHost)===null||r===void 0||r.alert("KeymanWeb Version "+Fn.VERSION+'<br /><br /><span style="font-size:0.8em">Copyright &copy; 2007-2023 SIL International</span>')}),t.on("dragmove",function(r){return(0,d.__awaiter)(n,void 0,void 0,function(){return(0,d.__generator)(this,function(l){switch(l.label){case 0:return c.restoringFocus=!0,[4,r];case 1:return l.sent(),e.restoreLastActiveTarget(),c.restoringFocus=!1,c.setMaintainingFocus(!1),[2]}})})}),t.on("resizemove",function(r){return(0,d.__awaiter)(n,void 0,void 0,function(){return(0,d.__generator)(this,function(l){switch(l.label){case 0:return c.restoringFocus=!0,[4,r];case 1:return l.sent(),e.restoreLastActiveTarget(),c.restoringFocus=!1,c.setMaintainingFocus(!1),[2]}})})}),t.on("pointerinteraction",function(r){return(0,d.__awaiter)(n,void 0,void 0,function(){return(0,d.__generator)(this,function(l){switch(l.label){case 0:return c.setMaintainingFocus(!0),[4,r];case 1:return l.sent(),c.setMaintainingFocus(!1),[2]}})})})}function So(i){var t=document.createElement(i);return t.style.userSelect="none",t}var zr=function(){function i(t){this.getAbsoluteX=_,this.getAbsoluteY=P,this._GetAbsoluteX=_,this._GetAbsoluteY=P,this._GetAbsolute=this.getAbsolute,this.toNzString=this.nzString,this.createElement=So,this.getStyleValue=ze,this.config=t,this.stylesheetManager=new ye(document.body,t.applyCacheBusting),this.domEventTracker=new Ve}return i.prototype.isTouchDevice=function(){return this.config.hostDevice.touchable},i.prototype.getAbsolute=function(t){return{x:_(t),y:P(t)}},i.prototype.getOption=function(t,e){return t in this.config.paths?this.config.paths[t]:t in this.config.options?this.config.options[t]:arguments.length>1?e:""},i.prototype.setOption=function(t,e){switch(t){case"attachType":break;case"ui":break;case"useAlerts":this.config.signalUser=e?new nt:null;break;case"setActiveOnRegister":this.config.activateFirstKeyboard=!!e;break;case"spacebarText":this.config.spacebarText=e;break;default:throw new Error("Path-related options may not be changed after the engine has initialized.")}},i.prototype.loadCookie=function(t){var e=new Ie(t);return e.load(decodeURIComponent)},i.prototype.saveCookie=function(t,e){var n=new Ie(t);n.save(e,encodeURIComponent)},i.prototype.addStyleSheet=function(t){var e=Ae(t);return this.stylesheetManager.linkStylesheet(e),e},i.prototype.removeStyleSheet=function(t){return this.stylesheetManager.unlink(t)},i.prototype.linkStyleSheet=function(t){this.stylesheetManager.linkExternalSheet(t)},i.prototype.getLanguageCodes=function(t){return t.indexOf("-")==-1?[t]:t.split("-")},i.prototype.attachDOMEvent=function(t,e,n,c){this.domEventTracker.attachDOMEvent(t,e,n,c)},i.prototype.detachDOMEvent=function(t,e,n,c){this.domEventTracker.detachDOMEvent(t,e,n,c)},Object.defineProperty(i.prototype,"alertHost",{get:function(){return this.config.alertHost?this.config.alertHost:(this._alertHost||(this._alertHost=new nt),this._alertHost)},enumerable:!1,configurable:!0}),i.prototype.alert=function(t,e){this.alertHost.alert(t,e)},i.prototype.nzString=function(t,e){var n="";return arguments.length>1&&(n=e),typeof t=="undefined"||t==null||t==0||t==""?n:""+t},i.prototype.toNumber=function(t,e){var n=parseInt(t,10);return isNaN(n)?e:n},i.prototype.toFloat=function(t,e){var n=parseFloat(t);return isNaN(n)?e:n},i.prototype.rgba=function(t,e,n,c,r){var l="transparent";try{l="rgba("+e+","+n+","+c+","+r+")"}catch(s){l="rgb("+e+","+n+","+c+")"}return l},i.prototype.shutdown=function(){var t,e,n;(t=this.stylesheetManager)===null||t===void 0||t.unlinkAll(),(e=this.domEventTracker)===null||e===void 0||e.shutdown(),(n=this._alertHost)===null||n===void 0||n.shutdown()},i}();var Jo=function(){function i(t,e,n){this.code=t,this.shift=e,this.handler=n}return i.prototype.matches=function(t,e){return this.code==t&&this.shift==e},i}(),Kr=function(){function i(){var t=this;this.hotkeys=[],this._Process=function(e){e||(e=window.event);var n=Uc(e);if(n==null)return!1;for(var c=(e.shiftKey?16:0)|(e.ctrlKey?32:0)|(e.altKey?64:0),r=0;r<t.hotkeys.length;r++)if(t.hotkeys[r].matches(n,c))return t.hotkeys[r].handler(),e.returnValue=!1,e&&e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,!1;return!0}}return i.prototype.addHotKey=function(t,e,n){for(var c=0;c<this.hotkeys.length;c++)if(this.hotkeys[c].code==t&&this.hotkeys[c].shift==e){this.hotkeys[c].handler=n;return}this.hotkeys.push(new Jo(t,e,n))},i.prototype.removeHotkey=function(t,e){for(var n=0;n<this.hotkeys.length;n++)if(this.hotkeys[n].matches(t,e)){this.hotkeys.splice(n,1);return}},i}();var Ro=function(){function i(t){this.e=t,this.c=t.style.backgroundColor}return i.prototype.reset=function(){this.e.style.backgroundColor=this.c},i}(),_r=function(){function i(t){var e=this;this._BeepObjects=[],this._BeepTimeout=0,this.reset=function(){e.keyboardInterface.resetContextCache();var n;for(e._BeepTimeout=0,n=0;n<e._BeepObjects.length;n++)e._BeepObjects[n].reset();e._BeepObjects=[]},this.keyboardInterface=t}return i.prototype.beep=function(t){if(t instanceof ce){var e=t.getElement();if(t instanceof ie&&(e=t.docRoot),!!e&&!(!e.style||typeof e.style.backgroundColor=="undefined")){for(var n=0;n<this._BeepObjects.length;n++)if(this._BeepObjects[n].e==e)return;this._BeepObjects.push(new Ro(e)),e.style.backgroundColor="#000000",this._BeepTimeout==0&&(this._BeepTimeout=1,window.setTimeout(this.reset,50))}}},i}();var Pr=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this,e,n)||this;return c.GetLastActiveElement=c.getLastActiveElement,c.FocusLastActiveElement=c.focusLastActiveElement,c.HideHelp=c.hideHelp,c.ShowHelp=c.showHelp,c.ShowPinnedHelp=c.showPinnedHelp,c}return t.prototype.saveFocus=function(){this.engine.contextManager.focusAssistant._IgnoreNextSelChange=1},t.prototype.getLastActiveElement=function(){return this.engine.contextManager.lastActiveTarget},t.prototype.focusLastActiveElement=function(){this.engine.contextManager.restoreLastActiveTarget()},t.prototype.hideHelp=function(){var e=this.engine.osk;e.startHide(!0)},t.prototype.showHelp=function(e,n){var c=this.engine.osk;c instanceof et?c.presentAtPosition(e,n):c.present()},t.prototype.showPinnedHelp=function(){var e=this.engine.osk;e instanceof et&&(!e.activeKeyboard.keyboard.isCJK||!this.ruleBehavior)&&(e.userPositioned=!0),e.present()},t}(Tn),jr=Pr;(function(){Pr.__publishShorthandAPI()})();var Ao=function(i){(0,d.__extends)(t,i);function t(e,n){var c=this,r=new Jr(n);return c=i.call(this,e,r,new Tr(r,function(){return c.legacyAPIEvents}),function(l){return{keyboardInterface:new jr(window,l),defaultOutputRules:new Er(l.contextManager)}})||this,c._initialized=0,c.hotkeyManager=new Kr,c.helpURL="https://help.keyman.com/go",c.keyEventRefocus=function(){c.contextManager.restoreLastActiveTarget()},c._GetKeyboardDetail=function(l,s){var o={Name:l.KN,InternalName:l.KI,LanguageName:l.KL,LanguageCode:l.KLC,RegionName:l.KR,RegionCode:l.KRC,CountryName:l.KC,CountryCode:l.KCC,KeyboardID:l.KD,Font:l.KFont,OskFont:l.KOskFont,HasLoaded:!!s,IsRTL:s?s.isRTL:null};return o},c._util=new zr(r),c.beepHandler=new _r(c.core.keyboardInterface),c.core.keyboardProcessor.beepHandler=function(){return c.beepHandler.beep(c.contextManager.activeTarget)},c.hardKeyboard=new kr(r.hardDevice,c.core.keyboardProcessor,c.contextManager),c.contextManager.on("targetchange",function(l){var s=l==null?void 0:l.getElement();c.osk&&(c.osk.activationModel.activationTrigger=s),c.config.hostDevice.touchable&&l&&c.ensureElementVisibility(s)}),c}return t.prototype.ensureElementVisibility=function(e){if(!(!e||!this.osk)){var n=P(e),c=window.pageYOffset,r=n-c;n>=c&&(r-=window.innerHeight-this.osk._Box.offsetHeight-e.offsetHeight-2,r<0&&(r=0)),r!=0&&window.scrollTo(0,r+c)}},Object.defineProperty(t.prototype,"util",{get:function(){return this._util},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"views",{get:function(){return Fc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"initialized",{get:function(){return this._initialized},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ui",{get:function(){return this._ui},set:function(e){this._ui&&this._ui.shutdown(),this._ui=e,this.config.deferForInitialization.isFulfilled&&e.initialize()},enumerable:!1,configurable:!0}),t.prototype.init=function(e){return(0,d.__awaiter)(this,void 0,void 0,function(){var n,c,r,l,s=this;return(0,d.__generator)(this,function(o){switch(o.label){case 0:return n=new Wt,c=n.detect(),r=(0,d.__assign)((0,d.__assign)({},Rr),e),this.config.hostDevice=c,this.config.initialize(r),this._initialized=1,[4,Vt()];case 1:return o.sent(),this.config.deferForInitialization.isResolved?[2,Promise.resolve()]:[4,i.prototype.init.call(this,r)];case 2:return o.sent(),this.keyboardRequisitioner.cloudQueryEngine.once("unboundregister",function(){var a;!((a=s.contextManager.activeKeyboard)===null||a===void 0)&&a.keyboard||s.setActiveKeyboard("","")}),this.contextManager.initialize(),l=this.contextManager.getSavedKeyboardRaw(),c.touchable?this.osk=new gc(this):this.osk=new uc(this),Dr(this,this.osk,this.contextManager),this.pageIntegration=new Or(window,this),this.config.finalizeInit(),this.ui&&(this.ui.initialize(),this.legacyAPIEvents.callEvent("loaduserinterface",{})),this._initialized=2,[4,Promise.resolve()];case 3:return o.sent(),this.contextManager.restoreSavedKeyboard(l),[4,Promise.resolve()];case 4:return o.sent(),[2]}})})},Object.defineProperty(t.prototype,"register",{get:function(){return this.keyboardRequisitioner.cloudQueryEngine.registerFromCloud},enumerable:!1,configurable:!0}),t.prototype.getUIState=function(){return this.contextManager.focusAssistant.getUIState()},t.prototype.activatingUI=function(e){this.contextManager.focusAssistant.setMaintainingFocus(!!e)},t.prototype.setKeyboardForControl=function(e,n,c){if(e instanceof e.ownerDocument.defaultView.HTMLIFrameElement){console.warn("'keymanweb.setKeyboardForControl' cannot set keyboard on iframes.");return}if(!this.isAttached(e)){console.error("KeymanWeb is not attached to element "+e);return}var r=null;if(n&&(r=this.keyboardRequisitioner.cache.getStub(n,c),!r))throw new Error("No keyboard has been registered with id ".concat(n," and language code ").concat(c,"."));this.contextManager.setKeyboardForTarget(e._kmwAttachment.interface,n,c)},t.prototype.getKeyboardForControl=function(e){var n=xe(e);return this.contextManager.getKeyboardStubForTarget(n).id},t.prototype.getLanguageForControl=function(e){var n=xe(e);return this.contextManager.getKeyboardStubForTarget(n).langId},t.prototype.isAttached=function(e){return this.contextManager.page.isAttached(e)},t.prototype.addKeyboards=function(){for(var e=this,n=[],c=0;c<arguments.length;c++)n[c]=arguments[c];return this.config.deferForInitialization.then(function(){if(!n||!n[0]||n[0].length==0)return e.keyboardRequisitioner.fetchCloudCatalog().catch(function(l){return console.error(l[0].error),l});var r=[];return Array.isArray(n[0])?r=r.concat(n[0]):Array.isArray(n)&&(r=r.concat(n)),e.keyboardRequisitioner.addKeyboardArray(r)})},t.prototype.addKeyboardsForLanguage=function(e){var n=this;return this.config.deferForInitialization.then(function(){return typeof e=="string"?n.keyboardRequisitioner.addLanguageKeyboards(e.split(",").map(function(c){return c.trim()})):n.keyboardRequisitioner.addLanguageKeyboards(e)})},t.prototype.isCJK=function(e){var n;if(e){var c=e;c.KeyboardID?n=this.keyboardRequisitioner.cache.getKeyboard(e.KeyboardID):n=new $(e)}else n=this.core.activeKeyboard;return n&&n.isCJK},t.prototype.getKeyboard=function(e,n){var c=this.keyboardRequisitioner.cache.getStub(e,n),r=this.keyboardRequisitioner.cache.getKeyboardForStub(c);return c&&this._GetKeyboardDetail(c,r)},t.prototype.getKeyboards=function(){for(var e=[],n=this.keyboardRequisitioner.cache,c=n.getStubList(),r=0;r<c.length;r++){var l=c[r],s=n.getKeyboardForStub(l),o=this._GetKeyboardDetail(l,s);e.push(o)}return e},t.prototype.removeKeyboards=function(){for(var e,n=[],c=0;c<arguments.length;c++)n[c]=arguments[c];for(var r=0;r<n.length;r++)this.keyboardRequisitioner.cache.forgetKeyboard(n[r],!0),((e=this.contextManager.activeKeyboard)===null||e===void 0?void 0:e.metadata.id)==ee(n[r])&&this.contextManager.activateKeyboard("","");return!0},t.prototype.getSavedKeyboard=function(){return this.contextManager.getSavedKeyboard()},t.prototype.focusLastActiveElement=function(){var e;(e=this.contextManager.lastActiveTarget)===null||e===void 0||e.focus()},t.prototype.getLastActiveElement=function(){var e;return(e=this.contextManager.lastActiveTarget)===null||e===void 0?void 0:e.getElement()},t.prototype.setActiveElement=function(e,n){if(typeof e=="string"){var c=e;if(e=document.getElementById(e),!e)throw new Error("Could not find the specified element (id: ".concat(c))}var r=xe(e);if(!r)throw new Error("KMW is not attached to the specified element (id: ".concat(e.id,")."));this.contextManager.setActiveTarget(r,n)},t.prototype.moveToElement=function(e){typeof e=="string"&&(e=document.getElementById(e)),e.focus()},t.prototype.addHotKey=function(e,n,c){this.hotkeyManager.addHotKey(e,n,c)},t.prototype.removeHotKey=function(e,n){this.hotkeyManager.removeHotkey(e,n)},t.prototype.attachToControl=function(e){this.contextManager.page.attachToControl(e)},t.prototype.detachFromControl=function(e){this.contextManager.page.detachFromControl(e)},t.prototype.disableControl=function(e){this.contextManager.page.disableControl(e)},t.prototype.enableControl=function(e){this.contextManager.page.enableControl(e)},t.prototype.BuildVisualKeyboard=function(e,n,c,r){var l=null;e!=null&&(l=this.keyboardRequisitioner.cache.getKeyboard(e)),l=l||this.core.activeKeyboard;var s=this.keyboardRequisitioner.cache.getStub(l),o=this.getOskHeight,a=(typeof o=="function"?o():null)||this.osk.computedHeight||200;return fe.buildDocumentationKeyboard(l,s,this.config.paths,c,r,a)},t.prototype.shutdown=function(){var e,n;this.pageIntegration.shutdown(),this.contextManager.shutdown(),(e=this.osk)===null||e===void 0||e.shutdown(),this.core.languageProcessor.shutdown(),this.hardKeyboard.shutdown(),this.util.shutdown(),this.legacyAPIEvents.callEvent("unloaduserinterface",{}),(n=this.ui)===null||n===void 0||n.shutdown()},t}(zn),qr=Ao;var $r=document.getElementsByTagName("script"),el=$r[$r.length-1].src,Wo=el.substr(0,el.lastIndexOf("/")+1);window.keyman=new qr(kn.constructInstance(),Wo);})();
//# sourceMappingURL=keymanweb.es5.js.map

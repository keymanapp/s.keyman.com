(()=>{var b=Object.defineProperty;var f=(r,h)=>b(r,"name",{value:h,configurable:!0});function y(r,h,l,c){function u(t){return t instanceof l?t:new l(function(e){e(t)})}return f(u,"adopt"),new(l||(l=Promise))(function(t,e){function n(a){try{s(c.next(a))}catch(d){e(d)}}f(n,"fulfilled");function o(a){try{s(c.throw(a))}catch(d){e(d)}}f(o,"rejected");function s(a){a.done?t(a.value):u(a.value).then(n,o)}f(s,"step"),s((c=c.apply(r,h||[])).next())})}f(y,"__awaiter");var p,i=window.keyman;if(i){if(!(!((p=i.ui)===null||p===void 0)&&p.name))try{let r=i.util;if(r.isTouchDevice())throw"";let c=class c{constructor(){this.name="float",this.KeyboardSelector=null,this.outerDiv=null,this.innerDiv=null,this.oskButton=null,this.kbdIcon=null,this.selecting=!1,this.updateList=!0,this.updateTimer=0,this.floatRight=!1,this.initialized=!1,this.initTimer=0,this.toggleOSK=()=>{i.activatingUI(!0);let t=i.osk;return t&&t.show&&(t.isEnabled()?t.hide():t.show(!0)),window.event&&(window.event.returnValue=!1),i.focusLastActiveElement(),i.activatingUI(!1),!1},this.initialize=()=>{if(this.initTimer&&(window.clearTimeout(this.initTimer),this.initTimer=null),!i.initialized){this.initTimer=window.setTimeout(this.initialize,50);return}if(this.initialized||r.isTouchDevice())return;let t=r.getOption("resources")+"ui/float/";this.outerDiv=r.createElement("div"),this.innerDiv=r.createElement("div"),this.kbdIcon=r.createElement("img"),this.outerDiv.innerHTML="<a href='https://keyman.com/developer/keymanweb/' target='KeymanWebHelp'><img src='"+t+"kmicon.gif' border='0' style='padding: 0px 2px 0 1px; margin:0px;' title='KeymanWeb' alt='KeymanWeb' /></a>";let e=this.outerDiv.style;e.backgroundColor="white",e.border="solid 1px black",e.position="absolute",e.height="18px",e.font="bold 8pt sans-serif",e.display="none",e.textAlign="left",e.overflow="hidden",r.attachDOMEvent(this.outerDiv,"mousedown",this._SelectorMouseDown),r.attachDOMEvent(this.outerDiv,"mouseover",this._SelectorMouseOver),r.attachDOMEvent(this.outerDiv,"mouseout",this._SelectorMouseOut),this.registerEvents(),this.kbdIcon.src=t+"kbdicon.gif",this.kbdIcon.title="Display visual keyboard",this.oskButtonState(!1);let n=r.createElement("div");this.oskButton=n,n.onclick=this.toggleOSK,n.appendChild(this.kbdIcon),this.innerDiv.appendChild(n),this.outerDiv.appendChild(this.innerDiv),document.body.appendChild(this.outerDiv),this.KeyboardSelector=r.createElement("select"),e=this.KeyboardSelector.style,e.font="8pt sans-serif",e.backgroundColor="#f3e5de",e.border="solid 1px #7B9EBD",e.height="16px",e.margin="1px 2px 0px 2px",e.left="20px",e.top="0px",e.position="absolute",e.maxWidth="150px",r.attachDOMEvent(this.KeyboardSelector,"change",this.SelectKeyboardChange),r.attachDOMEvent(this.KeyboardSelector,"blur",this.SelectBlur),this.innerDiv.appendChild(this.KeyboardSelector);let o=r.getOption("ui"),s="(System keyboard)";o&&typeof o=="object"&&(typeof o.position=="string"&&o.position=="right"&&(this.floatRight=!0),typeof o.default=="string"&&(s=o.default));let a=r.createElement("option");a.value="-",a.innerHTML=s,this.KeyboardSelector.appendChild(a),a=null,this.initialized=!0,this.updateKeyboardList()},this._UnloadUserInterface=()=>{this.KeyboardSelector=this.innerDiv=this.outerDiv=this.kbdIcon=null},this.updateKeyboardList=()=>{if(this.updateList){this.initialized||this.initialize();let e=this.KeyboardSelector.getElementsByTagName("OPTION");for(let o=e.length;o>1;o--)this.KeyboardSelector.removeChild(e[o-1]);let n=i.getKeyboards();for(let o=0;o<n.length;o++){let s=r.createElement("option");if(s.value=n[o].InternalName+":"+n[o].LanguageCode,s.innerHTML=n[o].Name.replace(/\s?keyboard/i,""),n[o].LanguageName){let a=n[o].LanguageName;a=a.split(",")[0],n[o].Name.search(a)==-1&&(s.innerHTML=a+" ("+s.innerHTML+")")}this.KeyboardSelector.appendChild(s),s=null}}this.updateList=!1;let t=i.getSavedKeyboard().split(":");t.length<2&&(t[1]=""),this.updateMenu(t[0],t[1]),i.getLastActiveElement()&&(this.HideInterface(),this.ShowInterface())},this.updateMenu=(t,e)=>{let n=0;if(!this.initialized)return;let o=t;if(e!=""&&(o+=":"+e),t=="")this.KeyboardSelector.selectedIndex=0;else{let s=this.KeyboardSelector.getElementsByTagName("option");for(n=0;n<s.length;n++){let a=s[n].value;if(e==""&&(a=a.split(":")[0]),a==o){this.KeyboardSelector.selectedIndex=n;break}}}},this.oskButtonState=t=>{let e=this.kbdIcon.style;e.width="24px",e.height="13px",e.top="1px",e.verticalAlign="bottom",e.padding="2px 2px 1px 2px",e.position="absolute",e.border=t?"inset 1px #808080":"none",e.background=t?"#f7e7de":"white",e.display="block",this.initialized&&(this.oskButton.style.display="block")},this._SelectorMouseDown=t=>{i.activatingUI&&i.activatingUI(1)},this._SelectorMouseOver=t=>{i.activatingUI&&i.activatingUI(1)},this._SelectorMouseOut=t=>{i.activatingUI&&i.activatingUI(0)},this.SelectKeyboardChange=t=>y(this,void 0,void 0,function*(){if(i.activatingUI(!0),this.KeyboardSelector.value!="-"){let e=this.KeyboardSelector.selectedIndex,n=this.KeyboardSelector.options[e].value.split(":");yield i.setActiveKeyboard(n[0],n[1])}else yield i.setActiveKeyboard("");i.focusLastActiveElement(),i.activatingUI(!1),this.selecting=!0}),this.SelectBlur=t=>{this.selecting||i.focusLastActiveElement(),this.selecting=!1},this.ShowInterface=(t,e)=>{if(!this.initialized)return;let n=this.outerDiv.style;t&&e&&(n.left=t+"px",n.top=e+"px"),n.display="block",this.kbdIcon.style.left=this.KeyboardSelector.offsetWidth+24+"px",this.addButtonOSK(),this.updateMenu(i.getActiveKeyboard(),i.getActiveLanguage())},this.HideInterface=()=>{this.initialized&&(this.outerDiv.style.display="none")},this.addButtonOSK=()=>{if(this.oskButton!=null)if(i.isCJK()||this.KeyboardSelector.selectedIndex==0)this.oskButton.style.display="none",this.outerDiv.style.width=this.KeyboardSelector.offsetWidth+30+"px";else{this.oskButton.style.display="block";let t=i.osk;t?this.oskButtonState(t.isEnabled()):this.oskButtonState(!1),this.outerDiv.style.width=this.KeyboardSelector.offsetWidth+56+"px"}},this._Resize=t=>{if(this.outerDiv.style.display=="block"){let e=i.getLastActiveElement();this.floatRight?this.ShowInterface(r.getAbsoluteX(e)+e.offsetWidth+1,r.getAbsoluteY(e)+1):this.ShowInterface(r.getAbsoluteX(e)+1,r.getAbsoluteY(e)+e.offsetHeight+1)}return!0}}shutdown(){let t=this.outerDiv;t&&t.parentNode.removeChild(t),this._UnloadUserInterface(),window.removeEventListener&&window.removeEventListener("resize",this._Resize,!1)}registerEvents(){i.addEventListener("keyboardregistered",e=>{this.updateList=!0,this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=window.setTimeout(this.updateKeyboardList,200)}),i.addEventListener("keyboardloaded",e=>{let n=i.getSavedKeyboard().split(":");n.length>1&&this.updateMenu(n[0],n[1])}),i.addEventListener("keyboardchange",e=>{this.updateMenu(e.internalName,e.languageCode),this.addButtonOSK()});let t=i.osk;t&&(t.addEventListener("show",e=>(this.addButtonOSK(),e)),t.addEventListener("hide",e=>{this.initialized&&this.oskButtonState(!1)}))}};f(c,"UIFloat");let h=c,l=i.ui=new h;i.addEventListener("controlfocused",u=>((u.activeControl==null||u.activeControl._kmwAttachment)&&(l.floatRight?l.ShowInterface(r.getAbsoluteX(u.target)+u.target.offsetWidth+1,r.getAbsoluteY(u.target)+1):l.ShowInterface(r.getAbsoluteX(u.target),r.getAbsoluteY(u.target)-parseInt(r.getStyleValue(l.outerDiv,"height"),10)-2)),!0)),i.addEventListener("controlblurred",u=>(u.event&&(u.isActivating||l.HideInterface()),!0)),window.addEventListener&&window.addEventListener("resize",l._Resize,!1),l.initialize()}catch(r){}}else throw new Error("`keyman` global is missing; Keyman Engine for Web script has not been loaded");})();
//# sourceMappingURL=kmwuifloat.js.map

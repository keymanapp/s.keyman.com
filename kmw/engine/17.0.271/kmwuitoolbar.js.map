{
  "version": 3,
  "sources": [
    "node_modules/tslib/tslib.js",
    "common/web/tslib/src/index.ts",
    "web/src/app/ui/kmwuitoolbar.ts"
  ],
  "sourceRoot": "https://s.keyman.com/kmw/engine/17.0.271/src",
  "sourcesContent": [
    "/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global global, define, System, Reflect, Promise */\r\nvar __extends;\r\nvar __assign;\r\nvar __rest;\r\nvar __decorate;\r\nvar __param;\r\nvar __esDecorate;\r\nvar __runInitializers;\r\nvar __propKey;\r\nvar __setFunctionName;\r\nvar __metadata;\r\nvar __awaiter;\r\nvar __generator;\r\nvar __exportStar;\r\nvar __values;\r\nvar __read;\r\nvar __spread;\r\nvar __spreadArrays;\r\nvar __spreadArray;\r\nvar __await;\r\nvar __asyncGenerator;\r\nvar __asyncDelegator;\r\nvar __asyncValues;\r\nvar __makeTemplateObject;\r\nvar __importStar;\r\nvar __importDefault;\r\nvar __classPrivateFieldGet;\r\nvar __classPrivateFieldSet;\r\nvar __classPrivateFieldIn;\r\nvar __createBinding;\r\n(function (factory) {\r\n    var root = typeof global === \"object\" ? global : typeof self === \"object\" ? self : typeof this === \"object\" ? this : {};\r\n    if (typeof define === \"function\" && define.amd) {\r\n        define(\"tslib\", [\"exports\"], function (exports) { factory(createExporter(root, createExporter(exports))); });\r\n    }\r\n    else if (typeof module === \"object\" && typeof module.exports === \"object\") {\r\n        factory(createExporter(root, createExporter(module.exports)));\r\n    }\r\n    else {\r\n        factory(createExporter(root));\r\n    }\r\n    function createExporter(exports, previous) {\r\n        if (exports !== root) {\r\n            if (typeof Object.create === \"function\") {\r\n                Object.defineProperty(exports, \"__esModule\", { value: true });\r\n            }\r\n            else {\r\n                exports.__esModule = true;\r\n            }\r\n        }\r\n        return function (id, v) { return exports[id] = previous ? previous(id, v) : v; };\r\n    }\r\n})\r\n(function (exporter) {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n\r\n    \r\n\r\n    __assign = Object.assign || function (t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    /** @deprecated */\r\n    \r\n\r\n    /** @deprecated */\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n\r\n    \r\n    exporter(\"__assign\", __assign);\r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n});\r\n",
    "export * from '../../../../node_modules/tslib/tslib.js';\r\n\r\nexport * as tslib from '../../../../node_modules/tslib/tslib.js';",
    "/***\r\n   KeymanWeb 17.0\r\n   Copyright 2019-2023 SIL International\r\n***/\r\n\r\nimport type { KeymanEngine, KeyboardCookie, UIModule } from 'keyman/app/browser';\r\nimport { type StylesheetManager } from 'keyman/engine/dom-utils';\r\n\r\ndeclare var keyman: KeymanEngine\r\n\r\ntype MapRegion = {\r\n  /** The title of the region */\r\n  t: string,\r\n\r\n  /** The geometrical specification, in string form, for the region of the map to highlight */\r\n  m: string\r\n}\r\n\r\ntype ToolbarCookie = {\r\n  /**\r\n   * The two-letter code for the currently-selected map region\r\n   */\r\n  region: string;\r\n\r\n  /**\r\n   * The number of encoded 'recent'-keyboard entries enumerated within the cookie.\r\n   */\r\n  maxrecent: number;\r\n} & Record<`recent${number}`, string>;\r\n\r\ntype KeyboardDetail = ReturnType<KeymanEngine['_GetKeyboardDetail']>;\r\n\r\ntype LanguageEntry = {\r\n  /** Language id */\r\n  id: string;\r\n\r\n  /** Language ID */\r\n  name: string;\r\n\r\n  /**\r\n   * A rich list of keyboard metadata for keyboards matching this language's language code (`id`).\r\n   */\r\n  keyboards: KeyboardDetail[];\r\n}\r\n\r\n// If a UI module has been loaded, we can rely on the publically-published 'name' property\r\n// having been set as a way to short-out a UI reload.  Its parent object always exists by\r\n// this point in the build process.\r\nif(!keyman?.ui?.name) {\r\n  /********************************/\r\n  /*                              */\r\n  /* Toolbar User Interface       */\r\n  /*                              */\r\n  /********************************/\r\n\r\n  /**\r\n   * Do not enclose in an anonymous function, as the compiler may create\r\n   * global scope variables to replace true, false, null, which can collide\r\n   * with other variables.\r\n   * Instead, use the --output-wrapper command during optimization, which will\r\n   * add the anonymous function to enclose all code, including those optimized\r\n   * variables which would otherwise have global scope.\r\n   **/\r\n\r\n  try {\r\n    // Declare KeymanWeb, OnScreen keyboard and Util objects\r\n    const keymanweb=keyman;\r\n    const util=keymanweb.util;\r\n\r\n    // Disable UI for touch devices\r\n    if(util.isTouchDevice()) {\r\n      throw '';\r\n    }\r\n\r\n    let controller = document.getElementById('KeymanWebControl');\r\n\r\n    // User interface local variables\r\n    class ToolbarUI implements UIModule {\r\n      init = false;\r\n\r\n      toolbarNode: HTMLDivElement = null;\r\n      backgroundNode = null;\r\n      browseMapNode: HTMLDivElement = null;\r\n      keyboardsButtonNode: HTMLDivElement = null;\r\n      languageButtonsNode: HTMLDivElement = null;\r\n      offButtonNode: HTMLDivElement = null;\r\n      offBarNode: HTMLDivElement = null;\r\n      oskButtonNode: HTMLDivElement = null;\r\n      oskBarNode: HTMLDivElement = null;\r\n      selectorNode: HTMLDivElement = null;\r\n      regionLanguageListNodes: Record<string, HTMLDivElement> = {};\r\n      regionsNode: HTMLDivElement = null;\r\n      regionNodes = null;\r\n      langKeyboardNodes = [];\r\n      langKeyboardListNodes = [];\r\n      selectedRegion = 'as';\r\n\r\n      /**\r\n       * Tracks a list of recently-selected keyboards.\r\n       *\r\n       * This list may be used to pick the most-recent **and** still-available keyboard upon\r\n       * page refresh.  (If either condition isn't met, it's ignored and the next in line\r\n       * is checked until one is found that meets both conditions.)\r\n       */\r\n      listedKeyboards = [];\r\n      catchAllRegion = 'un';\r\n\r\n      /**\r\n       * A seed value for tracking listedKeyboards entry 'age'; smaller values = older, as this\r\n       * seed is incremented on each keyboard change.\r\n       */\r\n      keyboardListPriority = 0;\r\n\r\n      /**\r\n       * The maximum length of the `listedKeyboards` array; once this length is reached, addition\r\n       * of a new entry will result in pruning the oldest in the list, as with a cache.\r\n       */\r\n      maxListedKeyboards = 1;\r\n      lastActiveControl = null;\r\n      selectedKeyboard: KeyboardDetail = null;\r\n      selectedLanguage = '';\r\n      helpOffsetX = 0;\r\n      helpOffsetY = 0;\r\n\r\n      keyboardsForLangPopup = null;\r\n      lastSelectedKeyboard = null;\r\n\r\n      regions: Record<string, MapRegion>;\r\n\r\n      /**\r\n       * If no prior KeymanWebControl element exists, the Toolbar UI will generate its own\r\n       * during initialization and insert it.  That reference is stored here so that we may\r\n       * remove it later if/when `.shutdown()` is called.\r\n       */\r\n      _insertedElem: HTMLElement;\r\n\r\n      /**\r\n       * associative-array of objects { id: <langid>, name: <name>, keyboards: <array of KeymanWeb keyboards> }\r\n       */\r\n      languages: Record<string, LanguageEntry> = {};\r\n\r\n      /**\r\n       * flag to control re-initialization of keyboard map\r\n       */\r\n      updateMap = false;\r\n\r\n      /**\r\n       * initialization timer - wait 2 seconds after last stub installed then initialize map\r\n       */\r\n      startTimer = 0;\r\n\r\n      /**\r\n       * language name in toolbar\r\n       */\r\n      lgText = ''\r\n\r\n      readonly name = 'toolbar';\r\n\r\n      /**\r\n       * Appears to be the i18n/l10n setup for the KMW Toolbar UI.\r\n       */\r\n      ToolBar_Text = {\r\n        Keyboards: 'Languages',\r\n        OffTitle: 'Turn off KeymanWeb keyboards',\r\n        Off: 'Off',\r\n        ShowOSK: 'Show On Screen Keyboard',\r\n        LanguageSelector: 'Select language',\r\n\r\n        SelectKeyboardPre: 'Select ',\r\n        SelectKeyboardSuf: 'keyboard',\r\n        AltKeyboardsPre: 'Alternate keyboards for ',\r\n        AltKeyboardsSuf: '',\r\n\r\n        ca: 'Central America',\r\n        sa: 'South America',\r\n        na: 'Americas',\r\n        eu: 'Europe',\r\n        af: 'Africa',\r\n        un: 'Undetermined',\r\n        as: 'Asia',\r\n        oc: 'Oceania'\r\n      };\r\n\r\n      /**\r\n       * Create some of the controls but don't insert them into the document yet\r\n       * This does not need or want to prevent loss of focus, so uses document.createElement\r\n       * rather than util.createElement.\r\n       *\r\n       * @param       {string}  tag\r\n       * @param       {?string=}  id\r\n       * @param       {?string=}  className\r\n       * @param       {string=}  innerHTML\r\n       * @return      {Node|null}\r\n       */\r\n      private createNode<E extends keyof HTMLElementTagNameMap>(tag: E, id?: string, className?: string, innerHTML?: string) {\r\n        const node = document.createElement(tag);\r\n        if(id) {\r\n          node.id = id;\r\n        }\r\n        if(className) {\r\n          node.className = className;\r\n        }\r\n        if(innerHTML) {\r\n          node.innerHTML = innerHTML;\r\n        }\r\n\r\n        // The following is OK for IE and for F3.5 and later - should simply be ignored for others\r\n        // first tried preventDefault() as suggested by many on web, which worked but interfered with keyboard and OSK enabling\r\n        if(tag == 'a' || tag == 'area' || tag == 'map') {\r\n          node.ondragstart = () => false;\r\n        }\r\n        return node;\r\n      }\r\n\r\n      /**\r\n       * Initialize toolbar UI\r\n       */\r\n      initialize() {\r\n        if(!keymanweb.initialized || this.init) {\r\n          return;\r\n        }\r\n\r\n        // Find the controller DIV, insert at top of body if undefined\r\n        let e = document.getElementById('KeymanWebControl');\r\n        if(!e) {\r\n          if(document.body == null) {\r\n            return;\r\n          } else {\r\n            e = document.createElement('div');\r\n            e.id = 'KeymanWebControl';\r\n            document.body.insertBefore(e, document.body.firstChild);\r\n            this._insertedElem = e;\r\n          }\r\n        }\r\n\r\n        // Hide toolbar until elements fully drawn, to prevent spurious text displays\r\n        e.style.visibility='hidden';\r\n        e.style.maxHeight='35px';\r\n\r\n        this.init = true;\r\n\r\n        if(util.isTouchDevice()) {\r\n          return;\r\n        }\r\n\r\n        this.regions = {};\r\n        //ui.regions['ca'] = {t: ui.ToolBar_Text['ca'], m: '49,52,65,54,68,57,71,56,73,59,75,60,93,61,94,58,97,58,101,59,107,60,114,64,115,68,114,77,104,74,98,75,96,78,95,82,90,81,85,80,82,76,78,74,74,73,65,68,57,61' },\r\n        //ui.regions['sa'] = {t: ui.ToolBar_Text['sa'], m: '82,82,95,82,96,78,98,75,104,74,114,77,120,79,124,83,126,87,141,90,142,97,138,103,135,113,127,116,123,124,115,131,112,132,109,138,117,139,140,141,141,146,134,148,114,145,109,148,100,148,91,143,91,130,96,111,89,102,83,95,77,89' },\r\n        this.regions['na'] = {t: this.ToolBar_Text['na'], m: '0,3,0,37,24,32,35,37,43,47,49,52,65,54,68,57,71,56,73,59,75,60,93,61,93,57,103,49,118,41,126,41,136,23,148,17,156,14,164,5,164,0,57,0,35,5,25,9,5,8,49,52,65,54,68,57,71,56,73,59,75,60,93,61,94,58,97,58,101,59,107,60,114,64,115,68,114,77,104,74,98,75,96,78,95,82,90,81,85,80,82,76,78,74,74,73,65,68,57,61,82,82,95,82,96,78,98,75,104,74,114,77,120,79,124,83,126,87,141,90,142,97,138,103,135,113,127,116,123,124,115,131,112,132,109,138,117,139,140,141,141,146,134,148,114,145,109,148,100,148,91,143,91,130,96,111,89,102,83,95,77,89' },\r\n        this.regions['eu'] = {t: this.ToolBar_Text['eu'], m: '145,29,146,19,158,14,171,6,187,2,206,1,217,4,227,11,231,16,231,33,227,34,225,35,225,37,227,39,228,44,228,47,227,48,223,46,218,44,215,43,208,43,203,45,202,48,205,52,201,52,195,49,189,50,187,48,177,48,175,49,166,50,147,33' },\r\n        this.regions['af'] = {t: this.ToolBar_Text['af'], m: '150,58,158,50,166,50,175,49,177,48,187,48,189,50,195,49,201,52,205,52,207,53,221,75,229,75,231,77,231,85,227,92,232,101,237,106,237,112,227,115,222,118,206,125,199,127,193,127,185,111,183,104,180,87,168,89,153,85,143,71,147,60' },\r\n        this.regions['as'] = {t: this.ToolBar_Text['as'], m: '219,1,221,6,228,12,231,16,231,33,227,34,225,35,225,37,227,39,229,45,232,48,239,48,240,49,239,53,242,60,243,65,249,70,252,81,259,87,271,87,278,95,289,100,303,101,311,98,320,98,323,98,323,84,311,81,308,73,307,65,317,57,330,50,334,44,348,36,364,38,375,34,375,8,355,8,336,5,292,1,285,0,219,0' },\r\n        this.regions['oc'] = {t: this.ToolBar_Text['oc'], m: '288,117,289,107,303,101,311,98,323,98,323,84,333,77,344,73,362,80,369,88,375,96,375,141,352,143,323,142,316,136,310,130,291,130' }\r\n        this.regions['un'] = {t: this.ToolBar_Text['un'], m: '205,52,202,48,203,45,208,43,215,43,218,44,223,46,227,48,232,48,239,48,240,49,239,53,242,60,243,65,237,76,231,77,229,75,221,75,207,53' },\r\n\r\n        this.toolbarNode = this.createNode('div', 'kmw_controls');\r\n        this.toolbarNode.style.display='block';\r\n\r\n        util.linkStyleSheet(util.getOption('resources')+'ui/toolbar/kmwuitoolbar.css');\r\n\r\n        const tbNode = this.createNode('a', 'kmw_controls_start', null, ' ');\r\n        tbNode.href = \"https://keyman.com/developer/keymanweb/\";\r\n        tbNode.target=\"_blank\";\r\n        this.toolbarNode.appendChild(tbNode);\r\n\r\n        /* Keyboards button */\r\n        this.keyboardsButtonNode = this.createNode('div','kmw_btn_keyboards','kmw_button');\r\n        this.keyboardsButtonNode.title=this.ToolBar_Text.LanguageSelector;\r\n        let aNode = this.createNode('a', null, 'kmw_button_a');\r\n        aNode.href='#';\r\n        aNode.onclick = this.showKeyboardsPopup;\r\n        aNode.appendChild(this.createNode('div', 'kmw_img_keyboards', 'kmw_img'));\r\n        aNode.appendChild(this.createNode('div', null, 'kmw_a', this.ToolBar_Text.Keyboards));\r\n        aNode.appendChild(this.createNode('div', null, 'kmw_drop'));\r\n        this.keyboardsButtonNode.appendChild(aNode);\r\n\r\n        /* Keyboards popup */\r\n        this.selectorNode = this.createNode('div', 'kmw_selector');\r\n        this.regionsNode = this.createNode('div', 'kmw_selector_regions');\r\n\r\n        this.browseMapNode = this.createNode('div', 'kmw_browsemap');\r\n        const imgNode = this.createNode('img', 'kmw_region_browsemap');\r\n        imgNode.src= util.getOption('resources')+'ui/toolbar/blank.gif';\r\n        imgNode.useMap = '#kmw_worldgrey16';\r\n        this.browseMapNode.appendChild(imgNode);\r\n\r\n        const mapNode = this.createNode('map', 'kmw_worldgrey16');\r\n        mapNode.name='kmw_worldgrey16';\r\n        for(let i in this.regions) {\r\n          const areaNode = this.createNode('area');\r\n          areaNode.shape = 'poly';\r\n          areaNode.alt = '';\r\n          areaNode.href = '#';\r\n          areaNode.title = this.regions[i].t;\r\n          areaNode['hidefocus'] = 'true';\r\n          areaNode.onclick =     ((i) => { return (event) => this.selectRegion(event, i);  })(i);\r\n          areaNode.onmouseover = ((i) => { return (event) => this.hoverRegion(event, i);   })(i);\r\n          areaNode.onmouseout =  ((i) => { return (event) => this.unhoverRegion(event, i); })(i);\r\n          areaNode.coords = this.regions[i].m;\r\n          mapNode.appendChild(areaNode);\r\n        }\r\n\r\n        const areaNode = this.createNode('area');\r\n        areaNode.shape = 'default';\r\n        areaNode.noHref = true;\r\n        areaNode.alt = '';\r\n        areaNode.onclick=this.eventCapture;   // do not close map when clicking on ocean!\r\n        mapNode.appendChild(areaNode);\r\n        this.browseMapNode.appendChild(mapNode);\r\n        this.regionsNode.appendChild(this.browseMapNode);\r\n        this.regionNodes = {};\r\n\r\n        const listNode = this.createNode('ul');\r\n        for(let i in this.regions) {\r\n          const itemNode = this.createNode('li');\r\n          this.regionNodes[i] = this.createNode('a', null, null, this.regions[i].t);\r\n          this.regionNodes[i].href='#';\r\n          this.regionNodes[i].onclick = ((i) =>     { return (event) => this.selectRegion(event, i);  })(i);\r\n          this.regionNodes[i].onmouseover = ((i) => { return (event) => this.hoverRegion(event, i);   })(i);\r\n          this.regionNodes[i].onmouseout = ((i) =>  { return (event) => this.unhoverRegion(event, i); })(i);\r\n          itemNode.appendChild(this.regionNodes[i]);\r\n          listNode.appendChild(itemNode);\r\n        }\r\n        this.regionsNode.appendChild(listNode);\r\n        this.selectorNode.appendChild(this.regionsNode);\r\n        this.keyboardsButtonNode.appendChild(this.selectorNode);\r\n        this.toolbarNode.appendChild(this.keyboardsButtonNode);\r\n\r\n        // Separator and Keyboard Off Button\r\n        this.toolbarNode.appendChild(this.offBarNode = this.createNode('div', 'kmw_bar_off', 'kmw_bar'));\r\n\r\n        this.offButtonNode = this.createNode('div', 'kmw_btn_off', 'kmw_button_selected');\r\n\r\n        // Re-used variable!\r\n        aNode = this.createNode('a', null, 'kmw_button_a');\r\n        aNode.href = '#';\r\n        aNode.onclick = this.offButtonClickEvent;\r\n        aNode.title = this.ToolBar_Text.OffTitle;\r\n        aNode.appendChild(this.createNode('div', 'kmw_img_off', 'kmw_img'));\r\n        aNode.appendChild(this.createNode('div', null, 'kmw_a', this.ToolBar_Text.Off));\r\n        this.offButtonNode.appendChild(aNode);\r\n        this.toolbarNode.appendChild(this.offButtonNode);\r\n\r\n        // Keyboard buttons\r\n        this.toolbarNode.appendChild(this.languageButtonsNode = this.createNode('div', 'kmw_control_keyboards', 'kmw_button'));\r\n\r\n        // Separator and On Screen Keyboard Button\r\n        this.toolbarNode.appendChild(this.oskBarNode = this.createNode('div', 'kmw_bar_osk', 'kmw_bar'));\r\n\r\n        this.oskButtonNode = this.createNode('div', 'kmw_btn_osk', 'kmw_button');//was 'kmw_button_selected'\r\n\r\n        // Re-used variable!\r\n        aNode = this.createNode('a', null, 'kmw_button_a');\r\n        aNode.href = '#';\r\n        aNode.onclick = this.showOSK;\r\n        aNode.onmousedown = function() {\r\n          keymanweb.activatingUI(true);\r\n        };\r\n        aNode.title = this.ToolBar_Text.ShowOSK;\r\n        aNode.appendChild(this.createNode('div', 'kmw_img_osk', 'kmw_img'));\r\n        //aNode.appendChild(ui.createNode('div', null, 'kmw_a', 'On Screen Keyboard'));\r\n        this.oskButtonNode.appendChild(aNode);\r\n        this.toolbarNode.appendChild(this.oskButtonNode);\r\n\r\n        this.toolbarNode.appendChild(this.createNode('div', 'kmw_controls_end', null, ' '));\r\n\r\n        const img = this.createNode('div');\r\n        img.id = 'kmw_map_preload';\r\n        this.toolbarNode.appendChild(img);\r\n\r\n        this.toolbarNode.appendChild(this.createNode('br', null, 'kmw_clear'));\r\n\r\n        // Append toolbar node to controller\r\n        e.appendChild(this.toolbarNode);\r\n\r\n        // Initialize map array, using a timer to allow restarting if necessary after keyboards loaded\r\n        // Note that toolbar will be displayed and enabled on completion of timeout routine\r\n        this.updateMap = true;\r\n        if(this.startTimer) {\r\n          clearTimeout(this.startTimer);\r\n        }\r\n        this.startTimer = window.setTimeout(this.addKeyboardsToMap, 0);\r\n\r\n        // Ensure that popups are hidden by clicking elsewhere on document\r\n        util.attachDOMEvent(document.body,'click', this.hideAllPopups, false);\r\n\r\n        // Set Europe to be the default region\r\n        this.selectedRegion = 'eu';\r\n\r\n        this.registerEvents();\r\n\r\n        // Restore focus\r\n        keymanweb.focusLastActiveElement();\r\n      }\r\n\r\n      shutdown() {\r\n        let root: HTMLElement = this.toolbarNode;\r\n        if(root) {\r\n          root.parentNode.removeChild(root);\r\n        }\r\n\r\n        root = this._insertedElem;\r\n        if(root) {\r\n          root.parentNode.removeChild(root);\r\n        }\r\n      }\r\n\r\n      /**\r\n       * Fill the map with available keyboards when the Keyboards selector is clicked\r\n       *    after all keyboard stubs have been registered\r\n      **/\r\n      readonly addKeyboardsToMap = () => {\r\n        // Do nothing unless a keyboard has been installed since map created\r\n        if(this.updateMap) {\r\n          this.updateMap=false;\r\n        } else {\r\n          return;\r\n        }\r\n\r\n        this.regionLanguageListNodes = {};\r\n\r\n        // Build list of keyboards by region and language\r\n        let Keyboards = keymanweb.getKeyboards();\r\n\r\n        // Sort the keyboards by region and language\r\n        Keyboards.sort(this.sortKeyboards);\r\n\r\n        // Always rebuild the map, so remove any previously created language lists\r\n        let n=0;\r\n        for(n=this.regionsNode.children.length; n>0; n--) {\r\n          if(this.regionsNode.children[n-1].className == 'kmw_selector_region') {\r\n            this.regionsNode.removeChild(this.regionsNode.childNodes[n-1]);\r\n          }\r\n        }\r\n\r\n        for(let i in this.regions) {\r\n          this.regionLanguageListNodes[i] = this.createNode('div', null, 'kmw_selector_region');\r\n          let colNode = this.createNode('div', null, 'kmw_keyboard_col');\r\n          var max = 0, count = 0, languageCode = '';\r\n\r\n          // Get number of languages for the region\r\n          for(let j=0; j<Keyboards.length; j++) {\r\n            // REVERT:  ensures that keyboards without visible map region get displayed SOMEWHERE.\r\n            var kbdRegion = Keyboards[j].RegionCode;\r\n            if(!this.regions[kbdRegion]) {\r\n              // For now, we'll display them within the 'middle-east' region.\r\n              if(i != this.catchAllRegion) {\r\n                continue;\r\n              }\r\n            } else if(kbdRegion != i) {\r\n              continue; // Not this region\r\n            }\r\n\r\n            // Get JUST the language code for this section.  BCP-47 codes can include more!\r\n            var bcpSubtags: string[] = keymanweb.util.getLanguageCodes(Keyboards[j].LanguageCode);\r\n            if(bcpSubtags[0] == languageCode) {\r\n              continue; // Same language as previous keyboard\r\n            }\r\n            languageCode = bcpSubtags[0];\r\n\r\n            max++;\r\n          }\r\n          max = Number(((max+3)/4).toFixed(0));   // Get number of entries per column\r\n\r\n          // Add language list to columns for the region\r\n          languageCode='';\r\n          for(let j=0; j<Keyboards.length; j++) {\r\n            // REVERT:  ensures that keyboards without visible map region get displayed SOMEWHERE.\r\n            const kbdRegion = Keyboards[j].RegionCode;\r\n            if(!this.regions[kbdRegion]) {\r\n              // For now, we'll display them within the 'middle-east' region.\r\n              if(i != this.catchAllRegion) {\r\n                continue;\r\n              }\r\n            } else if(kbdRegion != i) {\r\n              continue; // Not this region\r\n            }\r\n\r\n            var bcpSubtags: string[] = keymanweb.util.getLanguageCodes(Keyboards[j].LanguageCode);\r\n            if(bcpSubtags[0] == languageCode) {  // Same language as previous keyboard, so add it to that entry\r\n              var x = this.languages[languageCode].keyboards;\r\n\r\n              // While we could avoid duplicating keyboard entries that occur for multiple regions, we'll instead\r\n              // allow them to display while distinguishing them more directly.  (That part is handled later.)\r\n              if(x.push) {\r\n                x.push(Keyboards[j]);\r\n              } else {\r\n                this.languages[languageCode].keyboards = x.concat(Keyboards[j]);\r\n              }\r\n\r\n              continue;\r\n            }\r\n\r\n            // Add a new language entry\r\n            languageCode = bcpSubtags[0];\r\n            this.languages[languageCode] = {\r\n              id: Keyboards[j].LanguageCode,\r\n              name: Keyboards[j].LanguageName,\r\n              keyboards: [Keyboards[j]]\r\n            };\r\n\r\n            // Start a new column if necessary\r\n            if(count % max == 0 && count > 0) {\r\n              this.regionLanguageListNodes[i].appendChild(colNode);\r\n              colNode = this.createNode('div', null, count/max == 3 ? 'kmw_keyboard_col_right' : 'kmw_keyboard_col');\r\n            }\r\n            count++;\r\n\r\n            // Add the language to the column\r\n            const langNode = this.createNode('div', null, 'kmw_language');\r\n            const aNode = this.createNode('a', null, null, Keyboards[j].LanguageName);\r\n            aNode.href='#';\r\n            aNode.onclick = ((lang) => {\r\n              return (event) => this.selectLanguage(event, lang);\r\n            }) (this.languages[languageCode]);\r\n\r\n            langNode.appendChild(aNode);\r\n            colNode.appendChild(langNode);\r\n\r\n            // This is almost certainly an irrelevant code line; nothing seems to reference it here.\r\n            n++;\r\n          }\r\n          // Finish the last column and close the list\r\n          this.regionLanguageListNodes[i].appendChild(colNode);\r\n          this.regionLanguageListNodes[i].appendChild(this.createNode('div', null, 'kmw_clear'));\r\n          this.regionsNode.appendChild(this.regionLanguageListNodes[i]);\r\n        }\r\n        this.loadCookie();\r\n\r\n        // Ensure that the correct region has been selected\r\n        this.selectRegion(null, this.selectedRegion);\r\n        this.enableControls();\r\n\r\n        // When a keyboard is activated before init is complete,\r\n        // the toolbar needs to refresh the loaded keyboard\r\n        if(this.lastSelectedKeyboard) {\r\n          this.changeKeyboardEvent(this.lastSelectedKeyboard);\r\n        }\r\n\r\n        // Restore focus\r\n        keymanweb.focusLastActiveElement();\r\n      }\r\n\r\n      /**\r\n       * Sort keyboards array returned from keymanweb by region and language\r\n       *\r\n       * @param       {Object}  a\r\n       * @param       {Object}  b\r\n       * @return      {number}\r\n       **/\r\n      readonly sortKeyboards = function(a: KeyboardDetail, b: KeyboardDetail) {\r\n        if(a.RegionCode < b.RegionCode) {\r\n          return -2;\r\n        }\r\n\r\n        if(a.RegionCode > b.RegionCode) {\r\n          return 2;\r\n        }\r\n\r\n        if(a.LanguageName < b.LanguageName) {\r\n          return -1;\r\n        }\r\n\r\n        if(a.LanguageName > b.LanguageName) {\r\n          return 1;\r\n        }\r\n\r\n        return 0;\r\n      }\r\n\r\n      /* KeymanWeb Interfaces */\r\n\r\n      /**\r\n       * Function     findListedKeyboard\r\n       * Scope        Private\r\n       * @param       {Object}  lang\r\n       * @return      {?number}\r\n       * Description  Test if a keyboard is still shown on the toolbar.  Returns index of keyboard in listedKeyboards or null if not found\r\n       */\r\n      findListedKeyboard(lang: LanguageEntry | string) {\r\n        if(typeof lang != 'string') {\r\n          lang = lang.id;\r\n        }\r\n        for(let i = 0; i < this.listedKeyboards.length; i++) {\r\n          if(this.listedKeyboards[i].lang.id == lang) {\r\n            return i;\r\n          }\r\n        }\r\n\r\n        return null;\r\n      }\r\n\r\n      /**\r\n       * Add a keyboard to the list of keyboards available for a language\r\n       *\r\n       * @param       {Object}  lang\r\n       * @param       {Object}  kbd\r\n       **/\r\n      addKeyboardToList(lang: LanguageEntry, kbd: KeyboardDetail) {\r\n        let found = this.findListedKeyboard(lang);\r\n        if(found == null) {\r\n          // Add the button\r\n          if(this.listedKeyboards.length >= this.maxListedKeyboards) {\r\n            let oldestPriority = 0x7fffffff, oldestFound = null;\r\n\r\n            for(let i = 0; i < this.listedKeyboards.length; i++) {\r\n              if(this.listedKeyboards[i].priority < oldestPriority) {\r\n                oldestFound = i;\r\n                oldestPriority = this.listedKeyboards[i].priority;\r\n              }\r\n            }\r\n\r\n            // delete the oldest used control\r\n            if(oldestFound != null) {\r\n              let rk = this.listedKeyboards[oldestFound];\r\n              this.langKeyboardListNodes[rk.lang.id] = null;\r\n              this.langKeyboardNodes[rk.lang.id] = null;\r\n              this.languageButtonsNode.removeChild(rk.buttonNode);\r\n              if(oldestFound == 0) {\r\n                this.listedKeyboards = this.listedKeyboards.slice(oldestFound + 1);\r\n              } else if(oldestFound == this.listedKeyboards.length - 1) {\r\n                this.listedKeyboards = this.listedKeyboards.slice(0, oldestFound);\r\n              } else {\r\n                this.listedKeyboards = this.listedKeyboards.slice(0, oldestFound).concat(this.listedKeyboards.slice(oldestFound+1));\r\n              }\r\n            }\r\n          }\r\n          let buttonNode = this.createNode('div', null/*'kmw_button_keyboard_'+lang.id*/, 'kmw_button');\r\n          let aNode = this.createNode('a', null, 'kmw_button_a'+(lang.keyboards.length>1 ? ' kmw_norightgap' : ''));\r\n          aNode.href='#';\r\n\r\n          let p1=this.ToolBar_Text['SelectKeyboardPre'] + kbd.Name;\r\n          let p2=this.ToolBar_Text['SelectKeyboardSuf'];\r\n          if(p1.toLowerCase().indexOf(p2.toLowerCase()) < 0) {\r\n            p1=p1+' '+ p2;\r\n          }\r\n          aNode.title = p1;\r\n          aNode.onclick = (event) => this.selectLanguage(event, lang);\r\n          aNode.appendChild(this.createNode('div', 'kmw_img_kbd', 'kmw_img'));\r\n\r\n          this.lgText=this.truncate(lang.name,28);\r\n          aNode.appendChild(this.createNode('div', null, 'kmw_a', this.lgText));\r\n          buttonNode.appendChild(aNode);\r\n\r\n          let thisANode = aNode;\r\n\r\n          if(lang.keyboards.length > 1) {\r\n            aNode = this.createNode('a', null, 'kmw_button_a kmw_noleftgap');\r\n            aNode.href = '#';\r\n            aNode.title = this.ToolBar_Text['AltKeyboardsPre']+lang.name + this.ToolBar_Text['AltKeyboardsSuf'];\r\n            aNode.onclick = (event) => this.showKeyboardsForLanguage(event, lang);\r\n            let divNode = this.createNode('div', null, 'kmw_a');\r\n            let kbdText = this.truncate(kbd.Name.replace(/\\s?keyboard/i,''),40-this.lgText.length);\r\n            divNode.appendChild(this.langKeyboardNodes[lang.id] = this.createNode('span', null, 'kmw_kbd', kbdText));\r\n            aNode.appendChild(divNode);\r\n            aNode.appendChild(this.createNode('div', null, 'kmw_drop'));\r\n            buttonNode.appendChild(aNode);\r\n\r\n            this.langKeyboardListNodes[lang.id] = this.createNode('ul', null, 'kmw_selector_kbd');\r\n            this.langKeyboardListNodes[lang.id].style.display='none';\r\n\r\n            for(let n in lang.keyboards) {\r\n              let itemNode = this.createNode('li');\r\n              kbdText = lang.keyboards[n].Name.replace(/\\s?keyboard/i,'');\r\n              // We append the full BCP-47 code here for disambiguation when regional and/or script variants exist.\r\n              kbdText = kbdText + \" [\" + lang.keyboards[n].LanguageCode + \"]\";\r\n              aNode = this.createNode('a', null, null, kbdText);\r\n              aNode.href = '#';\r\n              aNode.title = '';\r\n              aNode.onclick = ((lang, kbd) => {\r\n                return (event) => this.selectKeyboard(event, lang, kbd, true);\r\n              })(lang, lang.keyboards[n]);\r\n\r\n              itemNode.appendChild(aNode);\r\n              this.langKeyboardListNodes[lang.id].appendChild(itemNode);\r\n            }\r\n            buttonNode.appendChild(this.langKeyboardListNodes[lang.id]);\r\n          }\r\n\r\n          this.languageButtonsNode.appendChild(buttonNode);\r\n\r\n          let thisLang = lang, thisButtonNode = buttonNode;\r\n          this.listedKeyboards.push({priority: this.keyboardListPriority++, lang:thisLang, keyboard:kbd, buttonNode:thisButtonNode, aNode:thisANode});\r\n        } else {\r\n          this.listedKeyboards[found].priority = this.keyboardListPriority++;\r\n          this.listedKeyboards[found].keyboard = kbd;\r\n          let e = this.langKeyboardNodes[lang.id];\r\n          if(e) {\r\n            var kbdText=kbd.Name.replace(/\\s?keyboard/i,'');\r\n            e.innerHTML = this.truncate(kbdText,40-this.lgText.length);\r\n          }\r\n\r\n          if(this.listedKeyboards[found].aNode) {\r\n            let p1 = this.ToolBar_Text['SelectKeyboardPre']+kbd.Name;\r\n            let p2 = this.ToolBar_Text['SelectKeyboardSuf'];\r\n            if(p1.toLowerCase().indexOf(p2.toLowerCase()) < 0) {\r\n              p1=p1+' '+ p2;\r\n            }\r\n\r\n            this.listedKeyboards[found].aNode.title = p1;\r\n          }\r\n        }\r\n      }\r\n\r\n      /**\r\n       *  Truncate a long name and add an ellipsis\r\n       *\r\n       *  @param  {string}  PName   string that may need to be truncated\r\n       *  @param  {number}  PLen    max non-truncated length\r\n       *  @return {string}          string, truncated with ellipsis if necessary\r\n       *\r\n       **/\r\n      truncate(PName: string, PLen: number) {\r\n        if(PName.length <=PLen) {\r\n          return PName;\r\n        }\r\n\r\n        return PName.substr(0,PLen-1)+'\\u2026';\r\n      }\r\n\r\n      /**\r\n       * Rebuild the entire keyboard list whenever a keyboard is installed\r\n       * (without necessarily loading the keyboard)\r\n       **/\r\n      readonly registerKeyboard = () => {\r\n        this.updateMap = true;\r\n        if(this.startTimer) {\r\n          clearTimeout(this.startTimer);\r\n        }\r\n\r\n        this.startTimer = window.setTimeout(this.addKeyboardsToMap, 0);\r\n      }\r\n\r\n      /**\r\n       * Function     hideKeyboardsForLanguage\r\n       * Scope        Private\r\n       * @param       {Object}  event\r\n       * @return      {boolean}\r\n       * Description  Hide the list of keyboards for this language\r\n       **/\r\n      readonly hideKeyboardsForLanguage = (event: Event) => {\r\n        var e = this.keyboardsForLangPopup;\r\n        if(e) {\r\n          e.style.display='none';\r\n        }\r\n        this.CancelPopupDismissal(this.hideKeyboardsForLanguage);\r\n        return this.eventCapture(event);\r\n      }\r\n\r\n      /**\r\n       * Display the list of keyboards for this language\r\n       *\r\n       * @param       {Object}  event\r\n       * @param       {Object}  lang\r\n       * @return      {boolean}\r\n       *\r\n       **/\r\n      readonly showKeyboardsForLanguage = (event: Event, lang: LanguageEntry) => {\r\n        this.hideKeyboardsPopup(event);\r\n        const e = this.langKeyboardListNodes[lang.id];\r\n        if(e) {\r\n          if(e.style.display=='block') {\r\n            return this.hideKeyboardsForLanguage(event);\r\n          }\r\n\r\n          e.style.display='block';\r\n          this.keyboardsForLangPopup = e;\r\n          this.SetupPopupDismissal(e, this.hideKeyboardsForLanguage);\r\n        }\r\n        return this.eventCapture(event);\r\n      }\r\n\r\n      /**\r\n       * Select the language, and either select the keyboard (if unique) or display the list of keyboards\r\n       * available for this language\r\n       *\r\n       * @param       {Object}  event\r\n       * @param       {Object}  lang\r\n       * @return      {boolean}\r\n       **/\r\n      selectLanguage(event: Event, lang: LanguageEntry) {\r\n        let found = this.findListedKeyboard(lang);\r\n        let kbd: KeyboardDetail = null;\r\n\r\n        if(found == null) {\r\n          kbd = lang.keyboards[0];\r\n        } else {\r\n          kbd = this.listedKeyboards[found].keyboard;\r\n        }\r\n\r\n        if(!kbd) {\r\n          return false;\r\n        }\r\n\r\n        return this.selectKeyboard(event, lang, kbd, true);\r\n      }\r\n\r\n\r\n      /**\r\n       * Enable a selected keyboard\r\n       *\r\n       * @param       {Object}  event\r\n       * @param       {Object}  lang\r\n       * @param       {Object}  kbd\r\n       * @param       {boolean} updateKeyman\r\n       * @return      {boolean}\r\n       **/\r\n      selectKeyboard(event: Event, lang: LanguageEntry, kbd: KeyboardDetail, updateKeyman: boolean) {\r\n        keymanweb.activatingUI(true);\r\n\r\n        if(this.selectedLanguage) {\r\n          let found = this.findListedKeyboard(this.selectedLanguage);\r\n          if(found != null) {\r\n            this.listedKeyboards[found].buttonNode.className = 'kmw_button';\r\n          }\r\n        }\r\n\r\n        this.offButtonNode.className = 'kmw_button';\r\n        this.selectedKeyboard = kbd;\r\n\r\n        // In 12.0, this UI class has only been partially converted to BCP-47.\r\n        // `lang.id` refers to the base language identifier and will NOT include\r\n        // any subtags.  We want the FULL language identifier here, with subtags.\r\n        this.selectedLanguage = kbd.LanguageCode;\r\n\r\n        // Return focus to input area and activate the selected keyboard\r\n        this.addKeyboardToList(lang, kbd);\r\n        if(updateKeyman) {\r\n          keymanweb.setActiveKeyboard(kbd.InternalName, kbd.LanguageCode).then(() => {\r\n            // Restore focus _after_ the keyboard finishes loading.\r\n            this.setLastFocus();\r\n          });\r\n        }\r\n        this.listedKeyboards[this.findListedKeyboard(lang)].buttonNode.className = 'kmw_button_selected';\r\n\r\n        // Always save current state when selecting a keyboard\r\n        this.saveCookie();\r\n        this.enableControls();\r\n\r\n        keymanweb.activatingUI(false);\r\n\r\n        return this.hideKeyboardsPopup(event) || this.hideKeyboardsForLanguage(event);\r\n      }\r\n\r\n      /**\r\n       * Enable all UI controls\r\n       *\r\n       * @return      {boolean}\r\n       **/\r\n      enableControls(): boolean {\r\n        let elems = [\r\n          this.offButtonNode,\r\n          this.offBarNode,\r\n          this.oskButtonNode,\r\n          this.oskBarNode\r\n        ];\r\n        let hideOskButton=false;\r\n\r\n        if(keymanweb.isCJK(this.selectedKeyboard)) {\r\n          hideOskButton = true;\r\n        } else if(this.selectedKeyboard == null) {\r\n          hideOskButton = (elems[2].style.display == 'none');\r\n        }\r\n\r\n        if(this.selectedKeyboard != null || this.listedKeyboards.length > 0) {\r\n          for(let i = 0; i < elems.length; i++) {\r\n            elems[i].style.display='';\r\n          }\r\n        } else {\r\n          for(let i = 0; i < elems.length; i++) {\r\n            elems[i].style.display='none';\r\n          }\r\n        }\r\n\r\n        if(hideOskButton) {\r\n          this.oskButtonNode.style.display = this.oskBarNode.style.display = 'none';\r\n        } else if(this.selectedKeyboard == null) {\r\n          this.oskButtonNode.className='kmw_button_disabled';\r\n        }\r\n        // else {\r\n        //   ui.oskButtonNode.className=(osk && osk.isEnabled() ? 'kmw_button_selected' : 'kmw_button');\r\n        // }\r\n\r\n        // Display the toolbar if still hidden\r\n        this.toolbarNode.parentElement.style.visibility='visible';\r\n        return true;\r\n      }\r\n\r\n      /**\r\n       * Restore the focus to the last focused element\r\n       **/\r\n      setLastFocus() {\r\n        keymanweb.focusLastActiveElement();\r\n      }\r\n\r\n      /**\r\n       * Display or hide the OSK according to user control. This will always force\r\n       * the focus to the last active element if currently unfocused, which is\r\n       * preferable to not having the OSK appear when the OSK button is clicked.\r\n       *\r\n       * @param       {Object}  event\r\n       * @return      {boolean}\r\n       **/\r\n      readonly showOSK = (event: Event) => {\r\n        let osk = keymanweb.osk;\r\n        if(!osk) {\r\n          return;\r\n        }\r\n        keymanweb.activatingUI(true);\r\n        //Toggle OSK on or off\r\n        if(osk && keymanweb.getActiveKeyboard() != '') {\r\n          if(osk.isEnabled()) {\r\n            osk.hide();\r\n           } else {\r\n            osk.show(true);\r\n           }\r\n        }\r\n        this.setLastFocus();\r\n        keymanweb.activatingUI(false);\r\n        return this.eventCapture(event);\r\n      }\r\n\r\n\r\n      /**\r\n       * Function     offButtonClickEvent\r\n       * Scope        Private\r\n       * @param       {Object}  event\r\n       * @return      {boolean}\r\n       * Description  Update the UI when all keyboards disabled by user\r\n       **/\r\n      readonly offButtonClickEvent = (event: Event) => {\r\n        if(this.toolbarNode.className != 'kmw_controls_disabled') {\r\n          this.hideKeyboardsForLanguage(null);\r\n          if(this.selectedLanguage) {\r\n            var found = this.findListedKeyboard(this.selectedLanguage);\r\n            if(found != null) {\r\n              this.listedKeyboards[found].buttonNode.className = 'kmw_button';\r\n            }\r\n          }\r\n          this.selectedKeyboard = null;\r\n          this.selectedLanguage = null;\r\n          this.offButtonNode.className = 'kmw_button_selected';\r\n        }\r\n\r\n        // Return the focus to the input area and set the active keyboard to nothing\r\n        this.setLastFocus();\r\n        keymanweb.setActiveKeyboard('','');\r\n\r\n        //Save current state when deselecting a keyboard (may not be needed)\r\n        this.saveCookie();\r\n        this.enableControls();\r\n        return this.eventCapture(event);\r\n      }\r\n\r\n      /**\r\n       * Function     eventCapture\r\n       * Scope        Private\r\n       * @param       {Object}  event\r\n       * @return      {boolean}\r\n       * Description  Browser-independent event capture\r\n       **/\r\n      readonly eventCapture = (event?: Event) => {\r\n        if(!event) {\r\n          event = window.event;\r\n        }\r\n        if(window.event) {\r\n          window.event.returnValue = false;\r\n        }\r\n        if(event) {\r\n          event.cancelBubble = true;\r\n        }\r\n\r\n        return false;\r\n      }\r\n\r\n      /**\r\n       * Function     selectRegion\r\n       * Scope        Private\r\n       * @param       {Object}  event\r\n       * @param       {string}  region\r\n       * @return      {boolean}\r\n       * Description  Select the region for which to list languages\r\n       **/\r\n      readonly selectRegion = (event: Event, region: string) => {\r\n        let e = this.browseMapNode;\r\n\r\n        if(!e) {\r\n          return this.eventCapture(event);\r\n        }\r\n\r\n        e.className = 'kmw_browsemap_'+region;\r\n        if(typeof(this.regionLanguageListNodes[region]) == 'undefined') {\r\n          this.updateMap = true;\r\n          this.addKeyboardsToMap();\r\n        }\r\n\r\n        this.regionLanguageListNodes[region].style.display='block';\r\n        this.regionNodes[region].className='selected';\r\n        if(this.selectedRegion != null && this.selectedRegion != region) {\r\n          this.regionLanguageListNodes[this.selectedRegion].style.display='none';\r\n          this.regionNodes[this.selectedRegion].className='';\r\n        }\r\n        this.selectedRegion = region;\r\n        //this.saveCookie();\r\n        return this.eventCapture(event);\r\n      }\r\n\r\n      /**\r\n       * Function     unhoverRegion\r\n       * Scope        Private\r\n       * @param       {Object}  event\r\n       * @param       {string}  region\r\n       * @return      {boolean}\r\n       * Description  Remove highlighting from a region\r\n       **/\r\n      readonly unhoverRegion = (event: Event, region: string) => {\r\n        this.browseMapNode.className = (this.selectedRegion == null ? '' : 'kmw_browsemap_' + this.selectedRegion);\r\n        this.regionNodes[region].className=(this.selectedRegion==region?'selected':'');\r\n        return this.eventCapture(event);\r\n      }\r\n\r\n      /**\r\n       * Function     hoverRegion\r\n       * Scope        Private\r\n       * @param       {Object}  event\r\n       * @param       {string}  region\r\n       * @return      {boolean}\r\n       * Description  Highlight a hovered region\r\n       **/\r\n      readonly hoverRegion = (event: Event, region: string) => {\r\n        this.browseMapNode.className = 'kmw_browsemap_'+region+'_sel';\r\n        this.regionNodes[region].className='hover';\r\n        return this.eventCapture(event);\r\n      }\r\n\r\n      /**\r\n       * Function     pluck\r\n       * Scope        Private\r\n       * @param       {Object}  elem\r\n       * @param       {string}  property\r\n       * @return      {*}\r\n       * Description  Get the value of an element property\r\n       **/\r\n      pluck(elem, property) {\r\n        return elem.getAttribute ? elem.getAttribute(property) || elem[property] : elem[property];\r\n      };\r\n\r\n      /**\r\n       * Function     focusControlEvent\r\n       * Scope        Private\r\n       * @param       {Object}  params    Object containing Target element (or frame)\r\n       * @return      {boolean}\r\n       * Description  UI code to be executed on receiving focus\r\n       */\r\n      readonly focusControlEvent = (params: {target: HTMLElement, activeControl: HTMLElement}) => {\r\n        if(!this.init) {\r\n          return true;\r\n        }\r\n\r\n        let t=params.target;\r\n        if(t.tagName.toLowerCase() == 'textarea' ||\r\n          (t.tagName.toLowerCase() == 'input' && (t as HTMLInputElement).type.toLowerCase() == 'text')\r\n        ) {\r\n          this.lastActiveControl = t;\r\n          if(this.pluck(t, 'kmw_disable')) {\r\n            if(this.toolbarNode.className != 'kmw_controls_disabled') {\r\n              this.toolbarNode.className = 'kmw_controls_disabled';\r\n            }\r\n          } else {\r\n            if(this.selectedKeyboard != null) {\r\n              if(keymanweb.isCJK()) {\r\n                this.oskButtonNode.style.display = this.oskBarNode.style.display = 'none';\r\n              } else {\r\n                let osk = keymanweb.osk;\r\n                this.oskButtonNode.className = (osk && osk.isEnabled()) ? 'kmw_button_selected' : 'kmw_button';\r\n              }\r\n            }\r\n\r\n            if(this.toolbarNode.className != '') {\r\n              this.toolbarNode.className = '';\r\n            }\r\n\r\n            // NOTE:  as best as I can tell, this is to be specified by the site developer, not KMW.\r\n            // I don't see documentation for it on first glance, though.\r\n            let offsetX, offsetY;\r\n            if(t['KMW_HelpOffsetX']) {\r\n              offsetX = t['KMW_HelpOffsetX'];\r\n            } else {\r\n              offsetX = 64;\r\n            }\r\n\r\n            if(t['KMW_HelpOffsetY']) {\r\n              offsetY = t['KMW_HelpOffsetY'];\r\n            } else {\r\n              offsetY = 0;\r\n            }\r\n\r\n            this.helpOffsetX = util.getAbsoluteX(t)+offsetX;\r\n            this.helpOffsetY = util.getAbsoluteY(t)+t.offsetHeight+offsetY;\r\n          }\r\n        }\r\n        return true;\r\n      }\r\n\r\n      /**\r\n       * Function     oncontrolblurred\r\n       * Scope        Private\r\n       * Parameters   {Object}  params  Object containing event\r\n       * @return      {boolean}\r\n       * Description  UI code to be executed on losing focus\r\n       */\r\n      readonly blurControlEvent = () => {\r\n        if(!this.init) {\r\n          return true;\r\n        }\r\n\r\n        // Must disable OSK button when not focused\r\n        if(this.oskButtonNode.style.display != 'none') {\r\n          this.oskButtonNode.className='kmw_button_disabled';\r\n        }\r\n\r\n        return true;\r\n      }\r\n\r\n      /**\r\n       * UI action required when keyboard changed indirectly\r\n       *\r\n       * @param       {Object}  p   keyboard selection object\r\n       * @return      {boolean}\r\n       **/\r\n      readonly changeKeyboardEvent = (p: {\r\n        internalName: string,\r\n        languageCode: string\r\n      }) => {  // Uses a different format than .getKeyboards(), b/c why not?\r\n        // https://help.keyman.com/developer/engine/web/16.0/reference/core/getKeyboards vs\r\n        // https://help.keyman.com/developer/engine/web/16.0/reference/events/kmw.keyboardchange\r\n        this.lastSelectedKeyboard = null;\r\n        let kbName=p.internalName,\r\n            lgName=keymanweb.util.getLanguageCodes(p.languageCode)[0];\r\n        if(lgName != '' && kbName != '') {\r\n          let lg = this.languages[lgName];\r\n          if(lg != null) {\r\n            for(let j=0; j<lg.keyboards.length; j++) {\r\n              if(lg.keyboards[j].InternalName == kbName) {\r\n                this.selectKeyboard(null, lg, lg.keyboards[j], false);\r\n                return true;\r\n              }\r\n            }\r\n          }\r\n          this.lastSelectedKeyboard = {...p};\r\n        }\r\n        return true;\r\n      }\r\n\r\n      /**\r\n       * UI action when OSK displayed: restore to or update the saved OSK position\r\n       *\r\n       * @param       {Object}  oskPosition\r\n       * @return      {Object}\r\n       **/\r\n      readonly onShowOSK = (oskPosition) => {\r\n        if(this.init) {\r\n          this.oskButtonNode.className = 'kmw_button_selected';\r\n        }\r\n\r\n        //The return value is not currently useful, but allows for the possibility of the OSK restricting or limiting\r\n        //a UI-set position, and returning the corrected position to the UI\r\n        return oskPosition;\r\n      }\r\n\r\n      /**\r\n       * Update appearance of OSK button whenever the OSK is hidden by the user\r\n       *\r\n       * @param       {Object}  p\r\n       **/\r\n      readonly onHideOSK = (p: {\r\n        HiddenByUser: boolean\r\n      }) => {\r\n        if(this.init && p.HiddenByUser) {\r\n          this.oskButtonNode.className = 'kmw_button';\r\n        }\r\n      }\r\n\r\n      registerEvents() {\r\n        let osk = keymanweb.osk;\r\n        if(!osk) {\r\n          return;\r\n        }\r\n\r\n        osk.addEventListener('show', this.onShowOSK);\r\n        osk.addEventListener('hide', this.onHideOSK);\r\n      }\r\n\r\n      /**\r\n       * Function     showKeyboardsPopup\r\n       * Scope        Private\r\n       * @param       {Object}  event\r\n       * @return      {boolean}\r\n       * Description  Update the map when displayed\r\n       **/\r\n      readonly showKeyboardsPopup = (event) => {\r\n        // Add any newly available keyboards to the map\r\n        this.addKeyboardsToMap();\r\n\r\n        if(this.toolbarNode.className == 'kmw_controls_disabled') {\r\n          return this.eventCapture(event);\r\n        }\r\n        this.hideKeyboardsForLanguage(null);\r\n        if(this.selectorNode.className=='kmw_over') {\r\n          return this.hideKeyboardsPopup(event);\r\n        }\r\n        this.selectorNode.className='kmw_over';\r\n        this.keyboardsButtonNode.className='kmw_button_selected';\r\n\r\n        this.SetupPopupDismissal(this.selectorNode, this.hideKeyboardsPopup);\r\n        return this.eventCapture(event);\r\n      }\r\n\r\n      /**\r\n       * Function     hideKeyboardsPopup\r\n       * Scope        Private\r\n       * @param       {Object}  event\r\n       * @return      {boolean}\r\n       * Description  Hide the list of keyboards for this language\r\n       **/\r\n      readonly hideKeyboardsPopup = (event: Event) => {\r\n        this.selectorNode.className='';\r\n        this.keyboardsButtonNode.className='kmw_button';\r\n        this.CancelPopupDismissal(this.hideKeyboardsPopup);\r\n        return this.eventCapture(event);\r\n      }\r\n\r\n      /**\r\n       * Hide both language and keyboard selection popups on body click\r\n       * @param   {Object}  event\r\n       * @return  {boolean}\r\n      **/\r\n      readonly hideAllPopups = (event: Event) => {\r\n        var e = this.keyboardsForLangPopup;\r\n        if((!e || (e.style.display =='none')) && (this.selectorNode.className == '')) {\r\n          return true;\r\n        }\r\n        this.hideKeyboardsPopup(event);\r\n        this.hideKeyboardsForLanguage(event);\r\n        return this.eventCapture(event);\r\n      }\r\n\r\n      // Fields only used for the three Popup-related methods that follow.\r\n\r\n      /**\r\n       * A closure to be evaluated upon dismissal of a modal popup generated\r\n       * by this UI module.\r\n       */\r\n      dismissalCallback: (event: Event) => any = null;\r\n\r\n      /**\r\n       * The root element associated with an active modal popup; related\r\n       * events will check to see if they are a descendant (or this element).\r\n       */\r\n      popupElement: HTMLElement = null;\r\n\r\n      /**\r\n       * As we replace any `onclick` event listener when acting modally\r\n       * for the popup, we stash the old event listener here and restore\r\n       * it when we're done.\r\n       */\r\n      lastDismissalCallback: (event: Event) => any = null;\r\n\r\n      /**\r\n       * Function     PopupDismissal\r\n       * Scope        Private\r\n       * @param       {Object}  event\r\n       * @return      {Object}\r\n       * Description  Carry out action when popup dismissed\r\n       **/\r\n      readonly PopupDismissal = (event: Event) => {\r\n        let t = ((event && event.target) || (window.event && window.event.srcElement)) as HTMLElement;\r\n        if(t) {\r\n          while(t.parentElement) {\r\n            if (t == this.popupElement) {\r\n              return null;\r\n            }\r\n            t = t.parentElement;\r\n          }\r\n        }\r\n        if(t.nodeName == '#document') {\r\n          this.hideAllPopups(event); //KMEW-41, fixed for build 356.\r\n        }\r\n        return this.dismissalCallback;\r\n      }\r\n\r\n      /**\r\n       * Function     SetupPopupDismissal\r\n       * Scope        Private\r\n       * @param       {Object}            element\r\n       * @param       {function(Object)}  callback\r\n       * Description  Prepare for callback dismissal\r\n       **/\r\n      SetupPopupDismissal(element, callback: (event: Event) => any) {\r\n        if(this.PopupDismissal == document.onclick) {\r\n          this.CancelPopupDismissal(this.dismissalCallback);\r\n        }\r\n        this.dismissalCallback = callback;\r\n        this.popupElement = element;\r\n        this.lastDismissalCallback = document.onclick;\r\n        document.onclick = this.PopupDismissal;\r\n      }\r\n\r\n      /**\r\n       * Function     CancelPopupDismissal\r\n       * Scope        Private\r\n       * @param       {?function(Object)}  callback\r\n       * Description  Cancel callback dismissal\r\n       **/\r\n      CancelPopupDismissal(callback) {\r\n        if(this.PopupDismissal == document.onclick) {\r\n          document.onclick = this.lastDismissalCallback;\r\n          this.lastDismissalCallback = null;\r\n          this.dismissalCallback = null;\r\n          this.popupElement = null;\r\n        }\r\n      }\r\n\r\n\r\n\r\n\r\n      /**\r\n       * Load the previous state from the KeymanWeb_Keyboard and KeymanWeb_Toolbar cookies\r\n       **/\r\n      loadCookie() {\r\n        let currentKeyboard='';\r\n        let currentLgCode='';\r\n        const kc=util.loadCookie<KeyboardCookie>(\"KeymanWeb_Keyboard\");\r\n        if(kc.current != undefined) {\r\n          currentKeyboard = kc.current.split(':')[0];\r\n        }\r\n\r\n        const c=util.loadCookie<ToolbarCookie>(\"KeymanWeb_Toolbar\");\r\n\r\n        if(c.region != undefined) {\r\n          this.selectedRegion = c.region;\r\n        }\r\n\r\n        // If there's a defined length for the cookie's keyboard count...\r\n        if(c.maxrecent != undefined) {\r\n\r\n          // Iterate over the implicit array\r\n          for(let i=0; i < c.maxrecent; i++) {\r\n            // Is the entry actually defined?\r\n            if(c['recent'+i] != undefined) {\r\n              var r=c['recent'+i].split(',');\r\n              // Does its definition have the expected format?  That is: langID,keyboardID\r\n              if(r.length == 2) {\r\n                var k = this.languages[r[0]];\r\n                // If the language has a defined entry in our list of loaded languages...\r\n                if(k != null) {\r\n                  // Then, for our loaded keyboards for said loaded language...\r\n                  // find the most recent match that is available in our current list.\r\n                  for(var j=0; j<k.keyboards.length; j++) {\r\n                    if(k.keyboards[j].InternalName == r[1]) {\r\n                      this.addKeyboardToList(k, k.keyboards[j]);\r\n                      if(k.keyboards[j].InternalName == currentKeyboard) {\r\n                        this.selectKeyboard(null, k, k.keyboards[j], true);\r\n                        window.focus();\r\n                        this.setLastFocus();\r\n                        break;\r\n                      }\r\n                      break;\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        } else {\r\n          // If language list and keyboard list have not yet been saved as a cookie,\r\n          // initialize to the current (default) language and keyboard, if set by KMW\r\n          let kbName=keymanweb.getActiveKeyboard();\r\n          let lgName=keymanweb.getActiveLanguage();\r\n          if(lgName != '' && kbName != '') {\r\n            var lg = this.languages[lgName];\r\n            if(lg != null) {\r\n              for(var j=0; j<lg.keyboards.length; j++) {\r\n                if(lg.keyboards[j].InternalName == kbName) {\r\n                  this.selectKeyboard(null, lg, lg.keyboards[j], true);\r\n                  window.focus();\r\n                  this.setLastFocus();\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      /**\r\n       * Save the current UI state in the KeymanWeb_Toolbar cookie\r\n       **/\r\n      saveCookie() {\r\n        let vs: ToolbarCookie ={\r\n          region: this.selectedRegion,\r\n          maxrecent: this.listedKeyboards.length\r\n        };\r\n        vs.region = this.selectedRegion;\r\n        vs.maxrecent = this.listedKeyboards.length;\r\n\r\n        for(var i=0; i<this.listedKeyboards.length; i++) {\r\n          vs['recent'+i] = this.listedKeyboards[i].lang.id+\",\"+this.listedKeyboards[i].keyboard.InternalName;\r\n        }\r\n\r\n        util.saveCookie<ToolbarCookie>('KeymanWeb_Toolbar',vs);\r\n      }\r\n\r\n    }\r\n\r\n    const ui = keymanweb.ui = new ToolbarUI();\r\n\r\n    keymanweb.addEventListener('keyboardregistered', ui.registerKeyboard);\r\n    keymanweb.addEventListener('controlfocused', ui.focusControlEvent);\r\n    keymanweb.addEventListener('controlblurred', ui.blurControlEvent);\r\n    keymanweb.addEventListener('keyboardchange', ui.changeKeyboardEvent);\r\n\r\n    // Initialize when everything defined (replaces unreliable onload event handler)\r\n    // In case the toolbar script loads a bit later than the main KMW script\r\n    // (may happen in unit testing)\r\n    ui.initialize(); // equivalent to ui.Initialize() from the other UI modules\r\n  } catch(ex){}\r\n}"
  ],
  "mappings": "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",
  "names": [
    "require_tslib",
    "__commonJSMin",
    "exports",
    "module",
    "__assign",
    "factory",
    "root",
    "createExporter",
    "previous",
    "id",
    "v",
    "exporter",
    "extendStatics",
    "d",
    "b",
    "p",
    "s",
    "i",
    "n",
    "build_exports",
    "__export",
    "tslib_1",
    "__reExport",
    "_a",
    "keymanweb_1",
    "util_1",
    "controller",
    "ToolbarUI",
    "_this",
    "Keyboards",
    "n",
    "i",
    "colNode",
    "max",
    "count",
    "languageCode",
    "j",
    "kbdRegion",
    "bcpSubtags",
    "kbdRegion_1",
    "x",
    "langNode",
    "aNode",
    "lang",
    "event",
    "a",
    "b",
    "e",
    "osk",
    "found",
    "region",
    "params",
    "t",
    "offsetX",
    "offsetY",
    "p",
    "kbName",
    "lgName",
    "lg",
    "oskPosition",
    "tag",
    "id",
    "className",
    "innerHTML",
    "node",
    "tbNode",
    "imgNode",
    "mapNode",
    "areaNode_1",
    "areaNode",
    "listNode",
    "itemNode",
    "img",
    "root",
    "kbd",
    "oldestPriority",
    "oldestFound",
    "rk",
    "buttonNode",
    "p1",
    "p2",
    "thisANode",
    "divNode",
    "kbdText_1",
    "thisLang",
    "thisButtonNode",
    "kbdText",
    "PName",
    "PLen",
    "updateKeyman",
    "elems",
    "hideOskButton",
    "elem",
    "property",
    "element",
    "callback",
    "currentKeyboard",
    "currentLgCode",
    "kc",
    "c",
    "r",
    "k",
    "vs",
    "ui",
    "ex"
  ]
}
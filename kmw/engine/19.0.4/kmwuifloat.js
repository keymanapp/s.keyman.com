(()=>{var v=Object.defineProperty;var f=(i,s)=>v(i,"name",{value:s,configurable:!0});var c;if(!(!((c=keyman==null?void 0:keyman.ui)===null||c===void 0)&&c.name))try{let i=keyman,s=i.util;if(s.isTouchDevice())throw"";let u=class u{constructor(){this.name="float",this.KeyboardSelector=null,this.outerDiv=null,this.innerDiv=null,this.oskButton=null,this.kbdIcon=null,this.selecting=!1,this.updateList=!0,this.updateTimer=0,this.floatRight=!1,this.initialized=!1,this.initTimer=0,this.toggleOSK=()=>{i.activatingUI(!0);let t=i.osk;return t&&t.show&&(t.isEnabled()?t.hide():t.show(!0)),window.event&&(window.event.returnValue=!1),i.focusLastActiveElement(),i.activatingUI(!1),!1},this.initialize=()=>{if(this.initTimer&&(window.clearTimeout(this.initTimer),this.initTimer=null),!i.initialized){this.initTimer=window.setTimeout(this.initialize,50);return}if(this.initialized||s.isTouchDevice())return;let t=s.getOption("resources")+"ui/float/";this.outerDiv=s.createElement("div"),this.innerDiv=s.createElement("div"),this.kbdIcon=s.createElement("img"),this.outerDiv.innerHTML="<a href='http://keyman.com/web/' target='KeymanWebHelp'><img src='"+t+"kmicon.gif' border='0' style='padding: 0px 2px 0 1px; margin:0px;' title='KeymanWeb' alt='KeymanWeb' /></a>";var e=this.outerDiv.style;e.backgroundColor="white",e.border="solid 1px black",e.position="absolute",e.height="18px",e.font="bold 8pt sans-serif",e.display="none",e.textAlign="left",e.overflow="hidden",s.attachDOMEvent(this.outerDiv,"mousedown",this._SelectorMouseDown),s.attachDOMEvent(this.outerDiv,"mouseover",this._SelectorMouseOver),s.attachDOMEvent(this.outerDiv,"mouseout",this._SelectorMouseOut),this.registerEvents(),this.kbdIcon.src=t+"kbdicon.gif",this.kbdIcon.title="Display visual keyboard",this.oskButtonState(!1);var o=s.createElement("div");this.oskButton=o,o.onclick=this.toggleOSK,o.appendChild(this.kbdIcon),this.innerDiv.appendChild(o),this.outerDiv.appendChild(this.innerDiv),document.body.appendChild(this.outerDiv),this.KeyboardSelector=s.createElement("select"),e=this.KeyboardSelector.style,e.font="8pt sans-serif",e.backgroundColor="#f3e5de",e.border="solid 1px #7B9EBD",e.height="16px",e.margin="1px 2px 0px 2px",e.left="20px",e.top="0px",e.position="absolute",e.maxWidth="150px",s.attachDOMEvent(this.KeyboardSelector,"change",this.SelectKeyboardChange),s.attachDOMEvent(this.KeyboardSelector,"blur",this.SelectBlur),this.innerDiv.appendChild(this.KeyboardSelector);var r=s.getOption("ui"),n="(System keyboard)";r&&typeof r=="object"&&(typeof r.position=="string"&&r.position=="right"&&(this.floatRight=!0),typeof r.default=="string"&&(n=r.default));var a=s.createElement("option");a.value="-",a.innerHTML=n,this.KeyboardSelector.appendChild(a),a=null,this.initialized=!0,this.updateKeyboardList()},this._UnloadUserInterface=()=>{this.KeyboardSelector=this.innerDiv=this.outerDiv=this.kbdIcon=null},this.updateKeyboardList=()=>{if(this.updateList){this.initialized||this.initialize();let r=this.KeyboardSelector.getElementsByTagName("OPTION");for(let n=r.length;n>1;n--)this.KeyboardSelector.removeChild(r[n-1]);var t=i.getKeyboards();for(let n=0;n<t.length;n++){let a=s.createElement("option");if(a.value=t[n].InternalName+":"+t[n].LanguageCode,a.innerHTML=t[n].Name.replace(/\s?keyboard/i,""),t[n].LanguageName){var e=t[n].LanguageName;e=e.split(",")[0],t[n].Name.search(e)==-1&&(a.innerHTML=e+" ("+a.innerHTML+")")}this.KeyboardSelector.appendChild(a),a=null}}this.updateList=!1;let o=i.getSavedKeyboard().split(":");o.length<2&&(o[1]=""),this.updateMenu(o[0],o[1]),i.getLastActiveElement()&&(this.HideInterface(),this.ShowInterface())},this.updateMenu=(t,e)=>{var o=0;if(this.initialized){var r=t;if(e!=""&&(r+=":"+e),t=="")this.KeyboardSelector.selectedIndex=0;else{let n=this.KeyboardSelector.getElementsByTagName("option");for(o=0;o<n.length;o++){let a=n[o].value;if(e==""&&(a=a.split(":")[0]),a==r){this.KeyboardSelector.selectedIndex=o;break}}}}},this.oskButtonState=t=>{var e=this.kbdIcon.style;e.width="24px",e.height="13px",e.top="1px",e.verticalAlign="bottom",e.padding="2px 2px 1px 2px",e.position="absolute",e.border=t?"inset 1px #808080":"none",e.background=t?"#f7e7de":"white",e.display="block",this.initialized&&(this.oskButton.style.display="block")},this._SelectorMouseDown=t=>{i.activatingUI&&i.activatingUI(1)},this._SelectorMouseOver=t=>{i.activatingUI&&i.activatingUI(1)},this._SelectorMouseOut=t=>{i.activatingUI&&i.activatingUI(0)},this.SelectKeyboardChange=t=>{if(i.activatingUI(!0),this.KeyboardSelector.value!="-"){var e=this.KeyboardSelector.selectedIndex,o=this.KeyboardSelector.options[e].value.split(":");i.setActiveKeyboard(o[0],o[1])}else i.setActiveKeyboard("");i.focusLastActiveElement(),i.activatingUI(!1),this.selecting=!0},this.SelectBlur=t=>{this.selecting||i.focusLastActiveElement(),this.selecting=!1},this.ShowInterface=(t,e)=>{if(this.initialized){var o=this.outerDiv.style;t&&e&&(o.left=t+"px",o.top=e+"px"),o.display="block",this.kbdIcon.style.left=this.KeyboardSelector.offsetWidth+24+"px",this.addButtonOSK(),this.updateMenu(i.getActiveKeyboard(),i.getActiveLanguage())}},this.HideInterface=()=>{this.initialized&&(this.outerDiv.style.display="none")},this.addButtonOSK=()=>{if(this.oskButton!=null)if(i.isCJK()||this.KeyboardSelector.selectedIndex==0)this.oskButton.style.display="none",this.outerDiv.style.width=this.KeyboardSelector.offsetWidth+30+"px";else{this.oskButton.style.display="block";let t=i.osk;t?this.oskButtonState(t.isEnabled()):this.oskButtonState(!1),this.outerDiv.style.width=this.KeyboardSelector.offsetWidth+56+"px"}},this._Resize=t=>{if(this.outerDiv.style.display=="block"){var e=i.getLastActiveElement();this.floatRight?this.ShowInterface(s.getAbsoluteX(e)+e.offsetWidth+1,s.getAbsoluteY(e)+1):this.ShowInterface(s.getAbsoluteX(e)+1,s.getAbsoluteY(e)+e.offsetHeight+1)}return!0}}shutdown(){var t=this.outerDiv;t&&t.parentNode.removeChild(t),this._UnloadUserInterface(),window.removeEventListener&&window.removeEventListener("resize",this._Resize,!1)}registerEvents(){i.addEventListener("keyboardregistered",e=>{this.updateList=!0,this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=window.setTimeout(this.updateKeyboardList,200)}),i.addEventListener("keyboardloaded",e=>{let o=i.getSavedKeyboard().split(":");o.length>1&&this.updateMenu(o[0],o[1])}),i.addEventListener("keyboardchange",e=>{this.updateMenu(e.internalName,e.languageCode),this.addButtonOSK()});let t=i.osk;t&&(t.addEventListener("show",e=>(this.addButtonOSK(),e)),t.addEventListener("hide",e=>{this.initialized&&this.oskButtonState(!1)}))}};f(u,"UIFloat");let d=u,h=i.ui=new d;i.addEventListener("controlfocused",l=>((l.activeControl==null||l.activeControl._kmwAttachment)&&(h.floatRight?h.ShowInterface(s.getAbsoluteX(l.target)+l.target.offsetWidth+1,s.getAbsoluteY(l.target)+1):h.ShowInterface(s.getAbsoluteX(l.target),s.getAbsoluteY(l.target)-parseInt(s.getStyleValue(h.outerDiv,"height"),10)-2)),!0)),i.addEventListener("controlblurred",l=>(l.event&&(l.isActivating||h.HideInterface()),!0)),window.addEventListener&&window.addEventListener("resize",h._Resize,!1),h.initialize()}catch(i){}})();
//# sourceMappingURL=kmwuifloat.js.map

(()=>{var p=Object.defineProperty;var f=(o,d)=>p(o,"name",{value:d,configurable:!0});var u,i=window.keyman;if(i){if(!(!((u=i.ui)===null||u===void 0)&&u.name))try{let o=i.util;if(o.isTouchDevice())throw"";let c=class c{constructor(){this.name="float",this.KeyboardSelector=null,this.outerDiv=null,this.innerDiv=null,this.oskButton=null,this.kbdIcon=null,this.selecting=!1,this.updateList=!0,this.updateTimer=0,this.floatRight=!1,this.initialized=!1,this.initTimer=0,this.toggleOSK=()=>{i.activatingUI(!0);let t=i.osk;return t&&t.show&&(t.isEnabled()?t.hide():t.show(!0)),window.event&&(window.event.returnValue=!1),i.focusLastActiveElement(),i.activatingUI(!1),!1},this.initialize=()=>{if(this.initTimer&&(window.clearTimeout(this.initTimer),this.initTimer=null),!i.initialized){this.initTimer=window.setTimeout(this.initialize,50);return}if(this.initialized||o.isTouchDevice())return;let t=o.getOption("resources")+"ui/float/";this.outerDiv=o.createElement("div"),this.innerDiv=o.createElement("div"),this.kbdIcon=o.createElement("img"),this.outerDiv.innerHTML="<a href='http://keyman.com/web/' target='KeymanWebHelp'><img src='"+t+"kmicon.gif' border='0' style='padding: 0px 2px 0 1px; margin:0px;' title='KeymanWeb' alt='KeymanWeb' /></a>";let e=this.outerDiv.style;e.backgroundColor="white",e.border="solid 1px black",e.position="absolute",e.height="18px",e.font="bold 8pt sans-serif",e.display="none",e.textAlign="left",e.overflow="hidden",o.attachDOMEvent(this.outerDiv,"mousedown",this._SelectorMouseDown),o.attachDOMEvent(this.outerDiv,"mouseover",this._SelectorMouseOver),o.attachDOMEvent(this.outerDiv,"mouseout",this._SelectorMouseOut),this.registerEvents(),this.kbdIcon.src=t+"kbdicon.gif",this.kbdIcon.title="Display visual keyboard",this.oskButtonState(!1);let s=o.createElement("div");this.oskButton=s,s.onclick=this.toggleOSK,s.appendChild(this.kbdIcon),this.innerDiv.appendChild(s),this.outerDiv.appendChild(this.innerDiv),document.body.appendChild(this.outerDiv),this.KeyboardSelector=o.createElement("select"),e=this.KeyboardSelector.style,e.font="8pt sans-serif",e.backgroundColor="#f3e5de",e.border="solid 1px #7B9EBD",e.height="16px",e.margin="1px 2px 0px 2px",e.left="20px",e.top="0px",e.position="absolute",e.maxWidth="150px",o.attachDOMEvent(this.KeyboardSelector,"change",this.SelectKeyboardChange),o.attachDOMEvent(this.KeyboardSelector,"blur",this.SelectBlur),this.innerDiv.appendChild(this.KeyboardSelector);let n=o.getOption("ui"),r="(System keyboard)";n&&typeof n=="object"&&(typeof n.position=="string"&&n.position=="right"&&(this.floatRight=!0),typeof n.default=="string"&&(r=n.default));let a=o.createElement("option");a.value="-",a.innerHTML=r,this.KeyboardSelector.appendChild(a),a=null,this.initialized=!0,this.updateKeyboardList()},this._UnloadUserInterface=()=>{this.KeyboardSelector=this.innerDiv=this.outerDiv=this.kbdIcon=null},this.updateKeyboardList=()=>{if(this.updateList){this.initialized||this.initialize();let e=this.KeyboardSelector.getElementsByTagName("OPTION");for(let n=e.length;n>1;n--)this.KeyboardSelector.removeChild(e[n-1]);let s=i.getKeyboards();for(let n=0;n<s.length;n++){let r=o.createElement("option");if(r.value=s[n].InternalName+":"+s[n].LanguageCode,r.innerHTML=s[n].Name.replace(/\s?keyboard/i,""),s[n].LanguageName){let a=s[n].LanguageName;a=a.split(",")[0],s[n].Name.search(a)==-1&&(r.innerHTML=a+" ("+r.innerHTML+")")}this.KeyboardSelector.appendChild(r),r=null}}this.updateList=!1;let t=i.getSavedKeyboard().split(":");t.length<2&&(t[1]=""),this.updateMenu(t[0],t[1]),i.getLastActiveElement()&&(this.HideInterface(),this.ShowInterface())},this.updateMenu=(t,e)=>{let s=0;if(!this.initialized)return;let n=t;if(e!=""&&(n+=":"+e),t=="")this.KeyboardSelector.selectedIndex=0;else{let r=this.KeyboardSelector.getElementsByTagName("option");for(s=0;s<r.length;s++){let a=r[s].value;if(e==""&&(a=a.split(":")[0]),a==n){this.KeyboardSelector.selectedIndex=s;break}}}},this.oskButtonState=t=>{let e=this.kbdIcon.style;e.width="24px",e.height="13px",e.top="1px",e.verticalAlign="bottom",e.padding="2px 2px 1px 2px",e.position="absolute",e.border=t?"inset 1px #808080":"none",e.background=t?"#f7e7de":"white",e.display="block",this.initialized&&(this.oskButton.style.display="block")},this._SelectorMouseDown=t=>{i.activatingUI&&i.activatingUI(1)},this._SelectorMouseOver=t=>{i.activatingUI&&i.activatingUI(1)},this._SelectorMouseOut=t=>{i.activatingUI&&i.activatingUI(0)},this.SelectKeyboardChange=t=>{if(i.activatingUI(!0),this.KeyboardSelector.value!="-"){let e=this.KeyboardSelector.selectedIndex,s=this.KeyboardSelector.options[e].value.split(":");i.setActiveKeyboard(s[0],s[1])}else i.setActiveKeyboard("");i.focusLastActiveElement(),i.activatingUI(!1),this.selecting=!0},this.SelectBlur=t=>{this.selecting||i.focusLastActiveElement(),this.selecting=!1},this.ShowInterface=(t,e)=>{if(!this.initialized)return;let s=this.outerDiv.style;t&&e&&(s.left=t+"px",s.top=e+"px"),s.display="block",this.kbdIcon.style.left=this.KeyboardSelector.offsetWidth+24+"px",this.addButtonOSK(),this.updateMenu(i.getActiveKeyboard(),i.getActiveLanguage())},this.HideInterface=()=>{this.initialized&&(this.outerDiv.style.display="none")},this.addButtonOSK=()=>{if(this.oskButton!=null)if(i.isCJK()||this.KeyboardSelector.selectedIndex==0)this.oskButton.style.display="none",this.outerDiv.style.width=this.KeyboardSelector.offsetWidth+30+"px";else{this.oskButton.style.display="block";let t=i.osk;t?this.oskButtonState(t.isEnabled()):this.oskButtonState(!1),this.outerDiv.style.width=this.KeyboardSelector.offsetWidth+56+"px"}},this._Resize=t=>{if(this.outerDiv.style.display=="block"){let e=i.getLastActiveElement();this.floatRight?this.ShowInterface(o.getAbsoluteX(e)+e.offsetWidth+1,o.getAbsoluteY(e)+1):this.ShowInterface(o.getAbsoluteX(e)+1,o.getAbsoluteY(e)+e.offsetHeight+1)}return!0}}shutdown(){let t=this.outerDiv;t&&t.parentNode.removeChild(t),this._UnloadUserInterface(),window.removeEventListener&&window.removeEventListener("resize",this._Resize,!1)}registerEvents(){i.addEventListener("keyboardregistered",e=>{this.updateList=!0,this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=window.setTimeout(this.updateKeyboardList,200)}),i.addEventListener("keyboardloaded",e=>{let s=i.getSavedKeyboard().split(":");s.length>1&&this.updateMenu(s[0],s[1])}),i.addEventListener("keyboardchange",e=>{this.updateMenu(e.internalName,e.languageCode),this.addButtonOSK()});let t=i.osk;t&&(t.addEventListener("show",e=>(this.addButtonOSK(),e)),t.addEventListener("hide",e=>{this.initialized&&this.oskButtonState(!1)}))}};f(c,"UIFloat");let d=c,h=i.ui=new d;i.addEventListener("controlfocused",l=>((l.activeControl==null||l.activeControl._kmwAttachment)&&(h.floatRight?h.ShowInterface(o.getAbsoluteX(l.target)+l.target.offsetWidth+1,o.getAbsoluteY(l.target)+1):h.ShowInterface(o.getAbsoluteX(l.target),o.getAbsoluteY(l.target)-parseInt(o.getStyleValue(h.outerDiv,"height"),10)-2)),!0)),i.addEventListener("controlblurred",l=>(l.event&&(l.isActivating||h.HideInterface()),!0)),window.addEventListener&&window.addEventListener("resize",h._Resize,!1),h.initialize()}catch(o){}}else throw new Error("`keyman` global is missing; Keyman Engine for Web script has not been loaded");})();
//# sourceMappingURL=kmwuifloat.js.map

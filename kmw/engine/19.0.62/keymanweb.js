"use strict";(()=>{var Ia=Object.create;var zt=Object.defineProperty,ba=Object.defineProperties,Ir=Object.getOwnPropertyDescriptor,ha=Object.getOwnPropertyDescriptors,Fa=Object.getOwnPropertyNames,ur=Object.getOwnPropertySymbols,br=Object.getPrototypeOf,hr=Object.prototype.hasOwnProperty,ya=Object.prototype.propertyIsEnumerable,ma=Reflect.get;var Br=(g,n,t)=>n in g?zt(g,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):g[n]=t,p=(g,n)=>{for(var t in n||(n={}))hr.call(n,t)&&Br(g,t,n[t]);if(ur)for(var t of ur(n))ya.call(n,t)&&Br(g,t,n[t]);return g},A=(g,n)=>ba(g,ha(n)),a=(g,n)=>zt(g,"name",{value:n,configurable:!0});var Ga=(g,n)=>()=>(n||g((n={exports:{}}).exports,n),n.exports),Kt=(g,n)=>{for(var t in n)zt(g,t,{get:n[t],enumerable:!0})},pa=(g,n,t,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of Fa(n))!hr.call(g,s)&&s!==t&&zt(g,s,{get:()=>n[s],enumerable:!(i=Ir(n,s))||i.enumerable});return g};var Ca=(g,n,t)=>(t=g!=null?Ia(br(g)):{},pa(n||!g||!g.__esModule?zt(t,"default",{value:g,enumerable:!0}):t,g));var Qe=(g,n,t,i)=>{for(var s=i>1?void 0:i?Ir(n,t):n,c=g.length-1,l;c>=0;c--)(l=g[c])&&(s=(i?l(n,t,s):l(s))||s);return i&&s&&zt(n,t,s),s};var Ei=(g,n,t)=>ma(br(g),t,n);var R=(g,n,t)=>new Promise((i,s)=>{var c=r=>{try{o(t.next(r))}catch(d){s(d)}},l=r=>{try{o(t.throw(r))}catch(d){s(d)}},o=r=>r.done?i(r.value):Promise.resolve(r.value).then(c,l);o((t=t.apply(g,n)).next())});var mr=Ga((zg,nc)=>{"use strict";var Sa=Object.prototype.hasOwnProperty,$="~";function Hn(){}a(Hn,"Events");Object.create&&(Hn.prototype=Object.create(null),new Hn().__proto__||($=!1));function Wa(g,n,t){this.fn=g,this.context=n,this.once=t||!1}a(Wa,"EE");function yr(g,n,t,i,s){if(typeof t!="function")throw new TypeError("The listener must be a function");var c=new Wa(t,i||g,s),l=$?$+n:n;return g._events[l]?g._events[l].fn?g._events[l]=[g._events[l],c]:g._events[l].push(c):(g._events[l]=c,g._eventsCount++),g}a(yr,"addListener");function Mi(g,n){--g._eventsCount===0?g._events=new Hn:delete g._events[n]}a(Mi,"clearEvent");function M(){this._events=new Hn,this._eventsCount=0}a(M,"EventEmitter");M.prototype.eventNames=a(function(){var n=[],t,i;if(this._eventsCount===0)return n;for(i in t=this._events)Sa.call(t,i)&&n.push($?i.slice(1):i);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},"eventNames");M.prototype.listeners=a(function(n){var t=$?$+n:n,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var s=0,c=i.length,l=new Array(c);s<c;s++)l[s]=i[s].fn;return l},"listeners");M.prototype.listenerCount=a(function(n){var t=$?$+n:n,i=this._events[t];return i?i.fn?1:i.length:0},"listenerCount");M.prototype.emit=a(function(n,t,i,s,c,l){var o=$?$+n:n;if(!this._events[o])return!1;var r=this._events[o],d=arguments.length,u,B;if(r.fn){switch(r.once&&this.removeListener(n,r.fn,void 0,!0),d){case 1:return r.fn.call(r.context),!0;case 2:return r.fn.call(r.context,t),!0;case 3:return r.fn.call(r.context,t,i),!0;case 4:return r.fn.call(r.context,t,i,s),!0;case 5:return r.fn.call(r.context,t,i,s,c),!0;case 6:return r.fn.call(r.context,t,i,s,c,l),!0}for(B=1,u=new Array(d-1);B<d;B++)u[B-1]=arguments[B];r.fn.apply(r.context,u)}else{var b=r.length,I;for(B=0;B<b;B++)switch(r[B].once&&this.removeListener(n,r[B].fn,void 0,!0),d){case 1:r[B].fn.call(r[B].context);break;case 2:r[B].fn.call(r[B].context,t);break;case 3:r[B].fn.call(r[B].context,t,i);break;case 4:r[B].fn.call(r[B].context,t,i,s);break;default:if(!u)for(I=1,u=new Array(d-1);I<d;I++)u[I-1]=arguments[I];r[B].fn.apply(r[B].context,u)}}return!0},"emit");M.prototype.on=a(function(n,t,i){return yr(this,n,t,i,!1)},"on");M.prototype.once=a(function(n,t,i){return yr(this,n,t,i,!0)},"once");M.prototype.removeListener=a(function(n,t,i,s){var c=$?$+n:n;if(!this._events[c])return this;if(!t)return Mi(this,c),this;var l=this._events[c];if(l.fn)l.fn===t&&(!s||l.once)&&(!i||l.context===i)&&Mi(this,c);else{for(var o=0,r=[],d=l.length;o<d;o++)(l[o].fn!==t||s&&!l[o].once||i&&l[o].context!==i)&&r.push(l[o]);r.length?this._events[c]=r.length===1?r[0]:r:Mi(this,c)}return this},"removeListener");M.prototype.removeAllListeners=a(function(n){var t;return n?(t=$?$+n:n,this._events[t]&&Mi(this,t)):(this._events=new Hn,this._eventsCount=0),this},"removeAllListeners");M.prototype.off=M.prototype.removeListener;M.prototype.addListener=M.prototype.on;M.prefixed=$;M.EventEmitter=M;typeof nc!="undefined"&&(nc.exports=M)});var m={LCTRLFLAG:1,RCTRLFLAG:2,LALTFLAG:4,RALTFLAG:8,K_SHIFTFLAG:16,K_CTRLFLAG:32,K_ALTFLAG:64,K_METAFLAG:128,CAPITALFLAG:256,NOTCAPITALFLAG:512,NUMLOCKFLAG:1024,NOTNUMLOCKFLAG:2048,SCROLLFLAG:4096,NOTSCROLLFLAG:8192,ISVIRTUALKEY:16384,VIRTUALCHARKEY:32768};var Yi={K_BKSP:8,K_TAB:9,K_ENTER:13,K_SHIFT:16,K_CONTROL:17,K_ALT:18,K_PAUSE:19,K_CAPS:20,K_ESC:27,K_SPACE:32,K_PGUP:33,K_PGDN:34,K_END:35,K_HOME:36,K_LEFT:37,K_UP:38,K_RIGHT:39,K_DOWN:40,K_SEL:41,K_PRINT:42,K_EXEC:43,K_INS:45,K_DEL:46,K_HELP:47,K_0:48,K_1:49,K_2:50,K_3:51,K_4:52,K_5:53,K_6:54,K_7:55,K_8:56,K_9:57,K_A:65,K_B:66,K_C:67,K_D:68,K_E:69,K_F:70,K_G:71,K_H:72,K_I:73,K_J:74,K_K:75,K_L:76,K_M:77,K_N:78,K_O:79,K_P:80,K_Q:81,K_R:82,K_S:83,K_T:84,K_U:85,K_V:86,K_W:87,K_X:88,K_Y:89,K_Z:90,K_NP0:96,K_NP1:97,K_NP2:98,K_NP3:99,K_NP4:100,K_NP5:101,K_NP6:102,K_NP7:103,K_NP8:104,K_NP9:105,K_NPSTAR:106,K_NPPLUS:107,K_SEPARATOR:108,K_NPMINUS:109,K_NPDOT:110,K_NPSLASH:111,K_F1:112,K_F2:113,K_F3:114,K_F4:115,K_F5:116,K_F6:117,K_F7:118,K_F8:119,K_F9:120,K_F10:121,K_F11:122,K_F12:123,K_NUMLOCK:144,K_SCROLL:145,K_LSHIFT:160,K_RSHIFT:161,K_LCONTROL:162,K_RCONTROL:163,K_LALT:164,K_RALT:165,K_COLON:186,K_EQUAL:187,K_COMMA:188,K_HYPHEN:189,K_PERIOD:190,K_SLASH:191,K_BKQUOTE:192,K_LBRKT:219,K_BKSLASH:220,K_RBRKT:221,K_QUOTE:222,K_oE2:226,K_OE2:226,K_oC1:193,K_OC1:193,"K_?C1":193,"k_?C1":193,K_oDF:223,K_ODF:223,K_LOPT:50001,K_ROPT:50002,K_NUMERALS:50003,K_SYMBOLS:50004,K_CURRENCIES:50005,K_UPPER:50006,K_LOWER:50007,K_ALPHA:50008,K_SHIFTED:50009,K_ALTGR:50010,K_TABBACK:50011,K_TABFWD:50012},V=Yi,Lg={2:V.K_1,3:V.K_2,4:V.K_3,5:V.K_4,6:V.K_5,7:V.K_6,8:V.K_7,9:V.K_8,10:V.K_9,11:V.K_0,12:V.K_HYPHEN,13:V.K_EQUAL,16:V.K_Q,17:V.K_W,18:V.K_E,19:V.K_R,20:V.K_T,21:V.K_Y,22:V.K_U,23:V.K_I,24:V.K_O,25:V.K_P,26:V.K_LBRKT,27:V.K_RBRKT,30:V.K_A,31:V.K_S,32:V.K_D,33:V.K_F,34:V.K_G,35:V.K_H,36:V.K_J,37:V.K_K,38:V.K_L,39:V.K_COLON,40:V.K_QUOTE,41:V.K_BKQUOTE,43:V.K_BKSLASH,44:V.K_Z,45:V.K_X,46:V.K_C,47:V.K_V,48:V.K_B,49:V.K_N,50:V.K_M,51:V.K_COMMA,52:V.K_PERIOD,53:V.K_SLASH,57:V.K_SPACE,86:V.K_oE2,115:V.K_oC1,125:V.K_oE2};var Ua={};Kt(Ua,{PRIVATE_USE_IDS:()=>Qa,TouchLayoutKeySp:()=>Fr});var Qa=["T_*_MT_SHIFT_TO_SHIFT","T_*_MT_SHIFT_TO_CAPS","T_*_MT_SHIFT_TO_DEFAULT"],Fr=(r=>(r[r.normal=0]="normal",r[r.special=1]="special",r[r.specialActive=2]="specialActive",r[r.customSpecial=3]="customSpecial",r[r.customSpecialActive=4]="customSpecialActive",r[r.deadkey=8]="deadkey",r[r.blank=9]="blank",r[r.spacer=10]="spacer",r))(Fr||{});var xa=55296,Za=56319,Xa=56320,Va=57343;function Ti(g){return g>=xa&&g<=Za}a(Ti,"Uni_IsSurrogate1");function wi(g){return g>=Xa&&g<=Va}a(wi,"Uni_IsSurrogate2");var e={};var eV={};var S=Ca(mr(),1);var Gr={modifierCodes:{LCTRL:m.LCTRLFLAG,RCTRL:m.RCTRLFLAG,LALT:m.LALTFLAG,RALT:m.RALTFLAG,SHIFT:m.K_SHIFTFLAG,CTRL:m.K_CTRLFLAG,ALT:m.K_ALTFLAG,META:m.K_METAFLAG,CAPS:m.CAPITALFLAG,NO_CAPS:m.NOTCAPITALFLAG,NUM_LOCK:m.NUMLOCKFLAG,NO_NUM_LOCK:m.NOTNUMLOCKFLAG,SCROLL_LOCK:m.SCROLLFLAG,NO_SCROLL_LOCK:m.NOTSCROLLFLAG,VIRTUAL_KEY:m.ISVIRTUALKEY,VIRTUAL_CHAR_KEY:m.VIRTUALCHARKEY},modifierBitmasks:{ALL:127,ALT_GR_SIM:5,CHIRAL:31,IS_CHIRAL:15,NON_CHIRAL:112,NON_LEGACY:111},stateBitmasks:{ALL:16128,CAPS:768,NUM_LOCK:3072,SCROLL_LOCK:12288},keyCodes:p({},Yi),codesUS:[["0123456789",";=,-./`","[\\]'"],[")!@#$%^&*(",":+<_>?~",'{|}"']],isFrameKey(g){switch(g){case"K_SHIFT":case"K_LOPT":case"K_ROPT":case"K_NUMLOCK":case"K_CAPS":return!0;default:if(Gr.keyCodes[g]>=5e4)return!0}return!1},getModifierState(g){var n=0;g.indexOf("shift")>=0&&(n|=m.K_SHIFTFLAG);var t=!1;g.indexOf("leftctrl")>=0&&(n|=m.LCTRLFLAG,t=!0),g.indexOf("rightctrl")>=0&&(n|=m.RCTRLFLAG,t=!0),g.indexOf("ctrl")>=0&&!t&&(n|=m.K_CTRLFLAG);var i=!1;return g.indexOf("leftalt")>=0&&(n|=m.LALTFLAG,i=!0),g.indexOf("rightalt")>=0&&(n|=m.RALTFLAG,i=!0),g.indexOf("alt")>=0&&!i&&(n|=m.K_ALTFLAG),n},getStateFromLayer(g){var n=0;return g.indexOf("caps")>=0?n|=m.CAPITALFLAG:n|=m.NOTCAPITALFLAG,n}},C=Gr;var ic=class ic{codeForEvent(n){return C.keyCodes[n.kName]||n.Lcode}forAny(n,t,i){var s="";if((s=this.forSpecialEmulation(n))!=null)return s;if(!t&&(s=this.forNumpadKeys(n))!=null)return s;if((s=this.forUnicodeKeynames(n,i))!=null)return s;if((s=this.forBaseKeys(n,i))!=null)return s;{let c=this.codeForEvent(n);return null}}isCommand(n){let t=this.codeForEvent(n);return!1}applyCommand(n,t){}forSpecialEmulation(n){switch(this.codeForEvent(n)){case C.keyCodes.K_BKSP:return"\b";case C.keyCodes.K_ENTER:return`
`;default:return null}}forNumpadKeys(n){if(n.Lmodifiers!=m.K_SHIFTFLAG&&n.Lmodifiers!=0)return null;if(n.Lcode>=C.keyCodes.K_NP0&&n.Lcode<=C.keyCodes.K_NPSLASH){if(n.Lcode<106)var t=n.Lcode-48;else t=n.Lcode-64;return String.fromCodePoint(t)}else return null}forUnicodeKeynames(n,t){let i=n.kName;if(!i||i.substr(0,2)!="U_")return null;let s="",c=i.substr(2).split("_");for(let l of c){let o=parseInt(l,16);if(0<=o&&o<=31||128<=o&&o<=159||isNaN(o)){t&&(t.errorLog="Suppressing Unicode control code in "+i);continue}else s+=String.fromCodePoint(o)}return s||null}forBaseKeys(n,t){let i=n.Lcode,s=n.Lmodifiers;if(s==m.K_SHIFTFLAG)s=1;else if(s!=0)return t&&(t.warningLog="KMW only defines default key output for the 'default' and 'shift' layers!"),null;try{if(i==C.keyCodes.K_SPACE)return" ";if(i>=C.keyCodes.K_0&&i<=C.keyCodes.K_9)return C.codesUS[s][0][i-C.keyCodes.K_0];if(i>=C.keyCodes.K_A&&i<=C.keyCodes.K_Z)return String.fromCharCode(i+(s?0:32));if(i>=C.keyCodes.K_COLON&&i<=C.keyCodes.K_BKQUOTE)return C.codesUS[s][1][i-C.keyCodes.K_COLON];if(i>=C.keyCodes.K_LBRKT&&i<=C.keyCodes.K_QUOTE)return C.codesUS[s][2][i-C.keyCodes.K_LBRKT];if(i==C.keyCodes.K_oE2)return s?"|":"\\"}catch(c){t&&(t.errorLog="Error detected with default mapping for key:  code = "+i+", shift state = "+(s==1?"shift":"default"))}return null}};a(ic,"DefaultRules");var Re=ic;var Aa=new Re,fn=class fn{constructor(n){this.isSynthetic=!0;for(let t in n)n[t]!==void 0&&(this[t]=n[t])}static constructNullKeyEvent(n){return new fn({Lcode:0,kName:"",device:n,Lstates:void 0,Lmodifiers:void 0,vkCode:void 0,LisVirtualKey:void 0})}get isModifier(){switch(this.Lcode){case 16:case 17:case 18:case 20:case 144:case 145:return!0;default:return!1}}setMnemonicCode(n,t){if(this.Lcode!=C.keyCodes.K_SPACE){let s=new fn(this);for(let c in this)s[c]=this[c];s.kName="K_xxxx",s.Lmodifiers=n?16:0;var i=Aa.forAny(s,!0);this.vkCode=this.Lcode,i?this.Lcode=i.charCodeAt(0):this.isModifier||delete this.Lcode}t&&(this.Lcode>=65&&this.Lcode<=90||this.Lcode>=97&&this.Lcode<=122)&&(this.Lmodifiers^=16,this.Lcode^=32)}};a(fn,"KeyEvent");var ne=fn;var lc=class lc{};a(lc,"KeyMap");var Me=lc,oc=class oc{constructor(){this.FF=new Me;this.Safari=new Me;this.Opera=new Me;this.FF.k61=187,this.FF.k59=186,this.FF.k173=189}};a(oc,"BrowserKeyMaps");var sc=oc,rc=class rc{constructor(){this.se=new Me,this.se.k220=192,this.se.k187=189,this.se.k219=187,this.se.k221=219,this.se.k186=221,this.se.k191=220,this.se.k192=186,this.se.k189=191,this.uk=new Me,this.uk.k223=192,this.uk.k192=222,this.uk.k222=226,this.uk.k220=220}};a(rc,"LanguageKeyMaps");var cc=rc,He=class He{constructor(){}static _usCodeInit(){var n=new Me,t=new Me;n.k192=96,n.k49=49,n.k50=50,n.k51=51,n.k52=52,n.k53=53,n.k54=54,n.k55=55,n.k56=56,n.k57=57,n.k48=48,n.k189=45,n.k187=61,n.k81=113,n.k87=119,n.k69=101,n.k82=114,n.k84=116,n.k89=121,n.k85=117,n.k73=105,n.k79=111,n.k80=112,n.k219=91,n.k221=93,n.k220=92,n.k65=97,n.k83=115,n.k68=100,n.k70=102,n.k71=103,n.k72=104,n.k74=106,n.k75=107,n.k76=108,n.k186=59,n.k222=39,n.k90=122,n.k88=120,n.k67=99,n.k86=118,n.k66=98,n.k78=110,n.k77=109,n.k188=44,n.k190=46,n.k191=47,t.k192=126,t.k49=33,t.k50=64,t.k51=35,t.k52=36,t.k53=37,t.k54=94,t.k55=38,t.k56=42,t.k57=40,t.k48=41,t.k189=95,t.k187=43,t.k81=81,t.k87=87,t.k69=69,t.k82=82,t.k84=84,t.k89=89,t.k85=85,t.k73=73,t.k79=79,t.k80=80,t.k219=123,t.k221=125,t.k220=124,t.k65=65,t.k83=83,t.k68=68,t.k70=70,t.k71=71,t.k72=72,t.k74=74,t.k75=75,t.k76=76,t.k186=58,t.k222=34,t.k90=90,t.k88=88,t.k67=67,t.k86=86,t.k66=66,t.k78=78,t.k77=77,t.k188=60,t.k190=62,t.k191=63,He._usCharCodes=[n,t]}static _USKeyCodeToCharCode(n){return He.usCharCodes[n.Lmodifiers&16?1:0]["k"+n.Lcode]}static get usCharCodes(){return He._usCharCodes||He._usCodeInit(),He._usCharCodes}};a(He,"KeyMapping"),He.browserMap=new sc,He.languageMap=new cc;var ie=He;function ae(g){if(typeof g!="object"||!g)return g;{let n=Array.isArray(g)?[]:{},t=Object.keys(g);for(let i of t)g[i]!==void 0&&(n[i]=ae(g[i]));return n}}a(ae,"deepCopy");var Y=class Y{constructor(n,t,i,s){switch(n.toLowerCase()){case Y.Browser.Chrome:case Y.Browser.Edge:case Y.Browser.Firefox:case Y.Browser.Native:case Y.Browser.Opera:case Y.Browser.Safari:this.browser=n.toLowerCase();break;default:this.browser=Y.Browser.Other}switch(t.toLowerCase()){case Y.FormFactor.Desktop:case Y.FormFactor.Phone:case Y.FormFactor.Tablet:this.formFactor=t.toLowerCase();break;default:throw"Invalid form factor specified for device: "+t}switch(i.toLowerCase()){case Y.OperatingSystem.Windows.toLowerCase():case Y.OperatingSystem.macOS.toLowerCase():case Y.OperatingSystem.Linux.toLowerCase():case Y.OperatingSystem.Android.toLowerCase():case Y.OperatingSystem.iOS.toLowerCase():this.OS=i.toLowerCase();break;default:this.OS=Y.OperatingSystem.Other}this.touchable=s}};a(Y,"DeviceSpec");var Gt=Y;(i=>{let g;(B=>(B.Chrome="chrome",B.Edge="edge",B.Firefox="firefox",B.Native="native",B.Opera="opera",B.Safari="safari",B.Other="other"))(g=i.Browser||(i.Browser={}));let n;(u=>(u.Windows="windows",u.macOS="macosx",u.Linux="linux",u.Android="android",u.iOS="ios",u.Other="other"))(n=i.OperatingSystem||(i.OperatingSystem={}));let t;(o=>(o.Desktop="desktop",o.Phone="phone",o.Tablet="tablet"))(t=i.FormFactor||(i.FormFactor={}))})(Gt||(Gt={}));function ac(g){return new Gt(g.browser,"desktop",g.OS,!1)}a(ac,"physicalKeyDeviceAlias");var W=Gt;var ge=class ge{};a(ge,"KEYMAN_VERSION"),ge.VERSION="19.0.62",ge.VERSION_RELEASE="19.0",ge.VERSION_MAJOR="19",ge.VERSION_MINOR="0",ge.VERSION_PATCH="62",ge.TIER="alpha",ge.VERSION_TAG="-alpha",ge.VERSION_WITH_TAG="19.0.62-alpha",ge.VERSION_ENVIRONMENT="alpha",ge.VERSION_GIT_TAG="release@19.0.62-alpha";var Ln=ge,it=Ln;var he=class he{constructor(n){if(n==null){this.components=[].concat(he.DEVELOPER_VERSION_FALLBACK.components);return}if(Array.isArray(n)){let s=n;if(s.length<2)throw new Error("Version string must have at least a major and minor component!");this.components=[].concat(s);return}let t=n.split("."),i=[];if(t.length<2)throw new Error("Version string must have at least a major and minor component!");for(let s=0;s<t.length;s++){let c=parseInt(t[s],10);if(isNaN(c))throw new Error("Version string components must be numerical!");i.push(c)}this.components=i}get major(){return this.components[0]}get minor(){return this.components[1]}toString(){return this.components.join(".")}toJSON(){return this.toString()}equals(n){return this.compareTo(n)==0}precedes(n){return this.compareTo(n)<0}compareTo(n){let t=this.components.length<n.components.length,i=this.components.length<n.components.length?this.components.length:n.components.length,s;for(s=0;s<i;s++){let l=this.components[s]-n.components[s];if(l!=0)return l}let c=t?n.components:this.components;do{if(c[s]>0)return t?-1:1;s++}while(s<c.length);return 0}};a(he,"Version"),he.CURRENT=new he(it.VERSION_RELEASE),he.DEVELOPER_VERSION_FALLBACK=new he([9,0,0]),he.NO_DEFAULT_KEYCAPS=new he([12,0]),he.MAC_POSSIBLE_IPAD_ALIAS=new he([10,15]);var z=he;function Dt(){return typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof self!="undefined"?self:global}a(Dt,"getGlobalObject");var Q={};Kt(Q,{charAt:()=>ka,charCodeAt:()=>Ha,codePointToCodeUnit:()=>pt,codeUnitToCodePoint:()=>Na,enableSupplementaryPlane:()=>Ra,indexOf:()=>fa,lastIndexOf:()=>La,length:()=>vn,nextChar:()=>Ct,prevChar:()=>Cr,slice:()=>va,substr:()=>pr,substring:()=>Ja});var Ue=!1;function Ra(g){Ue=g}a(Ra,"enableSupplementaryPlane");function Ha(g,n){let t=g;if(!Ue)return g.charCodeAt(n);let i=0;if(n<0||n>=t.length)return NaN;for(let c=0;c<n;c++)if(i=Ct(t,i),i===null)return NaN;let s=t.charCodeAt(i);if(s>=55296&&s<=56319&&t.length>i+1){let c=t.charCodeAt(i+1);if(c>=56320&&c<=57343)return(s-55296<<10)+(c-56320)+65536}return s}a(Ha,"charCodeAt");function fa(g,n,t){let i=g;if(!Ue)return g.indexOf(n,t);let s=i.indexOf(n,t);if(s<0)return s;let c=0;for(let l=0;l!==null&&l<s;l=Ct(i,l))c++;return c}a(fa,"indexOf");function La(g,n,t){let i=g;if(!Ue)return i.lastIndexOf(n,t);let s=i.lastIndexOf(n,t);if(s<0)return s;let c=0;for(let l=0;l!==null&&l<s;l=Ct(i,l))c++;return c}a(La,"lastIndexOf");function vn(g){let n=g;if(!Ue)return n.length;if(n.length==0)return 0;let t,i;for(t=0,i=0;i!==null;t++)i=Ct(n,i);return t}a(vn,"length");function va(g,n,t){let i=g;if(!Ue)return i.slice(n,t);let s=pt(i,n),c=pt(i,t);return s===null||c===null?"":i.slice(s,c)}a(va,"slice");function pr(g,n,t){let i=g;if(!Ue)return n>-1?i.substr(n,t):i.substr(i.length+n,-n);n<0&&(n=vn(i)+n),n<0&&(n=0);let s=pt(i,n),c=s;if(s===null)return"";if(arguments.length<3)c=i.length;else for(let l=0;l<t;l++)c=Ct(i,c);return c===null?i.substring(s):i.substring(s,c)}a(pr,"substr");function Ja(g,n,t){let i=g;if(!Ue)return i.substring(n,t);let s,c;if(typeof t=="undefined")s=pt(i,n),c=i.length;else{if(n>t){let l=n;n=t,t=l}s=pt(i,n),c=pt(i,t)}return(isNaN(s)||s===null)&&(s=0),(isNaN(c)||c===null)&&(c=i.length),i.substring(s,c)}a(Ja,"substring");function Ct(g,n){let t=g;if(n===null||n<0||n>=t.length-1)return null;if(!Ue)return n+1;let i=t.charCodeAt(n);if(i>=55296&&i<=56319&&t.length>n+1){let s=t.charCodeAt(n+1);if(s>=56320&&s<=57343)return n==t.length-2?null:n+2}return n+1}a(Ct,"nextChar");function Cr(g,n){let t=g;if(n==null||n<=0||n>t.length)return null;if(!Ue)return n-1;let i=t.charCodeAt(n-1);if(i>=56320&&i<=57343&&n>1){let s=t.charCodeAt(n-2);if(s>=55296&&s<=56319)return n-2}return n-1}a(Cr,"prevChar");function pt(g,n){if(n===null)return null;let t=g,i=0;if(n<0){i=t.length;for(let s=0;s>n;s--)i=Cr(t,i);return i}if(n==vn(t))return t.length;for(let s=0;s<n;s++)i=Ct(t,i);return i}a(pt,"codePointToCodeUnit");function Na(g,n){let t=g;return n===null?null:n==0?0:n<0?vn(t.substr(n)):vn(t.substr(0,n))}a(Na,"codeUnitToCodePoint");function ka(g,n){let t=g;return Ue?n>=0?pr(t,n,1):"":t.charAt(n)}a(ka,"charAt");var gc=class gc{constructor(n){this._isFulfilled=!1;this._isRejected=!1;this._promise=new Promise((t,i)=>{this._resolve=s=>{this._isFulfilled=!0,t(s)},this._reject=s=>{this._isRejected=!0,i(s)},n&&n(this._resolve,this._reject)})}get resolve(){return this._resolve}get reject(){return this._reject}get isFulfilled(){return this._isFulfilled}get isRejected(){return this._isRejected}get isResolved(){return this.isFulfilled||this.isRejected}then(n,t){return this._promise.then(n,t)}catch(n){return this._promise.catch(n)}finally(n){return this._promise.finally(n)}get corePromise(){return this._promise}};a(gc,"ManagedPromise");var f=gc;var dc=class dc extends f{constructor(n){let t=null;super(c=>{t=setTimeout(()=>{this.isResolved||c(!0)},n)}),this.timerHandle=t;let i=this._resolve;this._resolve=c=>{clearTimeout(this.timerHandle),i(c)};let s=this._reject;this._reject=c=>{clearTimeout(this.timerHandle),s(c)}}};a(dc,"TimeoutPromise");var ze=dc,de=a(g=>new ze(g).corePromise,"timedPromise");var k=Ua.TouchLayoutKeySp;var Ea=200,J=class J{static buildDefaultLayout(n,t,i){var Rn;let s=i;typeof J.dfltLayout[s]!="object"&&(s="desktop");let c=C.modifierBitmasks.NON_CHIRAL,l=z.CURRENT;t&&(c=t.modifierBitmask,l=t.compilerVersion),n||(n=this.DEFAULT_RAW_SPEC);var o=ae(J.dfltLayout[s]),r,d=o.layer,u=n.KLS,B=n.K102,b,I,h,F,y,G,x=(c&C.modifierBitmasks.IS_CHIRAL)!=0;if(n.F){let we=/^(?:(?:italic|bold) )* *[0-9.eE-]+(?:[a-z]+) "(.+)"$/.exec(n.F);we&&(o.font=we[1])}var Z=!(typeof u=="undefined"||!u);Z||(u=n.KLS=J.processLegacyDefinitions(n.BK));var U=Object.getOwnPropertyNames(u),H=[];if(U.splice(U.indexOf("default"),1),U=["default"].concat(U),t&&t.emulatesAltGr&&(U.indexOf("leftctrl-leftalt")==-1&&U.indexOf("rightalt")!=-1&&(U.push("leftctrl-leftalt"),u["leftctrl-leftalt"]=u.rightalt),U.indexOf("leftctrl-leftalt-shift")==-1&&U.indexOf("rightalt-shift")!=-1&&(U.push("leftctrl-leftalt-shift"),u["leftctrl-leftalt-shift"]=u["rightalt-shift"])),o.displayUnderlying=t?!!t.scriptObject.KDU:!1,i=="desktop")for(H=J.generateLayerIds(x),r=0;r<H.length;r++)U.indexOf(H[r])!=-1&&H.splice(r--,1);var L=U.concat(H);if(Z&&i!="desktop"){var v=null;F=d[0].row;for(var Ae=0;Ae<F.length;Ae++){G=F[Ae].key;for(var Ye=0;Ye<G.length;Ye++)y=G[Ye],y.id=="K_SHIFT"&&(v=y)}if(v){v.sk=[];for(let we in u){if(we=="default"||we=="shift")continue;var wt=J.modifierSpecials[we];let nt={id:`K_${wt}`,text:wt,sp:1,nextlayer:we};v.sk.push(nt)}}else console.warn("Error in default layout - cannot find default Shift key!")}for(r=0;r<L.length;r++)r>0&&(d[r]=ae(d[0])),d[r].id=L[r],d[r].nextlayer=L[r],J.formatDefaultLayer(d[r],x,i,!!B);for(r=0;r<d.length;r++){var q=d[r],Te,v=null,Sn=null,mt=null,Wn=null,tt=u[q.id],Mt=q.id=="shift"?1:0,An=q.id=="default"||Mt?1:0;for(F=q.row,b=0;b<F.length;b++)for(G=F[b].key,I=0;I<G.length;I++){switch(y=G[I],Te=J.dfltCodes.indexOf(y.id),(tt||An)&&(tt&&Te>=0&&Te<tt.length&&(y.text=tt[Te]),An&&l.precedes(z.NO_DEFAULT_KEYCAPS)&&y.id!="K_SPACE"&&Te+65*Mt<J.dfltText.length&&y.text!==null&&(y.text=y.text||J.dfltText[Te+65*Mt])),y.text!==null&&(y.text=y.text||""),y.id){case"K_SHIFT":v=y;break;case"K_CAPS":Sn=y;break;case"K_NUMLOCK":mt=y;break;case"K_SCROLL":Wn=y;break}if(y.sk!=null){for(h=0;h<y.sk.length;h++)U.indexOf(y.sk[h].nextlayer)==-1&&y.sk.splice(h--,1);y.sk.length==0&&(y.sk=null)}}q.shiftKey=v,q.capsKey=Sn,q.numKey=mt,q.scrollKey=Wn;let nt=d[r].id;i!="desktop"&&r>0&&v!=null&&(v.sp=k.specialActive,v.sk=null,v.text=(Rn=J.modifierSpecials[nt])!=null?Rn:"*Shift*")}return o}static getLayerId(n){var t="";return n==0?"default":(n&m.LCTRLFLAG&&(t=(t.length>0?t+"-":"")+"leftctrl"),n&m.RCTRLFLAG&&(t=(t.length>0?t+"-":"")+"rightctrl"),n&m.LALTFLAG&&(t=(t.length>0?t+"-":"")+"leftalt"),n&m.RALTFLAG&&(t=(t.length>0?t+"-":"")+"rightalt"),n&m.K_SHIFTFLAG&&(t=(t.length>0?t+"-":"")+"shift"),n&m.K_CTRLFLAG&&(t=(t.length>0?t+"-":"")+"ctrl"),n&m.K_ALTFLAG&&(t=(t.length>0?t+"-":"")+"alt"),t)}static generateLayerIds(n){var t,i;n?(t=32,i=1):(t=8,i=16);for(var s=[],c=0;c<t;c++)s.push(J.getLayerId(c*i));return s}static formatDefaultLayer(n,t,i,s){for(var c=n.id,l=0;l<n.row.length;l++)for(var o=n.row[l],r=o.key,d=0;d<r.length;d++){var u=r[d];switch(u.id){case"K_SHIFT":case"K_LSHIFT":case"K_RSHIFT":c.indexOf("shift")!=-1&&(u.sp=k.specialActive),i!="desktop"&&(c!="default"?u.nextlayer="default":u.nextlayer="shift");break;case"K_LCTRL":case"K_LCONTROL":if(t){c.indexOf("leftctrl")!=-1&&(u.sp=k.specialActive);break}case"K_RCTRL":case"K_RCONTROL":if(t){c.indexOf("rightctrl")!=-1&&(u.sp=k.specialActive);break}case"K_CONTROL":c.indexOf("ctrl")!=-1&&(!t||c.indexOf("leftctrl")!=-1&&c.indexOf("rightctrl")!=-1)&&(u.sp=k.specialActive);break;case"K_LALT":if(t){c.indexOf("leftalt")!=-1&&(u.sp=k.specialActive);break}case"K_RALT":if(t){c.indexOf("rightalt")!=-1&&(u.sp=k.specialActive);break}case"K_ALT":c.indexOf("alt")!=-1&&(!t||c.indexOf("leftalt")!=-1&&c.indexOf("rightalt")!=-1)&&(u.sp=k.specialActive);break;case"K_oE2":(typeof s=="undefined"||!s)&&(i=="desktop"?(r.splice(d--,1),r[0].width=Ea):r[d].sp=k.spacer);break}}}static processLegacyDefinitions(n){for(var t=J.generateLayerIds(!1),i={},s=0;s<t.length;s++){for(var c=t[s],l=[],o=!1,r=0;r<65;r++){var d=r+65*s;l.push(n[d]),d<n.length&&n[d]!=""&&r!=J.dfltCodes.indexOf("K_SPACE")&&(o=!0)}o&&(i[c]=l)}return(typeof i.default=="undefined"||!i.default)&&(i.default=[""]),(typeof i.shift=="undefined"||!i.shift)&&(i.shift=[""]),i}};a(J,"Layouts"),J.dfltCodes=["K_BKQUOTE","K_1","K_2","K_3","K_4","K_5","K_6","K_7","K_8","K_9","K_0","K_HYPHEN","K_EQUAL","K_*","K_*","K_*","K_Q","K_W","K_E","K_R","K_T","K_Y","K_U","K_I","K_O","K_P","K_LBRKT","K_RBRKT","K_BKSLASH","K_*","K_*","K_*","K_A","K_S","K_D","K_F","K_G","K_H","K_J","K_K","K_L","K_COLON","K_QUOTE","K_*","K_*","K_*","K_*","K_*","K_oE2","K_Z","K_X","K_C","K_V","K_B","K_N","K_M","K_COMMA","K_PERIOD","K_SLASH","K_*","K_*","K_*","K_*","K_*","K_SPACE"],J.dfltText="`1234567890-=§~~qwertyuiop[]\\~~~asdfghjkl;'~~~~~?zxcvbnm,./~~~~~ ~!@#$%^&*()_+§~~QWERTYUIOP{}\\~~~ASDFGHJKL:\"~~~~~?ZXCVBNM<>?~~~~~ ",J.DEFAULT_RAW_SPEC={F:"Tahoma",BK:J.dfltText.split("")},J.modifierSpecials={leftalt:"*LAlt*",rightalt:"*RAlt*",alt:"*Alt*",leftctrl:"*LCtrl*",rightctrl:"*RCtrl*",ctrl:"*Ctrl*","ctrl-alt":"*AltGr*","leftctrl-leftalt":"*LAltCtrl*","rightctrl-rightalt":"*RAltCtrl*","leftctrl-leftalt-shift":"*LAltCtrlShift*","rightctrl-rightalt-shift":"*RAltCtrlShift*",shift:"*Shift*","shift-alt":"*AltShift*","shift-ctrl":"*CtrlShift*","shift-ctrl-alt":"*AltCtrlShift*","leftalt-shift":"*LAltShift*","rightalt-shift":"*RAltShift*","leftctrl-shift":"*LCtrlShift*","rightctrl-shift":"*RCtrlShift*"},J.dfltShiftToCaps={id:"T_*_MT_SHIFT_TO_CAPS",text:"*ShiftLock*",sp:1,nextlayer:"caps"},J.dfltShiftToDefault={id:"T_*_MT_SHIFT_TO_DEFAULT",text:"*Shift*",sp:1,nextlayer:"default"},J.dfltShiftToShift={id:"T_*_MT_SHIFT_TO_SHIFT",text:"*Shift*",sp:1,nextlayer:"shift"},J.dfltLayout={desktop:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:1,key:[{id:"K_BKQUOTE"},{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{id:"K_BKSP",text:"*BkSp*",sp:1,width:130}]},{id:2,key:[{id:"K_TAB",text:"*Tab*",sp:1,width:130},{id:"K_Q"},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{id:"K_BKSLASH"}]},{id:3,key:[{id:"K_CAPS",text:"*Caps*",sp:1,width:165},{id:"K_A"},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_ENTER",text:"*Enter*",sp:1,width:165}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:130},{id:"K_oE2"},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_RSHIFT",text:"*Shift*",sp:1,width:130}]},{id:5,key:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:170},{id:"K_LALT",text:"*Alt*",sp:1,width:160},{id:"K_SPACE",text:"",width:770},{id:"K_RALT",text:"*Alt*",sp:1,width:160},{id:"K_RCONTROL",text:"*Ctrl*",sp:1,width:170}]}]}]},tablet:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:0,key:[{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{sp:10,width:1}]},{id:1,key:[{id:"K_Q",pad:25},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{sp:10,width:1}]},{id:2,key:[{id:"K_A",pad:50},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_BKSLASH",width:90}]},{id:3,key:[{id:"K_oE2",width:90},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_BKQUOTE"},{sp:10,width:1}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:200,sk:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:50,nextlayer:"ctrl"},{id:"K_LCONTROL",text:"*LCtrl*",sp:1,width:50,nextlayer:"leftctrl"},{id:"K_RCONTROL",text:"*RCtrl*",sp:1,width:50,nextlayer:"rightctrl"},{id:"K_LALT",text:"*Alt*",sp:1,width:50,nextlayer:"alt"},{id:"K_LALT",text:"*LAlt*",sp:1,width:50,nextlayer:"leftalt"},{id:"K_RALT",text:"*RAlt*",sp:1,width:50,nextlayer:"rightalt"},{id:"K_ALTGR",text:"*AltGr*",sp:1,width:50,nextlayer:"ctrl-alt"}]},{id:"K_LOPT",text:"*Menu*",sp:1,width:150},{id:"K_SPACE",text:"",width:570},{id:"K_BKSP",text:"*BkSp*",sp:1,width:150},{id:"K_ENTER",text:"*Enter*",sp:1,width:200}]}]}]},phone:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:0,key:[{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{sp:10,width:1}]},{id:1,key:[{id:"K_Q",pad:25},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{sp:10,width:1}]},{id:2,key:[{id:"K_A",pad:50},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_BKSLASH",width:90}]},{id:3,key:[{id:"K_oE2",width:90},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_BKQUOTE"},{sp:10,width:1}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:200,sk:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:50,nextlayer:"ctrl"},{id:"K_LCONTROL",text:"*LCtrl*",sp:1,width:50,nextlayer:"leftctrl"},{id:"K_RCONTROL",text:"*RCtrl*",sp:1,width:50,nextlayer:"rightctrl"},{id:"K_LALT",text:"*Alt*",sp:1,width:50,nextlayer:"alt"},{id:"K_LALT",text:"*LAlt*",sp:1,width:50,nextlayer:"leftalt"},{id:"K_RALT",text:"*RAlt*",sp:1,width:50,nextlayer:"rightalt"},{id:"K_ALTGR",text:"*AltGr*",sp:1,width:50,nextlayer:"ctrl-alt"}]},{id:"K_LOPT",text:"*Menu*",width:150,sp:1},{id:"K_SPACE",width:570,text:""},{id:"K_BKSP",text:"*BkSp*",width:150,sp:1},{id:"K_ENTER",text:"*Enter*",width:200,sp:1}]}]}]}};var T=J;function fe(g,n,t){t.enumerable=!0}a(fe,"Enumerable");var Qr={id:"string",text:"string",layer:"string",nextlayer:"string",font:"string",fontsize:"string",sp:"number",pad:"number",width:"number",sk:"subkeys",flick:"flicks",multitap:"subkeys",hint:"string",default:"boolean"},Ur=["n","ne","e","se","s","sw","w","nw"];function uc(g,n){let t=Object.getPrototypeOf(n);for(let i in n)if(!g.hasOwnProperty(i)){let s=Object.getOwnPropertyDescriptor(t,i);s?Object.defineProperty(g,i,s):g[i]=n[i]}return g}a(uc,"assignDefaultsWithPropDefs");var ee=class ee{constructor(n,t,i){this.isMnemonic=!1;Object.assign(this,n),!this.text&&typeof this.id=="string"&&(this.text=se.unicodeIDToText(this.id)),this.displayLayer=i,this.layer=this.layer||i,this._baseKeyEvent=()=>this.constructBaseKeyEvent(t,i)}get baseKeyID(){if(typeof this.id!="undefined")return this.id}get isPadding(){return this.sp==k.spacer}get coreID(){if(typeof this.id=="undefined")return;let n=this.id||"";return this.displayLayer!=this.layer&&(n=n+"+"+this.layer),n}get elementID(){if(typeof this.id!="undefined")return this.displayLayer+"-"+this.coreID}get baseKeyEvent(){let n=this._baseKeyEvent;return typeof n=="function"&&(n=n()),new ne(n)}static unicodeIDToText(n,t){if(!n||n.substring(0,2)!="U_")return null;let i="",s=n.substring(2).split("_");for(let c of s){let l=parseInt(c,16);if(0<=l&&l<=31||128<=l&&l<=159||isNaN(l)){t&&t(c);continue}else i+=String.fromCodePoint(l)}return i||null}static sanitize(n){typeof n.width=="string"&&(n.width=parseInt(n.width,10)),n.width||(n.width=se.DEFAULT_KEY_WIDTH),typeof n.pad=="string"&&(n.pad=parseInt(n.pad,10)),n.pad||(n.pad=se.DEFAULT_PAD),typeof n.sp=="string"&&(n.sp=Number.parseInt(n.sp,10)),n.sp||(n.sp=se.DEFAULT_KEY.sp);for(let t of Object.keys(Qr)){let i=Qr[t];switch(i){case"subkeys":let s=n[t];if(s===void 0)break;if(!Array.isArray(s))delete n[t];else for(let o=0;o<s.length;o++){let r=s[o];typeof r!="object"?s.splice(o--,1):se.sanitize(r)}break;case"flicks":let c=n[t];if(c===void 0)break;if(typeof c!="object")delete n[t];else for(let o of Ur){let r=c[o];if(r===void 0)break;typeof r!="object"?delete c[o]:se.sanitize(r)}break;default:let l=n[t];l!==void 0&&typeof l!=i&&delete n[t]}}n.text||(n.text=se.DEFAULT_KEY.text)}constructBaseKeyEvent(n,t){let i=this.layer||t||"",s=this.id?this.id.toUpperCase():null,c={Lmodifiers:C.getModifierState(i),Lstates:C.getStateFromLayer(i),Lcode:s?C.keyCodes[s]:0,LisVirtualKey:!0,vkCode:0,kName:s,kLayer:i,kbdLayer:t,kNextLayer:this.nextlayer,device:null,isSynthetic:!0},l=new ne(c);if(n.keyboard){let o=n.keyboard;o.isMnemonic&&!(n.isDefault&&n.formFactor!="desktop")?l.Lcode!=C.keyCodes.K_SPACE&&(l.vkCode=l.Lcode,this.isMnemonic=!0):l.vkCode=l.Lcode,o.definesPositionalOrMnemonic||(l.Lcode=ie._USKeyCodeToCharCode(l),l.LisVirtualKey=!1)}return l}};a(ee,"ActiveKeyBase"),ee.DEFAULT_PAD=15,ee.DEFAULT_RIGHT_MARGIN=15,ee.DEFAULT_KEY_WIDTH=100,ee.DEFAULT_KEY={text:"",width:ee.DEFAULT_KEY_WIDTH,sp:k.normal,pad:ee.DEFAULT_PAD},Qe([fe],ee.prototype,"baseKeyID",1),Qe([fe],ee.prototype,"isPadding",1),Qe([fe],ee.prototype,"coreID",1),Qe([fe],ee.prototype,"elementID",1),Qe([fe],ee.prototype,"baseKeyEvent",1),Qe([fe],ee.prototype,"constructBaseKeyEvent",1);var Jn=ee,Di=class Di extends Jn{getSubkey(n){if(this.sk){for(let t of this.sk)if(t.coreID==n)return t}return null}constructor(n,t,i){super(n,t,i);let s=this.sk;if(s)for(let o=0;o<s.length;o++)s[o]=new Qt(s[o],t,i);let c=this.multitap;if(c)for(let o=0;o<c.length;o++)c[o]=new Qt(c[o],t,i);let l=this.flick;if(l)for(let o in l)l[o]=new Qt(l[o],t,i);Di.determineHint(this,t.defaultHint)}static determineHint(n,t){var i;if(n.hint){n.hintSrc=n;return}if(t!=null&&t.includes("flick-")){if(n.flick){let s=t.substring(6);(i=n.flick[s])!=null&&i.text&&(n.hintSrc=n.flick[s])}return}switch(t){case"none":return;case"multitap":n.multitap&&(n.hintSrc=n.multitap[0]);return;case"flick":if(n.flick){for(let s of Ur)if(n.flick[s]){n.hintSrc=n.flick[s];return}}return;case"longpress":n.sk&&(n.hintSrc=n.sk[0]);return;case"dot":default:n.sk&&(n.hint="•",n.hintSrc=n);return}}};a(Di,"ActiveKey");var se=Di,Bc=class Bc extends Jn{};a(Bc,"ActiveSubKey");var Qt=Bc,st=class st{constructor(){}static sanitize(n){for(let t of n.key)t==null?n.key.length=n.key.length-1:se.sanitize(t);typeof n.id=="string"&&(n.id=Number.parseInt(n.id,10))}static polyfill(n,t,i,s,c){let l=n.key,o=Jn.DEFAULT_KEY;for(let b=0;b<l.length;b++){let I=l[b],h=Object.keys(o);for(let y of h){let G=y;typeof I[G]!="string"&&typeof I[G]!="number"&&(I[G]=o[G])}switch(I.sp){case k.special:!st.SPECIAL_LABEL.test(I.text)&&I.text!=""&&(I.sp=k.customSpecial);break;case k.specialActive:!st.SPECIAL_LABEL.test(I.text)&&I.text!=""&&(I.sp=k.customSpecialActive);break}let F=new se(I,t,i);l[b]=F}let r=a(function(b,I,h,F){b.proportionalPad=I,b.proportionalWidth=h,b.proportionalX=F+I+h/2},"setProportions"),d=0;for(let b=0;b<l.length-1;b++){let I=l[b];r(I,I.pad/s,I.width/s,d),d+=I.proportionalPad,d+=I.proportionalWidth}let u=se.DEFAULT_RIGHT_MARGIN/s;if(l.length>0){let b=l[l.length-1];if(l.length==1&&b.pad<0){let I=b.width/s,h=1-(d+I+u);r(b,h,I,d)}else{let I=b.pad/s,h=1-(d+I+u);r(b,I,h,d)}}uc(n,new st);let B=n;B.proportionalY=c}populateKeyMap(n){this.key.forEach(function(t){t.coreID&&(n[t.coreID]=t)})}};a(st,"ActiveRow"),st.SPECIAL_LABEL=/\*\w+\*/,Qe([fe],st.prototype,"populateKeyMap",1);var zi=st,Ot=class Ot{constructor(){}static sanitize(n){for(let t of n.row)zi.sanitize(t)}static polyfill(n,t){n.aligned=!1;let i=n.row,s=0;for(let o of i){let r=0,d=o.key;for(let u of d)r+=u.width+u.pad;r>s&&(s=r)}t.formFactor=="desktop"?s+=5:s+=se.DEFAULT_RIGHT_MARGIN;let c=n.row.length;for(let o=0;o<c;o++){let r=(o+.5)/c;zi.polyfill(n.row[o],t,n.id,s,r)}uc(n,new Ot);let l=n;l.totalWidth=s,l.defaultKeyProportionalWidth=se.DEFAULT_KEY.width/s,l.rowProportionalHeight=1/c,l.keyMap=l.constructKeyMap()}constructKeyMap(){let n={};return this.row.forEach(function(t){t.populateKeyMap(n)}),n}getKey(n){n.indexOf(this.id+"-")==0&&(n=n.replace(this.id+"-",""));let t=n.split("::");return t.length>1?this.keyMap[t[0]].getSubkey(t[1]):this.keyMap[n]}};a(Ot,"ActiveLayer"),Qe([fe],Ot.prototype,"constructKeyMap",1),Qe([fe],Ot.prototype,"getKey",1);var Ki=Ot,Pt=class Pt{constructor(){this.hasFlicks=!1;this.hasLongpresses=!1;this.hasMultitaps=!1}getLayer(n){if(!this.layerMap[n]){let t=this.layer.find(i=>i.id==n);if(!t)return null;Ki.sanitize(t),Ki.polyfill(t,this),this.layerMap[n]=t}return this.layerMap[n]}static correctLayerEmptyRowBug(n){for(let t=0;t<n.length;t++){let s=n[t].row,c;for(c=s.length-1;c>=0;c--)(!Array.isArray(s[c].key)||s[c].key.length==0)&&s.splice(c,1)}}static sanitize(n){Pt.correctLayerEmptyRowBug(n.layer)}static polyfill(n,t,i){if(n==null)throw new Error("Cannot build an ActiveLayout for a null specification.");let s={hasFlicks:!1,hasLongpresses:!1,hasMultitaps:!1};this.sanitize(n);for(let o of n.layer)for(let r of o.row)for(let d of r.key)s.hasLongpresses||(s.hasLongpresses=!!d.sk),s.hasFlicks||(s.hasFlicks=!!d.flick),s.hasMultitaps||(s.hasMultitaps=!!d.multitap);let c={};uc(n,new Pt);let l=n;if(l.keyboard=t,l.formFactor=i,l.layerMap=c,i!="desktop"&&n.layer.find(o=>o.id=="caps")){let o=l.getLayer("default"),r=l.getLayer("shift"),d=o.getKey("K_SHIFT"),u=r==null?void 0:r.getKey("K_SHIFT");d&&u&&!d.multitap&&!u.multitap&&!d.sk&&!u.sk&&(s.hasMultitaps=!0,d.multitap=[p({},T.dfltShiftToCaps),p({},T.dfltShiftToDefault)],u.multitap=[p({},T.dfltShiftToCaps),p({},T.dfltShiftToShift)],d.multitap.forEach((B,b)=>d.multitap[b]=new Qt(B,l,"default")),u.multitap.forEach((B,b)=>u.multitap[b]=new Qt(B,l,"shift")))}return l.hasFlicks=s.hasFlicks,l.hasLongpresses=s.hasLongpresses,l.hasMultitaps=s.hasMultitaps,l}};a(Pt,"ActiveLayout"),Qe([fe],Pt.prototype,"getLayer",1);var jt=Pt;var hc=class hc{constructor(){this.stores={}}};a(hc,"CacheTag");var Ic=hc,bc=(t=>(t[t.NOT_LOADED=void 0]="NOT_LOADED",t[t.POLYFILLED=1]="POLYFILLED",t))(bc||{}),_t=class _t{constructor(n){n?this.scriptObject=n:this.scriptObject=_t.DEFAULT_SCRIPT_OBJECT,this.layoutStates={}}process(n,t){return this.scriptObject.gs(n,t)}processNewContextEvent(n,t){return this.scriptObject.gn?this.scriptObject.gn(n,t):!1}processPostKeystroke(n,t){return this.scriptObject.gpk?this.scriptObject.gpk(n,t):!1}get isHollow(){return this.scriptObject==_t.DEFAULT_SCRIPT_OBJECT}get id(){return this.scriptObject.KI}get name(){return this.scriptObject.KN}get variableStores(){let n=this.scriptObject.KVS,t={};if(Array.isArray(n))for(let i of n)t[i]=this.scriptObject[i];return t}set variableStores(n){let t=this.scriptObject.KVS;if(Array.isArray(t))for(let i of t)typeof n[i]=="string"&&(this.scriptObject[i]=n[i])}get _legacyLayoutSpec(){return this.scriptObject.KV}get _layouts(){return this.scriptObject.KVKL}set _layouts(n){this.scriptObject.KVKL=n}get compilerVersion(){return new z(this.scriptObject.KVER)}get isMnemonic(){return!!this.scriptObject.KM}get definesPositionalOrMnemonic(){return typeof this.scriptObject.KM!="undefined"}get helpText(){return this.scriptObject.KH}get hasScript(){return!!this.scriptObject.KHF}embedScript(n){this.scriptObject.KHF(n)}get oskStyling(){return this.scriptObject.KCSS}get isCJK(){var n;return typeof this.scriptObject.KLC!="undefined"?n=this.scriptObject.KLC:typeof this.scriptObject.LanguageCode!="undefined"&&(n=this.scriptObject.LanguageCode),n=="cmn"||n=="jpn"||n=="kor"}get isRTL(){return!!this.scriptObject.KRTL}get modifierBitmask(){return this.scriptObject.KMBM||C.modifierBitmasks.NON_CHIRAL}get isChiral(){return!!(this.modifierBitmask&C.modifierBitmasks.IS_CHIRAL)}get desktopFont(){return this.scriptObject.KV?this.scriptObject.KV.F:null}get cacheTag(){let n=this.scriptObject._kmw;return n||(n=new Ic,this.scriptObject._kmw=n),n}get explodedStores(){return this.cacheTag.stores}get emulatesAltGr(){if(!this.isChiral||this._legacyLayoutSpec==null)return!1;let n=this._legacyLayoutSpec.KLS;if(!n)return!1;var t=m.LCTRLFLAG|m.LALTFLAG,i=n[T.getLayerId(t)],s=n[T.getLayerId(m.K_SHIFTFLAG|t)];if(i!=null&&i!=n[T.getLayerId(m.RALTFLAG)]||s!=null&&s!=n[T.getLayerId(m.RALTFLAG|m.K_SHIFTFLAG)])return!1;var c=this.modifierBitmask;return(c&t)!=t||i==null&&s==null,!0}get usesSupplementaryPlaneChars(){let n=this.scriptObject;return n&&(n.KS&&n.KS==1||n.KN=="Hieroglyphic")}get version(){return this.scriptObject.KBVER||""}usesDesktopLayoutOnDevice(n){return this.scriptObject.KVKL?n.formFactor==W.FormFactor.Desktop:!0}notify(n,t,i){typeof this.scriptObject.KNS=="function"&&this.scriptObject.KNS(n,t,i)}findOrConstructLayout(n){if(this._layouts){if(this._layouts[n]!==void 0)return this._layouts[n];if(n==W.FormFactor.Phone&&this._layouts[W.FormFactor.Tablet])return this._layouts[W.FormFactor.Phone]=this._layouts[W.FormFactor.Tablet];if(n==W.FormFactor.Tablet&&this._layouts[W.FormFactor.Phone])return this._layouts[W.FormFactor.Tablet]=this._layouts[W.FormFactor.Phone]}let t=null;if(this._legacyLayoutSpec!=null&&this._legacyLayoutSpec.KLS)t=this._legacyLayoutSpec;else if(this._legacyLayoutSpec!=null&&this._legacyLayoutSpec.BK!=null){for(var i=this._legacyLayoutSpec.BK,s=0;s<i.length;s++)if(i[s].length>0){t=this._legacyLayoutSpec;break}}if(!t&&(this.helpText==""||n!=W.FormFactor.Desktop)&&(t={F:"Tahoma",BK:T.dfltText}),this._layouts||(this._layouts={}),t){let c=this._layouts[n]=T.buildDefaultLayout(t,this,n);return c.isDefault=!0,c}else return this._layouts[n]=null,null}layout(n){let t=this.findOrConstructLayout(n);if(t)if(this.layoutStates[n]==bc.NOT_LOADED){let i=jt.polyfill(t,this,n);return this.layoutStates[n]=1,i}else return t;else return null}refreshLayouts(){let n=[W.FormFactor.Desktop,W.FormFactor.Phone,W.FormFactor.Tablet],t=this;n.forEach(function(i){t.layoutStates[i]=bc.NOT_LOADED})}constructNullKeyEvent(n,t){t=t||{K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1};let i=ne.constructNullKeyEvent(n);return this.setSyntheticEventDefaults(i,t),i}constructKeyEvent(n,t,i){let s=n.baseKeyEvent;s.device=t,this.isMnemonic&&s.setMnemonicCode(n.layer.indexOf("shift")!=-1,i.K_CAPS),this.setSyntheticEventDefaults(s,i);let l={K_CAPS:C.stateBitmasks.CAPS,K_NUMLOCK:C.stateBitmasks.NUM_LOCK,K_SCROLL:C.stateBitmasks.SCROLL_LOCK}[s.kName];return l&&(s.Lstates^=l,s.LmodifierChange=!0),s}setSyntheticEventDefaults(n,t){n.device.touchable||(n.Lstates=0,n.Lstates|=t.K_CAPS?m.CAPITALFLAG:m.NOTCAPITALFLAG,n.Lstates|=t.K_NUMLOCK?m.NUMLOCKFLAG:m.NOTNUMLOCKFLAG,n.Lstates|=t.K_SCROLL?m.SCROLLFLAG:m.NOTSCROLLFLAG),n.kName&&n.kName.substr(0,2)=="U_"&&(n.LisVirtualKey=!1),typeof n.Lcode=="undefined"&&(n.Lcode=this.getVKDictionaryCode(n.kName),n.Lcode||(n.Lcode=1)),(n.Lmodifiers&C.modifierBitmasks.ALT_GR_SIM)==C.modifierBitmasks.ALT_GR_SIM&&this.emulatesAltGr&&(n.Lmodifiers&=~C.modifierBitmasks.ALT_GR_SIM,n.Lmodifiers|=m.RALTFLAG)}getVKDictionaryCode(n){let t=this.scriptObject.VKDictionary||{};if(!this.scriptObject.VKDictionary){if(typeof this.scriptObject.KVKD=="string"){let c=this.scriptObject.KVKD.split(" ");for(var i=0;i<c.length;i++)t[c[i].toUpperCase()]=i+256}this.scriptObject.VKDictionary=t}let s=t[n.toUpperCase()];return s||0}};a(_t,"Keyboard"),_t.DEFAULT_SCRIPT_OBJECT={gs:a(function(n,t){return!1},"gs"),KI:"",KN:"",KV:T.DEFAULT_RAW_SPEC,KM:0};var w=_t;var Nn={osk:C},Fc=class Fc{constructor(n,t){this.loadedKeyboard=null;this._jsGlobal=n,this.keymanGlobal=t,this.install()}KR(n){if(this.loadedKeyboard)throw new Error("Unexpected state:  the most-recently loaded keyboard field was not properly reset.");this.loadedKeyboard=new w(n)}KLOAD(n,t,i){return i}install(){this._jsGlobal.KeymanWeb=this,this._jsGlobal.keyman=this.keymanGlobal}uninstall(){this._jsGlobal.KeymanWeb==this&&delete this._jsGlobal.KeymanWeb,this._jsGlobal.keyman==this.keymanGlobal&&delete this._jsGlobal.keyman}};a(Fc,"KeyboardHarness");var Ut=Fc;var Gc=class Gc extends Error{constructor(n,t){super(n),this.cause=t}};a(Gc,"KeyboardScriptError");var xt=Gc,pc=class pc extends Error{constructor(n,t){super(n),this.cause=t}};a(pc,"KeyboardMissingError");var kn=pc,Cc=class Cc{constructor(n){this.uri=n}missingError(n){let t=`Cannot find the keyboard at ${this.uri}.`;return new kn(t,n)}scriptError(n){let t=`Error registering the keyboard script at ${this.uri}; it may contain an error.`;return new xt(t,n)}};a(Cc,"UriBasedErrorBuilder");var yc=Cc,Qc=class Qc{constructor(n){this.stub=n}missingError(n){let t=this.stub,i=`Cannot find the ${t.name} keyboard for ${t.langName} at ${t.filename}.`;return new kn(i,n)}scriptError(n){let t=this.stub,i=`Error registering the ${t.name} keyboard for ${t.langName}; keyboard script at ${t.filename} may contain an error.`;return new xt(i,n)}};a(Qc,"StubBasedErrorBuilder");var mc=Qc,Uc=class Uc{get harness(){return this._harness}constructor(n){this._harness=n}loadKeyboardFromPath(n){return this.harness.install(),this.loadKeyboardInternal(n,new yc(n))}loadKeyboardFromStub(n){return this.harness.install(),this.loadKeyboardInternal(n.filename,new mc(n),n.id)}};a(Uc,"KeyboardLoaderBase");var qt=Uc;var xr=(s=>(s.KEYBOARD="keyboard",s.LANGUAGE="language",s.LANGUAGE_KEYBOARD="languageKeyboard",s.BLANK="blank",s))(xr||{}),xe=xr;function xc(g,n){if(g)return{family:g.family,path:n,files:g.filename||g.source}}a(xc,"internalizeFont");var ct=class ct{static get spacebarTextMode(){return typeof this.spacebarTextModeSrc=="string"?this.spacebarTextModeSrc:this.spacebarTextModeSrc()}static set spacebarTextMode(n){this.spacebarTextModeSrc=n}constructor(n,t){if(typeof n!="string")if(n.KI||n.KL||n.KLC||n.KFont||n.KOskFont){let i=n;this.KI=i.KI,this.KN=i.KN,this.KL=i.KL,this.KLC=i.KLC,this.KFont=i.KFont,this.KOskFont=i.KOskFont,this._displayName=i instanceof ct?i._displayName:i.displayName}else{let i=n;i.languages||(i.languages=i.language),this.KI=i.id,this.KN=i.name,this.KL=i.languages.name,this.KLC=i.languages.id,this.KFont=xc(i.languages.font,t),this.KOskFont=xc(i.languages.oskFont,t)}else this.KI=n,this.KLC=t}static fromMultilanguageAPIStub(n){let t=[];n.languages||(n.languages=n.language);for(let i of n.languages){let s={id:n.id,name:n.name,languages:i};t.push(new ct(s))}return t}get id(){return this.KI}get name(){return this.KN}get langId(){return this.KLC}get langName(){return this.KL}get displayName(){if(this._displayName)return this._displayName;let n=this.KN,t=this.KL;switch(ct.spacebarTextMode){case xe.KEYBOARD:return n;case xe.LANGUAGE:return t;case xe.LANGUAGE_KEYBOARD:return n==t?t:t+" - "+n;case xe.BLANK:return"";default:return n}}set displayName(n){this._displayName=n}get textFont(){return this.KFont}get oskFont(){return this.KOskFont}validateForOSK(){return this.KLC?this.displayName===void 0||ct.spacebarTextMode!=xe.BLANK&&!this.displayName?new Error("A display name is missing for this keyboard and cannot be generated under current settings."):null:this.KI||this.KN?new Error(`No language code was specified for use with the ${this.KI||this.KN} keyboard`):new Error("No language code was specified for use with the corresponding keyboard")}validateForCustomKeyboard(){return!this.KI||!this.KN||!this.KL||!this.KLC?new Error("To use a custom keyboard, you must specify keyboard id, keyboard name, language and language code."):null}};a(ct,"KeyboardProperties"),ct.spacebarTextModeSrc=xe.KEYBOARD;var Ke=ct;var Zr=a(g=>g.substring(g.length-1)!="/"?g+"/":g,"addDelimiter"),Zc=class Zc{constructor(n,t){t=Zr(t),this.sourcePath=t,this.protocol=t.replace(/(.{3,5}:)(.*)/,"$1"),this.updateFromOptions(n)}updateFromOptions(n){let t=this.sourcePath.replace(/(https?:\/\/)([^\/]*)(.*)/,"$1$2/");this._root=t,n.root!=""?this._root=this.fixPath(n.root):this._root=this.fixPath(t);let i=n.resources;i==""&&(i=this.sourcePath),this._resources=this.fixPath(i),this._keyboards=this.fixPath(n.keyboards),this._fonts=this.fixPath(n.fonts)}fixPath(n){return n.length==0||(n=Zr(n),n.replace(/^(http)s?:.*/,"$1")=="http"||n.replace(/^(file):.*/,"$1")=="file")?n:n.substring(0,2)=="//"?this.protocol+n:n.substring(0,1)=="/"?this.root+n.substring(1):this.sourcePath+n}get fonts(){return this._fonts}updateFontPath(n){this._fonts=this.fixPath(n)}get root(){return this._root}get resources(){return this._resources}get keyboards(){return this._keyboards}};a(Zc,"PathConfiguration");var $t=Zc;var Xc={root:"",resources:"",keyboards:"",fonts:""};var Vc=class Vc{constructor(n,t){this.suggestions=n,this.transcriptionID=t}};a(Vc,"ReadySuggestions");var Zt=Vc;var Sc=class Sc extends S.default{constructor(t,i){super();this.initNewContext=!0;this._currentSuggestions=[];this.swallowPrediction=!1;this.doRevert=!1;this.recentRevert=!1;this.doTryAccept=a((t,i)=>{let s=this.recentAcceptCause;if(!s&&this.selected)this.accept(this.selected),i.shouldSwallow=!this.currentTarget.getTextAfterCaret(),this.recentAcceptCause="key";else if(s&&t=="space"){if(this.recentAcceptCause=null,s=="key"){i.shouldSwallow=!1;return}i.shouldSwallow=!!this.langProcessor.wordbreaksAfterSuggestions&&!this.currentTarget.getTextAfterCaret()}else i.shouldSwallow=!1},"doTryAccept");this.doTryRevert=a(()=>{this.doRevert?(this.doRevert=!1,this.recentAcceptCause=null):this.recentAcceptCause&&(this.showRevert(),this.swallowPrediction=!0)},"doTryRevert");this.invalidateSuggestions=a(t=>{this.initNewContext=!1,this.selected=null,(!this.swallowPrediction||t=="context")&&(this.recentAcceptCause=null,this.doRevert=!1,this.recentRevert=!1,t=="context"&&(this.swallowPrediction=!1,this.initNewContext=!0)),t!="new"&&this.clearSuggestions()},"invalidateSuggestions");this.updateSuggestions=a(t=>{let i=t.suggestions;this._currentSuggestions=i,this.selected=null,this.keepSuggestion=null;for(let s of i)s.tag=="keep"&&(this.keepSuggestion=s),this.langProcessor.mayAutoCorrect&&s.autoAccept&&!this.selected&&(this.selected=s);this.keepSuggestion&&this._currentSuggestions.splice(this._currentSuggestions.indexOf(this.keepSuggestion),1),this.swallowPrediction?this.swallowPrediction=!1:(this.recentAcceptCause=null,this.doRevert=!1,this.recentRevert=!1),this.sendUpdateEvent()},"updateSuggestions");this.onModelStateChange=a(t=>{(t=="configured"||t=="inactive")&&this.resetContext()},"onModelStateChange");this.langProcessor=t,this.getLayerId=i;let s=a(()=>this.currentTarget&&t.state=="configured","validSuggestionState");this.suggestionApplier=c=>s()?t.applySuggestion(c,this.currentTarget,i):null,this.suggestionReverter=c=>R(this,null,function*(){if(s()){let l=yield t.applyReversion(c,this.currentTarget);this.swallowPrediction=!0,this.updateSuggestions(new Zt(l,c.id?-c.id:void 0))}}),this.connect()}get currentTarget(){return this._currentTarget}setCurrentTarget(t){let i=this._currentTarget;return this._currentTarget=t,i!=t?this.resetContext():Promise.resolve([])}connect(){this.langProcessor.addListener("invalidatesuggestions",this.invalidateSuggestions),this.langProcessor.addListener("suggestionsready",this.updateSuggestions),this.langProcessor.addListener("tryaccept",this.doTryAccept),this.langProcessor.addListener("tryrevert",this.doTryRevert),this.langProcessor.addListener("statechange",this.onModelStateChange)}disconnect(){this.langProcessor.removeListener("invalidatesuggestions",this.invalidateSuggestions),this.langProcessor.removeListener("suggestionsready",this.updateSuggestions),this.langProcessor.removeListener("tryaccept",this.doTryAccept),this.langProcessor.removeListener("tryrevert",this.doTryRevert),this.langProcessor.removeListener("statechange",this.onModelStateChange),this.clearSuggestions()}get currentSuggestions(){let t=[],i=this.activateKeep()&&this.keepSuggestion,s=this.selected&&this.keepSuggestion!=this.selected;return i&&(s||this.keepSuggestion.matchesModel)?t.push(this.keepSuggestion):this.doRevert&&t.push(this.revertSuggestion),t.concat(this._currentSuggestions)}acceptInternal(t){return t?t.tag=="revert"?(this.suggestionReverter(t),null):this.suggestionApplier(t):null}accept(t){let i=this;return this.selected=null,this.doRevert=!1,this.revertAcceptancePromise=this.acceptInternal(t),this.revertAcceptancePromise?(this.revertAcceptancePromise.then(function(s){s&&(i.revertSuggestion=s)}),this.recentAcceptCause="banner",this.recentRevert=!1,this.swallowPrediction=!0,this.revertAcceptancePromise):(t&&t.tag=="revert"&&(this.recentAcceptCause=null,this.recentRevert=!0),Promise.resolve(null))}showRevert(){this.doRevert=!0,this.sendUpdateEvent()}clearSuggestions(){this.updateSuggestions({suggestions:[],transcriptionID:0})}activateKeep(){return!this.recentAcceptCause&&!this.recentRevert&&!this.initNewContext}sendUpdateEvent(){this.emit("update",this.currentSuggestions)}resetContext(){let t=this.currentTarget;return t?this.langProcessor.invalidateContext(t,this.getLayerId()):Promise.resolve([])}};a(Sc,"PredictionContext");var Xt=Sc;var Oi=class Oi{constructor(n){n.OS==W.OperatingSystem.Android?this.popupCanvasBackgroundColor="#999":this.popupCanvasBackgroundColor=Oi.prefersDarkMode()?"#0f1319":"#ffffff"}static prefersDarkMode(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches}};a(Oi,"StyleConstants");var En=Oi;var Wc=class Wc{constructor(){this.touchable="ontouchstart"in window,this.OS="",this.formFactor="desktop",this.browser="",this.dyPortrait=0,this.dyLandscape=0,this.version="0",this.orientation=window.orientation}getDPI(){let n=document.createElement("DIV"),t=n.style,i=96;return document.readyState!=="complete"||(n.id="calculateDPI",t.position="absolute",t.display="block",t.visibility="hidden",t.left="10px",t.top="10px",t.width="1in",t.height="10px",document.body.appendChild(n),i=typeof window.devicePixelRatio=="undefined"?n.offsetWidth:n.offsetWidth*window.devicePixelRatio,document.body.removeChild(n)),i}detect(){let n=!1;if(navigator&&navigator.userAgent){let o=navigator.userAgent;if(o.indexOf("iPad")>=0)this.OS="iOS",this.formFactor="tablet",this.dyPortrait=this.dyLandscape=0;else if(o.indexOf("iPhone")>=0)this.OS="iOS",this.formFactor="phone",this.dyPortrait=this.dyLandscape=25;else if(o.indexOf("Android")>=0){this.OS="Android",this.formFactor="phone",this.dyPortrait=75,this.dyLandscape=25;try{let r=new RegExp("(?:Android\\s+)(\\d+\\.\\d+\\.\\d+)");this.version=o.match(r)[1]}catch(r){}}else if(o.indexOf("Linux")>=0)this.OS="Linux";else if(o.indexOf("Macintosh")>=0){let d=/Intel Mac OS X (\d+(?:[_\.]\d+)+)/i.exec(o);if(!d)console.warn("KMW could not properly parse the user agent string.A suboptimal keyboard layout may result."),this.OS="MacOSX";else if(d.length>1&&d[1]){let u=d[1].replace("_","."),B=new z(u);n=z.MAC_POSSIBLE_IPAD_ALIAS.compareTo(B)<=0,this.OS="MacOSX"}}else o.indexOf("Windows NT")>=0&&(this.OS="Windows",o.indexOf("Touch")>=0&&(this.formFactor="phone"),typeof navigator.msMaxTouchPoints=="number"&&navigator.msMaxTouchPoints>0&&(this.touchable=!0))}let t=Math.min(screen.width,screen.height),i=Math.max(screen.width,screen.height),s=t/i;this.OS!="iOS"&&this.formFactor=="phone"&&(t>=600&&s>.5625||s>=.625)&&(this.formFactor="tablet");let c=navigator.platform=="Win32"||navigator.platform=="MacIntel";if(this.OS=="iOS"&&!("ongesturestart"in window)&&!c&&(this.OS="Android"),this.browser="web",(this.OS=="iOS"||this.OS.toLowerCase()=="macosx")&&(this.browser="safari"),/Firefox|Chrome|OPR|Safari|Edge/.test(navigator.userAgent)&&(navigator.userAgent.indexOf("Firefox")>=0&&"onmozorientationchange"in screen?this.browser="firefox":navigator.userAgent.indexOf("OPR")>=0?this.browser="opera":navigator.userAgent.indexOf(" Edge/")>=0?this.browser="edge":navigator.userAgent.indexOf("Chrome")>=0?this.browser="chrome":navigator.userAgent.indexOf("Safari")>=0&&(this.browser="safari")),n&&this.browser=="safari"&&window.TouchEvent){this.OS="iOS",this.formFactor="tablet",this.dyPortrait=this.dyLandscape=0;let o=screen.height/screen.width;o<1&&(o=1/o),o>1.6&&(this.formFactor="phone",this.dyPortrait=this.dyLandscape=25)}return this.colorScheme=En.prefersDarkMode()?"dark":"light",this.coreSpec}get coreSpec(){return new W(this.browser,this.formFactor,this.OS,this.touchable)}};a(Wc,"DeviceDetector");var Vt=Wc;var Rc=class Rc extends S.default{constructor(t,i){super();this.applyCacheBusting=!1;if(!i){let s=new Vt;s.detect(),i=s.coreSpec}this.sourcePath=t,this.hostDevice=i,this.deferForInitialization=new f}initialize(t){this._paths?this._paths.updateFromOptions(t):this._paths=new $t(t,this.sourcePath),typeof t.setActiveOnRegister=="boolean"?this.activateFirstKeyboard=t.setActiveOnRegister:this.activateFirstKeyboard=!0,this._spacebarText=t.spacebarText,Ke.spacebarTextMode=()=>this.spacebarText}finalizeInit(){this.deferForInitialization.resolve()}get paths(){return this._paths}get spacebarText(){return this._spacebarText}set spacebarText(t){this._spacebarText!=t&&(this._spacebarText=t,this.emit("spacebartext",t))}get softDevice(){return this.hostDevice}get hardDevice(){return ac(this.hostDevice)}get stubNamespacer(){return this._stubNamespacer}set stubNamespacer(t){this._stubNamespacer=t}debugReport(){return{hostDevice:this.hostDevice,initialized:this.deferForInitialization.isResolved}}onRuleFinalization(t,i){}};a(Rc,"EngineConfiguration");var Yn=Rc,Ac=p({setActiveOnRegister:!0,spacebarText:xe.LANGUAGE_KEYBOARD},Xc);var Tn=class Tn extends S.default{constructor(t){super();this.pendingActivations=[];this.engineConfig=t}get predictionContext(){return this._predictionContext}configure(t){this._resetContext=t.resetContext,this._predictionContext=t.predictionContext,this.keyboardCache=t.keyboardCache}insertText(t,i,s){let c=this.activeTarget;return c!=null?(i!=null&&t.output(0,c,i),typeof s!="undefined"&&s!==null&&t.deadkeyOutput(0,c,s),c.invalidateSelection(),!0):!1}resetContext(){this._resetContext(this.activeTarget),this.predictionContext.resetContext()}findAndPopActivation(t){let i;for(i=0;i<this.pendingActivations.length&&this.pendingActivations[i].target!=t;i++);return i==this.pendingActivations.length?null:this.pendingActivations.splice(i,1)[0]}deferredKeyboardActivation(t,i,s){return R(this,null,function*(){let c={target:s,keyboard:t,stub:i};this.findAndPopActivation(s),this.pendingActivations.push(c),yield t;let l=this.findAndPopActivation(s);return l==c?c:(l&&this.pendingActivations.push(l),null)})}activateKeyboard(t,i,s){return R(this,null,function*(){let c=!this.activeKeyboard;this.findAndPopActivation(this.currentKeyboardSrcTarget());let l=this.prepareKeyboardForActivation(t,i),o=this.currentKeyboardSrcTarget(),r=yield l.keyboard;if(r==null&&l.metadata)return!1;this.currentKeyboardSrcTarget()==o&&this.emit("beforekeyboardchange",l.metadata);let d=null;return r&&(d={keyboard:r,metadata:l.metadata}),this.activateKeyboardForTarget(d,o),this.currentKeyboardSrcTarget()==o&&(!c||r)&&this.emit("keyboardchange",this.activeKeyboard),!0})}prepareKeyboardForActivation(t,i){var l;i||(i="");let s=null;if(t?s=this.keyboardCache.getStub(t,i):i=="",!s){if(t)throw new Error("No matching stub has been registered.");return{keyboard:Promise.resolve(null),metadata:null}}if((l=this.activeKeyboard)!=null&&l.metadata&&t==this.activeKeyboard.metadata.id){let o=this.activeKeyboard.keyboard;return{keyboard:Promise.resolve(o),metadata:s}}let c;if(c=this.keyboardCache.getKeyboardForStub(s))return{keyboard:Promise.resolve(c),metadata:s};{this.emit("beforekeyboardchange",s);let o=this.engineConfig.deferForInitialization.then(()=>{let d=new f;this.emit("keyboardasyncload",s,d.corePromise);let u=this.keyboardCache.fetchKeyboardForStub(s),B=new Promise((I,h)=>{let F=`Sorry, the ${s.name} keyboard for ${s.langName} is not currently available.`;window.setTimeout(()=>h(new Error(F)),Tn.TIMEOUT_THRESHOLD)}),b=Promise.race([u,B]);return b.then(()=>{d.resolve(null),B.catch(()=>{})}),b.catch(I=>{throw d.resolve(I),I}),b});return{keyboard:this.deferredKeyboardActivation(o,s,this.currentKeyboardSrcTarget()).then(d=>R(this,null,function*(){return d?o:Promise.resolve(null)})),metadata:s}}}};a(Tn,"ContextManagerBase"),Tn.TIMEOUT_THRESHOLD=1e4;var wn=Tn;var fc=class fc extends S.default{};a(fc,"HardKeyboardBase");var Mn=fc;function Hc(g,n,t){if(n&&n.isMnemonic&&g.setMnemonicCode(!!(g.Lmodifiers&m.K_SHIFTFLAG),!!(g.Lmodifiers&m.CAPITALFLAG)),n&&!n.isMnemonic){let i=ie.languageMap[t];i&&i["k"+g.Lcode]&&(g.Lcode=i["k"+g.Lcode]),!n.definesPositionalOrMnemonic&&!(g.Lmodifiers&C.modifierBitmasks.NON_LEGACY)&&!g.isModifier&&(g=new ne({Lcode:ie._USKeyCodeToCharCode(g),Lmodifiers:0,LisVirtualKey:!1,vkCode:g.Lcode,Lstates:g.Lstates,kName:"",device:g.device,isSynthetic:!1}))}return g}a(Hc,"processForMnemonicsAndLegacy");function Lc(g,n,t){let i=Math.min(g.length,n.length),s,c,l,o,r;for(t?(s=c=g.length-1,l=c-i,o=-1,r=n.length-g.length):(s=c=0,l=i,o=1,r=0);c!=l&&g.charAt(c)==n.charAt(c+r);c+=o);if(c!=s&&c!=l){let d=g.charCodeAt(c-o),u=g.charCodeAt(c),B=n.charCodeAt(c+r),b=t?wi:Ti,I=t?Ti:wi;if(b(d)&&(I(u)||I(B)))return c-o}return c}a(Lc,"findCommonSubstringEndIndex");var St=class St{constructor(n,t){this.p=n,this.d=t,this.o=St.ordinalSeed++}match(n,t){return this.p==n&&this.d==t}set(){this.matched=1}reset(){this.matched=0}before(n){return this.o<n.o}clone(){let n=new St(this.p,this.d);return n.o=this.o,n}equal(n){return this.d==n.d&&this.p==n.d&&this.o==n.o}};a(St,"Deadkey"),St.ordinalSeed=0,St.sortFunc=a(function(n,t){return n.p!=t.p?t.p-n.p:t.o-n.o},"sortFunc");var zn=St,ji=class ji{constructor(){this.dks=[]}toSortedArray(){return this.dks=this.dks.sort(zn.sortFunc),[].concat(this.dks)}clone(){let n=new ji,t=this.toSortedArray();return n.dks=[],t.forEach(function(i){n.dks.push(i.clone())}),n}isMatch(n,t,i){if(this.dks.length==0)return!1;t=n-t;for(let c=0;c<this.dks.length;c++)if(this.dks[c].match(t,i)&&!this.dks[c].matched)return this.dks[c].set(),!0;return this.resetMatched(),!1}add(n){this.dks=this.dks.concat(n)}remove(n){let t=this.dks.indexOf(n);this.dks.splice(t,1)}clear(){this.dks=[]}resetMatched(){for(let n of this.dks)n.reset()}deleteMatched(){for(let n=0;n<this.dks.length;n++)this.dks[n].matched&&this.dks.splice(n--,1)}adjustPositions(n,t){if(t!=0)for(let i of this.dks)i.p>n&&(i.p+=t)}equal(n){if(this.dks.length!=n.dks.length)return!1;let t=n.dks,i=[];for(let s of this.dks)if(!t.find(l=>s.equal(l)))return!1;return i.length==t.length}count(){return this.dks.length}};a(ji,"DeadkeyTracker");var Pi=ji;function Wt(g){var n;return g?g.insert===""&&g.deleteLeft===0&&((n=g.deleteRight)!=null?n:0)===0:!0}a(Wt,"isEmptyTransform");var Kn=class Kn{constructor(n,t,i,s){this.insert=n,this.deleteLeft=t,this.deleteRight=i,this.erasedSelection=s}};a(Kn,"TextTransform"),Kn.nil=new Kn("",0,0,!1);var vc=Kn,Dn=class Dn{constructor(n,t,i,s){let c=this.token=Dn.tokenSeed++;this.keystroke=n,this.transform=t,this.alternates=s,this.preInput=i,this.transform.id=this.token,s&&s.forEach(function(l){l.sample.id=c})}};a(Dn,"Transcription"),Dn.tokenSeed=0;var Jc=Dn,Nc=class Nc{constructor(){this._dks=new Pi}get isSynthetic(){return!0}resetContext(){this.deadkeys().clear()}deadkeys(){return this._dks}hasDeadkeyMatch(n,t){return this.deadkeys().isMatch(this.getDeadkeyCaret(),n,t)}insertDeadkeyBeforeCaret(n){let t=new zn(this.getDeadkeyCaret(),n);this.deadkeys().add(t)}adjustDeadkeys(n){this.deadkeys().adjustPositions(this.getDeadkeyCaret(),n)}setDeadkeys(n){this._dks=n.clone()}buildTransformFrom(n){let t=this.getTextBeforeCaret(),i=n.getTextBeforeCaret(),s=Lc(i,t,!1),c=Q.length(i.substring(s)),l=t.substring(s),o=this.getTextAfterCaret(),r=n.getTextAfterCaret(),d=Lc(r,o,!0),u=Q.length(r.substring(0,d+1));return new vc(l,c,u,n.getSelectedText()&&!this.getSelectedText())}buildTranscriptionFrom(n,t,i,s){let c=this.buildTransformFrom(n);return new Jc(t,c,E.from(n,i),s)}restoreTo(n){this.clearSelection(),this.setTextBeforeCaret(n.getTextBeforeCaret()),this.setTextAfterCaret(n.getTextAfterCaret()),this._dks=n._dks.clone()}apply(n){this.clearSelection(),n.deleteRight&&this.setTextAfterCaret(Q.substr(this.getTextAfterCaret(),n.deleteRight)),n.deleteLeft&&this.deleteCharsBeforeCaret(n.deleteLeft),n.insert&&this.insertTextBeforeCaret(n.insert),this._dks.clear()}setTextBeforeCaret(n){this.deleteCharsBeforeCaret(Q.length(this.getTextBeforeCaret())),this.insertTextBeforeCaret(n)}saveProperties(){}restoreProperties(){}};a(Nc,"OutputTarget");var lt=Nc;var en=class en extends lt{constructor(t,i,s){super();this.selForward=!0;this.text=t||"";let c=Q.length(this.text);this.selStart=typeof i=="number"?i:c,this.selEnd=typeof s=="number"?s:this.selStart,this.selForward=this.selEnd>=this.selStart}static from(t,i){let s;if(t instanceof en){let c=t;s=new en(c.text,c.selStart,c.selEnd)}else{let c=t.getText(),l=Q.length(c),o=l,r=0;if(t.hasSelection()){let d=t.getTextBeforeCaret(),u=t.getTextAfterCaret();o=Q.length(d),r=l-Q.length(u)}s=new en(c,o,r)}return s.setDeadkeys(t.deadkeys()),s}clearSelection(){this.text=this.getTextBeforeCaret()+this.getTextAfterCaret(),this.selEnd=this.selStart,this.selForward=!0}invalidateSelection(){}isSelectionEmpty(){return this.selStart==this.selEnd}hasSelection(){return!0}getDeadkeyCaret(){return this.selStart}setSelection(t,i){if(this.selStart=t,this.selEnd=typeof i=="number"?i:t,this.selForward=i>=t,!this.selForward){let s=this.selStart;this.selStart=this.selEnd,this.selEnd=s}}getTextBeforeCaret(){return Q.substr(this.text,0,this.selStart)}getSelectedText(){return Q.substr(this.text,this.selStart,this.selEnd-this.selStart)}getTextAfterCaret(){return Q.substr(this.text,this.selEnd)}getText(){return this.text}deleteCharsBeforeCaret(t){t>=0&&(t>this.selStart&&(t=this.selStart),this.adjustDeadkeys(-t),this.text=Q.substr(this.text,0,this.selStart-t)+Q.substr(this.text,this.selStart),this.selStart-=t,this.selEnd-=t)}insertTextBeforeCaret(t){this.adjustDeadkeys(Q.length(t)),this.text=this.getTextBeforeCaret()+t+Q.substr(this.text,this.selStart),this.selStart+=Q.length(t),this.selEnd+=Q.length(t)}handleNewlineAtCaret(){this.insertTextBeforeCaret(`
`)}setTextAfterCaret(t){this.text=this.getTextBeforeCaret()+t}isEqual(t){return this.text==t.text&&this.selStart==t.selStart&&this.selEnd==t.selEnd&&this.deadkeys().equal(t.deadkeys())}doInputEvent(){}};a(en,"Mock");var E=en;var kc=class kc{constructor(){this.transcription=null;this.setStore={};this.saveStore={};this.variableStores={};this.triggersDefaultCommand=!1}finalize(n,t,i){if(!this.transcription)throw"Cannot finalize a RuleBehavior with no transcription.";n.beepHandler&&this.beep&&n.beepHandler(t);for(let s in this.setStore){let c=n.keyboardInterface.systemStores[s];if(c)try{c.set(this.setStore[s])}catch(l){n.errorLogger&&n.errorLogger("Rule attempted to perform illegal operation - 'platform' may not be changed.")}else n.warningLogger&&n.warningLogger("Unknown store affected by keyboard rule: "+s)}if(n.keyboardInterface.applyVariableStores(this.variableStores),n.keyboardInterface.variableStoreSerializer)for(let s in this.saveStore)n.keyboardInterface.variableStoreSerializer.saveStore(n.activeKeyboard.id,s,this.saveStore[s]);if(this.triggersDefaultCommand){let s=this.transcription.keystroke;n.defaultRules.applyCommand(s,t)}n.warningLogger&&this.warningLog?n.warningLogger(this.warningLog):n.errorLogger&&this.errorLog&&n.errorLogger(this.errorLog)}mergeInDefaults(n){let t=this.transcription.keystroke,i=n.transcription.keystroke;if(t.Lcode!=i.Lcode||t.Lmodifiers!=i.Lmodifiers)throw"RuleBehavior default-merge not supported unless keystrokes are identical!";this.triggersDefaultCommand=this.triggersDefaultCommand||n.triggersDefaultCommand;let s=E.from(this.transcription.preInput,!1);s.apply(this.transcription.transform),s.apply(n.transcription.transform),this.transcription=s.buildTranscriptionFrom(this.transcription.preInput,t,!1,this.transcription.alternates)}};a(kc,"RuleBehavior");var ce=kc;var Ec=class Ec{constructor(n){this.id=n}set(n){throw new Error("System store with ID "+this.id+" may not be directly set.")}};a(Ec,"SystemStore");var _i=Ec,Yc=class Yc extends _i{constructor(t,i){super(t);this.handler=null;this._value=i}get value(){return this._value}matches(t){return this._value==t}set(t){this.handler&&this.handler(this,t)||(this._value=t)}};a(Yc,"MutableSystemStore");var tn=Yc,Tc=class Tc extends _i{constructor(n){super(31),this.kbdInterface=n}matches(n){let t=n.split(" "),i=this.kbdInterface.activeDevice;for(let s=0;s<t.length;s++){let c=t[s].toLowerCase();switch(c){case"touch":case"hardware":if(i.touchable!=(c=="touch"))return!1;break;case"macos":case"mac":c="macosx";case"macosx":case"windows":case"android":case"ios":case"linux":if(i.OS!=c)return!1;break;case"tablet":case"phone":case"desktop":if(i.formFactor!=c)return!1;break;case"web":if(i.browser=="native")return!1;break;case"native":case"chrome":case"firefox":case"safari":case"edge":case"opera":if(i.browser!=c)return!1;break;default:return!1}}return!0}};a(Tc,"PlatformSystemStore");var qi=Tc;var Kc=class Kc{};a(Kc,"KeyInformation");var wc=Kc;var Dc=class Dc{reset(){this._cache=[]}get(n,t){return typeof this._cache[n]=="undefined"||typeof this._cache[n][t]=="undefined"?null:this._cache[n][t]}set(n,t,i){typeof this._cache[n]=="undefined"&&(this._cache[n]=[]),this._cache[n][t]=i}};a(Dc,"CachedContext");var Mc=Dc,$i=class $i{reset(){this._cache=[]}get(n,t){return typeof this._cache[n]=="undefined"||typeof this._cache[n][t]=="undefined"?null:this._cache[n][t]}set(n,t,i){typeof this._cache[n]=="undefined"&&(this._cache[n]=[]),this._cache[n][t]=i}clone(){let n=new $i;return n._cache=this._cache,n}};a($i,"CachedContextEx");var zc=$i,On=class On extends Ut{constructor(t,i,s=null){super(t,i);this.cachedContext=new Mc;this.cachedContextEx=new zc;this._AnyIndices=[];this.systemStores={},this.systemStores[31]=new qi(this),this.systemStores[33]=new tn(33,"default"),this.systemStores[42]=new tn(42,""),this.systemStores[43]=new tn(43,""),this.variableStoreSerializer=s}get Codes(){return C}saveFocus(){}registerKeyboard(t){let i=new w(t);this.loadedKeyboard=i}context(t,i,s){let c=this.cachedContext.get(t,i);if(c!==null)return c;let l=this.KC_(t,i,s);return this.cachedContext.set(t,i,l),l}KC_(t,i,s){let c="";return c=s.isSelectionEmpty()?s.getTextBeforeCaret():"",Q.length(c)<t&&(c=Array(t-Q.length(c)+1).join("￾")+c),Q.substr(Q.substr(c,-t),0,i)}nul(t,i){return this.context(t+1,1,i)==="￾"}contextMatch(t,i,s,c){return this.context(t,c,i)===s?!0:(i.deadkeys().resetMatched(),!1)}_BuildExtendedContext(t,i,s){let c=this.cachedContextEx.get(t,i);if(c!==null)return c;{if(c=this.cachedContextEx.get(t,t),c===null){let o=s.deadkeys().toSortedArray(),r=0;for(c={valContext:[],deadContext:[]};c.valContext.length<t;){let u=s.getDeadkeyCaret()-r;if(o.length>0&&o[0].p>u){o.splice(0,1);continue}else if(o.length>0&&o[0].p==u)c.deadContext[t-c.valContext.length-1]=o[0],c.valContext=[o[0].d].concat(c.valContext),o.splice(0,1);else{let B=this.context(++r,1,s);c.valContext=[B].concat(c.valContext)}}this.cachedContextEx.set(t,t,c)}let l=c;return l.valContext=l.valContext.slice(0,i),this.cachedContextEx.set(t,i,l),l}}fullContextMatch(t,i,s){let c=this._BuildExtendedContext(t,s.length,i);this.ruleContextEx=this.cachedContextEx.clone();let l=c.valContext,o=c.deadContext,r=!1,d="￾",u=a(function(B){throw new Error("Unexpected object in fullContextMatch specification: "+B)},"assertNever");for(let B=0;B<s.length;B++)if(typeof s[B]=="string"){if(s[B]!==l[B]){r=!0;break}}else{let b=s[B];switch(b.t){case"d":b.d!==l[B]?r=!0:o[B].set();break;case"a":let I;typeof l[B]=="string"?I=l[B]:I={t:"d",d:l[B]};let h=this.any(B,I,b.a);b.n?b.n&&(h||l[B]===d)&&(r=!0):h?o[B]!==void 0&&o[B].set():r=!0;break;case"i":let F=this._Index(b.i,b.o);F!==void 0&&(typeof F=="string"?F:F.d)!==l[B]?r=!0:o[B]!==void 0&&o[B].set();break;case"c":l[b.c-1]!==l[B]?r=!0:o[B]!==void 0&&o[B].set();break;case"n":l[B]!=d&&(r=!0);break;default:u(b)}}return r&&(i.deadkeys().resetMatched(),this._AnyIndices=[]),!r}isKeypress(t){return this.activeKeyboard.isMnemonic?!t.LisVirtualKey:!!ie._USKeyCodeToCharCode(t)}static matchModifiersToRuleChirality(t,i){let s=m.LALTFLAG|m.RALTFLAG,c=m.LCTRLFLAG|m.RCTRLFLAG,l=t;if(!(i&s)){let o=l&s;o&&(l^=o|m.K_ALTFLAG)}if(!(i&c)){let o=l&c;o&&(l^=o|m.K_CTRLFLAG)}return l}keyMatch(t,i,s){let c=!1,l=t.Lcode==173?189:t.Lcode,o=this.activeKeyboard.modifierBitmask,r=o&C.modifierBitmasks.ALL,d=o&C.stateBitmasks.ALL,u=On.matchModifiersToRuleChirality(t.Lmodifiers,i);return t.vkCode>255&&(l=t.vkCode),t.LisVirtualKey||l>255?((i&16384)==16384||l>255)&&(c=s==l&&(i&r)==u,c=c&&this.stateMatch(t,i&d)):(i&16384)==0&&(c=l==s),c||this.activeTargetOutput.deadkeys().resetMatched(),c}stateMatch(t,i){return(i&t.Lstates)==i}keyInformation(t){let i=new wc;return i.vk=t.LisVirtualKey,i.code=t.Lcode,i.modifiers=t.Lmodifiers,i}deadkeyMatch(t,i,s){return i.hasDeadkeyMatch(t,s)}beep(t){this.resetContextCache(),this.ruleBehavior.beep=!0}_ExplodeStore(t){if(typeof t=="string"){let i=this.activeKeyboard.explodedStores;if(i[t])return i[t];let s=[];for(let c=0;c<Q.length(t);c++)s.push(Q.charAt(t,c));return i[t]=s,s}else return t}any(t,i,s){if(i=="")return!1;s=this._ExplodeStore(s);let c=-1;for(let l=0;l<s.length;l++){let o=s[l];if(typeof o=="string"){if(s[l]==i){c=l;break}}else if(o.d===i.d){c=l;break}}return this._AnyIndices[t]=c,c>=0}_Index(t,i){return t=this._ExplodeStore(t),this._AnyIndices[i-1]<t.length?t[this._AnyIndices[i-1]]:(console.warn("Unmatched contextual index() statement detected in rule with index "+i+"!"),"")}indexOutput(t,i,s,c){this.resetContextCache();let l=a(function(r){throw new Error("Unexpected object in fullContextMatch specification: "+r)},"assertNever"),o=this._Index(i,s);if(o!=="")if(typeof o=="string")this.output(t,c,o);else if(o.t)switch(o.t){case"b":this.beep(c);break;case"d":this.deadkeyOutput(t,c,o.d);break;default:l(o)}else this.deadkeyOutput(t,c,o.d)}deleteContext(t,i){let s;if(t>0){s=this._BuildExtendedContext(t,t,i);let c=0;for(let o=0;o<s.valContext.length;o++){let r=s.deadContext[o];r?(i.deadkeys().remove(r),t--):s.valContext[o]=="￾"&&c++}let l=s.valContext.length-c;t>l&&(t=l)}i.deadkeys().resetMatched(),this.output(t,i,"")}output(t,i,s){this.resetContextCache(),i.saveProperties(),i.clearSelection(),i.deadkeys().deleteMatched(),t>=0&&i.deleteCharsBeforeCaret(t),i.insertTextBeforeCaret(s),i.restoreProperties()}contextExOutput(t,i,s,c){this.resetContextCache(),t>=0&&this.output(t,i,"");let l=this.ruleContextEx.get(s,s),o=l.deadContext[c-1],r=l.valContext[c-1];if(o)i.insertDeadkeyBeforeCaret(o.d);else if(typeof r=="string")this.output(-1,i,r);else throw new Error("contextExOutput: should never be a numeric valContext with no corresponding deadContext")}deadkeyOutput(t,i,s){this.resetContextCache(),t>=0&&this.output(t,i,""),i.insertDeadkeyBeforeCaret(s)}ifStore(t,i,s){let c=!0,l=this.systemStores[t];return l&&(c=l.matches(i)),c}setStore(t,i,s){return this.resetContextCache(),t==33&&this.activeDevice.touchable?(this.ruleBehavior.setStore[t]=i,!0):!1}loadStore(t,i,s){return this.resetContextCache(),this.variableStoreSerializer&&this.variableStoreSerializer.loadStore(t,i)[i]||s}saveStore(t,i){this.resetContextCache();let s=this.activeKeyboard;if(!s||typeof s.id=="undefined"||s.id=="")return!1;let c={};return c[t]=i,this.ruleBehavior?this.ruleBehavior.saveStore[t]=c:this.variableStoreSerializer.saveStore(this.activeKeyboard.id,t,c),!0}resetContextCache(){this.cachedContext.reset(),this.cachedContextEx.reset()}defaultBackspace(t){t.isSelectionEmpty()?this.output(1,t,""):this.output(0,t,"")}processNewContextEvent(t,i){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.processNewContextEvent.bind(this.activeKeyboard),t,i,!0)}processPostKeystroke(t,i){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.processPostKeystroke.bind(this.activeKeyboard),t,i,!0)}processKeystroke(t,i){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.process.bind(this.activeKeyboard),t,i,!1)}process(t,i,s,c){if(i)if(this.activeKeyboard){if(!t)throw"No callee for keystroke processing!"}else throw"No active keyboard for keystroke processing!";else throw"No target specified for keyboard output!";i.invalidateSelection(),i.deadkeys().resetMatched(),this.resetContextCache();let l=E.from(i,!0),o=this.activeKeyboard.variableStores;this.ruleBehavior=new ce,this.activeDevice=s.device,this.activeTargetOutput=i;let r=t(i,s);this.activeTargetOutput=null,this.ruleBehavior.transcription=i.buildTranscriptionFrom(l,s,c),this.ruleBehavior.variableStores=this.activeKeyboard.variableStores,this.activeKeyboard.variableStores=o,this.ruleBehavior.triggerKeyDefault=!r;let d=this.ruleBehavior;return this.ruleBehavior=null,d}applyVariableStores(t){this.activeKeyboard.variableStores=t}static __publishShorthandAPI(){let t=this.prototype,i=a(function(s,c){t[c]&&(t[s]=t[c])},"exportKBCallback");i("KSF","saveFocus"),i("KBR","beepReset"),i("KT","insertText"),i("KR","registerKeyboard"),i("KRS","registerStub"),i("KC","context"),i("KN","nul"),i("KCM","contextMatch"),i("KFCM","fullContextMatch"),i("KIK","isKeypress"),i("KKM","keyMatch"),i("KSM","stateMatch"),i("KKI","keyInformation"),i("KDM","deadkeyMatch"),i("KB","beep"),i("KA","any"),i("KDC","deleteContext"),i("KO","output"),i("KDO","deadkeyOutput"),i("KCXO","contextExOutput"),i("KIO","indexOutput"),i("KIFS","ifStore"),i("KSETS","setStore"),i("KLOAD","loadStore"),i("KSAVE","saveStore")}};a(On,"KeyboardInterface"),On.GLOBAL_NAME="KeymanWeb";var De=On;(function(){De.__publishShorthandAPI()})();var At=class At extends S.default{constructor(t,i){super();this.stateKeys={K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1};this.modStateFlags=0;i||(i=At.DEFAULT_OPTIONS),this.contextDevice=t,this.baseLayout=i.baseLayout||At.DEFAULT_OPTIONS.baseLayout,this.keyboardInterface=i.keyboardInterface||new De(Dt(),Nn),this.defaultRules=i.defaultOutputRules||At.DEFAULT_OPTIONS.defaultOutputRules}get activeKeyboard(){return this.keyboardInterface.activeKeyboard}set activeKeyboard(t){this.keyboardInterface.activeKeyboard=t,this.resetContext()}get layerStore(){return this.keyboardInterface.systemStores[33]}get newLayerStore(){return this.keyboardInterface.systemStores[42]}get oldLayerStore(){return this.keyboardInterface.systemStores[43]}get layerId(){return this.layerStore.value}set layerId(t){this.layerStore.set(t)}defaultRuleBehavior(t,i,s){let c=E.from(i,s),l=new ce,o=!1,r="",d;if(t.isSynthetic||i.isSynthetic)if(o=!0,this.defaultRules.isCommand(t))l.triggersDefaultCommand=!0;else if((d=this.defaultRules.forSpecialEmulation(t))!=null)switch(d){case"\b":this.keyboardInterface.defaultBackspace(i);break;case`
`:i.handleNewlineAtCaret();break;default:l.errorLog="Unexpected 'special emulation' character (\\u"+Q.charCodeAt(d,0).toString(16)+") went unhandled!"}else o=!1;let u=this.activeKeyboard&&this.activeKeyboard.isMnemonic;if(!o)if((r=this.defaultRules.forAny(t,u,l))!=null)if(d=this.defaultRules.forSpecialEmulation(t),d=="\b")this.keyboardInterface.defaultBackspace(i);else{if(d||this.defaultRules.isCommand(t))return null;this.keyboardInterface.output(0,i,r)}else return null;if(l.errorLog)return l;let B=i.buildTranscriptionFrom(c,t,s);return l.transcription=B,l}processNewContextEvent(t,i){return this.activeKeyboard?this.keyboardInterface.processNewContextEvent(i,this.activeKeyboard.constructNullKeyEvent(t,this.stateKeys)):null}processPostKeystroke(t,i){return this.activeKeyboard?this.keyboardInterface.processPostKeystroke(i,this.activeKeyboard.constructNullKeyEvent(t,this.stateKeys)):null}processKeystroke(t,i){let s,c=Q.length(i.getTextBeforeCaret())==0&&i.isSelectionEmpty();if(this.activeKeyboard&&t.Lcode!=0&&(s=this.keyboardInterface.processKeystroke(i,t)),c&&t.Lcode==C.keyCodes.K_BKSP&&s.triggerKeyDefault)s=this.defaultRuleBehavior(t,i,!1),s.triggerKeyDefault=!0,s.transcription.transform.deleteLeft=1;else if(!s||s.triggerKeyDefault){t.Lcode=t.vkCode||t.Lcode,this.keyboardInterface.activeTargetOutput=i;let l=this.defaultRuleBehavior(t,i,!1);l&&(s?s.mergeInDefaults(l):s=l,s.triggerKeyDefault=!1),this.keyboardInterface.activeTargetOutput=null}return s}_UpdateVKShift(t){let i=0,s=["CAPS","NUM_LOCK","SCROLL_LOCK"],c=["K_CAPS","K_NUMLOCK","K_SCROLL"],l=[m.CAPITALFLAG,m.NUMLOCKFLAG,m.SCROLLFLAG];if(!this.activeKeyboard)return!0;if(t){i=t.Lmodifiers,this.activeKeyboard.isChiral&&this.activeKeyboard.emulatesAltGr&&(this.modStateFlags&C.modifierBitmasks.ALT_GR_SIM)==C.modifierBitmasks.ALT_GR_SIM&&(i|=C.modifierBitmasks.ALT_GR_SIM,i&=~m.RALTFLAG);let o=!1;for(let r=0;r<s.length;r++)t.Lstates&C.stateBitmasks[s[r]]&&(this.stateKeys[c[r]]=!!(t.Lstates&l[r]),o=!0);o&&this.emit("statekeychange",this.stateKeys)}return this.updateStates(),this.activeKeyboard.isMnemonic&&this.stateKeys.K_CAPS&&(!t||!t.isModifier)&&(i^=m.K_SHIFTFLAG),this.layerId=this.getLayerId(i),!0}updateStates(){let t=["K_CAPS","K_NUMLOCK","K_SCROLL"],i=[m.CAPITALFLAG,m.NUMLOCKFLAG,m.SCROLLFLAG],s=[m.NOTCAPITALFLAG,m.NOTNUMLOCKFLAG,m.NOTSCROLLFLAG];for(let c=0;c<t.length;c++){let l=t[c];this.stateKeys[l]?(this.modStateFlags|=i[c],this.modStateFlags&=~s[c]):(this.modStateFlags&=~i[c],this.modStateFlags|=s[c])}}getLayerId(t){return T.getLayerId(t)}selectLayer(t){let i=t.kName,s=t.kNextLayer,c=this.activeKeyboard&&this.activeKeyboard.isChiral;if(typeof s=="number"&&(s=this.getLayerId(s*16)),!s)switch(i){case"K_LSHIFT":case"K_RSHIFT":case"K_SHIFT":s="shift";break;case"K_LCONTROL":case"K_LCTRL":if(c){s="leftctrl";break}case"K_RCONTROL":case"K_RCTRL":if(c){s="rightctrl";break}case"K_CTRL":s="ctrl";break;case"K_LMENU":case"K_LALT":if(c){s="leftalt";break}case"K_RMENU":case"K_RALT":if(c){s="rightalt";break}case"K_ALT":s="alt";break;case"K_ALTGR":c?s="leftctrl-rightalt":s="ctrl-alt";break;case"K_CURRENCIES":case"K_NUMERALS":case"K_SHIFTED":case"K_UPPER":case"K_LOWER":case"K_SYMBOLS":s="default";break}return s?(this.updateLayer(t,s),!0):!1}updateLayer(t,i){let s=this.layerId,c=s;if(i==s&&t.device.formFactor!=W.FormFactor.Desktop)return;let l=i,o;if(t.device.formFactor==W.FormFactor.Desktop){let u=["leftctrl","rightctrl","ctrl","leftalt","rightalt","alt","shift"];for(o=0;o<u.length;o++)l=l.replace(u[o]+"-",""),l=l.replace(u[o],"");if(s=="default"||s=="numeric"||s=="symbol"||s=="currency"||l!="")c=i;else{let B=C.getModifierState(c);for(o=0;o<u.length;o++)c=c.replace(u[o]+"-",""),c=c.replace(u[o],"");switch(i){case"shift":B^=m.K_SHIFTFLAG;break;case"leftctrl":B^=m.LCTRLFLAG;break;case"rightctrl":B^=m.RCTRLFLAG;break;case"ctrl":B^=m.K_CTRLFLAG;break;case"leftalt":B^=m.LALTFLAG;break;case"rightalt":B^=m.RALTFLAG;break;case"alt":B^=m.K_ALTFLAG;break;default:c=i}c!="default"&&(c==""?c=this.getLayerId(B):c=this.getLayerId(B)+"-"+c)}c==""&&(c="default")}else c=i;this.activeKeyboard.layout(t.device.formFactor).getLayer(c)?this.layerId=c:this.layerId="default";let d=C.getModifierState(this.layerId);this.modStateFlags=d|t.Lstates}doModifierPress(t,i,s){return this.activeKeyboard?t.isModifier?(this.activeKeyboard.notify(t.Lcode,i,s?1:0),t.device.touchable?!0:this._UpdateVKShift(t)):(t.LmodifierChange&&(this.activeKeyboard.notify(0,i,1),t.device.touchable||this._UpdateVKShift(t)),!1):!1}performNewContextEvent(t){let i=this.processNewContextEvent(this.contextDevice,t);return i&&i.finalize(this,t,!0),i}resetContext(t){this.layerId="default",t==null||t.resetContext(),this.keyboardInterface.resetContextCache(),t&&this.performNewContextEvent(t),this.contextDevice.touchable||this._UpdateVKShift(null)}setNumericLayer(t){this.activeKeyboard&&this.activeKeyboard.layout(t.formFactor).getLayer("numeric")&&(this.layerId="numeric")}};a(At,"KeyboardProcessor"),At.DEFAULT_OPTIONS={baseLayout:"us",defaultOutputRules:new Re};var nn=At;var es="Keyboard_";function le(g){return g.startsWith(es)?g:es+g}a(le,"prefixed");function Oe(g){return g.startsWith(es)?g.substring(es.length):g}a(Oe,"withoutPrefix");var Oc=class Oc extends S.default{constructor(t){super();this.stubSetTable={};this.keyboardTable={};this.keyboardLoader=t}getKeyboardForStub(t){return t?this.getKeyboard(t.KI):null}getKeyboard(t){if(!t)return null;let i=this.keyboardTable[le(t)];return i instanceof Promise?null:i}get defaultStub(){function t(s){let c=Object.keys(s);if(c.length!=0)return s[c[0]]}a(t,"getFirstValue");let i=t(this.stubSetTable);if(i)return t(i)}addKeyboard(t){let i=le(t.id);this.keyboardTable[i]=t,this.emit("keyboardadded",t)}fetchKeyboardForStub(t){return this.fetchKeyboard(t.KI)}isFetchingKeyboard(t){if(!t)throw new Error("Keyboard ID must be specified");return t=le(t),this.keyboardTable[t]instanceof Promise}fetchKeyboard(t){if(!t)throw new Error("Keyboard ID must be specified");if(!this.keyboardLoader)throw new Error("Cannot load keyboards; this cache was configured without a loader");t=le(t);let i=this.keyboardTable[t];if(i instanceof w)return Promise.resolve(i);if(i instanceof Promise)return i;let s=this.getStub(t,null);if(!s)throw new Error(`No stub for ${Oe(t)} has been registered`);if(!s.filename)throw new Error(`The registered stub for ${Oe(t)} lacks a path to the main keyboard file`);let c=this.keyboardLoader.loadKeyboardFromStub(s);return this.keyboardTable[t]=c,c.then(l=>{l.scriptObject.KI=t,this.addKeyboard(l)}).catch(l=>{throw delete this.keyboardTable[t],l}),c}addStub(t){var c;let i=le(t.KI),s=this.stubSetTable[i]=(c=this.stubSetTable[i])!=null?c:{};s[t.KLC]=t,this.emit("stubadded",t)}findMatchingStub(t){return this.getStub(t.KI,t.KLC)}getStub(t,i){var o;let s,c=i||"---";t instanceof w?s=t.id:s=t,s&&(s=le(s));let l=(o=this.stubSetTable[s])!=null?o:{};if(c!="---")return l[c];{let r=Object.keys(l);return r.length==0?null:l[r[0]]}}forgetKeyboard(t,i=!1){let s=t instanceof w?t.id:le(t);this.stubSetTable[s]&&delete this.stubSetTable[s],i&&this.keyboardTable[s]&&delete this.keyboardTable[s]}getStubList(){let t=[],i=Object.keys(this.stubSetTable);for(let s of i){let c=this.stubSetTable[s],l=Object.keys(c);for(let o of l)t.push(c[o])}return t}};a(Oc,"StubAndKeyboardCache");var sn=Oc;var Pc=["World","Africa","Asia","Europe","South America","North America","Oceania","Central America","Middle East"],jc=["un","af","as","eu","sa","na","oc","ca","me"],Ya=RegExp("^(([\\.]/)|([\\.][\\.]/)|(/))|(:)");function Vr(g,n){return n=n||"",g&&!Ya.test(g)?n+g:g}a(Vr,"configureFilePathing");var ts=class ts extends Ke{constructor(n,t,i){if(typeof n!="string")if(n.id!==void 0){let s=n;s.id=le(s.id),super(s,i),this.KF=Vr(s.filename,t),this.mapRegion(s.languages)}else{let s=n;s.KI=le(s.KI),super(s,i),this.KF=Vr(s.KF,t),this.KP=s.KP,this.KR=s.KR,this.KRC=s.KRC;return}else super(le(n),t)}mapRegion(n){let t=n.region,i=0;if(typeof t=="number")t<1||t>9?i=0:i=t-1;else if(typeof t=="string"){let s=t.length==2?jc:Pc;for(let c=0;c<s.length;c++)if(t.toLowerCase()==s[c].toLowerCase()){i=c;break}}this.KR=Pc[i],this.KRC=jc[i]}get region(){return this.KR}get regionCode(){return this.KRC}get filename(){return this.KF}static toStubs(n,t,i){let s="";if(typeof n.language!="undefined"&&console.warn("The 'language' property for keyboard stubs has been deprecated.  Please use the 'languages' property instead."),n.languages||(n.languages=n.language),n?n.id?n.languages||(s="KeyboardStub has undefined languages"):s="KeyboardStub has undefined id":s="Stub undefined",s!="")return[{error:new Error(s)}];let c=[];Array.isArray(n.languages)?c=c.concat(n.languages):c.push(n.languages);let l=[];return c.forEach(o=>{let r=A(p({},n),{languages:o,language:void 0}),d=new ts(r,t,i);l.push(d)}),l}merge(n){this.KL||(this.KL=n.KL),this.KR||(this.KR=n.KR),this.KRC||(this.KRC=n.KRC),this.KN||(this.KN=n.KN),this.KF||(this.KF=n.KF),this.KFont||(this.KFont=n.KFont),this.KOskFont||(this.KOskFont=n.KOskFont),n._displayName&&(this._displayName||(this._displayName=n._displayName))}validateForCustomKeyboard(){return super.validateForCustomKeyboard()||!this.KF||!this.KR?new Error("To use a custom keyboard, you must specify file name, keyboard id, keyboard name, language, language code, and region."):null}};a(ts,"KeyboardStub");var te=ts;function ns(g){if(g.length>1){let n=g.map(t=>{var i;return`${t.error.message}:
  ${(i=t.error.stack)!=null?i:""}`});return Promise.reject(new Error(n.join(`

`)))}else return Promise.reject(g[0].error)}a(ns,"rejectErrorStubs");function _c(g,n){if(n.length==0)return Promise.resolve(g);if(g.length==0)return ns(n);{let t=g;return Promise.resolve(t.concat(n))}}a(_c,"mergeAndResolveStubPromises");var Sr="The Cloud API request timed out.",qc="Could not find a keyboard with that ID.",Wr="The Cloud API failed to find an appropriate keyboard.",Ta="Error occurred while registering keyboards: ",wa=a(function(g){return g+" keyboard not found."},"MISSING_KEYBOARD"),Pn=class Pn extends S.default{constructor(t,i){super();this.cloudResolutionPromises=new Map;this.languageFetchStarted=!1;this.registerFromCloud=a(t=>{let i=Number.parseInt(t.timerid),s;try{s=this._registerCore(t)}catch(c){s=new Error(Ta+c)}if(i){let c=this.cloudResolutionPromises.get(i);if(c)try{s instanceof Error?c.reject(s):c.resolve(s)}finally{this.cloudResolutionPromises.delete(i)}else{this.emit("unboundregister",s);return}}else{this.emit("unboundregister",s);return}},"registerFromCloud");this.requestEngine=t,this.pathConfig=i,this._languageListPromise=new f}get languageListPromise(){return this.languageFetchStarted||(this.languageFetchStarted=!0,this.keymanCloudRequest("",!0).catch(t=>{this.languageFetchStarted=!1,this._languageListPromise.reject(t),this._languageListPromise=new f})),this._languageListPromise.corePromise}keymanCloudRequest(t,i){let s="https://api.keyman.com/cloud/4.0/"+(arguments.length>1&&i?"languages":"keyboards"),c="?jsonp=keyman.register&languageidtype=bcp47&version="+z.CURRENT.toString(),l=s+c+t,{promise:o,queryId:r}=this.requestEngine.request(l);return this.cloudResolutionPromises.set(r,o),o.finally(()=>{this.cloudResolutionPromises.delete(r)}),o.corePromise}_registerCore(t){let i=t.options,s=i.fontBaseUri;if(this.pathConfig.fonts!=""?s=this.pathConfig.fonts:this.pathConfig.updateFontPath(s),typeof t.error=="string"){let l="";if(typeof t.options.keyboardid=="string"){let o=t.options.keyboardid;l=o.substring(0,1).toUpperCase()+o.substring(1)}return new Error(wa(l))}if(typeof i=="undefined"||typeof i.context=="undefined")return new Error(qc);let c=[];if(i.context=="keyboard"){let l=t.keyboard;if(Array.isArray(l))for(let o=0;o<l.length;o++)c=c.concat(Pn.registerLanguagesForKeyboard(l[o],i,o));else c=c.concat(Pn.registerLanguagesForKeyboard(l,i,0))}else if(i.context=="language"){let l=t.languages;return this._languageListPromise.resolve(l),l}return c}static registerLanguagesForKeyboard(t,i,s){let c="";if(typeof t=="undefined")return[];if(typeof i.keyboardid=="string"&&(c=i.keyboardid.split(",")[s]),Array.isArray(t))if(t.length==1||c.substr(-1,1)=="$"||c==""){let l=[];for(let o=0;o<t.length;o++)l=l.concat(this.registerLanguagesForKeyboard(t[o],i,s));return l}else{let l=0;for(let o=0;o<t.length;o++){let r=t[o].id.toLowerCase();if(r=="us"&&(r="english"),Array.isArray(t[o].languages)){let d=t[o].languages;for(let u=0;u<d.length;u++)if(r==d[u].name.toLowerCase()){l=o;break}}}return this.registerLanguagesForKeyboard(t[l],i,s)}else{let l=i.fontBaseUri||"",o=te.toStubs(t,i.keyboardBaseUri,l),r=c.split("@")[1];if(o.length==1&&typeof o[0].error!="undefined")throw o[0].error;return typeof r!="string"?o:(r=r.replace(/\$$/,""),[o.find(d=>d.KLC==r)])}}fetchCloudStubs(t){return R(this,null,function*(){if(t.length==0)return Promise.resolve([]);let i="&keyboardid=",s="";for(let c=0;c<t.length;c++)i=i+s+t[c].toString(),s=",";try{return yield this.keymanCloudRequest(i,!1)}catch(c){return Promise.reject(c)}})}};a(Pn,"CloudQueryEngine");var cn=Pn;var tl=class tl{constructor(n,t){this.id=n,this.language=t}toString(){let n=this.id;return this.language?(n=n+"@"+this.language,this.version&&(n=n+"@"+this.version)):this.version&&(n=n+"@@"+this.version),n}};a(tl,"CloudRequestEntry");var el=tl;function $c(g,n){return{keyboard:{id:g.id,name:g.name},error:typeof n=="string"?new Error(n):n}}a($c,"convertToErrorStub");function Ar(g,n,t){let i=new el(g,n);return t&&(i.version=t),i}a(Ar,"toQuerySpecs");function Rr(g,n,t){if(g.getStub(t.id,t.language)==null){for(let i=0;i<n.length;i++)if(n[i].id==t.id&&n[i].language==t.language)return!1;return!0}else return!1}a(Rr,"isUniqueRequest");var nl=class nl{constructor(n,t,i){this.pathConfig=i,this.cache=new sn(n),this.cloudQueryEngine=new cn(t,this.pathConfig),this.cloudQueryEngine.on("unboundregister",s=>{Array.isArray(s)&&s.forEach(c=>{c instanceof te&&this.cache.addStub(c)})})}addKeyboardArray(n){let t=[],i=[],s=[],c=[],l=[];for(let d of n)if(typeof d=="string")d.length>0&&c.push(d);else if(d.KI||d.KL||d.KLC||d.KFont||d.KOskFont)s.push(new te(d));else{let u=d;if(typeof u.language!="undefined"&&console.warn("The 'language' property for keyboard stubs has been deprecated.  Please use the 'languages' property instead."),u.languages||(u.languages=u.language),typeof u.languages=="undefined"){let B="To use keyboard '"+u.id+"', you must specify languages.";l.push($c(u,B))}else if(Array.isArray(u.languages)){let B=te.toStubs(u,this.pathConfig.keyboards,this.pathConfig.fonts);for(let b of B)b instanceof te?s.push(b):l.push(b)}else{let B=u;s.push(new te(B,this.pathConfig.keyboards,this.pathConfig.fonts))}}for(let d of s)if(d.KF){let u=d.validateForCustomKeyboard();u?l.push($c(d,u)):t.push(d)}else i.push(d);let o=[];for(let d of i){if(!d.KI&&!d.KLC){l.push($c(d,"Cannot fetch keyboard information without a keyboard ID or language code."));continue}let u=Ar(Oe(d.id),d.langId);Rr(this.cache,o,u)&&o.push(u)}for(let d of c){let u=d.split("@"),B=[""];u[0].toLowerCase()=="english"&&(u[0]="us"),u.length>1&&(B=u[1].split(","));for(let b=0;b<B.length;b++){if(b>0&&B[b]=="")continue;let I=Ar(u[0],B[b],u[2]);Rr(this.cache,o,I)&&o.push(I)}}return t.forEach(d=>this.cache.addStub(d)),this.cloudQueryEngine.fetchCloudStubs(o.map(d=>d.toString())).then(d=>{for(let u of d)u instanceof te?(this.cache.addStub(u),t.push(u)):l.push(u);return[].concat(l).concat(t)})}addLanguageKeyboards(n){return R(this,null,function*(){let t=[],i=[];try{i=yield this.cloudQueryEngine.languageListPromise}catch(l){return console.error(l),t.push({error:l}),t}let s=i,c="";for(let l=0;l<n.length;l++){let o=n[l].toLowerCase(),r=o.substr(-1,1)=="$";r&&(o=o.substr(0,o.length-1));let d=!1;for(let u=0;u<s.length;u++)if(o==s[u].name.toLowerCase()){c!=""&&(c=c+","),c=c+"@"+s[u].id,r&&(c=c+"$"),d=!0;break}if(!d){let u={language:{name:o},error:new Error(this.alertLanguageUnavailable(o))};t.push(u)}}return c==""?ns(t):this.cloudQueryEngine.keymanCloudRequest("&keyboardid="+c,!1).then(l=>R(this,null,function*(){let o=yield _c(l,t);for(let r of o)typeof r.error=="undefined"&&this.cache.addStub(r);return o}),l=>{console.error(l);let o={error:l};return t.push(o),ns(t)})})}fetchCloudCatalog(){return R(this,null,function*(){try{let n=yield this.cloudQueryEngine.keymanCloudRequest("",!1);return n.forEach(t=>this.cache.addStub(t)),n}catch(n){return Promise.reject([{error:n}])}})}alertLanguageUnavailable(n){return"No keyboards are available for "+n+". Does it have another language name?"}};a(nl,"KeyboardRequisitioner");var ln=nl;var il=class il{constructor(){this.registeredModels={};this.languageModelMap={}}modelForLanguage(n){return this.languageModelMap[n]}register(n){if(n.id=n.id.toLowerCase(),JSON.stringify(n)==JSON.stringify(this.registeredModels[n.id]))return;this.registeredModels[n.id]=n;let t=this;n.languages.forEach(function(i){if(!i){console.warn("Null / undefined language codes are not permitted for registration.");return}t.languageModelMap[i]=n})}unregister(n){let t;if(n=n.toLowerCase(),this.registeredModels[n])t=this.registeredModels[n],delete this.registeredModels[n];else return null;let i=this;return t.languages.forEach(function(s){i.languageModelMap[s].id==n&&delete i.languageModelMap[s]}),t}isRegistered(n){return!!this.registeredModels[n.id.toLowerCase()]}};a(il,"ModelManager");var on=il;function is(g){let n=[];for(let t=0;t<g.length;t++)n.push(g[t]);return n}a(is,"arrayFromNodeList");function N(g){let n=document.createElement(g);return n.style.userSelect="none",n.style.webkitUserSelect="none",n}a(N,"createUnselectableElement");var sl=class sl{constructor(n,t){this.fontStyleDefinitions={};this.linkedSheets=[];this.fontPromises=[];if(!n){let i=document.getElementsByTagName("HEAD");i.length>0?n=i[0]:n=document.body}this.linkNode=n,this.doCacheBusting=t||!1}get sheets(){return this.linkedSheets.map(n=>n.sheet)}linkStylesheet(n){if(!(n instanceof HTMLLinkElement)&&!n.innerHTML)return;let t=new f;n instanceof HTMLLinkElement?n.onload=()=>t.resolve():t.resolve(),this.linkedSheets.push({sheet:n,load:t}),this.linkNode.appendChild(n)}allLoadedPromise(){return R(this,null,function*(){let n=this.linkedSheets.map(t=>t.load.corePromise);Promise.allSettled?yield Promise.allSettled(n):yield Promise.all(n)})}addStyleSheetForFont(n,t,i){if(!n||typeof n.files=="undefined")return null;let s=n.family,c,l,o="",r="",d=[],u="";i||(i=W.OperatingSystem.Other);let B=this.fontStyleDefinitions[i]=this.fontStyleDefinitions[i]||{};if(B[s]){let G=B[s];return G.parentNode||this.linkStylesheet(G),null}for(typeof n.files=="string"?d[0]=n.files:d=n.files,l=0;l<d.length;l++)d[l].toLowerCase().indexOf("data:font")==0&&(u=d[l]),d[l].toLowerCase().indexOf(".otf")>0&&(o=d[l]),d[l].toLowerCase().indexOf(".ttf")>0&&(o=d[l]),d[l].toLowerCase().indexOf(".woff")>0&&(r=d[l]);o!=""&&o.indexOf("/")<0&&(o=t+o),r!=""&&r.indexOf("/")<0&&(r=t+r);let b=`@font-face {
font-family:"`+n.family.replace(/\u0022/g,"")+`";
font-style:normal;
font-weight:normal;
`;if(u){let x=u.substring(10,u.indexOf(";",10));b+=`src:url('${u}'), format('${x}');`}else{if(i==W.OperatingSystem.iOS?o!=""&&(this.doCacheBusting&&(o=this.cacheBust(o)),c='url("'+encodeURI(o)+`") format('truetype')`):(r!=""&&(c='url("'+encodeURI(r)+`"') format('woff')`),o!=""&&(c='url("'+encodeURI(o)+`") format('truetype')`)),!c)return null;b+="src:"+c+";"}b=b+`
}
`;let I=ot(b);B[s]=I;let F=new FontFace(n.family,c).load(),y=a(()=>{this.fontPromises=this.fontPromises.filter(G=>G!=F)},"clearPromise");return this.fontPromises.push(F.then(y).catch(y)),this.linkStylesheet(I),I}cacheBust(n){return n+"?v="+new Date().getTime()}linkExternalSheet(n,t){try{if(!t&&document.querySelector("link[href="+JSON.stringify(n)+"]")!=null)return null}catch(s){return null}let i=document.createElement("link");return i.type="text/css",i.rel="stylesheet",i.href=n,this.linkStylesheet(i),i}unlink(n){let t=this.linkedSheets.findIndex(i=>i.sheet==n);return t>-1?(this.linkedSheets.splice(t,1)[0].load.resolve(),n.parentNode.removeChild(n),!0):!1}unlinkAll(){for(let n of this.linkedSheets){let t=n.sheet;t.parentNode&&t.parentNode.removeChild(t),n.load.resolve()}this.linkedSheets.splice(0,this.linkedSheets.length)}};a(sl,"StylesheetManager");var ue=sl;function ot(g){let n=document.createElement("style");return n.type="text/css",n.appendChild(document.createTextNode(g)),n}a(ot,"createStyleSheet");function Fe(){let g;return typeof window.orientation!="undefined"?g=window.orientation:typeof window.screen.orientation!="undefined"&&(g=window.screen.orientation.angle),g!==void 0?Math.abs(g/90)==1:!1}a(Fe,"landscapeView");var cl=class cl{constructor(n){this.name=n}load(n){return this.loadCookie(this.name,n||(t=>t))}save(n,t){this.saveCookie(this.name,n,t||(i=>i))}_loadRawCookies(){let n={};if(typeof document.cookie!="undefined"&&document.cookie!=""){let t=document.cookie.split(/;\s*/);for(let i=0;i<t.length;i++){let s=t[i].split("=");s.length==2&&(n[s[0]]=s[1])}}return n}loadCookie(n,t){let i={},c=this._loadRawCookies()[n];if(c){let l=decodeURIComponent(c).split(";");for(let o=0;o<l.length&&!(o==l.length-1&&!l[o]);o++){let r=l[o].split("=");if(r.length>1){let[d,u]=r;i[d]=t(u,d)}else i[r[0]]=""}}return i}saveCookie(n,t,i){let s="";for(let o in t)s+=o+"="+i(t[o],o)+";";let l=" path=/; expires="+new Date(new Date().valueOf()+1e3*60*60*24*30).toUTCString();document.cookie=`${n}=${encodeURIComponent(s)}; ${l}`}};a(cl,"CookieSerializer");var oe=cl;function K(g){let n;if(!g)return 0;let t=g.offsetLeft?g.offsetLeft:0;if(n=g,n.offsetParent){for(;n.offsetParent;)n=n.offsetParent,t+=n.offsetLeft;let i=n.ownerDocument;n.style.position=="fixed"&&i&&i.scrollingElement&&(t+=i.scrollingElement.scrollLeft)}if(n&&n.ownerDocument&&g.ownerDocument!=window.document){let i=n.ownerDocument;if(i&&i.defaultView&&i.defaultView.frameElement)return t+K(i.defaultView.frameElement)-i.documentElement.scrollLeft}return t}a(K,"getAbsoluteX");function D(g){let n;if(!g)return 0;let t=g.offsetTop?g.offsetTop:0;if(n=g,n.ownerDocument&&n instanceof n.ownerDocument.defaultView.HTMLElement){for(;n.offsetParent;)n=n.offsetParent,t+=n.offsetTop;let i=n.ownerDocument;n.style.position=="fixed"&&i&&i.scrollingElement&&(t+=i.scrollingElement.scrollTop)}if(n&&n.ownerDocument&&g.ownerDocument!=window.document){let i=n.ownerDocument;if(i&&i.defaultView&&i.defaultView.frameElement)return t+D(i.defaultView.frameElement)}return t}a(D,"getAbsoluteY");var ll=class ll extends oe{constructor(n,t){super(`KeymanWeb_${n}_Option_${t}`)}load(){return super.load(decodeURIComponent)}save(n){super.save(n,encodeURIComponent)}};a(ll,"VarStoreSerializer");var ss=ll,ol=class ol{loadStore(n,t){return new ss(n,t).load()}saveStore(n,t,i){new ss(n,t).save(i)}};a(ol,"VariableStoreCookieSerializer");var jn=ol;var rl=class rl extends De{constructor(t,i,s){super(t,i,new jn);this.insertText=a((t,i)=>{this.resetContextCache(),this.engine.contextManager.insertText(this,t,i)},"insertText");this.KT=this.insertText;this.engine=i,this.stubNamespacer=s}preserveID(t){let i;if(document.currentScript)i=document.currentScript.id;else{let s=document.getElementsByTagName("script");i=s[s.length-1].id}if(i)i.indexOf(Oe(t.KI))!=-1?t.KI=i:console.error("Error when registering keyboard:  current SCRIPT tag's ID does not match!");else return}registerKeyboard(t){super.registerKeyboard(t);let i=this.loadedKeyboard;this.preserveID(t),this.engine.config.deferForInitialization.then(()=>{this.engine.keyboardRequisitioner.cache.isFetchingKeyboard(i.id)||(this.engine.keyboardRequisitioner.cache.addKeyboard(i),this.loadedKeyboard=null)})}registerStub(t){var s;this.stubNamespacer&&this.stubNamespacer(t);let i=a(()=>{let c=this.engine.config.paths;return new te(t,c.keyboards,c.fonts)},"buildStub");if(!this.engine.config.deferForInitialization.isResolved)this.engine.config.deferForInitialization.then(()=>this.engine.keyboardRequisitioner.cache.addStub(i()));else{let c=i();if((s=this.engine.keyboardRequisitioner)!=null&&s.cache.findMatchingStub(c))return 1;this.engine.keyboardRequisitioner.cache.addStub(c)}return null}};a(rl,"KeyboardInterface");var Rt=rl;(function(){Rt.__publishShorthandAPI()})();var al=class al extends qt{constructor(n,t){n&&n._jsGlobal!=window&&(n._jsGlobal.String=window.String),n?super(n):super(new Ut(window,Nn)),this.performCacheBusting=t||!1}loadKeyboardInternal(n,t,i){let s=new f;this.performCacheBusting&&(n=this.cacheBust(n));try{let c=this.harness._jsGlobal.document,l=c.createElement("script");i&&(l.id=i),c.head.appendChild(l),l.onerror=o=>{s.reject(t.missingError(o))},l.onload=()=>{if(this.harness.loadedKeyboard){let o=this.harness.loadedKeyboard;this.harness.loadedKeyboard=null,s.resolve(o)}else s.reject(t.scriptError())},s.then(()=>{l.remove()}).catch(()=>{l.remove()}),l.src=n}catch(c){return Promise.reject(c)}return s.corePromise}cacheBust(n){return n+"?v="+new Date().getTime()}};a(al,"DOMKeyboardLoader");var cs=al;var ls=class ls{constructor(n,t,i){this.left=n.getTextBeforeCaret(),this.startOfBuffer=Q.length(this.left)<=t.leftContextCodePoints,this.startOfBuffer||(this.left=Q.substr(this.left,-t.leftContextCodePoints)),this.right=n.getTextAfterCaret(),this.endOfBuffer=Q.length(this.right)<=t.rightContextCodePoints,this.endOfBuffer||(this.right=Q.substr(this.right,0,t.rightContextCodePoints)),this.casingForm=i=="shift"?"initial":i=="caps"?"upper":null}toMock(){let n=Q.length(this.left);return new E(this.left+(this.right||""),n)}};a(ls,"ContextWindow"),ls.ENGINE_RULE_WINDOW={leftContextCodePoints:64,rightContextCodePoints:32};var Ze=ls;var gl=class gl{constructor(){this._promises=new Map}get length(){return this._promises.size}make(n,t,i){if(this._promises.has(n))return i(`Existing request with token ${n}`);this._promises.set(n,{reject:i,resolve:t})}keep(n,t){let i=this._promises.get(n);if(!i)throw new Error(`No promise associated with token: ${n}`);let s=i.resolve;return this._promises.delete(n),s(t)}break(n,t){let i=this._promises.get(n);if(!i)throw new Error(`No promise associated with token: ${n}`);this._promises.delete(n),i.reject(t)}};a(gl,"PromiseStore");var rt=gl;var dl=class dl{constructor(n,t,i){this._worker=t,this._worker.onmessage=this.onMessage.bind(this),this._declareLMLayerReady=null,this._predictPromises=new rt,this._wordbreakPromises=new rt,this._acceptPromises=new rt,this._revertPromises=new rt,this._nextToken=Number.MIN_SAFE_INTEGER,this.sendConfig(n,!!i)}sendConfig(n,t){this._worker.postMessage({message:"config",capabilities:n,testMode:t})}loadModel(n,t="file"){return new Promise((i,s)=>{this._declareLMLayerReady=i;let c={type:t};t=="file"?c.file=n:c.code=n,this._worker.postMessage({message:"load",source:c})})}unloadModel(){this._worker.postMessage({message:"unload"})}predict(n,t){let i=this._nextToken++;return new Promise((s,c)=>{this._predictPromises.make(i,s,c),this._worker.postMessage({message:"predict",token:i,transform:n,context:t})})}wordbreak(n){let t=this._nextToken++;return new Promise((i,s)=>{this._wordbreakPromises.make(t,i,s),this._worker.postMessage({message:"wordbreak",token:t,context:n})})}acceptSuggestion(n,t,i){let s=this._nextToken++;return new Promise((c,l)=>{this._acceptPromises.make(s,c,l),this._worker.postMessage({message:"accept",token:s,suggestion:n,context:t,postTransform:i})})}revertSuggestion(n,t){let i=this._nextToken++;return new Promise((s,c)=>{this._revertPromises.make(i,s,c),this._worker.postMessage({message:"revert",token:i,reversion:n,context:t})})}resetContext(n){this._worker.postMessage({message:"reset-context",context:n})}onMessage(n){let t=n.data;if(t.message==="error")t.error?console.error(`${t.log}
${t.error}`):console.error(t.log);else if(t.message==="ready")this._declareLMLayerReady(n.data.configuration);else if(t.message==="suggestions")this._predictPromises.keep(t.token,t.suggestions);else if(t.message==="currentword")this._wordbreakPromises.keep(t.token,t.word);else if(t.message==="postaccept")this._acceptPromises.keep(t.token,t.reversion);else if(t.message==="postrevert")this._revertPromises.keep(t.token,t.suggestions);else throw new Error(`Message not implemented: ${t.message}`)}shutdown(){this._worker.terminate()}};a(dl,"LMLayer");var rn=dl;function os(g){return g}a(os,"unwrap");var Hr=`"use strict";(()=>{var Ge=Object.defineProperty,nr=Object.defineProperties;var ir=Object.getOwnPropertyDescriptors;var At=Object.getOwnPropertySymbols;var or=Object.prototype.hasOwnProperty,sr=Object.prototype.propertyIsEnumerable;var ze=(a,t)=>(t=Symbol[a])?t:Symbol.for("Symbol."+a);var Ot=(a,t,r)=>t in a?Ge(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,B=(a,t)=>{for(var r in t||(t={}))or.call(t,r)&&Ot(a,r,t[r]);if(At)for(var r of At(t))sr.call(t,r)&&Ot(a,r,t[r]);return a},je=(a,t)=>nr(a,ir(t)),p=(a,t)=>Ge(a,"name",{value:t,configurable:!0});var Re=(a,t)=>{for(var r in t)Ge(a,r,{get:t[r],enumerable:!0})};var K=(a,t,r)=>new Promise((n,i)=>{var o=l=>{try{u(r.next(l))}catch(c){i(c)}},s=l=>{try{u(r.throw(l))}catch(c){i(c)}},u=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);u((r=r.apply(a,t)).next())}),Pe=function(a,t){this[0]=a,this[1]=t},Rt=(a,t,r)=>{var n=(s,u,l,c)=>{try{var d=r[s](u),h=(u=d.value)instanceof Pe,g=d.done;Promise.resolve(h?u[0]:u).then(m=>h?n(s==="return"?s:"next",u[1]?{done:m.done,value:m.value}:m,l,c):l({value:m,done:g})).catch(m=>n("throw",m,l,c))}catch(m){c(m)}},i=s=>o[s]=u=>new Promise((l,c)=>n(s,u,l,c)),o={};return r=r.apply(a,t),o[ze("asyncIterator")]=()=>o,i("next"),i("throw"),i("return"),o};var Pt=(a,t,r)=>(t=a[ze("asyncIterator")])?t.call(a):(a=a[ze("iterator")](),t={},r=(n,i)=>(i=a[n])&&(t[n]=o=>new Promise((s,u,l)=>(o=i.call(a,o),l=o.done,Promise.resolve(o.value).then(c=>s({value:c,done:l}),u)))),r("next"),r("return"),t);var We={};Re(We,{DummyModel:()=>Ht,QuoteBehavior:()=>ne,SENTINEL_CODE_UNIT:()=>_,TrieModel:()=>be,applyTransform:()=>y,buildMergedTransform:()=>Q,defaultApplyCasing:()=>De,getLastPreCaretToken:()=>Te,isHighSurrogate:()=>H,isLowSurrogate:()=>Ze,isSentinel:()=>Ne,tokenize:()=>ge,transformToSuggestion:()=>z,wordbreak:()=>ie});var e={};var L=class L{constructor(t,r,n,i){switch(t.toLowerCase()){case L.Browser.Chrome:case L.Browser.Edge:case L.Browser.Firefox:case L.Browser.Native:case L.Browser.Opera:case L.Browser.Safari:this.browser=t.toLowerCase();break;default:this.browser=L.Browser.Other}switch(r.toLowerCase()){case L.FormFactor.Desktop:case L.FormFactor.Phone:case L.FormFactor.Tablet:this.formFactor=r.toLowerCase();break;default:throw"Invalid form factor specified for device: "+r}switch(n.toLowerCase()){case L.OperatingSystem.Windows.toLowerCase():case L.OperatingSystem.macOS.toLowerCase():case L.OperatingSystem.Linux.toLowerCase():case L.OperatingSystem.Android.toLowerCase():case L.OperatingSystem.iOS.toLowerCase():this.OS=n.toLowerCase();break;default:this.OS=L.OperatingSystem.Other}this.touchable=i}};p(L,"DeviceSpec");var de=L;(n=>{let a;(h=>(h.Chrome="chrome",h.Edge="edge",h.Firefox="firefox",h.Native="native",h.Opera="opera",h.Safari="safari",h.Other="other"))(a=n.Browser||(n.Browser={}));let t;(d=>(d.Windows="windows",d.macOS="macosx",d.Linux="linux",d.Android="android",d.iOS="ios",d.Other="other"))(t=n.OperatingSystem||(n.OperatingSystem={}));let r;(u=>(u.Desktop="desktop",u.Phone="phone",u.Tablet="tablet"))(r=n.FormFactor||(n.FormFactor={}))})(de||(de={}));var R=class R{};p(R,"KEYMAN_VERSION"),R.VERSION="19.0.62",R.VERSION_RELEASE="19.0",R.VERSION_MAJOR="19",R.VERSION_MINOR="0",R.VERSION_PATCH="62",R.TIER="alpha",R.VERSION_TAG="-alpha",R.VERSION_WITH_TAG="19.0.62-alpha",R.VERSION_ENVIRONMENT="alpha",R.VERSION_GIT_TAG="release@19.0.62-alpha";var Ve=R,It=Ve;var P=class P{constructor(t){if(t==null){this.components=[].concat(P.DEVELOPER_VERSION_FALLBACK.components);return}if(Array.isArray(t)){let i=t;if(i.length<2)throw new Error("Version string must have at least a major and minor component!");this.components=[].concat(i);return}let r=t.split("."),n=[];if(r.length<2)throw new Error("Version string must have at least a major and minor component!");for(let i=0;i<r.length;i++){let o=parseInt(r[i],10);if(isNaN(o))throw new Error("Version string components must be numerical!");n.push(o)}this.components=n}get major(){return this.components[0]}get minor(){return this.components[1]}toString(){return this.components.join(".")}toJSON(){return this.toString()}equals(t){return this.compareTo(t)==0}precedes(t){return this.compareTo(t)<0}compareTo(t){let r=this.components.length<t.components.length,n=this.components.length<t.components.length?this.components.length:t.components.length,i;for(i=0;i<n;i++){let s=this.components[i]-t.components[i];if(s!=0)return s}let o=r?t.components:this.components;do{if(o[i]>0)return r?-1:1;i++}while(i<o.length);return 0}};p(P,"Version"),P.CURRENT=new P(It.VERSION_RELEASE),P.DEVELOPER_VERSION_FALLBACK=new P([9,0,0]),P.NO_DEFAULT_KEYCAPS=new P([12,0]),P.MAC_POSSIBLE_IPAD_ALIAS=new P([10,15]);var Ie=P;var T={};Re(T,{charAt:()=>mr,charCodeAt:()=>lr,codePointToCodeUnit:()=>X,codeUnitToCodePoint:()=>hr,enableSupplementaryPlane:()=>ar,indexOf:()=>ur,lastIndexOf:()=>cr,length:()=>he,nextChar:()=>$,prevChar:()=>Dt,slice:()=>pr,substr:()=>Nt,substring:()=>dr});var N=!1;function ar(a){N=a}p(ar,"enableSupplementaryPlane");function lr(a,t){let r=a;if(!N)return a.charCodeAt(t);let n=0;if(t<0||t>=r.length)return NaN;for(let o=0;o<t;o++)if(n=$(r,n),n===null)return NaN;let i=r.charCodeAt(n);if(i>=55296&&i<=56319&&r.length>n+1){let o=r.charCodeAt(n+1);if(o>=56320&&o<=57343)return(i-55296<<10)+(o-56320)+65536}return i}p(lr,"charCodeAt");function ur(a,t,r){let n=a;if(!N)return a.indexOf(t,r);let i=n.indexOf(t,r);if(i<0)return i;let o=0;for(let s=0;s!==null&&s<i;s=$(n,s))o++;return o}p(ur,"indexOf");function cr(a,t,r){let n=a;if(!N)return n.lastIndexOf(t,r);let i=n.lastIndexOf(t,r);if(i<0)return i;let o=0;for(let s=0;s!==null&&s<i;s=$(n,s))o++;return o}p(cr,"lastIndexOf");function he(a){let t=a;if(!N)return t.length;if(t.length==0)return 0;let r,n;for(r=0,n=0;n!==null;r++)n=$(t,n);return r}p(he,"length");function pr(a,t,r){let n=a;if(!N)return n.slice(t,r);let i=X(n,t),o=X(n,r);return i===null||o===null?"":n.slice(i,o)}p(pr,"slice");function Nt(a,t,r){let n=a;if(!N)return t>-1?n.substr(t,r):n.substr(n.length+t,-t);t<0&&(t=he(n)+t),t<0&&(t=0);let i=X(n,t),o=i;if(i===null)return"";if(arguments.length<3)o=n.length;else for(let s=0;s<r;s++)o=$(n,o);return o===null?n.substring(i):n.substring(i,o)}p(Nt,"substr");function dr(a,t,r){let n=a;if(!N)return n.substring(t,r);let i,o;if(typeof r=="undefined")i=X(n,t),o=n.length;else{if(t>r){let s=t;t=r,r=s}i=X(n,t),o=X(n,r)}return(isNaN(i)||i===null)&&(i=0),(isNaN(o)||o===null)&&(o=n.length),n.substring(i,o)}p(dr,"substring");function $(a,t){let r=a;if(t===null||t<0||t>=r.length-1)return null;if(!N)return t+1;let n=r.charCodeAt(t);if(n>=55296&&n<=56319&&r.length>t+1){let i=r.charCodeAt(t+1);if(i>=56320&&i<=57343)return t==r.length-2?null:t+2}return t+1}p($,"nextChar");function Dt(a,t){let r=a;if(t==null||t<=0||t>r.length)return null;if(!N)return t-1;let n=r.charCodeAt(t-1);if(n>=56320&&n<=57343&&t>1){let i=r.charCodeAt(t-2);if(i>=55296&&i<=56319)return t-2}return t-1}p(Dt,"prevChar");function X(a,t){if(t===null)return null;let r=a,n=0;if(t<0){n=r.length;for(let i=0;i>t;i--)n=Dt(r,n);return n}if(t==he(r))return r.length;for(let i=0;i<t;i++)n=$(r,n);return n}p(X,"codePointToCodeUnit");function hr(a,t){let r=a;return t===null?null:t==0?0:t<0?he(r.substr(t)):he(r.substr(0,t))}p(hr,"codeUnitToCodePoint");function mr(a,t){let r=a;return N?t>=0?Nt(r,t,1):"":r.charAt(t)}p(mr,"charAt");var Xe=class Xe{constructor(t){this._isFulfilled=!1;this._isRejected=!1;this._promise=new Promise((r,n)=>{this._resolve=i=>{this._isFulfilled=!0,r(i)},this._reject=i=>{this._isRejected=!0,n(i)},t&&t(this._resolve,this._reject)})}get resolve(){return this._resolve}get reject(){return this._reject}get isFulfilled(){return this._isFulfilled}get isRejected(){return this._isRejected}get isResolved(){return this.isFulfilled||this.isRejected}then(t,r){return this._promise.then(t,r)}catch(t){return this._promise.catch(t)}finally(t){return this._promise.finally(t)}get corePromise(){return this._promise}};p(Xe,"ManagedPromise");var re=Xe;var Je=class Je extends re{constructor(t){let r=null;super(o=>{r=setTimeout(()=>{this.isResolved||o(!0)},t)}),this.timerHandle=r;let n=this._resolve;this._resolve=o=>{clearTimeout(this.timerHandle),n(o)};let i=this._reject;this._reject=o=>{clearTimeout(this.timerHandle),i(o)}}};p(Je,"TimeoutPromise");var me=Je,$e=p(a=>new me(a).corePromise,"timedPromise");var W=class W{constructor(t,r){if(typeof t!="function"){this.comparator=t.comparator,this.heap=[].concat(t.heap);return}let n=t;this.comparator=n,this.heap=(r!=null?r:[]).slice(0),this.heapify()}static leftChildIndex(t){return t*2+1}static rightChildIndex(t){return t*2+2}static parentIndex(t){return Math.floor((t-1)/2)}heapify(t,r){if(t==null||r==null){this.heapify(0,this.count-1);return}let n=[],i=-1;for(let o=r;o>=t;o--){let s=W.parentIndex(o);this.siftDown(o)&&s<t&&i!=s&&(n.push(s),i=s)}for(i=-1;n.length>0;){let o=n.shift(),s=W.parentIndex(o);this.siftDown(o)&&s>=0&&i!=s&&(n.push(s),i=s)}}get count(){return this.heap.length}peek(){return this.heap[0]}enqueue(t){let r=this.heap.length;this.heap.push(t);let n=W.parentIndex,i=n(r);for(;r!==0&&this.comparator(this.heap[r],this.heap[i])<0;){let o=this.heap[r];this.heap[r]=this.heap[i],this.heap[i]=o,r=i,i=n(r)}}enqueueAll(t){if(t.length==0)return;let r=this.count;this.heap=this.heap.concat(t);let n=W.parentIndex(r);this.heapify(n>=0?n:0,W.parentIndex(this.count-1))}dequeue(){if(this.count==0)return;let t=this.heap[0],r=this.heap.pop();return this.heap.length>0&&(this.heap[0]=r,this.siftDown(0)),t}siftDown(t){let r=W.leftChildIndex(t),n=W.rightChildIndex(t),i=t;if(r<this.heap.length&&this.comparator(this.heap[r],this.heap[i])<0&&(i=r),n<this.heap.length&&this.comparator(this.heap[n],this.heap[i])<0&&(i=n),i!=t){let o=this.heap[t];return this.heap[t]=this.heap[i],this.heap[i]=o,this.siftDown(i),!0}else return!1}toArray(){return this.heap.slice(0)}};p(W,"PriorityQueue");var A=W;var _="﷐";function y(a,t){var d,h;let r=t.left||"",n=T.length(r),i=n<a.deleteLeft?n:a.deleteLeft,o=T.substr(r,0,n-i)+(a.insert||""),s=t.right||"",u=T.length(s),l=u<((d=a.deleteRight)!=null?d:0)?u:(h=a.deleteRight)!=null?h:0,c=T.substr(s,l);return{left:o,right:c,startOfBuffer:t.startOfBuffer,endOfBuffer:t.endOfBuffer,casingForm:t.casingForm}}p(y,"applyTransform");function Q(a,t){let r=a.insert,n=t.deleteLeft;if(t.deleteLeft){let i=T.length(a.insert);i<=t.deleteLeft?(r="",n=t.deleteLeft-i):(r=T.substr(a.insert,0,i-t.deleteLeft),n=0)}return{insert:r+t.insert,deleteLeft:a.deleteLeft+n,deleteRight:(a.deleteRight||0)+(t.deleteRight||0)}}p(Q,"buildMergedTransform");function H(a){return typeof a=="string"&&(a=a.charCodeAt(0)),a>=55296&&a<=56319}p(H,"isHighSurrogate");function Ze(a){return typeof a=="string"&&(a=a.charCodeAt(0)),a>=56320&&a<=57343}p(Ze,"isLowSurrogate");function Ne(a){return a==_}p(Ne,"isSentinel");function z(a,t){let r={transform:a,displayAs:a.insert};return a.id!==void 0&&(r.transformId=a.id),(t===0||t)&&(r.p=t),r}p(z,"transformToSuggestion");function De(a,t){switch(a){case"lower":return t.toLowerCase();case"upper":return t.toUpperCase();case"initial":let r=1;return t.length>1&&H(t.charAt(0))&&Ze(t.charCodeAt(1))&&(r=2),t.substring(0,r).toUpperCase().concat(t.substring(r))}}p(De,"defaultApplyCasing");var fe=(n=>(n.noQuotes="no-quotes",n.useQuotes="use-quotes",n.default="default-quotes",n))(fe||{});(t=>{function a(r,n,i,o){if(o=="default-quotes"||!o)throw"Specified quote behavior may be ambiguous - default behavior not specified (may not be .default)";switch(r=="default-quotes"&&(r=o),r){case"no-quotes":return n;case"use-quotes":let{open:s,close:u}=i.quotesForKeepSuggestion;return s+n+u;default:throw"Unsupported quote behavior state detected; implementation missing!"}}t.apply=a,p(a,"apply")})(fe||(fe={}));var ne=fe;function ge(a,t,r){let n=(r==null?void 0:r.rejoins)||["'"];t=t||{left:void 0,startOfBuffer:void 0,endOfBuffer:void 0};let i=a(t.left||"")||[],o=a(t.right||"")||[],s={left:[],right:[],caretSplitsToken:!1},u=0;for(;i.length>0;){let d=i[0];if(Math.max(d.start,u)!=u){let h=Math.max(u,d.start);s.left.push({text:t.left.substring(u,h),isWhitespace:!0}),u=h}else i.shift(),s.left.push({text:d.text}),u=Math.max(u,d.end)}if(t.left!=null&&u!=t.left.length){let d=Math.max(u,t.left.length);s.left.push({text:t.left.substring(u,d),isWhitespace:!0}),u=d}let l=s.left.length;if(l>1){let d=s.left[l-2],h=s.left[l-1];!d.isWhitespace&&!h.isWhitespace&&n.indexOf(h.text)!=-1&&(s.left.pop(),s.left.pop(),s.left.push({text:d.text+h.text}),l--)}u=0;let c=!0;for(;o.length>0;){let d=o[0];if(Math.max(d.start,u)!=u){let h=Math.max(u,d.start);s.right.push({text:t.right.substring(u,h),isWhitespace:!0}),u=h}else{let h=s.left[l-1];h&&c&&!h.isWhitespace&&a(h.text+d.text).length==1&&(s.caretSplitsToken=!0),o.shift(),s.right.push({text:d.text}),u=Math.max(u,d.end)}c=!1}if(t.right&&u!=t.right.length){let d=Math.max(u,t.right.length);s.right.push({text:t.right.substring(u,d),isWhitespace:!0}),u=d}return s}p(ge,"tokenize");function Te(a,t){let r=ge(a,t);if(r.left.length>0){let n=r.left.pop();return n.isWhitespace?"":n.text}return""}p(Te,"getLastPreCaretToken");function ie(a,t){return Te(a,t)}p(ie,"wordbreak");var xe={};Re(xe,{ascii:()=>tt,default:()=>q,defaultWordbreaker:()=>q,placeholder:()=>Ye});function Ye(a){let t=0;return a.split(/\\s+/).map(r=>{let n={start:t,end:t+r.length,text:r,length:r.length};return t=n.end,n})}p(Ye,"placeholder");function tt(a){let t=/[A-Za-z0-9']+/g,r=[],n;for(;(n=t.exec(a))!==null;)r.push(new et(n[0],n.index));return r}p(tt,"ascii");var rt=class rt{constructor(t,r){this.text=t,this.start=r}get length(){return this.text.length}get end(){return this.start+this.text.length}};p(rt,"RegExpDerivedSpan");var et=rt;var Ft=["Other","LF","Newline","CR","WSegSpace","Double_Quote","Single_Quote","MidNum","MidNumLet","Numeric","MidLetter","ALetter","ExtendNumLet","Format","Extend","Hebrew_Letter","ZWJ","Katakana","Regional_Indicator","sot","eot"],Wt=\`\\0 
!\\v"
#  $! "%# '&( ,'- .(/ 0):*;'< A+[ _,\\\` a+{ " ª+« ­-® µ+¶ ·*¸ º+» À+× Ø+÷ ø+˘ ˞+̀.Ͱ+͵ Ͷ+͸ ͺ+;'Ϳ+΀ Ά+·*Έ+΋ Ό+΍ Ύ+΢ Σ+϶ Ϸ+҂ ҃.Ҋ+԰ Ա+՗ ՙ+՝ ՞+՟*ՠ+։'֊+֋ ֑.־ ֿ.׀ ׁ.׃ ׄ.׆ ׇ.׈ א/׫ ׯ/׳+״*׵ ؀)؆ ،'؎ ؐ.؛ ؜-؝ ؠ+ً.٠)٪ ٫)٬'٭ ٮ+ٰ.ٱ+۔ ە+ۖ.۝)۞ ۟.ۥ+ۧ.۩ ۪.ۮ+۰)ۺ+۽ ۿ+܀ ܏+ܑ.ܒ+ܰ.݋ ݍ+ަ.ޱ+޲ ߀)ߊ+߫.ߴ+߶ ߸'߹ ߺ+߻ ߽.߾ ࠀ+ࠖ.ࠚ+ࠛ.ࠤ+ࠥ.ࠨ+ࠩ.࠮ ࡀ+࡙.࡜ ࡠ+࡫ ࡰ+࢈ ࢉ+࢏ ࢐)࢒ ࢗ.ࢠ+࣊.࣢)ࣣ.ऄ+ऺ.ऽ+ा.ॐ+॑.क़+ॢ.। ०)॰ ॱ+ঁ.঄ অ+঍ এ+঑ ও+঩ প+঱ ল+঳ শ+঺ ়.ঽ+া.৅ ে.৉ ো.ৎ+৏ ৗ.৘ ড়+৞ য়+ৢ.৤ ০)ৰ+৲ ৼ+৽ ৾.৿ ਁ.਄ ਅ+਋ ਏ+਑ ਓ+਩ ਪ+਱ ਲ+਴ ਵ+਷ ਸ+਺ ਼.਽ ਾ.੃ ੇ.੉ ੋ.੎ ੑ.੒ ਖ਼+੝ ਫ਼+੟ ੦)ੰ.ੲ+ੵ.੶ ઁ.઄ અ+઎ એ+઒ ઓ+઩ પ+઱ લ+઴ વ+઺ ઼.ઽ+ા.૆ ે.૊ ો.૎ ૐ+૑ ૠ+ૢ.૤ ૦)૰ ૹ+ૺ.଀ ଁ.଄ ଅ+଍ ଏ+଑ ଓ+଩ ପ+଱ ଲ+଴ ଵ+଺ ଼.ଽ+ା.୅ େ.୉ ୋ.୎ ୕.୘ ଡ଼+୞ ୟ+ୢ.୤ ୦)୰ ୱ+୲ ஂ.ஃ+஄ அ+஋ எ+஑ ஒ+஖ ங+஛ ஜ+஝ ஞ+஠ ண+஥ ந+஫ ம+஺ ா.௃ ெ.௉ ொ.௎ ௐ+௑ ௗ.௘ ௦)௰ ఀ.అ+఍ ఎ+఑ ఒ+఩ ప+఺ ఼.ఽ+ా.౅ ె.౉ ొ.౎ ౕ.౗ ౘ+౛ ౝ+౞ ౠ+ౢ.౤ ౦)౰ ಀ+ಁ.಄ ಅ+಍ ಎ+಑ ಒ+಩ ಪ+಴ ವ+಺ ಼.ಽ+ಾ.೅ ೆ.೉ ೊ.೎ ೕ.೗ ೝ+೟ ೠ+ೢ.೤ ೦)೰ ೱ+ೳ.೴ ഀ.ഄ+഍ എ+഑ ഒ+഻.ഽ+ാ.൅ െ.൉ ൊ.ൎ+൏ ൔ+ൗ.൘ ൟ+ൢ.൤ ൦)൰ ൺ+඀ ඁ.඄ අ+඗ ක+඲ ඳ+඼ ල+඾ ව+෇ ්.෋ ා.෕ ූ.෗ ෘ.෠ ෦)෰ ෲ.෴ ั.า ิ.฻ ็.๏ ๐)๚ ັ.າ ິ.ຽ ່.໏ ໐)໚ ༀ+༁ ༘.༚ ༠)༪ ༵.༶ ༷.༸ ༹.༺ ༾.ཀ+཈ ཉ+཭ ཱ.྅ ྆.ྈ+ྍ.྘ ྙ.྽ ࿆.࿇ ါ.ဿ ၀)၊ ၖ.ၚ ၞ.ၡ ၢ.ၥ ၧ.ၮ ၱ.ၵ ႂ.ႎ ႏ.႐)ႚ.႞ Ⴀ+჆ Ⴧ+჈ Ⴭ+჎ ა+჻ ჼ+቉ ቊ+቎ ቐ+቗ ቘ+቙ ቚ+቞ በ+኉ ኊ+኎ ነ+኱ ኲ+኶ ኸ+኿ ዀ+዁ ዂ+዆ ወ+዗ ዘ+጑ ጒ+጖ ጘ+፛ ፝.፠ ᎀ+᎐ Ꭰ+᏶ ᏸ+᏾ ᐁ+᙭ ᙯ+ $ᚁ+᚛ ᚠ+᛫ ᛮ+᛹ ᜀ+ᜒ.᜖ ᜟ+ᜲ.᜵ ᝀ+ᝒ.᝔ ᝠ+᝭ ᝮ+᝱ ᝲ.᝴ ឴.។ ៝.៞ ០)៪ ᠋.᠎-᠏.᠐)᠚ ᠠ+᡹ ᢀ+ᢅ.ᢇ+ᢩ.ᢪ+᢫ ᢰ+᣶ ᤀ+᤟ ᤠ.᤬ ᤰ.᤼ ᥆)ᥐ ᧐)᧛ ᨀ+ᨗ.᨜ ᩕ.᩟ ᩠.᩽ ᩿.᪀)᪊ ᪐)᪚ ᪰.᫏ ᬀ.ᬅ+᬴.ᭅ+᭍ ᭐)᭚ ᭫.᭴ ᮀ.ᮃ+ᮡ.ᮮ+᮰)ᮺ+᯦.᯴ ᰀ+ᰤ.᰸ ᱀)᱊ ᱍ+᱐)ᱚ+᱾ ᲀ+᲋ Ა+᲻ Ჽ+᳀ ᳐.᳓ ᳔.ᳩ+᳭.ᳮ+᳴.ᳵ+᳷.ᳺ+᳻ ᴀ+᷀.Ḁ+἖ Ἐ+἞ ἠ+὆ Ὀ+὎ ὐ+὘ Ὑ+὚ Ὓ+὜ Ὕ+὞ Ὗ+὾ ᾀ+᾵ ᾶ+᾽ ι+᾿ ῂ+῅ ῆ+῍ ῐ+῔ ῖ+῜ ῠ+῭ ῲ+῵ ῶ+´  $   $​ ‌.‍0‎-‐ ‘(‚ ․(‥ ‧*\\u2028"‪- ,‰ ‿,⁁ ⁄'⁅ ⁔,⁕  $⁠-⁥ ⁦-⁰ ⁱ+⁲ ⁿ+₀ ₐ+₝ ⃐.⃱ ℂ+℃ ℇ+℈ ℊ+℔ ℕ+№ ℙ+℞ ℤ+℥ Ω+℧ ℨ+℩ K+℮ ℯ+℺ ℼ+⅀ ⅅ+⅊ ⅎ+⅏ Ⅰ+↉ Ⓐ+⓪ Ⰰ+⳥ Ⳬ+⳯.Ⳳ+⳴ ⴀ+⴦ ⴧ+⴨ ⴭ+⴮ ⴰ+⵨ ⵯ+⵰ ⵿.ⶀ+⶗ ⶠ+⶧ ⶨ+⶯ ⶰ+⶷ ⶸ+⶿ ⷀ+⷇ ⷈ+⷏ ⷐ+⷗ ⷘ+⷟ ⷠ.⸀ ⸯ+⸰ 　$、 々+〆 〪.〰 〱1〶 〻+〽 ゙.゛1ゝ ゠1・ ー1㄀ ㄅ+㄰ ㄱ+㆏ ㆠ+㇀ ㇰ1㈀ ㋐1㋿ ㌀1㍘ ꀀ+꒍ ꓐ+꓾ ꔀ+꘍ ꘐ+꘠)ꘪ+꘬ Ꙁ+꙯.꙳ ꙴ.꙾ ꙿ+ꚞ.ꚠ+꛰.꛲ ꜈+꟎ Ꟑ+꟒ ꟓ+꟔ ꟕ+꟝ ꟲ+ꠂ.ꠃ+꠆.ꠇ+ꠋ.ꠌ+ꠣ.꠨ ꠬.꠭ ꡀ+꡴ ꢀ.ꢂ+ꢴ.꣆ ꣐)꣚ ꣠.ꣲ+꣸ ꣻ+꣼ ꣽ+ꣿ.꤀)ꤊ+ꤦ.꤮ ꤰ+ꥇ.꥔ ꥠ+꥽ ꦀ.ꦄ+꦳.꧁ ꧏ+꧐)꧚ ꧥ.ꧦ ꧰)ꧺ ꨀ+ꨩ.꨷ ꩀ+ꩃ.ꩄ+ꩌ.꩎ ꩐)꩚ ꩻ.ꩾ ꪰ.ꪱ ꪲ.ꪵ ꪷ.ꪹ ꪾ.ꫀ ꫁.ꫂ ꫠ+ꫫ.꫰ ꫲ+ꫵ.꫷ ꬁ+꬇ ꬉ+꬏ ꬑ+꬗ ꬠ+꬧ ꬨ+꬯ ꬰ+꭪ ꭰ+ꯣ.꯫ ꯬.꯮ ꯰)꯺ 가+힤 ힰ+퟇ ퟋ+퟼ ﬀ+﬇ ﬓ+﬘ יִ/ﬞ.ײַ/﬩ שׁ/﬷ טּ/﬽ מּ/﬿ נּ/﭂ ףּ/﭅ צּ/ﭐ+﮲ ﯓ+﴾ ﵐ+﶐ ﶒ+﷈ ﷰ+﷼ ︀.︐ ︓*︔ ︠.︰ ︳,︵ ﹍,﹐'﹑ ﹒(﹓ ﹔'﹕*﹖ ﹰ+﹵ ﹶ+﻽ \\uFEFF-＀ ＇(（ ，'－ ．(／ ０)：*；'＜ Ａ+［ ＿,｀ ａ+｛ ｦ1ﾞ.ﾠ+﾿ ￂ+￈ ￊ+￐ ￒ+￘ ￚ+￝ ￹-￼ ￿ \`,_t="𐀀+𐀌 𐀍+𐀧 𐀨+𐀻 𐀼+𐀾 𐀿+𐁎 𐁐+𐁞 𐂀+𐃻 𐅀+𐅵 𐇽.𐇾 𐊀+𐊝 𐊠+𐋑 𐋠.𐋡 𐌀+𐌠 𐌭+𐍋 𐍐+𐍶.𐍻 𐎀+𐎞 𐎠+𐏄 𐏈+𐏐 𐏑+𐏖 𐐀+𐒞 𐒠)𐒪 𐒰+𐓔 𐓘+𐓼 𐔀+𐔨 𐔰+𐕤 𐕰+𐕻 𐕼+𐖋 𐖌+𐖓 𐖔+𐖖 𐖗+𐖢 𐖣+𐖲 𐖳+𐖺 𐖻+𐖽 𐗀+𐗴 𐘀+𐜷 𐝀+𐝖 𐝠+𐝨 𐞀+𐞆 𐞇+𐞱 𐞲+𐞻 𐠀+𐠆 𐠈+𐠉 𐠊+𐠶 𐠷+𐠹 𐠼+𐠽 𐠿+𐡖 𐡠+𐡷 𐢀+𐢟 𐣠+𐣳 𐣴+𐣶 𐤀+𐤖 𐤠+𐤺 𐦀+𐦸 𐦾+𐧀 𐨀+𐨁.𐨄 𐨅.𐨇 𐨌.𐨐+𐨔 𐨕+𐨘 𐨙+𐨶 𐨸.𐨻 𐨿.𐩀 𐩠+𐩽 𐪀+𐪝 𐫀+𐫈 𐫉+𐫥.𐫧 𐬀+𐬶 𐭀+𐭖 𐭠+𐭳 𐮀+𐮒 𐰀+𐱉 𐲀+𐲳 𐳀+𐳳 𐴀+𐴤.𐴨 𐴰)𐴺 𐵀)𐵊+𐵦 𐵩.𐵮 𐵯+𐶆 𐺀+𐺪 𐺫.𐺭 𐺰+𐺲 𐻂+𐻅 𐻼.𐼀+𐼝 𐼧+𐼨 𐼰+𐽆.𐽑 𐽰+𐾂.𐾆 𐾰+𐿅 𐿠+𐿷 𑀀.𑀃+𑀸.𑁇 𑁦)𑁰.𑁱+𑁳.𑁵+𑁶 𑁿.𑂃+𑂰.𑂻 𑂽)𑂾 𑃂.𑃃 𑃍)𑃎 𑃐+𑃩 𑃰)𑃺 𑄀.𑄃+𑄧.𑄵 𑄶)𑅀 𑅄+𑅅.𑅇+𑅈 𑅐+𑅳.𑅴 𑅶+𑅷 𑆀.𑆃+𑆳.𑇁+𑇅 𑇉.𑇍 𑇎.𑇐)𑇚+𑇛 𑇜+𑇝 𑈀+𑈒 𑈓+𑈬.𑈸 𑈾.𑈿+𑉁.𑉂 𑊀+𑊇 𑊈+𑊉 𑊊+𑊎 𑊏+𑊞 𑊟+𑊩 𑊰+𑋟.𑋫 𑋰)𑋺 𑌀.𑌄 𑌅+𑌍 𑌏+𑌑 𑌓+𑌩 𑌪+𑌱 𑌲+𑌴 𑌵+𑌺 𑌻.𑌽+𑌾.𑍅 𑍇.𑍉 𑍋.𑍎 𑍐+𑍑 𑍗.𑍘 𑍝+𑍢.𑍤 𑍦.𑍭 𑍰.𑍵 𑎀+𑎊 𑎋+𑎌 𑎎+𑎏 𑎐+𑎶 𑎷+𑎸.𑏁 𑏂.𑏃 𑏅.𑏆 𑏇.𑏋 𑏌.𑏑+𑏒.𑏓+𑏔 𑏡.𑏣 𑐀+𑐵.𑑇+𑑋 𑑐)𑑚 𑑞.𑑟+𑑢 𑒀+𑒰.𑓄+𑓆 𑓇+𑓈 𑓐)𑓚 𑖀+𑖯.𑖶 𑖸.𑗁 𑗘+𑗜.𑗞 𑘀+𑘰.𑙁 𑙄+𑙅 𑙐)𑙚 𑚀+𑚫.𑚸+𑚹 𑛀)𑛊 𑛐)𑛤 𑜝.𑜬 𑜰)𑜺 𑠀+𑠬.𑠻 𑢠+𑣠)𑣪 𑣿+𑤇 𑤉+𑤊 𑤌+𑤔 𑤕+𑤗 𑤘+𑤰.𑤶 𑤷.𑤹 𑤻.𑤿+𑥀.𑥁+𑥂.𑥄 𑥐)𑥚 𑦠+𑦨 𑦪+𑧑.𑧘 𑧚.𑧡+𑧢 𑧣+𑧤.𑧥 𑨀+𑨁.𑨋+𑨳.𑨺+𑨻.𑨿 𑩇.𑩈 𑩐+𑩑.𑩜+𑪊.𑪚 𑪝+𑪞 𑪰+𑫹 𑯀+𑯡 𑯰)𑯺 𑰀+𑰉 𑰊+𑰯.𑰷 𑰸.𑱀+𑱁 𑱐)𑱚 𑱲+𑲐 𑲒.𑲨 𑲩.𑲷 𑴀+𑴇 𑴈+𑴊 𑴋+𑴱.𑴷 𑴺.𑴻 𑴼.𑴾 𑴿.𑵆+𑵇.𑵈 𑵐)𑵚 𑵠+𑵦 𑵧+𑵩 𑵪+𑶊.𑶏 𑶐.𑶒 𑶓.𑶘+𑶙 𑶠)𑶪 𑻠+𑻳.𑻷 𑼀.𑼂+𑼃.𑼄+𑼑 𑼒+𑼴.𑼻 𑼾.𑽃 𑽐)𑽚.𑽛 𑾰+𑾱 𒀀+𒎚 𒐀+𒑯 𒒀+𒕄 𒾐+𒿱 𓀀+𓐰-𓑀.𓑁+𓑇.𓑖 𓑠+𔏻 𔐀+𔙇 𖄀+𖄞.𖄰)𖄺 𖠀+𖨹 𖩀+𖩟 𖩠)𖩪 𖩰+𖪿 𖫀)𖫊 𖫐+𖫮 𖫰.𖫵 𖬀+𖬰.𖬷 𖭀+𖭄 𖭐)𖭚 𖭣+𖭸 𖭽+𖮐 𖵀+𖵭 𖵰)𖵺 𖹀+𖺀 𖼀+𖽋 𖽏.𖽐+𖽑.𖾈 𖾏.𖾓+𖾠 𖿠+𖿢 𖿣+𖿤.𖿥 𖿰.𖿲 𚿰1𚿴 𚿵1𚿼 𚿽1𚿿 𛀀1𛀁 𛄠1𛄣 𛅕1𛅖 𛅤1𛅨 𛰀+𛱫 𛱰+𛱽 𛲀+𛲉 𛲐+𛲚 𛲝.𛲟 𛲠-𛲤 𜳰)𜳺 𜼀.𜼮 𜼰.𜽇 𝅥.𝅪 𝅭.𝅳-𝅻.𝆃 𝆅.𝆌 𝆪.𝆮 𝉂.𝉅 𝐀+𝑕 𝑖+𝒝 𝒞+𝒠 𝒢+𝒣 𝒥+𝒧 𝒩+𝒭 𝒮+𝒺 𝒻+𝒼 𝒽+𝓄 𝓅+𝔆 𝔇+𝔋 𝔍+𝔕 𝔖+𝔝 𝔞+𝔺 𝔻+𝔿 𝕀+𝕅 𝕆+𝕇 𝕊+𝕑 𝕒+𝚦 𝚨+𝛁 𝛂+𝛛 𝛜+𝛻 𝛼+𝜕 𝜖+𝜵 𝜶+𝝏 𝝐+𝝯 𝝰+𝞉 𝞊+𝞩 𝞪+𝟃 𝟄+𝟌 𝟎)𝠀 𝨀.𝨷 𝨻.𝩭 𝩵.𝩶 𝪄.𝪅 𝪛.𝪠 𝪡.𝪰 𝼀+𝼟 𝼥+𝼫 𞀀.𞀇 𞀈.𞀙 𞀛.𞀢 𞀣.𞀥 𞀦.𞀫 𞀰+𞁮 𞂏.𞂐 𞄀+𞄭 𞄰.𞄷+𞄾 𞅀)𞅊 𞅎+𞅏 𞊐+𞊮.𞊯 𞋀+𞋬.𞋰)𞋺 𞓐+𞓬.𞓰)𞓺 𞗐+𞗮.𞗰+𞗱)𞗻 𞟠+𞟧 𞟨+𞟬 𞟭+𞟯 𞟰+𞟿 𞠀+𞣅 𞣐.𞣗 𞤀+𞥄.𞥋+𞥌 𞥐)𞥚 𞸀+𞸄 𞸅+𞸠 𞸡+𞸣 𞸤+𞸥 𞸧+𞸨 𞸩+𞸳 𞸴+𞸸 𞸹+𞸺 𞸻+𞸼 𞹂+𞹃 𞹇+𞹈 𞹉+𞹊 𞹋+𞹌 𞹍+𞹐 𞹑+𞹓 𞹔+𞹕 𞹗+𞹘 𞹙+𞹚 𞹛+𞹜 𞹝+𞹞 𞹟+𞹠 𞹡+𞹣 𞹤+𞹥 𞹧+𞹫 𞹬+𞹳 𞹴+𞹸 𞹹+𞹽 𞹾+𞹿 𞺀+𞺊 𞺋+𞺜 𞺡+𞺤 𞺥+𞺪 𞺫+𞺼 🄰+🅊 🅐+🅪 🅰+🆊 🇦2🈀 🏻.🐀 🯰)🯺 󠀁-󠀂 󠀠.󠂀 󠄀.󠇰 ";function qt(a){let t=a<=65535?2:3,r=t==2?Wt:_t;return nt(r,a,t,0,r.length/t-1)-32}p(qt,"searchForProperty");function nt(a,t,r,n,i){if(i<n)return 0;let o=n+~~((i-n)/2),s=a.codePointAt(r*o),u=a.codePointAt(r*(o+1)),l=isNaN(u)?1/0:u;return t<s?nt(a,t,r,n,o-1):t>=l?nt(a,t,r,o+1,i):a.charCodeAt(r*(o+1)-1)}p(nt,"_searchForProperty");function q(a,t){let r=Tr(a,t);if(r.length==0)return[];let n=[];for(let i=0;i<r.length-1;i++){let o=r[i],s=r[i+1],u=new Fe(a,o,s);gr(u.text,t)?n.push(u):i==r.length-2&&(u=new Fe(a,s,s),n.push(u))}return n}p(q,"default_");var st=class st{constructor(t,r,n){this._source=t,this.start=r,this.end=n}get text(){return this._source.substring(this.start,this.end)}get length(){return this.end-this.start}};p(st,"LazySpan");var Fe=st,oe=class oe{constructor(t,r,n,i,o,s){this.lookbehind=19;this.left=19;this.right=19;this.text=t,this.options=r,arguments.length==3?this.lookahead=this.wordbreakPropertyAt(n):(this.lookbehind=n,this.left=i,this.right=o,this.lookahead=s)}next(t){let r=this.wordbreakPropertyAt(t);return new oe(this.text,this.options,this.left,this.right,this.lookahead,r)}ignoringRight(t){let r=this.wordbreakPropertyAt(t);return new oe(this.text,this.options,this.lookbehind,this.left,this.lookahead,r)}ignoringLookahead(t){let r=this.wordbreakPropertyAt(t);return new oe(this.text,this.options,this.lookbehind,this.left,this.right,r)}wordbreakPropertyAt(t){return t<0?19:t>=this.text.length?20:Ut(this.text[t])?ot(this.text[t]+this.text[t+1]):ot(this.text[t],this.options)}match(t,r,n,i){var s,u,l,c;let o=(s=t==null?void 0:t.includes(this.lookbehind))!=null?s:!0;return o=o&&((u=r==null?void 0:r.includes(this.left))!=null?u:!0),o=o&&((l=n==null?void 0:n.includes(this.right))!=null?l:!0),o&&((c=i==null?void 0:i.includes(this.lookahead))!=null?c:!0)}propertyMatch(t,r,n,i){let o=p(s=>Bt(s,this.options),"propMapper");return this.match(t==null?void 0:t.map(o),r==null?void 0:r.map(o),n==null?void 0:n.map(o),i==null?void 0:i.map(o))}};p(oe,"BreakerContext");var it=oe;function gr(a,t){return!a.split("").map(r=>ot(r,t)).every(r=>r===3||r===1||r===2||r===4)}p(gr,"isNonSpace");function Tr(a,t){if(a.length===0)return[];t&&!t.rules&&(t.rules=[]);let r=[],n,i=0,o=new it(a,t,i),s=0;do{if(n=i,i=u(i),o=o.next(i),o.match(null,[19],null,null)){r.push(n);continue}if(o.match(null,null,[20],null)){r.push(n);break}if(o.match(null,[3],[1],null))continue;let l=[2,3,1];if(o.match(null,l,null,null)){r.push(n);continue}if(o.match(null,null,l,null)){r.push(n);continue}if(o.match(null,[4],[4],null))continue;let c=[13,14,16];for(;o.match(null,null,c,null);)[n,i]=[i,u(i)],o=o.ignoringRight(i);if(o.right===20){r.push(n);break}for(;o.match(null,null,null,c);)i=u(i),o=o.ignoringLookahead(i);let d=[11,15],h=[8,6];if(t!=null&&t.rules){let k=!1;for(let v of t.rules)if(k=v.match(o),k){v.breakIfMatch&&r.push(n);break}if(k)continue}if(o.match(null,d,d,null))continue;let g=[10].concat(h);if(o.match(null,d,g,d)||o.match(d,g,d,null)||o.match(null,[15],[6],null)||o.match(null,[15],[5],[15])||o.match([15],[5],[15],null)||o.match(null,[9],[9],null)||o.match(null,d,[9],null)||o.match(null,[9],d,null))continue;let m=[7].concat(h);if(o.match([9],m,[9],null)||o.match(null,[9],m,[9])||o.match(null,[17],[17],null))continue;let x=[17,9].concat(d);if(!o.match(null,x,[12],null)&&!o.match(null,[12],[12],null)&&!o.match(null,[12],x,null)){if(o.right===18){if(s+=1,s%2==1)continue}else s=0;r.push(n)}}while(n<a.length);return r;function u(l){return l>=a.length?a.length:Ut(a[l])?l+2:l+1}}p(Tr,"findBoundaries");function Ut(a){let t=a.charCodeAt(0);return t>=55296&&t<=56319}p(Ut,"isStartOfSurrogatePair");function ot(a,t){if(t!=null&&t.propertyMapping){let n=t.propertyMapping(a);if(n)return Bt(n,t)}let r=a.codePointAt(0);return qt(r)}p(ot,"property");function Bt(a,t){var i,o;let r=p(s=>s.toLowerCase()==a.toLowerCase(),"matcher"),n=(o=(i=t==null?void 0:t.customProperties)==null?void 0:i.findIndex(r))!=null?o:-1;return n!=-1?-n-1:Ft.findIndex(r)}p(Bt,"propertyVal");var Qt=12,U=class U{constructor(t,r,n){this.root=t,this.prefix=r,this.totalWeight=n}child(t){if(t=="")return this;let r=t.split(""),n=this;for(;r.length>0&&n;){let i=r.shift();n=n._child(i)}return n}_child(t){let r=this.root,n=this.totalWeight,i=this.prefix+t;if(r.type=="internal"){let o=r.children[t];return o?new U(o,i,n):void 0}else return r.entries.filter(function(s){return s.key.indexOf(i)==0}).length?new U(r,i,n):void 0}*children(){let t=this.root,r=this.totalWeight;if(t.type=="internal"){for(let n of t.values){let i=t.children[n];if(H(n))if(i.type=="internal"){let o=i;for(let s of o.values){let u=this.prefix+n+s;yield{char:n+s,traversal:p(function(){return new U(o.children[s],u,r)},"traversal")}}}else{let o=i.entries[0].key;n=n+o[this.prefix.length+1];let s=this.prefix+n;yield{char:n,traversal:p(function(){return new U(i,s,r)},"traversal")}}else{if(Ne(n))continue;if(n){let o=this.prefix+n;yield{char:n,traversal:p(function(){return new U(i,o,r)},"traversal")}}else continue}}return}else{let n=this.prefix,i=t.entries.filter(function(o){return o.key!=n&&n.length<o.key.length});for(let{key:o}of i){let s=o[n.length];H(s)&&(s=s+o[n.length+1]),yield{char:s,traversal:p(function(){return new U(t,n+s,r)},"traversal")}}return}}get entries(){let t=p(r=>({text:r.content,p:r.weight/this.totalWeight}),"entryMapper");if(this.root.type=="leaf"){let r=this.prefix;return this.root.entries.filter(function(i){return i.key==r}).map(t)}else{let r=this.root.children[_];return r&&r.type=="leaf"?r.entries.map(t):[]}}get p(){return this.root.weight/this.totalWeight}};p(U,"Traversal");var at=U,ut=class ut{constructor(t,r={}){this.languageUsesCasing=r.languageUsesCasing,this.applyCasing=r.applyCasing,this._trie=new lt(t.root,t.totalWeight,r.searchTermToKey||xr),this.breakWords=r.wordBreaker||q,this.punctuation=r.punctuation}configure(t){var r;return this.configuration={leftContextCodePoints:t.maxLeftContextCodePoints,rightContextCodePoints:(r=t.maxRightContextCodePoints)!=null?r:0}}toKey(t){return this._trie.toKey(t)}predict(t,r){if(!t.insert&&!r.left&&!r.right&&r.startOfBuffer&&r.endOfBuffer)return s(this._trie.firstN(Qt).map(({text:u,p:l})=>({transform:{insert:u,deleteLeft:0},displayAs:u,p:l})));let n=y(t,r),i=t.deleteLeft-T.length(t.insert),o=Te(this.breakWords,n);return s(this._trie.lookup(o).map(({text:u,p:l})=>z({insert:u,deleteLeft:i+T.length(o)},l)));function s(u){let l=[];for(let c of u)l.push({sample:c,p:c.p});return l}}get wordbreaker(){return this.breakWords}traverseFromRoot(){return this._trie.traverseFromRoot()}};p(ut,"TrieModel");var be=ut,ct=class ct{constructor(t,r,n){this.root=t,this.toKey=n,this.totalWeight=r}traverseFromRoot(){return new at(this.root,"",this.totalWeight)}lookup(t){let r=this.toKey(t),n=this.traverseFromRoot().child(r);if(!n)return[];let i=n.entries,o={};for(let l of i)o[l.text]=l.text;let u=Kt(n).filter(l=>!o[l.text]);return i.concat(u)}firstN(t){return Kt(this.traverseFromRoot(),t)}};p(ct,"Trie");var lt=ct;function Kt(a,t=Qt){let r=new A(function(i,o){return(o?o.p:0)-(i?i.p:0)}),n=[];for(r.enqueue(a);r.count>0;){let i=r.dequeue();if(i.text!==void 0){let o=i;if(n.push(o),n.length>=t)return n}else{let o=i;r.enqueueAll(o.entries);let s=[];for(let u of o.children())s.push(u.traversal());r.enqueueAll(s)}}return n}p(Kt,"getSortedResults");function xr(a){return a.normalize("NFD").replace(/[\\u0300-\\u036f]/g,"").toLowerCase()}p(xr,"defaultSearchTermToKey");var ht=class ht{constructor(t){t=t||{},this._futureSuggestions=t.futureSuggestions?t.futureSuggestions.slice():[],t.punctuation&&(this.punctuation=t.punctuation),this.toKey=t.toKey,this.wordbreaker=t.wordbreaker,this.applyCasing=t.applyCasing,this.languageUsesCasing=t.languageUsesCasing}configure(t){return this.configuration={leftContextCodePoints:t.maxLeftContextCodePoints,rightContextCodePoints:t.maxRightContextCodePoints},this.configuration}predict(t,r,n){let i=p(function(s){let u=[];for(let l of s)u.push({sample:l,p:l.p!==void 0?l.p:1});return u},"makeUniformDistribution");if(n)return i(n);let o=this._futureSuggestions.shift();return o?i(o):[]}};p(ht,"DummyModel");var dt=ht,Ht=dt;var Ee={};Re(Ee,{ClassicalDistanceCalculation:()=>J,ContextTracker:()=>we,ExecutionBucket:()=>Ce,ExecutionSpan:()=>Z,ExecutionTimer:()=>ye,QUEUE_NODE_COMPARATOR:()=>qe,STANDARD_TIME_BETWEEN_DEFERS:()=>_e,SearchNode:()=>Ue,SearchResult:()=>Le,SearchSpace:()=>I,TrackedContextState:()=>V,TrackedContextSuggestion:()=>yt,TrackedContextToken:()=>ee,getEditPathLastMatch:()=>Vt,tokenizeTransform:()=>Be,tokenizeTransformDistribution:()=>Ct});var S=class S{constructor(t){this.diagonalWidth=2;this.inputSequence=[];this.matchSequence=[];if(t){let r=t.resolvedDistances.length;this.resolvedDistances=Array(r);for(let n=0;n<r;n++)this.resolvedDistances[n]=t.resolvedDistances[n].slice(0);this.inputSequence=t.inputSequence.slice(0),this.matchSequence=t.matchSequence.slice(0),this.diagonalWidth=t.diagonalWidth}else this.resolvedDistances=[]}getTrueIndex(t,r,n){let i={row:t,col:r-t+n,sparse:!1};return(i.col<0||i.col>2*n)&&(i.sparse=!0),i}getCostAt(t,r,n=this.diagonalWidth){if(t<0||r<0)return t==-1&&r>=-1?r+1:r==-1&&t>=-1?t+1:Number.MAX_VALUE;let i=this.getTrueIndex(t,r,n);return i.sparse?Number.MAX_VALUE:this.resolvedDistances[i.row][i.col]}getFinalCost(){let t=this,r=t.getHeuristicFinalCost();for(;r>t.diagonalWidth;)t=t.increaseMaxDistance(),r=t.getHeuristicFinalCost();return r}getHeuristicFinalCost(){return this.getCostAt(this.inputSequence.length-1,this.matchSequence.length-1)}hasFinalCostWithin(t){let r=this,n=r.getHeuristicFinalCost(),i=this.diagonalWidth;do{if(n<=t)return!0;if(i<t)r=r.increaseMaxDistance(),i++,n=r.getHeuristicFinalCost();else break}while(!0);return!1}editPath(t=this.inputSequence.length-1,r=this.matchSequence.length-1){let n=this.getCostAt(t,r),i=null,o=null,s=this.getCostAt(t,r-1),u=this.getCostAt(t-1,r),l=this.getCostAt(t-1,r-1),[c,d]=S.getTransposeParent(this,t,r);if(c>=0&&d>=0){let h=1;if(i=["transpose-start"],c!=t-1){let g=t-c-1;i=i.concat(Array(g).fill("transpose-delete")),h+=g}else{let g=r-d-1;i=i.concat(Array(g).fill("transpose-insert")),h+=g}i.push("transpose-end"),this.getCostAt(c-1,d-1)!=n-h&&(i=null),o=[c-1,d-1]}return i||(s==n-1?(i=["insert"],o=[t,r-1]):l==n-1?(i=["substitute"],o=[t-1,r-1]):u==n-1?(i=["delete"],o=[t-1,r]):(i=["match"],o=[t-1,r-1])),o[0]>=0&&o[1]>=0?this.editPath(o[0],o[1]).concat(i):o[0]>-1?Array(o[0]+1).fill("delete").concat(i):o[1]>-1?Array(o[1]+1).fill("insert").concat(i):i}static getTransposeParent(t,r,n){if(r<0||n<0||t.inputSequence[r].key==t.matchSequence[n].key)return[-1,-1];let i=-1;for(let s=r-1;s>=0;s--)if(t.inputSequence[s].key==t.matchSequence[n].key){i=s;break}let o=-1;for(let s=n-1;s>=0;s--)if(t.matchSequence[s].key==t.inputSequence[r].key){o=s;break}return[i,o]}static initialCostAt(t,r,n,i,o){var s=t.inputSequence[r].key==t.matchSequence[n].key?0:1,u=t.getCostAt(r-1,n-1)+s,l=i||t.getCostAt(r,n-1)+1,c=o||t.getCostAt(r-1,n)+1,d=Number.MAX_VALUE;if(r>0&&n>0){let[h,g]=S.getTransposeParent(t,r,n);d=t.getCostAt(h-1,g-1)+(r-h-1)+1+(n-g-1)}return Math.min(u,c,l,d)}getSubset(t,r){let n=new S(this);if(t>this.inputSequence.length||r>this.matchSequence.length)throw"Invalid dimensions specified for trim operation";n.inputSequence.splice(t),n.matchSequence.splice(r),n.resolvedDistances.splice(t);let i=this.getTrueIndex(t-1,r-1,this.diagonalWidth);for(let o=i.col;o<=2*this.diagonalWidth;o++){let s=i.row-(o-i.col);if(s<0)break;if(o<0)n.resolvedDistances[s]=Array(2*n.diagonalWidth+1).fill(Number.MAX_VALUE);else{let u=2*this.diagonalWidth-o,l=n.resolvedDistances[s].splice(0,o+1),c=Array(u).fill(Number.MAX_VALUE);n.resolvedDistances[s]=l.concat(c)}}return n}static forDiagonalOfAxis(t,r,n,i){let o=n-r<t?n-r+t:2*t,s=r-t,u=s<0?0:s;for(let l=u-s;l<=o;l++)i(s+l,l)}addInputChar(t){let r=new S(this),n=r.inputSequence.length;r.inputSequence.push(t);let i=Array(2*r.diagonalWidth+1).fill(Number.MAX_VALUE);return r.resolvedDistances[n]=i,r.matchSequence.length==0||S.forDiagonalOfAxis(r.diagonalWidth,n,r.matchSequence.length-1,function(o,s){i[s]=S.initialCostAt(r,n,o)}),r}addMatchChar(t){let r=new S(this),n=r.matchSequence.length;return r.matchSequence.push(t),r.inputSequence.length==0||S.forDiagonalOfAxis(r.diagonalWidth,n,r.inputSequence.length-1,function(i,o){var s=r.resolvedDistances[i];s[2*r.diagonalWidth-o]=S.initialCostAt(r,i,n)}),r}increaseMaxDistance(){let t=new S(this);if(t.diagonalWidth++,t.inputSequence.length<1||t.matchSequence.length<1)return t;function r(i,o,s,u){let l=2*(t.diagonalWidth-1),c=s.length-1;l=l<c-i?l:c-i;for(let d=0;d<=l;d++)o==s[i+d].key&&u(i+d,d)}p(r,"forPossibleTranspositionsInDiagonal");for(let i=0;i<t.inputSequence.length;i++){let o=Number.MAX_VALUE,s=i-t.diagonalWidth;if(s>=0){let l=s==0?i+2:Number.MAX_VALUE;o=S.initialCostAt(t,i,s,l,void 0);let c=o;if(s<t.matchSequence.length-1){S.propagateUpdateFrom(t,i,s+1,c+1,0);let d=i+2;if(i+2<this.inputSequence.length){let h=t.inputSequence[i+1].key;r(s+3,h,t.matchSequence,function(g,m){S.propagateUpdateFrom(t,d,g,c+m+2,m)})}}}let u=Number.MAX_VALUE;if(s=i+t.diagonalWidth,s<t.matchSequence.length){let l=i==0?s+2:Number.MAX_VALUE;var n=t.getCostAt(i,s-1,this.diagonalWidth)+1;u=S.initialCostAt(t,i,s,n,l);let c=u;if(i<t.inputSequence.length-1){S.propagateUpdateFrom(t,i+1,s,c+1,2*this.diagonalWidth);let d=s+2;if(s+2<this.matchSequence.length){let h=t.matchSequence[i+1].key;r(i+3,h,t.inputSequence,function(g,m){let x=2*(t.diagonalWidth-1)-m;S.propagateUpdateFrom(t,g,d,c+m+2,x)})}}}t.resolvedDistances[i]=[o].concat(t.resolvedDistances[i],u)}return t}static propagateUpdateFrom(t,r,n,i,o){if(i<t.resolvedDistances[r][o])t.resolvedDistances[r][o]=i;else return;let s=r<t.inputSequence.length-1,u=n<t.matchSequence.length-1;if(o<2*(t.diagonalWidth-1)&&u){let l=i+1;this.propagateUpdateFrom(t,r,n+1,l,o+1)}if(o>0&&s){let l=i+1;this.propagateUpdateFrom(t,r+1,n,l,o-1)}if(s&&u){let l=i+(t.inputSequence[r+1].key==t.matchSequence[n+1].key?0:1);this.propagateUpdateFrom(t,r+1,n+1,l,o);let c=-1;for(let h=r+2;h<t.inputSequence.length;h++)if(t.inputSequence[h].key==t.matchSequence[n+1].key){c=h;break}let d=-1;for(let h=n+2;h<t.matchSequence.length;h++)if(t.matchSequence[h].key==t.inputSequence[r+1].key){d=h;break}if(c>0&&d>0){let h=i+(c-r-2)+1+(d-n-2);this.propagateUpdateFrom(t,c,d,h,t.diagonalWidth-1+d-c)}}}get mapKey(){let t=this.inputSequence.map(n=>n.key).join(""),r=this.matchSequence.map(n=>n.key).join("");return t+_+r+_+this.diagonalWidth}get lastInputEntry(){return this.inputSequence[this.inputSequence.length-1]}get lastMatchEntry(){return this.matchSequence[this.matchSequence.length-1]}static computeDistance(t,r,n=1){let i=new S;n=n||1,i.diagonalWidth=n;for(let o=0;o<t.length;o++)i=i.addInputChar(t[o]);for(let o=0;o<r.length;o++)i=i.addMatchChar(r[o]);return i}};p(S,"ClassicalDistanceCalculation");var J=S;var br=1,zt=5,_e=5,mt=class mt{constructor(t){this.timeSpent=0;this.eventCount=0;this.timeSquared=0;this.nearOutliers=[];this.outliers=[];this.preventOutliers=!1;this.preventOutliers=!!t}add(t){if(t<0)throw new Error("time may not be negative");this.eventCount++,this.timeSpent+=t,this.timeSquared+=t*t,t>=br&&(this.nearOutliers.length<zt||this.nearOutliers[zt-1]<t)&&(this.nearOutliers.push(t),this.nearOutliers.sort((r,n)=>n-r)),this.checkForOutlier()}checkForOutlier(){if(this.preventOutliers||this.eventCount<4||this.nearOutliers.length==0)return;let t=this.nearOutliers[0];this.timeSpent-=t,this.timeSquared-=t*t,this.eventCount--;let r=this.average,n=t-r,i=this.variance,o=n*n/i;o>=49||this.eventCount>=8&&o>=9?(this.nearOutliers.shift(),this.outliers.push(t)):(this.timeSpent+=t,this.timeSquared+=t*t,this.eventCount++)}get average(){return this.timeSpent/this.eventCount}get variance(){let t=this.eventCount;return t<=1?NaN:this.timeSquared/t-this.timeSpent*this.timeSpent/(t*t)}get outlierTime(){let t=0;for(let r=0;r<this.outliers.length;r++)t+=this.outliers[r];return t}};p(mt,"ExecutionBucket");var Ce=mt,ft=class ft{constructor(t,r){this.bucket=t,this.finalizer=r,this.start=performance.now()}end(){var t,r;this.finish=performance.now(),(t=this.bucket)==null||t.add(this.duration),(r=this.finalizer)==null||r.call(this)}get duration(){var t;return((t=this.finish)!=null?t:performance.now())-this.start}};p(ft,"ExecutionSpan");var Z=ft,gt=class gt{constructor(t,r){this.buckets={};this.deferBucket=new Ce(!0);this.activeSpan=null;this.spanSinceLastDefer=null;this.trueStart=performance.now(),this.maxExecutionTime=t,this.maxTrueTime=r,this.spanSinceLastDefer=new Z}validateStart(){if(this.activeSpan)throw new Error("illegal state - span-based timer still pending")}getBucket(t){t!=null||(t=-1);let r=this.buckets[t];return r||(r=this.buckets[t]=new Ce),r}get executionTime(){let t=Object.values(this.buckets),r=0;for(let n of t)r+=n.timeSpent;return r}get deferredTime(){let t=Object.values(this.buckets),r=0;for(let n of t)r+=n.outlierTime;return r+=this.deferBucket.timeSpent,r}time(t,r){this.validateStart();let n=performance.now(),i=t(),o=performance.now()-n;return this.getBucket(r).add(o),i}defer(t){return K(this,null,function*(){this.validateStart(),t!=null||(t=0),this.activeSpan=new Z(this.deferBucket,()=>this.activeSpan=null),yield $e(t),this.activeSpan.end(),this.spanSinceLastDefer=new Z})}get timeSinceLastDefer(){return this.spanSinceLastDefer.duration}start(t){this.validateStart();let r=this.getBucket(t);return this.activeSpan=new Z(r,()=>{this.activeSpan=null}),this.activeSpan}terminate(){this.maxTrueTime=0}get elapsed(){return performance.now()-this.trueStart>=this.maxTrueTime?!0:this.executionTime>=this.maxExecutionTime}};p(gt,"ExecutionTimer");var ye=gt;var qe=p(function(a,t){return a.currentCost-t.currentCost},"QUEUE_NODE_COMPARATOR");var Y=class Y{constructor(t,r){this.toKey=p(t=>t,"toKey");if(r=r||(n=>n),t instanceof Y){let n=t;this.calculation=n.calculation,this.currentTraversal=n.currentTraversal,this.priorInput=n.priorInput,this.toKey=n.toKey}else this.calculation=new J,this.currentTraversal=t,this.priorInput=[],this.toKey=r}get knownCost(){return this.calculation.getHeuristicFinalCost()}get inputSamplingCost(){if(this._inputCost!==void 0)return this._inputCost;{let t=I.MIN_KEYSTROKE_PROBABILITY;return this._inputCost=this.priorInput.map(r=>r.p>t?r.p:t).reduce((r,n)=>r-Math.log(n),0),this._inputCost}}get currentCost(){return I.EDIT_DISTANCE_COST_SCALE*this.knownCost+this.inputSamplingCost}buildInsertionEdges(){let t=[];for(let r of this.currentTraversal.children()){let n=r.traversal(),i={key:r.char,traversal:n},o=this.calculation.addMatchChar(i),s=new Y(this);s.calculation=o,s.priorInput=this.priorInput,s.currentTraversal=n,t.push(s)}return t}buildDeletionEdges(t){let r=[];for(let n of t){if(n.p<t[0].p*Math.exp(-I.EDIT_DISTANCE_COST_SCALE))break;let i=this.calculation,o=n.sample;o.deleteLeft&&(i=i.getSubset(i.inputSequence.length-o.deleteLeft,i.matchSequence.length));let s=this.priorInput.slice(0);s.push(n);for(let l=0;l<o.insert.length;l++){let c=o.insert[l];H(c)&&(l++,c=c+o.insert[l]);let d=this.toKey(c);d&&(i=i.addInputChar({key:d}))}let u=new Y(this);u.calculation=i,u.priorInput=s,r.push(u)}return r}buildSubstitutionEdges(t){let r=this.buildDeletionEdges(t),n=[];for(let i of this.currentTraversal.children())for(let o of r){let s=i.traversal(),u={key:i.char,traversal:s},l=o.calculation.addMatchChar(u),c=new Y(this);c.calculation=l,c.priorInput=o.priorInput,c.currentTraversal=s,n.push(c)}return n}get pathKey(){let t=this.priorInput.map(n=>"+"+n.sample.insert+"-"+n.sample.deleteLeft).join(""),r=this.calculation.matchSequence.map(n=>n.key).join("");return t+_+r}get resultKey(){return this.calculation.matchSequence.map(t=>t.key).join("")}get isFullReplacement(){return this.knownCost&&this.knownCost==this.priorInput.length}};p(Y,"SearchNode");var Ue=Y,Tt=class Tt{constructor(t,r){this.processed=[];if(typeof t=="number"){this.index=t,this.correctionQueue=new A(qe,r);return}else this.index=t.index,this.processed=[].concat(t.processed),this.correctionQueue=new A(t.correctionQueue)}increaseMaxEditDistance(){let t=this.correctionQueue.toArray();t.forEach(function(r){r.calculation=r.calculation.increaseMaxDistance()}),this.correctionQueue=new A(qe,t)}};p(Tt,"SearchSpaceTier");var Se=Tt,xt=class xt{constructor(t){this.resultNode=t}get inputSequence(){return this.resultNode.priorInput}get matchSequence(){return this.resultNode.calculation.matchSequence}get matchString(){return this.resultNode.resultKey}get knownCost(){return this.resultNode.knownCost}get inputSamplingCost(){return this.resultNode.inputSamplingCost}get totalCost(){return this.resultNode.currentCost}get finalTraversal(){return this.resultNode.currentTraversal}};p(xt,"SearchResult");var Le=xt,G=class G{constructor(t){this.tierOrdering=[];this.inputSequence=[];this.minInputCost=[];this.returnedValues={};this.processedEdgeSet={};if(this.buildQueueSpaceComparator(),t instanceof G){this.inputSequence=[].concat(t.inputSequence),this.minInputCost=[].concat(t.minInputCost),this.rootNode=t.rootNode,this.completedPaths=[].concat(t.completedPaths),this.returnedValues=B({},t.returnedValues),this.processedEdgeSet=B({},t.processedEdgeSet),this.tierOrdering=t.tierOrdering.map(i=>new Se(i)),this.selectionQueue=new A(this.QUEUE_SPACE_COMPARATOR,this.tierOrdering);return}let r=t;if(r){if(!r.traverseFromRoot)throw"The provided model does not implement the \`traverseFromRoot\` function, which is needed to support robust correction searching."}else throw"The LexicalModel parameter must not be null / undefined.";this.selectionQueue=new A(this.QUEUE_SPACE_COMPARATOR),this.rootNode=new Ue(r.traverseFromRoot(),r.toKey?r.toKey.bind(r):null),this.completedPaths=[this.rootNode];let n=new Se(0,[this.rootNode]);this.tierOrdering.push(n),this.selectionQueue.enqueue(n)}buildQueueSpaceComparator(){let t=this;this.QUEUE_SPACE_COMPARATOR=function(r,n){let i=r.correctionQueue.peek(),o=n.correctionQueue.peek(),s=r.index,u=n.index,l=0,c=1;if(u<s){let d=u;u=s,s=d,c=-1}for(let d=s;d<u;d++)l=l+t.minInputCost[d];return i&&o?i.currentCost-o.currentCost+c*l:o?1:-1}}increaseMaxEditDistance(){this.tierOrdering.forEach(function(t){t.increaseMaxEditDistance()})}get correctionsEnabled(){return!!this.inputSequence.find(t=>t.length>1)}addInput(t){this.inputSequence.push(t),this.minInputCost.push(-Math.log(t[0].p));let r=[],n=this.completedPaths.map(function(o){let s=o.buildDeletionEdges(t),u=o.buildSubstitutionEdges(t);return s.concat(u)});this.completedPaths=[],this.returnedValues={},n.forEach(function(o){r=r.concat(o)});let i=new Se(this.tierOrdering.length,r);this.tierOrdering.push(i),this.selectionQueue.enqueue(i)}removeLastInput(){}hasNextMatchEntry(){let t=this.selectionQueue.peek();return t?t.correctionQueue.count>0:!1}handleNextNode(){if(!this.hasNextMatchEntry())return{type:"none"};let t=this.selectionQueue.dequeue(),r=t.correctionQueue.dequeue(),n={type:"intermediate",cost:r.currentCost};if(this.processedEdgeSet[r.pathKey])return this.selectionQueue.enqueue(t),n;this.processedEdgeSet[r.pathKey]=!0;let i=!1;if(r.knownCost>2)return n;r.knownCost==2&&(i=!0);let o=0;for(let s=0;s<=t.index;s++)o+=this.minInputCost[s];if(r.currentCost>o+2.5*G.EDIT_DISTANCE_COST_SCALE)return n;if(!i){let s=r.buildInsertionEdges();t.correctionQueue.enqueueAll(s)}if(t.index==this.tierOrdering.length-1)return this.completedPaths.push(r),this.selectionQueue.enqueue(t),{type:"complete",cost:r.currentCost,finalNode:r};{let s=this.tierOrdering[t.index+1],u=s.index,l=[];i||(l=r.buildDeletionEdges(this.inputSequence[u-1]));let c=r.buildSubstitutionEdges(this.inputSequence[u-1]);s.correctionQueue.enqueueAll(l.concat(c)),this.selectionQueue=new A(this.QUEUE_SPACE_COMPARATOR,this.tierOrdering)}return n}getBestMatches(t){return Rt(this,null,function*(){let r={},n=Object.values(this.returnedValues);if(n.length>0){let i=new A(qe,n);for(;i.count>0;){let o=t.time(()=>{let s=i.dequeue();return s.isFullReplacement?null:(r[s.resultKey]=s,new Le(s))},0);if(o){let s=t.start(1);yield o,s.end(),t.timeSinceLastDefer>_e&&(yield new Pe(t.defer()))}}}do{let i=t.time(()=>{var s,u;let o=this.handleNextNode();if(o.type=="none")return null;if(o.type=="complete"){if(o.finalNode.isFullReplacement)return null;let c=o.finalNode;if(((u=(s=r[c.resultKey])==null?void 0:s.currentCost)!=null?u:Number.MAX_VALUE)>c.currentCost)return r[c.resultKey]=c,this.returnedValues[c.resultKey]=c,new Le(c)}return null},2);if(i){let o=t.start(1);yield i,o.end()}t.timeSinceLastDefer>_e&&(yield new Pe(t.defer()))}while(!t.elapsed&&this.hasNextMatchEntry());return null})}};p(G,"SearchSpace"),G.EDIT_DISTANCE_COST_SCALE=5,G.MIN_KEYSTROKE_PROBABILITY=1e-4,G.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL=33;var I=G;var bt=class bt{static isWhitespace(t){let r=/^[\\u0009\\u000A\\u000D\\u0020\\u00a0\\u1680\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u200b\\u2028\\u2029\\u202f\\u205f\\u3000]+$/i;return t.insert.match(r)!=null}static isBackspace(t){return t.insert==""&&t.deleteLeft>0&&!t.deleteRight}static isEmpty(t){return t.insert==""&&t.deleteLeft==0&&!t.deleteRight}};p(bt,"TransformUtils");var O=bt;var Cr={quotesForKeepSuggestion:{open:"“",close:"”"},insertAfterWord:" "};function Me(a){let t=Cr;if(!a.punctuation)return t;let r=a.punctuation,n=r.insertAfterWord;n!==""&&!n&&(n=t.insertAfterWord);let i=r.quotesForKeepSuggestion;i||(i=t.quotesForKeepSuggestion);let o=r.isRTL;return{insertAfterWord:n,quotesForKeepSuggestion:i,isRTL:o}}p(Me,"determinePunctuationFromModel");function j(a){return t=>{if(a.wordbreaker||!a.wordbreak){let r=a.wordbreaker||q;return ie(r,t)}else return a.wordbreak(t)}}p(j,"determineModelWordbreaker");function se(a){return t=>a.wordbreaker?ge(a.wordbreaker,t):null}p(se,"determineModelTokenizer");function Gt(a,t){var o;let r=a,i=j(a)(t);if(!r.languageUsesCasing)throw"Invalid attempt to detect casing: languageUsesCasing is set to false";if(!r.applyCasing)throw"Invalid LMLayer state:  languageUsesCasing is set to true, but no applyCasing function exists";return t.casingForm=="upper"||t.casingForm=="initial"?t.casingForm:r.applyCasing("lower",i)==i?"lower":r.applyCasing("upper",i)==i?T.length(i)>1?"upper":"initial":r.applyCasing("initial",i)==i?"initial":(o=t.casingForm)!=null?o:null}p(Gt,"detectCurrentCasing");function Be(a,t,r){let n=y(r,t),i=a(n).left,o=r.insert,s=[];for(let u=i.length-1;u>=0;u--){let l=i[u],c=l.text.length;if(c<o.length)s.unshift({insert:l.text,deleteLeft:0}),o=o.substring(0,o.length-c);else{s.unshift({insert:o,deleteLeft:r.deleteLeft});break}}return s}p(Be,"tokenizeTransform");function Ct(a,t,r){return r.map(n=>({sample:Be(a,t,n.sample),p:n.p}))}p(Ct,"tokenizeTransformDistribution");function jt(a,t){let r=[];for(let n=0;n<T.length(a);n++){let o={insert:T.charAt(a,n),deleteLeft:0,id:t};r.push(o)}return r}p(jt,"textToCharTransforms");function Vt(a){let t=a.length;return t>=2&&a[t-2]=="substitute"&&a[t-1]=="match"?a.lastIndexOf("match",t-2):a.lastIndexOf("match")}p(Vt,"getEditPathLastMatch");var Lt=class Lt{};p(Lt,"TrackedContextSuggestion");var yt=Lt,Mt=class Mt{constructor(t){this.transformDistributions=[];this.replacements=[];this.activeReplacementId=-1;t&&(Object.assign(this,t),this.replacements=t.replacements.slice())}get currentText(){return this.replacementText===void 0||this.replacementText===null?this.raw:this.replacementText}get replacement(){let t=this.activeReplacementId;return this.replacements.find(function(r){return r.suggestion.id==t})}clearReplacements(){this.activeReplacementId=-1,this.replacements=[]}updateWithBackspace(t,r){let n=jt(t,r).map(function(i){return[{sample:i,p:1}]});this.raw=t,this.transformDistributions=n,this.clearReplacements()}update(t,r){r=r||(r===""?"":this.raw),(t==null?void 0:t.length)>0&&this.transformDistributions.push(t),this.raw=r,this.clearReplacements()}};p(Mt,"TrackedContextToken");var ee=Mt,Ke=class Ke{constructor(t){this.searchSpace=[];if(t instanceof Ke){let r=t;this.tokens=r.tokens.map(function(i){let o=new ee;return Object.assign(o,i),o.replacements=o.replacements.slice(),o.transformDistributions=o.transformDistributions.slice(),o}),this.indexOffset=0;let n=this.model=t.model;this.taggedContext=t.taggedContext,n!=null&&n.traverseFromRoot&&(this.searchSpace=t.searchSpace.map(i=>new I(i)))}else{let r=t;this.tokens=[],this.indexOffset=Number.MIN_SAFE_INTEGER,this.model=r,r&&r.traverseFromRoot&&(this.searchSpace=[new I(r)])}}get head(){return this.tokens[0]}get tail(){return this.tokens[this.tokens.length-1]}popHead(){this.tokens.splice(0,1),this.indexOffset-=1}pushTail(t){this.model&&this.model.traverseFromRoot?this.searchSpace=[new I(this.model)]:this.searchSpace=[],this.tokens.push(t);let r=this;r.searchSpace.length>0&&t.transformDistributions.forEach(n=>r.searchSpace[0].addInput(n))}toRawTokenization(){let t=[];for(let r of this.tokens)r.currentText!==null&&t.push(r.currentText);return t}};p(Ke,"TrackedContextState");var V=Ke,ke=class ke{constructor(t=ke.DEFAULT_ARRAY_SIZE){this.currentHead=0;this.currentTail=0;this.circle=Array(t)}get count(){let t=this.currentHead-this.currentTail;return t<0&&(t=t+this.circle.length),t}get maxCount(){return this.circle.length}get oldest(){if(this.count!=0)return this.item(0)}get newest(){if(this.count!=0)return this.item(this.count-1)}enqueue(t){var r=null;let n=(this.currentHead+1)%this.maxCount;return n==this.currentTail&&(r=this.circle[this.currentTail],this.currentTail=(this.currentTail+1)%this.maxCount),this.circle[this.currentHead]=t,this.currentHead=n,r}dequeue(){if(this.currentTail==this.currentHead)return null;{let t=this.circle[this.currentTail];return this.currentTail=(this.currentTail+1)%this.maxCount,t}}popNewest(){if(this.currentTail==this.currentHead)return null;{let t=this.circle[this.currentHead];return this.currentHead=(this.currentHead-1+this.maxCount)%this.maxCount,t}}item(t){if(t>=this.count)return;let r=(this.currentTail+t)%this.maxCount;return this.circle[r]}};p(ke,"CircularArray"),ke.DEFAULT_ARRAY_SIZE=5;var St=ke,ve=class ve extends St{static attemptMatchContext(t,r,n){var k,v;let i=r.toRawTokenization(),s=J.computeDistance(i.map(f=>({key:f})),t.map(f=>({key:f.text})),3).editPath(),u=s.indexOf("match"),l=Vt(s);if(u){for(let f=u+1;f<l;f++)if(s[f]!="match")return null}if(u==0&&l==s.length-1)return{state:r,baseState:r,headTokensRemoved:0,tailTokensAdded:0};let c=r,d,h=0;for(let f=0;f<u;f++)switch(s[f]){case"delete":if(d&&d!="delete")return null;c==r&&(c=new V(c)),c.popHead(),h++;break;case"substitute":break;default:return null}let g=n&&Array.isArray(n);d=void 0;let m,x=0;for(let f=l+1;f<s.length;f++){let C=f==s.length-1;if(!g)return null;let te=f-(l+1),ce=n.map(b=>{let M=b.sample[te];return M?{sample:M,p:b.p}:null}),D=t[f-h],w=g?(k=ce[0])==null?void 0:k.sample:null;if(s[f]!="delete")if(D){if(!(w||s[f]=="insert")&&(D==null?void 0:D.text)!="")return null}else return null;w&&w.insert==""&&w.deleteLeft==0&&!w.deleteRight&&(w=null),C||(m=m&&w?Q(m,w):w!=null?w:m);let tr=w&&O.isBackspace(w);switch(s[f]){case"substitute":C&&(c=new V(c));let b=r.tokens[f];c.tokens[f-h]=b;let M=c.tokens[f-h];tr?(M.updateWithBackspace(D.text,w.id),C&&(c.tokens.pop(),c.pushTail(M))):(M.update(ce,D.text),C&&((v=c.searchSpace[0])==null||v.addInput(ce))),c!=r&&!C&&(M.replacementText=D.text);break;case"insert":if(d&&d!="substitute"&&d!="match"&&d!="insert")return null;m||(m={insert:"",deleteLeft:0}),c==r&&(c=new V(c));let F=new ee;if(F.raw=D.text,w)F.transformDistributions=ce?[ce]:[];else if(D.text)return null;F.isWhitespace=D.isWhitespace,c.pushTail(F),x++;break;case"match":if(d=="substitute"&&t[t.length-1].text=="")continue;case"delete":for(let E=f+1;E<s.length;E++)if(s[E]!="delete")return null;c==r&&(c=new V(c)),c.tokens.pop();break;default:return null}d=s[f]}return{state:c,baseState:r,preservationTransform:m,headTokensRemoved:h,tailTokensAdded:x}}static modelContextState(t,r){let n=t.map(function(o){let s=new ee;return s.raw=o.text,o.isWhitespace&&(s.isWhitespace=!0),s.raw?s.transformDistributions=jt(s.raw).map(function(u){return[{sample:u,p:1}]}):s.transformDistributions=[],s}),i=new V(r);for(;n.length>0;)n.length==1&&n[0].updateWithBackspace(n[0].raw,null),i.pushTail(n.splice(0,1)[0]);if(i.tokens.length==0){let o=new ee;o.raw="",i.pushTail(o)}return i}analyzeState(t,r,n,i){if(!t.traverseFromRoot)throw"This lexical model does not provide adequate data for correction algorithms and context reuse";let o=se(t),s=n==null?void 0:n[0],u=0,l=null;s&&(u=Be(o,r,s.sample).length,l=Ct(o,r,n),r=y(s.sample,r),l=l.filter(h=>h.sample.length==u));let c=o(r);if(c.left.length>0)for(let h=this.count-1;h>=0;h--){let g=this.item(h),m=g.taggedContext;if(m&&n&&n.length>0){if(y(n[0].sample,m).left!=r.left)continue}else if((m==null?void 0:m.left)!=r.left)continue;let x=ve.attemptMatchContext(c.left,this.item(h),l);if(x!=null&&x.state)return this.newest!=x.state&&this.newest!=g&&this.enqueue(g),x.state.taggedContext=r,x.state!=this.item(h)&&this.enqueue(x.state),x}let d=ve.modelContextState(c.left,t);return d.taggedContext=r,this.enqueue(d),{state:d,baseState:null,headTokensRemoved:0,tailTokensAdded:0}}clearCache(){for(;this.count>0;)this.dequeue()}};p(ve,"ContextTracker");var we=ve;var yr=.66,Xt={MAX_SEARCH_THRESHOLD:8,REPLACEMENT_SEARCH_THRESHOLD:4};function vt(a,t){let r=t.matchLevel-a.matchLevel;return r!=0?r:t.totalProb-a.totalProb}p(vt,"tupleDisplayOrderSort");function $t(a,t,r,n,i){return K(this,null,function*(){let o=j(t),s=n[0].sample,u=y(s,i),l=[];if(!a){let b,M=O.isWhitespace(s),F=O.isBackspace(s);return M?b=[{sample:s,p:1}]:b=n.map(E=>{let Ae=E.sample;return O.isWhitespace(Ae)&&!M||O.isBackspace(Ae)&&!F?null:E}),b=b.filter(E=>!!E),l=kt(t,b,i),M&&l.forEach(E=>E.preservationTransform=s),{postContextState:null,rawPredictions:l}}let{state:c}=a.analyzeState(t,i,null),d=a.analyzeState(t,i,O.isEmpty(s)?null:n),h=d.state,g=h.searchSpace[0],m=0,x=h.tokens,k=x.length-c.tokens.length;d.preservationTransform?(m=0,i=y(d.preservationTransform,i)):k<0?m=T.length(o(u))+s.deleteLeft:m=T.length(o(i));let v=x[x.length-1];v.raw==""&&(m=0);let f=v.transformDistributions.length<=1,C,te={};if(!g.correctionsEnabled){let b={sample:{insert:o(u),deleteLeft:m,id:s.id},p:1},M=kt(t,[b],i);return M.forEach(F=>F.preservationTransform=d.preservationTransform),{postContextState:h,rawPredictions:M}}try{for(var ce=Pt(g.getBestMatches(r)),D,w,tr;D=!(w=yield ce.next()).done;D=!1){let b=w.value;let M=b.matchString;if(b.matchSequence.length==0&&b.inputSequence.length!=0||b.matchSequence.length!=0&&b.matchSequence.length==b.knownCost)continue;let F={insert:M,deleteLeft:m,id:s.id},E=b.totalCost;f&&(E*=ae.SINGLE_CHAR_KEY_PROB_EXPONENT);let Ae={sample:F,p:Math.exp(-E)},Oe=kt(t,[Ae],i);Oe.forEach(pe=>pe.preservationTransform=d.preservationTransform),Oe.length>0&&C===void 0&&(C=E);let Et=te[b.matchString];if(Et&&(l=l.filter(pe=>!Et.find(rr=>pe.prediction.sample==rr.sample))),te[b.matchString]=Oe.map(pe=>pe.prediction),l=l.concat(Oe),Sr(C,b.totalCost,l))break}}catch(w){tr=[w]}finally{try{D&&(w=ce.return)&&(yield w.call(ce))}finally{if(tr)throw tr[0]}}return{postContextState:h,rawPredictions:l}})}p($t,"correctAndEnumerate");function Sr(a,t,r){if(t>=a+Xt.MAX_SEARCH_THRESHOLD)return!0;if(r.length>=ae.MAX_SUGGESTIONS){if(t>=a+Xt.REPLACEMENT_SEARCH_THRESHOLD)return!0;if(r.sort(vt),r[ae.MAX_SUGGESTIONS-1].totalProb>Math.exp(-t))return!0}return!1}p(Sr,"shouldStopSearchingEarly");function kt(a,t,r){let n=[],i=j(a);for(let o of t){let s=a.predict(o.sample,r),{sample:u,p:l}=o,c=i(y(o.sample,r)),d=s.map(h=>(u.id!==void 0&&(h.sample.transformId=u.id),{prediction:h,correction:{sample:c,p:l},totalProb:h.p*l,matchLevel:0}));n=n.concat(d)}return n}p(kt,"predictFromCorrections");function Jt(a,t,r){let n=j(a),i={},o=[];for(let s of t){let u=n(y(s.prediction.sample.transform,r)),l=i[u];l?l.totalProb+=s.totalProb:i[u]=s}for(let s in i){let u=i[s];o.push(u)}return o}p(Jt,"dedupeSuggestions");function Zt(a,t,r,n){let{sample:i,p:o}=n,s=j(a),u=y(i,r),l=s(u),c=p(f=>a.toKey?a.toKey(f):f,"keyed"),d=p(f=>a.applyCasing?a.applyCasing("lower",f):f,"keyCased"),h=c(l),g=d(l),m;for(let f of t){i.id!==void 0&&(f.prediction.sample.transformId=i.id);let C=s(y(f.prediction.sample.transform,r));c(f.correction.sample)==h?C==l?(f.matchLevel=3,m=Qe(a,f.prediction.sample,"keep",ne.noQuotes),m.matchesModel=!0,Object.assign(f.prediction.sample,m),m=f.prediction.sample):d(C)==g?f.matchLevel=2:c(C)==h?f.matchLevel=1:f.matchLevel=0:f.matchLevel=0}if(m||l=="")return;let x=T.length(l)-T.length(i.insert)+i.deleteLeft,v=z({insert:l,deleteLeft:x},1);v.displayAs=l,m=Qe(a,v,"keep"),i.id!==void 0&&(m.transformId=i.id),m.matchesModel=!1,t.unshift({totalProb:m.p,prediction:{sample:m,p:m.p},correction:{sample:l,p:o},matchLevel:3})}p(Zt,"processSimilarity");function Yt(a){if(a.length==0)return;let t=a[0].prediction.sample;if(t.tag=="keep"&&t.matchesModel){t.autoAccept=!0;return}else if(a.length==1)return;if(a=a.slice(1),a.length==1){a[0].prediction.sample.autoAccept=!0;return}let r=a[0];if(r.correction.sample.length==0||a.reduce((l,c)=>(l==null?void 0:l.correction.p)>c.correction.p?l:c,null).correction.p>r.correction.p)return;let o=r.matchLevel,s=a.reduce((l,c)=>l+(c.matchLevel==o?c.totalProb:0),0);r.totalProb/s<yr||(r.prediction.sample.autoAccept=!0)}p(Yt,"predictionAutoSelect");function er(a,t,r,n,i){let o=Me(a),s=se(a),u=t.map(l=>{let c=l.prediction;if(l.preservationTransform){let d=Q(l.preservationTransform,c.sample.transform);d.id=c.sample.transformId;let h=c.sample;h.transform=d}return i?je(B({},c.sample),{p:l.totalProb,"lexical-p":c.p,"correction-p":l.correction.p}):je(B({},c.sample),{p:l.totalProb})});return u.forEach(l=>{let c=s(r);c&&c.caretSplitsToken?l.transform.insert+=o.insertAfterWord:r.right?o.insertAfterWord!=""&&r.right.indexOf(o.insertAfterWord)!=0&&(l.transform.insert+=o.insertAfterWord):l.transform.insert+=o.insertAfterWord}),u}p(er,"finalizeSuggestions");function Qe(a,t,r,n=ne.default){let i=ne,o=Me(a),s=i.noQuotes;(r=="keep"||r=="revert")&&(s=i.useQuotes);let u={transform:t.transform,displayAs:i.apply(n,t.displayAs,o,s),tag:r,p:t.p};return t.transformId!==void 0&&(u.transformId=t.transformId),u}p(Qe,"toAnnotatedSuggestion");var le=class le{constructor(t,r){this.SUGGESTION_ID_SEED=0;this.testMode=!1;this.verbose=!0;this.lexicalModel=t,t.traverseFromRoot&&(this.contextTracker=new we),this.punctuation=Me(t),this.testMode=!!r}predict(t,r){return K(this,null,function*(){var f;let n=this.lexicalModel;(f=this.activeTimer)==null||f.terminate(),t instanceof Array?t.length==0&&t.push({sample:{insert:"",deleteLeft:0},p:1}):t=[{sample:t,p:1}],t.sort(function(C,te){return te.p-C.p});let i=t[0].sample,o=O.isBackspace(i),s=O.isWhitespace(i),u=y(i,r),l=this.wordbreak(u),c=o||s?l:this.wordbreak(r),d=n.languageUsesCasing?Gt(n,u):null,h=I.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL,g=this.activeTimer=new ye(this.testMode?Number.MAX_VALUE:h,this.testMode?Number.MAX_VALUE:h*1.5),{postContextState:m,rawPredictions:x}=yield $t(this.contextTracker,this.lexicalModel,g,t,r);this.activeTimer==g&&(this.activeTimer=null);for(let C of x)d&&d!="lower"&&this.applySuggestionCasing(C.prediction.sample,c,d);let k=Jt(this.lexicalModel,x,r);Zt(this.lexicalModel,k,r,t[0]),k.sort(vt),Yt(k);let v=er(this.lexicalModel,k.splice(0,le.MAX_SUGGESTIONS),r,i,this.verbose);return v.forEach(C=>{C.id=this.SUGGESTION_ID_SEED,this.SUGGESTION_ID_SEED++}),m&&(m.tail.replacements=v.map(function(C){return{suggestion:C,tokenWidth:1}})),v})}applySuggestionCasing(t,r,n){let i=T.length(r)-t.transform.deleteLeft;i>0&&(t.transform.deleteLeft+=i,t.transform.insert=T.substr(r,0,i)+t.transform.insert),t.transform.insert=this.lexicalModel.applyCasing(n,t.transform.insert),t.displayAs=this.lexicalModel.applyCasing(n,t.displayAs)}acceptSuggestion(t,r,n){let i=t.transform,o=T.substr(r.left,-i.deleteLeft,i.deleteLeft),s=T.length(i.insert),u={insert:o,deleteLeft:s},l=r;n&&(u=Q(u,n),l=y(n,l));let c,d=this.tokenize(l);if(d){let m=d.left[d.left.length-1];c=m&&!m.isWhitespace?m.text:"",c+=d.caretSplitsToken?d.right[0].text:""}else c=this.wordbreak(l);let h=z(u);h.displayAs=c;let g=Qe(this.lexicalModel,h,"revert");if(t.transformId!=null&&(g.transformId=-t.transformId),t.id!=null?g.id=-t.id:(g.id=-this.SUGGESTION_ID_SEED,this.SUGGESTION_ID_SEED++),this.contextTracker){let m=this.contextTracker.newest;m||(m=this.contextTracker.analyzeState(this.lexicalModel,r).state),m.tail.activeReplacementId=t.id;let x=y(t.transform,r);this.contextTracker.analyzeState(this.lexicalModel,x)}return g}applyReversion(t,r){return K(this,null,function*(){let n=this,i=p(function(){return K(this,null,function*(){let u=y(t.transform,r),l=yield n.predict({insert:"",deleteLeft:0},u);return l.forEach(function(c){c.transformId=-t.transformId,c.autoAccept=!1}),l})},"fallbackSuggestions");if(!this.contextTracker)return i();let o=!1;for(let u=this.contextTracker.count-1;u>=0;u--)if(this.contextTracker.item(u).tail.activeReplacementId==-t.id){o=!0;break}if(!o)return i();for(;this.contextTracker.newest.tail.activeReplacementId!=-t.id;)this.contextTracker.popNewest();this.contextTracker.newest.tail.activeReplacementId=-1;let s=this.contextTracker.newest.tail.replacements.map(function(u){return u.suggestion});return s.forEach(function(u){u.transformId=-t.transformId,u.autoAccept=!1}),s})}wordbreak(t){return j(this.lexicalModel)(t)}tokenize(t){return se(this.lexicalModel)(t)}resetContext(t){var r;(r=this.activeTimer)==null||r.terminate(),this.contextTracker&&(this.contextTracker.clearCache(),this.contextTracker.analyzeState(this.lexicalModel,t,null))}};p(le,"ModelCompositor"),le.MAX_SUGGESTIONS=12,le.SINGLE_CHAR_KEY_PROB_EXPONENT=16;var wt=le,ae=wt;var He=class He{constructor(t={importScripts:null,postMessage:null}){this._testMode=!1;T.enableSupplementaryPlane(!0),this._postMessage=t.postMessage||postMessage,this._importScripts=t.importScripts||importScripts,this.setupConfigState()}error(t,r){this.cast("error",{log:t,error:r&&r.stack?r.stack:void 0})}onMessage(t){let{message:r}=t.data;if(!r)throw new Error(\`Missing required 'message' property: \${t.data}\`);let n=t.data;if(n.message=="load"){let i=n,o=!1;if(this._currentModelSource&&i.source.type==this._currentModelSource.type&&(i.source.type=="file"&&i.source.file==this._currentModelSource.file||i.source.type=="raw"&&i.source.code==this._currentModelSource.code)&&(o=!0),o){typeof console!="undefined"&&console.warn("Duplicate model load message detected - squashing!");return}else this._currentModelSource=i.source}else n.message=="unload"&&(this._currentModelSource=null);this.state.handleMessage(n)}cast(t,r){let n=this._postMessage;n(B({message:t},r))}loadModel(t){try{let r=t.configure(this._platformCapabilities);r.leftContextCodePoints||(r.leftContextCodePoints=r.leftContextCodeUnits),r.rightContextCodePoints||(r.rightContextCodePoints=r.rightContextCodeUnits),r.leftContextCodePoints||(r.leftContextCodePoints=this._platformCapabilities.maxLeftContextCodePoints),r.rightContextCodePoints||(r.rightContextCodePoints=this._platformCapabilities.maxRightContextCodePoints||0),t.languageUsesCasing&&!t.applyCasing&&(t.applyCasing=De);let n=this.transitionToReadyState(t);r.wordbreaksAfterSuggestions===void 0&&(r.wordbreaksAfterSuggestions=n.punctuation.insertAfterWord!=""),this.cast("ready",{configuration:r})}catch(r){this.error("loadModel failed!",r)}}loadModelFile(t){try{this._importScripts(t)}catch(r){this.error("Error occurred when attempting to load dictionary",r)}}unloadModel(){this.transitionToLoadingState()}setupConfigState(){this.state={name:"unconfigured",handleMessage:p(t=>{if(t.message!=="config")throw new Error(\`invalid message; expected 'config' but got \${t.message}\`);this._platformCapabilities=t.capabilities,this._testMode=!!t.testMode,this.transitionToLoadingState()},"handleMessage")}}transitionToLoadingState(){let t=this;this.state={name:"modelless",handleMessage:p(r=>{if(r.message!=="load")throw new Error(\`invalid message; expected 'load' but got \${r.message}\`);if(r.source.type=="file")t.loadModelFile(r.source.file);else{let n=r.source.code;new Function("LMLayerWorker","models","correction","wordBreakers",n)(t,We,Ee,xe)}},"handleMessage")}}transitionToReadyState(t){let r=new ae(t,this._testMode);return this.state={name:"ready",handleMessage:p(n=>{switch(n.message){case"predict":var{transform:i,context:l}=n;r.predict(i,l).then(d=>{this.cast("suggestions",{token:n.token,suggestions:d})});break;case"wordbreak":let c=ie(t.wordbreaker||q,n.context);this.cast("currentword",{token:n.token,word:c});break;case"unload":this.unloadModel();break;case"accept":var{suggestion:o,context:l,postTransform:s}=n,u=r.acceptSuggestion(o,l,s);this.cast("postaccept",{token:n.token,reversion:u});break;case"revert":var{reversion:u,context:l}=n;r.applyReversion(u,l).then(d=>{this.cast("postrevert",{token:n.token,suggestions:d})});break;case"reset-context":var{context:l}=n;r.resetContext(l);break;default:throw new Error(\`invalid message; expected one of {'predict', 'wordbreak', 'accept', 'revert', 'reset-context', 'unload'} but got \${n.message}\`)}},"handleMessage"),compositor:r},r}static install(t){let r=new He({postMessage:t.postMessage,importScripts:t.importScripts.bind(t)});return t.onmessage=r.onMessage.bind(r),r.self=t,t.LMLayerWorker=r,t.models=We,t.correction=Ee,t.wordBreakers=xe,r}};p(He,"LMLayerWorker");var ue=He;typeof self!="undefined"&&"postMessage"in self&&"importScripts"in self?ue.install(self):window.LMLayerWorker=ue;})();
//# sourceMappingURL=worker-main.min.js.map
`,fr="";var ul=class ul{static constructInstance(){return new Worker(this.asBlobURI(Hr))}static asBlobURI(n){let t=os(n);t+=`
`+fr;let i=new Blob([t],{type:"text/javascript"});return URL.createObjectURL(i)}};a(ul,"DefaultWorker");var an=ul;var Bl=class Bl extends S.default{constructor(t,i,s=!1){super();this._mayPredict=!0;this._mayCorrect=!0;this._mayAutoCorrect=!1;this._state="inactive";this.recentTranscriptions=i;let c={maxLeftContextCodePoints:64,maxRightContextCodePoints:s?0:64};if(!t)return;let l;try{l=t==null?void 0:t.constructInstance()}catch(o){console.warn("Web workers are not available: "+(o!=null?o:"").toString()),l=null}l&&(this.lmEngine=new rn(c,l))}get activeModel(){return this.currentModel}get isConfigured(){return!!this.configuration}get state(){return this._state}unloadModel(){this.canEnable&&(this.lmEngine.unloadModel(),delete this.currentModel,delete this.configuration,this._state="inactive",this.emit("statechange","inactive"))}loadModel(t){if(!t)throw new Error("Null reference not allowed.");if(!this.canEnable)return Promise.resolve();let i=t.path?"file":"raw",s=i=="file"?t.path:t.code;return this.currentModel=t,this.mayPredict&&(this._state="active",this.emit("statechange","active")),this.lmEngine.loadModel(s,i).then(c=>{this.configuration=c,this.mayPredict&&(this._state="configured",this.emit("statechange","configured"))}).catch(c=>{let l;c instanceof Error?l=c.message:l=String(c),console.error("Could not load model '"+t.id+"': "+l),this.currentModel=null,this._state="inactive",this.emit("statechange","inactive")})}invalidateContext(t,i){if(!this.currentModel||!this.configuration)return Promise.resolve([]);if(!this.isActive)return Promise.resolve([]);if(this.emit("invalidatesuggestions","context"),t){let s=t.buildTranscriptionFrom(t,null,!1);return this.predict_internal(s,!0,i)}else return Promise.resolve([])}wordbreak(t,i){if(!this.isActive)return null;let s=new Ze(E.from(t,!1),this.configuration,i);return this.lmEngine.wordbreak(s)}predict(t,i){return!this.isActive||!this.currentModel||!this.configuration?null:(this.emit("invalidatesuggestions","new"),this.predict_internal(t,!1,i))}applySuggestion(t,i,s){if(!i)throw"Accepting suggestions requires a destination OutputTarget instance.";if(!this.isActive)return null;if(!this.isConfigured)return console.warn("Could not apply suggestion; the corresponding model has been unloaded"),null;let c=this.getPredictionState(t.transformId);if(c){let l=E.from(c.preInput,!1);l.apply(t.transform);let o=l.buildTransformFrom(i);i.apply(o),this.emit("suggestionapplied",i),E.from(c.preInput,!1).apply(c.transform);let d=new Ze(c.preInput,this.configuration,s()),u=this.lmEngine.acceptSuggestion(t,d,c.transform);return u=u.then(B=>{let b={transform:c.transform,transformId:-c.token,displayAs:B.displayAs,id:B.id,tag:B.tag};return this.predictFromTarget(i,s()),b}),u}else return console.warn("Could not apply the Suggestion!"),null}applyReversion(t,i){if(!i)throw"Accepting suggestions requires a destination OutputTarget instance.";if(!this.isActive)return null;let s=this.getPredictionState(-t.transformId);if(!s)return console.warn("Could not apply the Suggestion!"),Promise.resolve([]);let c=E.from(s.preInput,!1);c.apply(t.transform);let l=c.buildTransformFrom(i);i.apply(l);let o=this.currentPromise=this.lmEngine.revertSuggestion(t,new Ze(s.preInput,this.configuration,null));return o.then(()=>this.currentPromise=this.currentPromise==o?null:this.currentPromise),o}predictFromTarget(t,i){if(!this.isActive||!t)return null;let s=t.buildTranscriptionFrom(t,null,!1);return this.predict(s,i)}predict_internal(t,i,s){if(!this.isActive||!t)return null;let c=new Ze(t.preInput,this.configuration,s);this.recordTranscription(t),i&&this.lmEngine.resetContext(c);let l=t.alternates;(!this.mayCorrect||!l||l.length==0)&&(l=[{sample:t.transform,p:1}]);let o=t.transform,r=this.currentPromise=this.lmEngine.predict(l,c);return r.then(d=>{if(r==this.currentPromise){let u=new Zt(d,o.id);this.emit("suggestionsready",u),this.currentPromise=null}return d})}recordTranscription(t){this.recentTranscriptions.save(t)}getPredictionState(t){return this.recentTranscriptions.get(t)}shutdown(){var t;(t=this.lmEngine)==null||t.shutdown(),this.removeAllListeners()}get isActive(){return this.canEnable?(this.activeModel||!1)&&this._mayPredict:(this._mayPredict=!1,!1)}get canEnable(){return!!this.lmEngine}get mayPredict(){return this._mayPredict}set mayPredict(t){if(!this.canEnable)return;let i=this._mayPredict;if(this._mayPredict=t,i!=t&&this.activeModel){let s=t?"active":"inactive";this._state=s,this.emit("statechange",s),t&&this.isConfigured&&(this._state="configured",this.emit("statechange","configured"))}}get mayCorrect(){return this._mayCorrect}set mayCorrect(t){this._mayCorrect=t}get mayAutoCorrect(){return this._mayAutoCorrect}set mayAutoCorrect(t){this._mayAutoCorrect=t}get wordbreaksAfterSuggestions(){return this.configuration.wordbreaksAfterSuggestions}tryAcceptSuggestion(t){var s;if(!this.isActive)return!1;let i={shouldSwallow:!1};return this.emit("tryaccept",t,i),(s=i.shouldSwallow)!=null?s:!1}tryRevertSuggestion(){return this.isActive&&this.emit("tryrevert"),!1}};a(Bl,"LanguageProcessor");var _n=Bl;var Ma=10,Il=class Il{constructor(){this.map=new Map}get(n){let t=this.map.get(n);return t&&this.save(t),t}save(n){let t=n.token>=0?n.token:-n.token;this.map.delete(t),this.map.set(t,n),this.map.size>Ma&&this.map.delete(this.map.keys().next().value)}buildLog(){return[...this.map.entries()].map(([t,i])=>{var s;return`Context state ${t}'s keystroke:
${(s=i.keystroke.inputBreadcrumb)!=null?s:""}`}).join(`
`)}};a(Il,"TranscriptionCache");var qn=Il;var $n=class $n{constructor(n,t,i){this.contextCache=new qn;if(!n)throw new Error("device must be defined");i||(i=$n.DEFAULT_OPTIONS),this.contextDevice=n,this.kbdProcessor=new nn(n,i),this.lngProcessor=new _n(t,this.contextCache)}get languageProcessor(){return this.lngProcessor}get keyboardProcessor(){return this.kbdProcessor}get keyboardInterface(){return this.keyboardProcessor.keyboardInterface}get activeKeyboard(){return this.keyboardInterface.activeKeyboard}set activeKeyboard(n){this.keyboardInterface.activeKeyboard=n,this.resetContext()}get activeModel(){return this.languageProcessor.activeModel}processKeyEvent(n,t){let i=n.srcKeyboard&&this.activeKeyboard!=n.srcKeyboard,s=this.activeKeyboard;try{if(i&&(this.keyboardInterface.activeKeyboard=n.srcKeyboard),n.baseTranscriptionToken){let c=this.contextCache.get(n.baseTranscriptionToken);c?(!Wt(c.transform)||!c.preInput.isEqual(E.from(t)))&&t.restoreTo(c.preInput):console.warn(`The base context for the multitap could not be found!

`+this.contextCache.buildLog())}return this._processKeyEvent(n,t)}finally{i&&(this.keyboardInterface.activeKeyboard=s)}}_processKeyEvent(n,t){var b;let i=n.device.formFactor,s=n.isSynthetic;if((i==W.FormFactor.Desktop||!this.activeKeyboard||this.activeKeyboard.usesDesktopLayoutOnDevice(n.device))&&s&&this.keyboardProcessor.selectLayer(n))return new ce;if(this.keyboardProcessor.doModifierPress(n,t,!s)&&!s)return new ce;if(this.languageProcessor.isActive){if((n.kName=="K_BKSP"||n.Lcode==C.keyCodes.K_BKSP)&&this.languageProcessor.tryRevertSuggestion())return new ce;if((n.kName=="K_SPACE"||n.Lcode==C.keyCodes.K_SPACE)&&this.languageProcessor.tryAcceptSuggestion("space"))return new ce}let c=E.from(t,!0),l=this.keyboardProcessor.layerId,o=this.keyboardProcessor.processKeystroke(n,t);n.kNextLayer&&this.keyboardProcessor.selectLayer(n);let r=C.isFrameKey(n.kName);Wt((b=o==null?void 0:o.transcription)==null?void 0:b.transform)&&n.kNextLayer&&(r=!0);let d=o!=null;if(d){let I=r?null:this.buildAlternates(o,n,c);o.finalize(this.keyboardProcessor,t,!1),I&&I.length>0&&(o.transcription.alternates=I)}else o=new ce,o.transcription=t.buildTranscriptionFrom(t,null,!1),o.triggersDefaultCommand=!0;this.contextCache.save(o.transcription);let u=o.setStore[33]||n.kNextLayer;this.keyboardProcessor.newLayerStore.set(u?this.keyboardProcessor.layerId:""),this.keyboardProcessor.oldLayerStore.set(u?l:"");let B=this.keyboardProcessor.processPostKeystroke(this.contextDevice,t);return B&&B.finalize(this.keyboardProcessor,t,!0),o.predictionPromise=this.languageProcessor.predict(o.transcription,this.keyboardProcessor.layerId),o.triggersDefaultCommand||t.doInputEvent(),d?o:null}buildAlternates(n,t,i){let s;if(this.languageProcessor.isActive&&!n.triggersDefaultCommand){let c=t.keyDistribution,o=new Ze(i,Ze.ENGINE_RULE_WINDOW,this.keyboardProcessor.layerId).toMock();if(this.languageProcessor.isActive&&c&&t.kbdLayer){let r=Number.MAX_VALUE,d=Dt(),u;d.performance&&d.performance.now&&(u=a(function(){return d.performance.now()},"timer"),r=u()+16);let B=Math.exp(-5);c.sort((I,h)=>h.p-I.p),s=[];let b=0;for(let I of c){if(I.p<B){b+=I.p;break}else if(u&&u()>=r)break;let h=E.from(o,!1),F=I.keySpec;if(!F){console.warn("Internal error:  failed to properly filter set of keys for corrections");continue}let y=this.keyboardProcessor.activeKeyboard.constructKeyEvent(F,t.device,this.keyboardProcessor.stateKeys),G=this.keyboardProcessor.processKeystroke(y,h);if(G&&!G.beep&&I.p>0){let x=G.transcription.transform;x.id=n.transcription.token,s.push({sample:x,p:I.p}),b+=I.p}}s.forEach(function(I){I.p/=b})}}return s}resetContext(n){this.keyboardProcessor.resetContext(n),this.languageProcessor.invalidateContext(n,this.keyboardProcessor.layerId)}};a($n,"InputProcessor"),$n.DEFAULT_OPTIONS={baseLayout:"us"};var ei=$n;var bl=class bl{constructor(n,t,i,s){this.Pelem=n,this.Peventname=t.toLowerCase(),this.Phandler=i,this.PuseCapture=s}equals(n){return this.Pelem==n.Pelem&&this.Peventname==n.Peventname&&this.Phandler==n.Phandler&&this.PuseCapture==n.PuseCapture}};a(bl,"DomEventTracking");var rs=bl,hl=class hl{constructor(){this.domEvents=[]}attachDOMEvent(n,t,i,s){this.detachDOMEvent(n,t,i,s),n.addEventListener(t,i,!!s);let c=new rs(n,t,i,s);this.domEvents.push(c)}detachDOMEvent(n,t,i,s){n.removeEventListener(t,i,s);let c=new rs(n,t,i,s);for(let l=0;l<this.domEvents.length;l++)if(this.domEvents[l].equals(c)){this.domEvents.splice(l,1);break}}shutdown(){for(let n of this.domEvents)this.detachDOMEvent(n.Pelem,n.Peventname,n.Phandler,n.PuseCapture)}};a(hl,"DomEventTracker");var Xe=hl;var Fl=class Fl extends S.default{constructor(n){super(),n instanceof S.default?(n.on=this.listenerRegistrationSpy("listeneradded",n,n.on),n.addListener=this.listenerRegistrationSpy("listeneradded",n,n.addListener),n.off=this.listenerRegistrationSpy("listenerremoved",n,n.off),n.removeListener=this.listenerRegistrationSpy("listenerremoved",n,n.off)):(n.addEventListener=this.listenerRegistrationSpy("listeneradded",n,n.addEventListener),n.removeEventListener=this.listenerRegistrationSpy("listenerremoved",n,n.removeEventListener))}listenerRegistrationSpy(n,t,i){return(s,c)=>{let l=i.apply(t,[s,c]);return this.emit(n,s),l}}};a(Fl,"EmitterListenerSpy");var gn=Fl;var yl=class yl{constructor(){this.events={};this.currentEvents=[]}addEventListener(n,t){return this._removeEventListener(n,t),this.events[n].push(t),!0}removeEventListener(n,t){return this._removeEventListener(n,t)}_removeEventListener(n,t){typeof this.events[n]=="undefined"&&(this.events[n]=[]);for(let i=0;i<this.events[n].length;i++)if(this.events[n][i]==t)return this.events[n].splice(i,1),!0;return!1}callEvent(n,t){if(typeof this.events[n]=="undefined")return!0;if(this.currentEvents.indexOf(n)!=-1)return!1;this.currentEvents.push(n);for(let i=0;i<this.events[n].length;i++){let s=this.events[n][i],c=!1;try{c=s(t)}catch(l){console.error(l),c=!1}if(c===!1)return this.currentEvents.pop(),!1}return this.currentEvents.pop(),!0}listenerCount(n){let t=this.events[n];return t?t.length:0}shutdown(){this.events={}}};a(yl,"LegacyEventEmitter");var dn=yl;var ml=class ml{constructor(n=!1){this.fileLocal=n}request(n){let t=new f,i=window.setTimeout(()=>{t.reject(new Error(Sr))},1e4),s="&timerid="+i,c=n+s,l=document.createElement("script");l.onload=o=>{window.clearTimeout(i),t.isResolved||t.reject(new Error(Wr))},l.onerror=(o,r,d,u,B)=>{window.clearTimeout(i);let b=qc;B&&(b=b+": "+B.message),t.reject(new Error(b))},this.fileLocal?l.src=n:l.src=c;try{document.body.appendChild(l)}catch(o){document.getElementsByTagName("head")[0].appendChild(l)}return t.finally(()=>{clearTimeout(i)}),{promise:t,queryId:i}}};a(ml,"DOMCloudRequester");var ti=ml;function za(){return typeof window.KeymanWeb_BaseLayout!="undefined"?window.KeymanWeb_BaseLayout:"us"}a(za,"determineBaseLayout");var Gl=class Gl{constructor(n,t,i,s){this.legacyAPIEvents=new dn;this.keyEventListener=a((n,t)=>{var c;let i=this.contextManager.activeTarget;if(!this.contextManager.activeKeyboard||!i){t&&t(null,null);return}if(this.core.languageProcessor.mayCorrect||(n.keyDistribution=[]),this.keyEventRefocus&&this.keyEventRefocus(),i.invalidateSelection(),i.deadkeys().deleteMatched(),n.isSynthetic){let l=this.osk.vkbd.layerId;l&&l!=this.core.keyboardProcessor.layerId&&(this.core.keyboardProcessor.layerId=l)}let s=this.core.processKeyEvent(n,i);s&&((c=s.transcription)!=null&&c.transform)&&this.config.onRuleFinalization(s,this.contextManager.activeTarget),t&&t(s,null)},"keyEventListener");this.config=t,this.contextManager=i;let c=s(this);c.baseLayout=za(),this.interface=c.keyboardInterface,this.core=new ei(t.hostDevice,n,c),this.core.languageProcessor.on("statechange",l=>{var o,r;(o=this.osk)==null||o.bannerController.selectBanner(l),(r=this.osk)==null||r.refreshLayout()}),this.core.keyboardProcessor.on("statekeychange",l=>{var o,r;(r=(o=this.osk)==null?void 0:o.vkbd)==null||r.updateStateKeys(l)}),this.contextManager.on("beforekeyboardchange",l=>{this.legacyAPIEvents.callEvent("beforekeyboardchange",{internalName:l==null?void 0:l.id,languageCode:l==null?void 0:l.langId})}),this.contextManager.on("keyboardchange",l=>{l||this.osk.startHide(!1);let o=a(()=>{var r,d;this.refreshModel(),this.core.activeKeyboard=l==null?void 0:l.keyboard,this.legacyAPIEvents.callEvent("keyboardchange",{internalName:(r=l==null?void 0:l.metadata.id)!=null?r:"",languageCode:(d=l==null?void 0:l.metadata.langId)!=null?d:""})},"prepareKeyboardSwap");this.osk?this.osk.batchLayoutAfter(()=>{o(),this.osk.activeKeyboard=l,this.contextManager.resetContext(),this.osk.present()}):(o(),this.contextManager.resetContext())}),this.contextManager.on("keyboardasyncload",l=>{var o,r;this.config.hostDevice.touchable&&((o=this.osk)!=null&&o.activationModel)&&(this.osk.activationModel.enabled=!0),(r=this.osk)==null||r.startHide(!1)})}init(n){return R(this,null,function*(){let t=this.config;if(t.deferForInitialization.isResolved)return Promise.resolve();t.initialize(n),Q.enableSupplementaryPlane(!0);let i=new cs(this.interface,t.applyCacheBusting);this.keyboardRequisitioner=new ln(i,new ti,this.config.paths),this.modelCache=new on;let s=this.keyboardRequisitioner.cache,c=this.core.keyboardProcessor,l=new Xt(this.core.languageProcessor,()=>c.layerId);this.contextManager.configure({resetContext:a(o=>{this.osk?this.osk.batchLayoutAfter(()=>{this.core.resetContext(o)}):this.core.resetContext(o)},"resetContext"),predictionContext:l,keyboardCache:this.keyboardRequisitioner.cache}),this.core.languageProcessor.on("suggestionapplied",()=>{var o;c.newLayerStore.set(""),c.oldLayerStore.set(""),(o=c.processPostKeystroke(c.contextDevice,l.currentTarget))==null||o.finalize(c,l.currentTarget,!0)}),this.config.on("spacebartext",()=>{var o;(o=this.osk)==null||o.refreshLayout()}),s.on("stubadded",o=>{let r=a(()=>{this.legacyAPIEvents.callEvent("keyboardregistered",{internalName:o.KI,language:o.KL,keyboardName:o.KN,languageCode:o.KLC,package:o.KP}),this.config.activateFirstKeyboard&&this.keyboardRequisitioner.cache.defaultStub==o&&this.contextManager.activateKeyboard(o.id,o.langId,!0)},"eventRaiser");this.config.deferForInitialization.isResolved?r():this.config.deferForInitialization.then(r)}),s.on("keyboardadded",o=>{let r=a(()=>{this.legacyAPIEvents.callEvent("keyboardloaded",{keyboardName:o.id})},"eventRaiser");this.config.deferForInitialization.isResolved?r():this.config.deferForInitialization.then(r)}),this.keyboardRequisitioner.cache.on("keyboardadded",o=>{this.legacyAPIEvents.callEvent("keyboardloaded",{keyboardName:o.id})})})}get build(){return Number.parseInt(it.VERSION_PATCH,10)}get version(){return it.VERSION_RELEASE}get hardKeyboard(){return this._hardKeyboard}set hardKeyboard(n){this._hardKeyboard&&this._hardKeyboard.off("keyevent",this.keyEventListener),this._hardKeyboard=n,n.on("keyevent",this.keyEventListener)}get osk(){return this._osk}set osk(n){var t;this._osk&&(this._osk.off("keyevent",this.keyEventListener),this.core.keyboardProcessor.layerStore.handler=this.osk.layerChangeHandler),this._osk=n,this.core.keyboardProcessor.contextDevice=(t=n==null?void 0:n.targetDevice)!=null?t:this.config.softDevice,n&&(this.contextManager.activeKeyboard&&(n.activeKeyboard=this.contextManager.activeKeyboard),n.on("keyevent",this.keyEventListener),this.core.keyboardProcessor.layerStore.handler=n.layerChangeHandler)}getDebugInfo(){var i,s,c,l,o,r,d,u,B,b,I,h,F,y;let n=(i=this.contextManager)==null?void 0:i.activeKeyboard;return{configReport:(s=this.config)==null?void 0:s.debugReport(),keyboard:{id:Oe((l=(c=n==null?void 0:n.metadata)==null?void 0:c.id)!=null?l:""),langId:((o=n==null?void 0:n.metadata)==null?void 0:o.langId)||"",version:(d=(r=n==null?void 0:n.keyboard)==null?void 0:r.version)!=null?d:""},model:{id:((B=(u=this.core)==null?void 0:u.activeModel)==null?void 0:B.id)||""},osk:{banner:(h=(I=(b=this.osk)==null?void 0:b.banner)==null?void 0:I.banner.type)!=null?h:"",layer:((y=(F=this.osk)==null?void 0:F.vkbd)==null?void 0:y.layerId)||""}}}refreshModel(){let n=this.contextManager.activeKeyboard,t=this.modelCache.modelForLanguage(n==null?void 0:n.metadata.langId);return this.core.activeModel!=t&&(this.core.activeModel&&this.core.languageProcessor.unloadModel(),t)?this.core.languageProcessor.loadModel(t).then(()=>t):Promise.resolve(t)}addEventListener(n,t){this.legacyAPIEvents.addEventListener(n,t)}removeEventListener(n,t){this.legacyAPIEvents.removeEventListener(n,t)}shutdown(){var n;this.legacyAPIEvents.shutdown(),(n=this.osk)==null||n.shutdown()}addModel(n){var i;this.modelCache.register(n);let t=(i=this.contextManager.activeKeyboard)==null?void 0:i.metadata;return t&&n.languages.indexOf(t.langId)!=-1?this.refreshModel().then(()=>{}):Promise.resolve()}removeModel(n){this.modelCache.unregister(n),this.core.activeModel&&this.core.activeModel.id==n&&this.core.languageProcessor.unloadModel()}setActiveKeyboard(n,t){return R(this,null,function*(){return this.contextManager.activateKeyboard(n,t,!0)})}getActiveKeyboard(){var n,t;return(t=(n=this.contextManager.activeKeyboard)==null?void 0:n.metadata.id)!=null?t:""}getActiveLanguage(n){var i,s,c;let t=(i=this.contextManager.activeKeyboard)==null?void 0:i.metadata;return n?(c=t==null?void 0:t.langName)!=null?c:"":(s=t==null?void 0:t.langId)!=null?s:""}isChiral(n){let t;if(n){if(typeof n=="string"){let i=this.keyboardRequisitioner.cache.getKeyboard(n);if(i)n=i;else throw new Error(`Keyboard '${n}' has not been loaded.`)}t=n}else t=this.core.activeKeyboard;return t.isChiral}resetContext(){this.contextManager.resetContext()}setNumericLayer(){this.core.keyboardProcessor.setNumericLayer(this.config.softDevice)}};a(Gl,"KeymanEngineBase");var ni=Gl;var at=class at{get height(){return this._height}set height(n){this._height=n>0?n:0,this.update()}get width(){return this._width}set width(n){this._width=n,this.update()}update(){let n=this.div.style,t=n.height,i=n.display;return this._height>0?(n.height=this._height+"px",n.display="block"):(n.height="0px",n.display="none"),t!==n.height||i!==n.display}constructor(n){let t=N("div");t.id=at.BANNER_ID,t.className=at.BANNER_CLASS,this.div=t,this.height=n,this.update()}appendStyleSheet(){}getDiv(){return this.div}configureForKeyboard(n,t){}shutdown(){}};a(at,"Banner"),at.DEFAULT_HEIGHT=37,at.BANNER_CLASS="kmw-banner-bar",at.BANNER_ID="kmw-banner-bar";var Be=at;var Pe=class Pe{constructor(n){let t=typeof n=="string"?Pe.parseLengthStyle(n):n,i={val:1,absolute:!1};typeof n=="number"&&(t=i),isNaN(t.val)&&(console.error("NaN appeared while trying to calculate style scaling effects"),t=i),this.val=t.val,this.absolute=t.absolute,t.special&&(this.special=t.special)}get styleString(){return this.absolute?this.val+"px":this.special?this.val+this.special:this.val*100+"%"}scaledBy(n){return isNaN(n)?(console.error("NaN appeared while trying to calculate style scaling effects"),this):new Pe({val:n*this.val,absolute:this.absolute})}static inPixels(n){return new Pe({val:n,absolute:!0})}static inPercent(n){return new Pe({val:n/100,absolute:!1})}static forScalar(n){return new Pe({val:n,absolute:!1})}static special(n,t){return new Pe({val:n,absolute:!1,special:t})}static parseLengthStyle(n){if(n=="")return Lr;let t=parseFloat(n);return isNaN(t)?(console.error("Could not properly parse specified length style info: '"+n+"'."),Lr):n.indexOf("px")!=-1?{val:t,absolute:!0}:n.indexOf("pt")!=-1?{val:4*t/3,absolute:!0}:n.indexOf("%")!=-1?{val:t/100,absolute:!1}:n.indexOf("rem")!=-1?{val:t,absolute:!1,special:"rem"}:n.indexOf("em")!=-1?{val:t,absolute:!1,special:"em"}:{val:4*t/3,absolute:!0}}};a(Pe,"ParsedLengthStyle");var X=Pe,Lr=new X("1em");var pl=class pl extends Be{constructor(){super(0);this.type="blank"}};a(pl,"BlankBanner");var gt=pl;var Cl=class Cl{constructor(){this._activeBannerHeight=Be.DEFAULT_HEIGHT;this.events=new S.default;this.constructContainer()}constructContainer(){let n=N("div");return n.id="keymanweb_banner_container",n.className="kmw-banner-container",this.bannerContainer=n}get element(){return this.bannerContainer}appendStyles(){this.currentBanner&&this.currentBanner.appendStyleSheet()}get banner(){return this.currentBanner}set banner(n){if(this.currentBanner){if(n==this.currentBanner)return;{let t=this.currentBanner;this.currentBanner=n,this.bannerContainer.replaceChild(n.getDiv(),t.getDiv()),t.shutdown()}}else this.currentBanner=n,n&&this.bannerContainer.appendChild(n.getDiv());n instanceof gt||(n.height=this.activeBannerHeight),this.events.emit("bannerchange")}get height(){return this.currentBanner?this.currentBanner.height:0}get activeBannerHeight(){return this._activeBannerHeight}set activeBannerHeight(n){this._activeBannerHeight=n,this.currentBanner&&!(this.currentBanner instanceof gt)&&(this.currentBanner.height=n)}get layoutHeight(){return X.inPixels(this.height)}get width(){var n;return(n=this.currentBanner)==null?void 0:n.width}set width(n){this.currentBanner&&(this.currentBanner.width=n)}refreshLayout(){var n,t;(t=(n=this.currentBanner).refreshLayout)==null||t.call(n)}};a(Cl,"BannerView");var as=Cl;var Ql=class Ql extends Be{constructor(n,t){n.length>0?(super(),t&&(this.height=t)):super(0),this.type="image",n.indexOf("base64")>=0?console.log("Loading img from base64 data"):console.log("Loading img with src '"+n+"'"),this.img=document.createElement("img"),this.img.setAttribute("src",n);let i=this.img.style;i.width="100%",i.height="100%",this.getDiv().appendChild(this.img),console.log("Image loaded.")}setImagePath(n){this.img&&this.img.setAttribute("src",n)}};a(Ql,"ImageBanner");var gs=Ql;function Le(g,n){n instanceof Error?console.error(`${g}: ${n.message}

${n.stack}`):(console.error(g),console.error(n))}a(Le,"reportError");var Ul=class Ul{constructor(n){this.queue=[],this.defaultWaitFactory=n||(()=>de(0))}get defaultWait(){return this.defaultWaitFactory()}get ready(){return this.queue.length==0&&!this.waitLock}triggerNextClosure(){return R(this,null,function*(){if(this.queue.length==0)return;let n=this.queue.shift();this.waitLock=Promise.resolve();let t;try{t=n()}catch(i){Le("Error from queued closure",i)}t=t!=null?t:this.defaultWaitFactory(),this.waitLock=t;try{yield t}catch(i){Le("Async error from queued closure",i)}this.waitLock=null,this.triggerNextClosure()})}runAsync(n){let t=this.ready;this.queue.push(n),t&&this.triggerNextClosure()}};a(Ul,"AsyncClosureDispatchQueue");var ds=Ul;function vr(g){return"targetX"in g&&"targetY"in g&&"t"in g}a(vr,"isAnInputSample");var dt=class dt{constructor(n){this.rawLinearSums={x:0,y:0,t:0};this.coordArcSum=0;this._sampleCount=0;if(n)if(n instanceof dt)Object.assign(this,n),this.rawLinearSums=p({},n.rawLinearSums);else if(vr(n))Object.assign(this,this.extend(n));else throw new Error("A constructor for this input pattern has not yet been implemented")}extend(n){return this._extend(new dt(this),n)}_extend(n,t){n._initialSample||(n._initialSample=t,n.baseSample=t);let i=n.baseSample;this.followingSample=t;let s=t.targetX-i.targetX,c=t.targetY-i.targetY,l=t.t-i.t;if(n.rawLinearSums.x+=s,n.rawLinearSums.y+=c,n.rawLinearSums.t+=l,this.lastSample){let o=t.targetX-this.lastSample.targetX,r=t.targetY-this.lastSample.targetY,d=o*o+r*r,u=Math.sqrt(d);n.coordArcSum+=u}return n._lastSample=t,n.sampleCount=this.sampleCount+1,n}deaccumulate(n){let t=new dt(this);return this._deaccumulate(t,n)}_deaccumulate(n,t){if(!t)return n;if(!t.followingSample||!t.lastSample)throw"Invalid argument:  stats missing necessary tracking variable.";for(let i in n.rawLinearSums){let s=i;n.rawLinearSums[s]-=t.rawLinearSums[s]}if(t.followingSample&&t.lastSample){let i=t.followingSample.targetX-t.lastSample.targetX,s=t.followingSample.targetY-t.lastSample.targetY,c=i*i+s*s,l=Math.sqrt(c);n.coordArcSum-=l,n.coordArcSum-=t.coordArcSum}return n.sampleCount-=t.sampleCount,n._initialSample=t.followingSample,n}translateCoordSystem(n){let t=new dt(this);return this._translateCoordSystem(t,n)}_translateCoordSystem(n,t){if(this.sampleCount==0)return n;let i=n.initialSample==n.lastSample;return n._initialSample=t(n.initialSample),n.baseSample=t(n.baseSample),n._lastSample=i?n._initialSample:t(n.lastSample),n}replaceInitialSample(n){let t=new dt(this);return this._replaceInitialSample(t,n)}_replaceInitialSample(n,t){if(this.sampleCount==0)throw new Error("no sample available to replace");let i=n.initialSample;if(n._initialSample=t,this.sampleCount>1){let s=t.targetX-i.targetX,c=t.targetY-i.targetY,l=t.t-i.t;n.rawLinearSums.x+=s,n.rawLinearSums.y+=c,n.rawLinearSums.t+=l;let o=s*s+c*c,r=Math.sqrt(o);n.coordArcSum+=r}else n._lastSample=t;return n}get lastSample(){return this._lastSample}get lastTimestamp(){var n;return(n=this.lastSample)==null?void 0:n.t}get sampleCount(){return this._sampleCount}set sampleCount(n){this._sampleCount=n}get initialSample(){return this._initialSample}mappingConstant(n){if(this.baseSample)return n=="t"?this.baseSample.t:n=="x"?this.baseSample.targetX:n=="y"?this.baseSample.targetY:0}mean(n){return this.rawLinearSums[n]/this.sampleCount+this.mappingConstant(n)}get netDistance(){if(!this.lastSample||!this.initialSample)return 0;let n=this.lastSample.targetX-this.initialSample.targetX,t=this.lastSample.targetY-this.initialSample.targetY;return Math.sqrt(n*n+t*t)}get duration(){return!this.lastSample||!this.initialSample?0:this.lastSample.t-this.initialSample.t}get angle(){if(this.sampleCount==1||!this.lastSample||!this.initialSample)return;if(this.netDistance<1)return;let n=this.lastSample.targetX-this.initialSample.targetX,t=this.lastSample.targetY-this.initialSample.targetY,i=Math.acos(-t/this.netDistance);return n<0?2*Math.PI-i:i}get angleInDegrees(){return this.angle*180/Math.PI}get cardinalDirection(){if(this.sampleCount==1||!this.lastSample||!this.initialSample||isNaN(this.angle)||this.angle===null||this.angle===void 0)return;let n=["n","ne","e","se","s","sw","w","nw","n"],t=Math.ceil((this.angleInDegrees-22.5)/45);return n[t]}get speed(){return this.duration?this.netDistance/this.duration:0}get rawDistance(){return this.coordArcSum}toJSON(){return{angle:this.angle,cardinal:this.cardinalDirection,netDistance:this.netDistance,duration:this.duration,sampleCount:this.sampleCount,rawDistance:this.rawDistance}}};a(dt,"CumulativePathStats");var ve=dt;function Ht(g,n){let t=g.gestures.find(i=>i.id==n);if(!t)throw new Error(`Could not find spec for gesture with id '${n}'`);return t}a(Ht,"getGestureModel");function xl(g,n){let t=g.sets[n];if(!t)throw new Error(`Could not find a defined gesture-set with id '${n}'`);let i=g.gestures.filter(c=>!!t.find(l=>c.id==l)),s=t.filter(c=>!i.find(l=>l.id==c));if(s.length>0)throw new Error(`Set '${n}' cannot find definitions for gestures with ids ${s}`);return i}a(xl,"getGestureModelSet");var Zl={gestures:[],sets:{default:[]}};var Xl=class Xl{constructor(){}getBoundingClientRect(){return new DOMRect(0,0,Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),Math.max(document.documentElement.clientHeight||0,window.innerHeight||0))}};a(Xl,"ViewportZoneSource");var us=Xl;var Vl=class Vl{get edgePadding(){return this._edgePadding}constructor(n,t){Array.isArray(n)&&(t=n,n=new us),this.root=n,t=t||[0,0,0,0],this.updatePadding(t)}updatePadding(n){switch(n.length){case 1:let t=n[0];this._edgePadding={x:t,y:t,w:2*t,h:2*t};break;case 2:this._edgePadding={x:n[1],y:n[0],w:2*n[1],h:2*n[0]};break;case 3:this._edgePadding={x:n[1],y:n[0],w:2*n[1],h:n[0]+n[2]};break;case 4:this._edgePadding={x:n[3],y:n[0],w:n[1]+n[3],h:n[0]+n[2]};break;default:throw new Error("Invalid values for PaddedZoneSource's edgePadding - must be between 1 to 4 `number` values.")}}getBoundingClientRect(){let n=this.root.getBoundingClientRect();return new DOMRect(n.left+this.edgePadding.x,n.top+this.edgePadding.y,n.width-this.edgePadding.w,n.height-this.edgePadding.h)}};a(Vl,"PaddedZoneSource");var Ie=Vl;function Bs(g){var t,i,s,c,l,o,r;let n=p({},g);if(n.mouseEventRoot=(t=n.mouseEventRoot)!=null?t:n.targetRoot,n.touchEventRoot=(i=n.touchEventRoot)!=null?i:n.targetRoot,n.inputStartBounds=(s=n.inputStartBounds)!=null?s:n.targetRoot,n.maxRoamingBounds=(c=n.maxRoamingBounds)!=null?c:n.targetRoot,n.safeBounds=(l=n.safeBounds)!=null?l:new Ie([2]),n.itemIdentifier=(o=n.itemIdentifier)!=null?o:()=>null,n.recordingMode=!!n.recordingMode,n.historyLength=((r=n.historyLength)!=null?r:0)>0?n.historyLength:0,g.paddedSafeBounds)delete n.safeBoundPadding;else{let d=g.safeBoundPadding;typeof d=="number"&&(d=[d]),d=d!=null?d:[3],n.paddedSafeBounds=new Ie(n.safeBounds,d)}return n}a(Bs,"preprocessRecognizerConfig");var Is=class Is extends S.default{constructor(){super();this._isComplete=!1;this._stats=new ve}get stats(){return this._stats}clone(){let t=new Is;return t._isComplete=this._isComplete,t._wasCancelled=this._wasCancelled,t._stats=new ve(this._stats),t}get isComplete(){return this._isComplete}get wasCancelled(){return this._wasCancelled}translateCoordSystem(t){this._stats=this._stats.translateCoordSystem(t)}replaceInitialSample(t){this._stats=this._stats.replaceInitialSample(t)}extend(t){if(this._isComplete)throw new Error("Invalid state:  this GesturePath has already terminated.");this._stats=this._stats.extend(t),this.emit("step",t)}terminate(t=!1){this._isComplete||(this._wasCancelled=t,this._isComplete=!0,t?this.emit("invalidated"):this.emit("complete"),this.removeAllListeners())}toJSON(){return{stats:this.stats,wasCancelled:this.wasCancelled}}};a(Is,"GesturePath");var un=Is;var ii=class ii extends un{constructor(){super(...arguments);this.samples=[]}clone(){let t=new ii;return t.samples=[].concat(this.samples),t._isComplete=this._isComplete,t._wasCancelled=this._wasCancelled,t._stats=new ve(this._stats),t}static deserialize(t){let i=new ii;i.samples=[].concat(t.coords.map(c=>p({},c))),i._isComplete=!0,i._wasCancelled=t.wasCancelled;let s=i.samples.reduce((c,l)=>c.extend(l),new ve);return i._stats=s,i}extend(t){if(this.isComplete)throw new Error("Invalid state:  this GesturePath has already terminated.");this.samples.push(t),super.extend(t)}translateCoordSystem(t){super.translateCoordSystem(t);for(let i=0;i<this.samples.length;i++)this.samples[i]=t(this.samples[i])}get coords(){return this.samples}toJSON(){let t={coords:[].concat(this.samples.map(i=>({targetX:i.targetX,targetY:i.targetY,t:i.t,item:i.item}))),wasCancelled:this.wasCancelled,stats:this.stats};for(let i of t.coords)delete i.clientX,delete i.clientY,i.item===void 0&&delete i.item;return t}};a(ii,"GestureDebugPath");var ut=ii;var Sl=class Sl{constructor(n,t,i,s){this.stateToken=null;this.rawIdentifier=n,this.isFromTouch=i,this._path=s?new s:new un,this.recognizerConfigStack=Array.isArray(t)?t:[t]}get path(){return this._path}setGestureMatchInspector(n){if(this._matchInspectionClosure)throw new Error("Invalid state:  the match-inspection closure has already been set");this._matchInspectionClosure=n}update(n){this.path.extend(n),this._baseItem||(this._baseItem=n.item)}get baseItem(){return this._baseItem}set baseItem(n){this._baseItem=n}get currentSample(){return this.path.stats.lastSample}get potentialModelMatchIds(){return this._matchInspectionClosure(this)}constructSubview(n,t,i){return new re(this,this.recognizerConfigStack,n,t,i)}terminate(n){this.path.terminate(n)}get isPathComplete(){return this.path.isComplete}get identifier(){return`${this.isFromTouch?"touch":"mouse"}:${this.rawIdentifier}`}pushRecognizerConfig(n){let t=A(p({},n),{mouseEventRoot:this.recognizerConfigStack[0].mouseEventRoot,touchEventRoot:this.recognizerConfigStack[0].touchEventRoot});this.recognizerConfigStack.push(Bs(t))}popRecognizerConfig(){if(this.recognizerConfigStack.length==1)throw new Error("Cannot 'pop' the original recognizer-configuration for this GestureSource.");return this.recognizerConfigStack.pop()}get currentRecognizerConfig(){return this.recognizerConfigStack[this.recognizerConfigStack.length-1]}toJSON(){return{identifier:this.identifier,isFromTouch:this.isFromTouch,path:this.path.toJSON(),stateToken:this.stateToken}}};a(Sl,"GestureSource");var ye=Sl,si=class si extends ye{constructor(n,t,i,s,c){let l=0,o=n.path.stats.sampleCount;n instanceof si&&(l=n._baseStartIndex),super(n.rawIdentifier,t,n.isFromTouch,Object.getPrototypeOf(n.path).constructor);let r=this._baseSource=n instanceof si?n._baseSource:n;this.stateToken=c!=null?c:n.stateToken;let d=a(h=>{let F=this.recognizerTranslation,y=A(p({},h),{targetX:h.targetX-F.x,targetY:h.targetY-F.y});return this.stateToken&&(y.stateToken=this.stateToken),(this.stateToken!=r.stateToken||this.stateToken!=n.stateToken)&&(y.item=this.currentRecognizerConfig.itemIdentifier(y,null)),y},"translateSample"),u=n.path.stats.lastSample;i?(this._baseStartIndex=l=Math.max(l+o-1,0),o=o>0?1:0):this._baseStartIndex=l,i?n.path.stats.sampleCount&&this._path.extend(n.path.stats.lastSample):this._path=n.path.clone(),this._path.translateCoordSystem(d),s?this._baseItem=n.baseItem:this._baseItem=u==null?void 0:u.item;let B=a(()=>this.path.terminate(!1),"completeHook"),b=a(()=>this.path.terminate(!0),"invalidatedHook"),I=a(h=>{super.update(d(h))},"stepHook");r.path.on("complete",B),r.path.on("invalidated",b),r.path.on("step",I),this.subviewDisconnector=()=>{r.path.off("complete",B),r.path.off("invalidated",b),r.path.off("step",I)},r.isPathComplete&&(this.path.terminate(r.path.wasCancelled),this.disconnect())}get recognizerTranslation(){if(this.recognizerConfigStack.length==1||!this.currentRecognizerConfig)return{x:0,y:0};let t=this.currentRecognizerConfig.targetRoot.getBoundingClientRect(),i=this.recognizerConfigStack[0].targetRoot.getBoundingClientRect();return{x:t.left-i.left,y:t.top-i.top}}get baseSource(){return this._baseSource}disconnect(){this.subviewDisconnector&&(this.subviewDisconnector(),this.subviewDisconnector=null)}pushRecognizerConfig(n){throw new Error("Pushing and popping of recognizer configurations should only be called on the base GestureSource")}popRecognizerConfig(){throw new Error("Pushing and popping of recognizer configurations should only be called on the base GestureSource")}update(n){throw new Error("Updates should be provided through the base GestureSource.")}terminate(n){this.baseSource.terminate(n)}};a(si,"GestureSourceSubview");var re=si;var hs=class hs extends ye{constructor(t,i,s){super(t,i,s,ut);this.stateToken=null}initPath(){return new ut}static deserialize(t,i){let s=i!==void 0?i:this._jsonIdSeed++,c=t.isFromTouch,l=ut.deserialize(t.path),o=new hs(s,null,c);return o._path=l,o}};a(hs,"GestureDebugSource");var bs=hs;var ci=class ci extends S.default{constructor(t){var i;super();this._activeTouchpoints=[];this.identifierMap={};this.config=t,this.sourceConstructor=(i=t==null?void 0:t.recordingMode)==null||i?bs:ye}createTouchpoint(t,i){let s=ci.IDENTIFIER_SEED++;this.identifierMap[t]=s;let c=new this.sourceConstructor(s,this.config,i);return c.stateToken=this.stateToken,c}fulfillInputStart(t){}maintainTouchpoints(t){t||(t=[]),this._activeTouchpoints.filter(i=>!t.includes(i)).forEach(i=>i.terminate(!0))}hasActiveTouchpoint(t){return this.identifierMap[t]!==void 0}getTouchpointWithId(t){let i=this.identifierMap[t];return this._activeTouchpoints.find(s=>s.rawIdentifier==i)}getConfigForId(t){return this.getTouchpointWithId(t).currentRecognizerConfig}getStateTokenForId(t){var i;return(i=this.getTouchpointWithId(t).stateToken)!=null?i:null}dropTouchpoint(t){let i=t.rawIdentifier;this._activeTouchpoints=this._activeTouchpoints.filter(s=>t!=s);for(let s of Object.keys(this.identifierMap)){let c=Number.parseInt(s,10);this.identifierMap[c]==i&&delete this.identifierMap[c]}}addTouchpoint(t){this._activeTouchpoints.push(t)}get activeSources(){return[].concat(this._activeTouchpoints)}};a(ci,"InputEngineBase"),ci.IDENTIFIER_SEED=0;var Fs=ci;function Wl(g,n,t){let i=g.targetRoot.getBoundingClientRect();return{clientX:n,clientY:t,targetX:n-i.left,targetY:t-i.top}}a(Wl,"processSampleClientCoords");var Al=class Al extends Fs{buildSampleFor(n,t,i,s,c){var d,u;let l=A(p({},Wl(this.config,n,t)),{t:s,stateToken:(d=c==null?void 0:c.stateToken)!=null?d:this.stateToken}),r=((u=c==null?void 0:c.currentRecognizerConfig.itemIdentifier)!=null?u:this.config.itemIdentifier)(l,i);return l.item=r,l}onInputStart(n,t,i,s){let c=this.createTouchpoint(n,s);c.update(t),this.addTouchpoint(c),c.path.on("invalidated",()=>{this.dropTouchpoint(c)}),c.path.on("complete",()=>{this.dropTouchpoint(c)});try{this.emit("pointstart",c)}catch(l){Le("Engine-internal error while initializing gesture matching for new source",l)}return c}onInputMove(n,t,i){if(n)try{n.update(t)}catch(s){Le("Error occurred while updating source",s)}}onInputMoveCancel(n,t,i){if(n)try{n.update(t),n.path.terminate(!0)}catch(s){Le("Error occurred while cancelling further input for source",s)}}onInputEnd(n,t){if(n)try{n.path.terminate(!1)}catch(i){Le("Error occurred while finalizing input for source",i)}}};a(Al,"InputEventEngine");var Bn=Al;var Ve=class Ve{constructor(){}static getCoordZoneBitmask(n,t){let i=t.getBoundingClientRect(),s=0;return s|=n.clientX<i.left?Ve.FAR_LEFT:0,s|=n.clientX>i.right?Ve.FAR_RIGHT:0,s|=n.clientY<i.top?Ve.FAR_TOP:0,s|=n.clientY>i.bottom?Ve.FAR_BOTTOM:0,s}static inputStartOutOfBoundsCheck(n,t){return!!this.getCoordZoneBitmask(n,t.inputStartBounds)}static inputStartSafeBoundProximityCheck(n,t){return this.getCoordZoneBitmask(n,t.paddedSafeBounds)}static inputMoveCancellationCheck(n,t,i){return i=i||0,this.getCoordZoneBitmask(n,t.maxRoamingBounds)?!0:!!(this.getCoordZoneBitmask(n,t.safeBounds)&~i)}};a(Ve,"ZoneBoundaryChecker"),Ve.FAR_TOP=8,Ve.FAR_LEFT=4,Ve.FAR_BOTTOM=2,Ve.FAR_RIGHT=1;var Je=Ve;var Rl=class Rl extends Bn{constructor(t){super(t);this.hasActiveClick=!1;this.disabledSafeBounds=0;this.currentSource=null;this.activeIdentifier=0;this._mouseStart=i=>this.onMouseStart(i),this._mouseMove=i=>this.onMouseMove(i),this._mouseEnd=i=>this.onMouseEnd(i)}get eventRoot(){return this.config.mouseEventRoot}registerEventHandlers(){this.eventRoot.addEventListener("mousedown",this._mouseStart,!0),this.eventRoot.addEventListener("mousemove",this._mouseMove,!1),this.eventRoot.addEventListener("mouseup",this._mouseEnd,!0)}unregisterEventHandlers(){this.eventRoot.removeEventListener("mousedown",this._mouseStart,!0),this.eventRoot.removeEventListener("mousemove",this._mouseMove,!1),this.eventRoot.removeEventListener("mouseup",this._mouseEnd,!0)}preventPropagation(t){t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1,typeof t.stopImmediatePropagation=="function"?t.stopImmediatePropagation():typeof t.stopPropagation=="function"&&t.stopPropagation()}buildSampleFromEvent(t){return this.buildSampleFor(t.clientX,t.clientY,t.target,performance.now(),this.currentSource)}onMouseStart(t){if(!this.config.targetRoot.contains(t.target))return;this.preventPropagation(t);let i=this.buildSampleFromEvent(t);Je.inputStartOutOfBoundsCheck(i,this.config)||(this.disabledSafeBounds=Je.inputStartSafeBoundProximityCheck(i,this.config));let s=this.onInputStart(this.activeIdentifier,i,t.target,!1);this.currentSource=s;let c=a(()=>{this.currentSource=null},"cleanup");s.path.on("complete",c),s.path.on("invalidated",c)}onMouseMove(t){let i=this.currentSource;if(!i)return;let s=this.buildSampleFromEvent(t);if(!t.buttons){this.hasActiveClick&&(this.hasActiveClick=!1,this.onInputMoveCancel(i,s,t.target));return}this.preventPropagation(t);let c=i.currentRecognizerConfig;Je.inputMoveCancellationCheck(s,c,this.disabledSafeBounds)?this.onInputMoveCancel(i,s,t.target):this.onInputMove(i,s,t.target)}onMouseEnd(t){let i=this.currentSource;i&&(t.buttons||(this.hasActiveClick=!1),this.onInputEnd(i,t.target))}};a(Rl,"MouseEventEngine");var ys=Rl;function Jr(g){let n=[];for(let t=0;t<g.length;t++)n.push(g.item(t));return n}a(Jr,"touchListToArray");var Hl=class Hl extends Bn{constructor(t){super(t);this.eventDispatcher=new ds;this.safeBoundMaskMap={};this.pendingSourcePromises=new Map;this.inputStartSignalMap=new Map;this._touchStart=i=>this.onTouchStart(i),this._touchMove=i=>this.onTouchMove(i),this._touchEnd=i=>this.onTouchEnd(i)}get eventRoot(){return this.config.touchEventRoot}registerEventHandlers(){this.eventRoot.addEventListener("touchstart",this._touchStart,{capture:!0,passive:!1}),this.eventRoot.addEventListener("touchmove",this._touchMove,{capture:!1,passive:!1}),this.eventRoot.addEventListener("touchend",this._touchEnd,{capture:!0,passive:!1})}unregisterEventHandlers(){this.eventRoot.removeEventListener("touchstart",this._touchStart,!0),this.eventRoot.removeEventListener("touchmove",this._touchMove,!1),this.eventRoot.removeEventListener("touchend",this._touchEnd,!0)}preventPropagation(t){t.cancelable&&t.preventDefault(),typeof t.stopImmediatePropagation=="function"?t.stopImmediatePropagation():typeof t.stopPropagation=="function"&&t.stopPropagation()}dropTouchpoint(t){super.dropTouchpoint(t);for(let i of Object.keys(this.safeBoundMaskMap)){let s=Number.parseInt(i,10);this.getTouchpointWithId(s)==t&&delete this.safeBoundMaskMap[s]}}fulfillInputStart(t){let i=this.inputStartSignalMap.get(t);i&&(this.inputStartSignalMap.delete(t),i.resolve())}hasActiveTouchpoint(t){return super.hasActiveTouchpoint(t)||!!this.pendingSourcePromises.has(t)}buildSampleFromTouch(t,i,s){return this.buildSampleFor(t.clientX,t.clientY,t.target,i,s)}onTouchStart(t){if(!this.config.targetRoot.contains(t.target))return;this.preventPropagation(t);let i=Jr(t.touches),s=Jr(t.changedTouches),l=i.filter(r=>s.findIndex(d=>r.identifier==d.identifier)==-1).map(r=>this.pendingSourcePromises.get(r.identifier));this.eventDispatcher.runAsync(()=>R(this,null,function*(){let r=yield Promise.all(l);return this.maintainTouchpoints(r),this.eventDispatcher.defaultWait}));let o=new Map;for(let r=0;r<t.changedTouches.length;r++){let d=t.changedTouches.item(r),u=new f;this.pendingSourcePromises.set(d.identifier,u),o.set(d.identifier,u)}this.eventDispatcher.runAsync(()=>{let r=performance.now(),d=null;for(let u=0;u<t.changedTouches.length;u++){let B=t.changedTouches.item(u),b=B.identifier,I=this.buildSampleFromTouch(B,r,null);if(!Je.inputStartOutOfBoundsCheck(I,this.config))this.safeBoundMaskMap[b]=Je.inputStartSafeBoundProximityCheck(I,this.config);else{o.get(b).resolve(null);continue}d=this.onInputStart(b,I,t.target,!0);let h=o.get(b);h.resolve(d);let F=a(()=>{this.pendingSourcePromises.get(b)==h&&this.pendingSourcePromises.delete(b)},"cleanup");d.path.on("complete",F),d.path.on("invalidated",F)}if(d){let u=new f;return this.inputStartSignalMap.set(d,u),u.corePromise}else return Promise.resolve()})}onTouchMove(t){var s;for(let c=0;c<t.touches.length;c++){let l=t.touches.item(c);if(this.hasActiveTouchpoint(l.identifier)){this.preventPropagation(t);break}}let i=new Map;for(let c=0;c<t.touches.length;c++){let l=t.touches.item(c).identifier;i.set(l,(s=this.pendingSourcePromises.get(l))==null?void 0:s.corePromise)}this.eventDispatcher.runAsync(()=>R(this,null,function*(){let c=yield Promise.all(i.values());return this.maintainTouchpoints(c),this.eventDispatcher.defaultWait})),this.eventDispatcher.runAsync(()=>R(this,null,function*(){let c=performance.now();for(let l=0;l<t.touches.length;l++){let o=t.touches.item(l),r=o.identifier,d=yield i.get(r);if(!d||d.isPathComplete)continue;let u=d.currentRecognizerConfig,B=this.buildSampleFromTouch(o,c,d);Je.inputMoveCancellationCheck(B,u,this.safeBoundMaskMap[r])?this.onInputMoveCancel(d,B,o.target):this.onInputMove(d,B,o.target)}return this.eventDispatcher.defaultWait}))}onTouchEnd(t){var s;for(let c=0;c<t.changedTouches.length;c++){let l=t.changedTouches.item(c);if(this.hasActiveTouchpoint(l.identifier)){this.preventPropagation(t);break}}let i=new Map;for(let c=0;c<t.changedTouches.length;c++){let l=t.changedTouches.item(c).identifier,o=(s=this.pendingSourcePromises.get(l))==null?void 0:s.corePromise;i.set(l,o)}this.eventDispatcher.runAsync(()=>R(this,null,function*(){for(let c=0;c<t.changedTouches.length;c++){let l=t.changedTouches.item(c),o=yield i.get(l.identifier);!o||o.isPathComplete||this.onInputEnd(o,t.target)}return this.eventDispatcher.defaultWait}))}};a(Hl,"TouchEventEngine");var ms=Hl;var fl=class fl{get promise(){return this.publishedPromise.corePromise}constructor(n,t,i){if(!n||!t)throw new Error("A gesture-path source and contact-path model must be specified.");if(this.model=n,this.publishedPromise=new f,this.source=t,this.inheritedStats=i,this.lastStats=null,n.timer){let s=n.timer.inheritElapsed?Math.min(t.path.stats.duration,n.timer.duration):0;this.timerPromise=new ze(n.timer.duration-s),this.publishedPromise.then(()=>{this.timerPromise.resolve(!1)}),this.timerPromise.then(c=>{let l=t instanceof re?t.baseSource:t,o=performance.now();!l.isPathComplete&&l.currentSample.t!=o&&l.path.extend(A(p({},l.currentSample),{t:o})),c!=n.timer.expectedResult&&this.finalize(!1,"timer"),this.finalize(!0,"timer")})}}finalize(n,t){if(this.publishedPromise.isFulfilled)return this._result;let i=this.model;i.validateItem&&n&&(n=i.validateItem(this.source.path.stats.lastSample.item,this.baseItem));let s;return n?s={type:i.pathResolutionAction,cause:t}:s={type:"reject",cause:t},this.publishedPromise.resolve(s),this._result=s,s}get stats(){return this.source.path.stats}get baseItem(){return this.source.baseItem}get lastItem(){return this.source.currentSample.item}update(){let n=this.model,t=this.source;if(t.path.wasCancelled)return this.finalize(!1,"path");if(n.itemChangeAction&&t.path.stats.sampleCount>0&&t.currentSample.item!=t.baseItem){let i=n.itemChangeAction=="resolve";return this.finalize(i,"item")}else{let i=n.pathModel.evaluate(t.path,this.lastStats,t.baseItem,this.inheritedStats)||"continue";return this.lastStats=t.path.stats,i!="continue"?this.finalize(i=="resolve","path"):t.path.isComplete?this.finalize(!1,"path"):{type:"continue"}}}};a(fl,"PathMatcher");var In=fl;var Ll=class Ll{constructor(n,t){this._isCancelled=!1;var o;if(!n||!t)throw new Error("Construction of GestureMatcher requires a gesture-model spec and a source for related contact points.");if(!n.sustainTimer&&!t)throw new Error("If the provided gesture-model spec lacks a sustain timer, there must be an active contact point.");let i=t instanceof ye?null:t,s=i?null:t;this.predecessor=i,this.publishedPromise=new f,this.model=n,n.sustainTimer&&(this.sustainTimerPromise=new ze(n.sustainTimer.duration),this.sustainTimerPromise.then(r=>{let d=n.sustainTimer.expectedResult==r;this.finalize(d,"timer")})),this.pathMatchers=[];let l=(s?[s]:i.sources).map(r=>s&&r==s?s:r.isPathComplete?null:r).reduce((r,d)=>d?r.concat(d):r,[]);if(n.sustainTimer&&l.length>0){this.finalize(!1,"path");return}else!n.sustainTimer&&l.length==0&&this.finalize(!1,"path");for(let r=0;r<l.length;r++){let d=l[r];d instanceof re&&d.disconnect();let u=n.contacts[r];if(!u)throw new Error(`No contact model for inherited path: gesture "${n.id}', entry ${r}`);let B=(o=u==null?void 0:u.model.pathInheritance)!=null?o:"chop",b=!1,I;switch(B){case"reject":this.finalize(!1,"path");return;case"full":I=d.constructSubview(!1,!0),this.addContactInternal(I,d.path.stats,!0);continue;case"partial":b=!0;case"chop":I=d.constructSubview(!0,b),this.addContactInternal(I,d.path.stats,!0);break}}}get sources(){return this.pathMatchers.map((n,t)=>{if(!this.model.contacts[t].resetOnInstantFulfill)return n.source}).filter(n=>!!n)}get promise(){return this.publishedPromise.corePromise}cancel(){this._isCancelled=!0,this._result||this.finalize(!1,"cancelled")}get isCancelled(){return this._isCancelled}finalize(n,t){var i,s;if(this.publishedPromise.isFulfilled)return this._result;try{let c;n?c=this.model.resolutionAction:(t!="cancelled"&&((i=this.model.rejectionActions)!=null&&i[t])&&(c=this.model.rejectionActions[t],c.item="none"),c=c||{type:"none",item:"none"});let l;switch((s=c.item)!=null?s:"current"){case"none":l=null;break;case"base":l=this.primaryPath.baseItem;break;case"current":l=this.primaryPath.currentSample.item;break}let r={matched:n,action:A(p({},c),{item:l})};return this.publishedPromise.resolve(r),this._result=r,r}catch(c){return this.publishedPromise.reject(c),{matched:!1,action:{type:"none",item:null}}}}finalizeSources(){if(!this._result)throw Error("Invalid state for source-finalization - the matcher's evaluation of the gesture model is not yet complete");let n=this._result.matched;for(let t=0;t<this.pathMatchers.length;t++){let i=this.pathMatchers[t],s=this.model.contacts[t];i.source.isPathComplete||(n&&s.endOnResolve||!n&&s.endOnReject)&&i.source.terminate(!1)}}get primaryPath(){let n,t=Number.NEGATIVE_INFINITY;for(let i of this.pathMatchers)i.model.itemPriority>t&&(t=i.model.itemPriority,n=i);return!n&&this.predecessor?this.predecessor.primaryPath:n==null?void 0:n.source}get baseItem(){return this.primaryPath.baseItem}get currentItem(){return this.primaryPath.currentSample.item}get allSourceIds(){let n=this.sources.map(i=>i.identifier),t=this.predecessor?this.predecessor.allSourceIds:[];return n=n.filter(i=>t.indexOf(i)==-1),n.concat(t)}mayAddContact(){return this.pathMatchers.length<this.model.contacts.length}addContact(n){let t=this.pathMatchers.length;if(!this.mayAddContact())throw new Error(`The specified gesture model does not support more than ${t} contact points.`);this.addContactInternal(n.constructSubview(!1,!0),null)}get result(){return this._result}addContactInternal(n,t,i){var u;let s=this.pathMatchers.length,c=this.model.contacts[s],l=new In(c.model,n,new ve(t));this.pathMatchers.push(l);let o=null,r=null;if(!s&&this.predecessor&&this.model.sustainTimer){o=this.predecessor.primaryPath;let B=(u=this.model.sustainTimer.baseItem)!=null?u:"result",b;switch(B){case"none":r=null;break;case"base":r=this.predecessor.primaryPath.baseItem,b=this.predecessor.primaryPath.stateToken;break;case"result":r=this.predecessor.result.action.item,b=this.predecessor.primaryPath.currentSample.stateToken;break}n.baseItem=r!=null?r:n.baseItem,n.stateToken=b,n.currentSample.stateToken=b,n.currentRecognizerConfig&&(n.currentSample.item=n.currentRecognizerConfig.itemIdentifier(n.currentSample,null))}else r=this.primaryPath.baseItem,o=this.primaryPath;if(c.model.baseCoordReplacer){let B=n.path.stats,b=c.model.baseCoordReplacer(B,r);if(b){let I=A(p({},Wl(n.currentRecognizerConfig,b.clientX,b.clientY)),{t:b.t||b.t===0?b.t:B.initialSample.t,item:r,stateToken:n.stateToken});n.path.replaceInitialSample(I)}}if(c.model.allowsInitialState&&!c.model.allowsInitialState(n.currentSample,o.currentSample,r,o.stateToken)){this.pathMatchers.pop(),this.finalize(!1,"cancelled");return}let d=l.update();if((d==null?void 0:d.type)=="reject"){this.finalize(!1,i?"cancelled":"path");return}l.promise.then(B=>{this.finalize(B.type=="resolve",B.cause)})}update(){this.pathMatchers.forEach(n=>{try{n.update()}catch(t){console.error(t),this.finalize(!1,"cancelled")}})}};a(Ll,"GestureMatcher");var ft=Ll;var vl=class vl extends S.default{constructor(t){super();this._sourceSelector=[];this.potentialMatchers=[];this.sustainMode=!1;this.attemptSynchronousUpdate=a(()=>{let i=this._sourceSelector.filter(c=>!c.source.isPathComplete).map(c=>c.source.currentSample.t),s=i[0];i.find(c=>s!=c)||this.potentialMatchers.forEach(c=>c.update())},"attemptSynchronousUpdate");this.baseGestureSetId=t||"default"}potentialMatchersForSource(t){return this.potentialMatchers.filter(i=>i.allSourceIds.find(s=>s==t.identifier))}cascadeTermination(){let t=this.potentialMatchers,i=t.filter(o=>!o.model.sustainWhenNested),s=t.filter(o=>o.model.sustainWhenNested);this.potentialMatchers=s;let c=s.map(o=>o.allSourceIds).reduce((o,r)=>{for(let d of r)o.indexOf(d)==-1&&o.push(d);return o},[]);return this._sourceSelector.filter(o=>!c.find(r=>r==o.source.identifier)).forEach(o=>{o.matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}});let r=this._sourceSelector.indexOf(o);r>-1&&this._sourceSelector.splice(r,1)}),i.forEach(o=>o.cancel()),this.sustainMode=!0,this._sourceSelector.map(o=>o.source)}matchGesture(t,i){return R(this,null,function*(){let s=t instanceof ye,c=a(I=>{let h=I.sources.map(F=>F.baseSource);return h&&h.length>0?h:I.predecessor?c(I.predecessor):[]},"determinePredecessorSources"),l=s?[t instanceof re?t.baseSource:t]:c(t),o=s?t:null,r=s?null:t;if(this.pendingMatchSetup){let I=this.pendingMatchSetup,h=new f;this.pendingMatchSetup=h.corePromise,yield I,this.pendingMatchSetup==h.corePromise&&(this.pendingMatchSetup=null),h.resolve()}s&&o.path.on("invalidated",()=>{this.dropSourcesWithIds([o.identifier])});let d=new f,u=l.map(I=>{let h={source:I,matchPromise:d,preserve:!0};return this._sourceSelector.push(h),h}),B=u.map(I=>I.matchPromise);if(s){let I=this.potentialMatchers.filter(h=>h.mayAddContact());if(I.forEach(h=>{h.addContact(o),h.promise.then(this.matcherSelectionFilter(h,B))}),I.length>0){let h=this.stateToken,F=new f;this.pendingMatchSetup=F.corePromise,yield de(0),yield de(0),this.pendingMatchSetup==F.corePromise&&(this.pendingMatchSetup=null),F.resolve();let y=this.stateToken;if(h!=y){let x=o.currentSample;o.stateToken=y,x.stateToken=y,x.item=t.currentRecognizerConfig.itemIdentifier(x,null),o.baseItem=x.item}let G=I.find(x=>x.result);if(G&&G.allSourceIds.includes(t.identifier))return d.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),{selectionPromise:d.corePromise}}}if(u.forEach(I=>{I.preserve=!1}),this.sustainMode&&o)return d.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),{selectionPromise:d.corePromise,sustainModeWithoutMatch:!0};let b=i.map(I=>{try{return new ft(I,o||r)}catch(h){return console.error(h),null}}).filter(I=>!!I);b=b.filter(I=>!I.result||I.result.matched!==!1);for(let I of b)I.promise.then(this.matcherSelectionFilter(I,B));return b.length>0?this.potentialMatchers=this.potentialMatchers.concat(b):d.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),this.potentialMatchers.sort((I,h)=>h.model.resolutionPriority-I.model.resolutionPriority),this.resetSourceHooks(),{selectionPromise:d.corePromise}})}resetSourceHooks(){let t=a(i=>{let s=i;s.path.off("step",this.attemptSynchronousUpdate),s.path.off("complete",this.attemptSynchronousUpdate),s.path.off("invalidated",this.attemptSynchronousUpdate),s.path.on("step",this.attemptSynchronousUpdate),s.path.on("complete",this.attemptSynchronousUpdate),s.path.on("invalidated",this.attemptSynchronousUpdate)},"resetHooks");this._sourceSelector.forEach(i=>t(i.source))}dropSourcesWithIds(t){for(let i of t){let s=this._sourceSelector.findIndex(c=>c.source.identifier==i);s>-1&&this._sourceSelector.splice(s,1)[0].matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"none",item:null}}})}}matchersForSource(t){return this.potentialMatchers.filter(i=>!!i.sources.find(s=>s.identifier==t.identifier))}matcherSelectionFilter(t,i){return s=>R(this,null,function*(){t.isCancelled?s={matched:!1,action:{type:"none",item:null}}:t.finalizeSources();let l=t.allSourceIds.map(r=>this._sourceSelector.find(d=>d.source.identifier==r)).filter(r=>!!r),o=this.potentialMatchers.indexOf(t);if(o!=-1){if(this.potentialMatchers.splice(o,1),s.action.type=="none"){this.finalizeMatcherlessTrackers(l);return}if(s.matched)for(let r of l){let d=this.matchersForSource(r.source);this.potentialMatchers=this.potentialMatchers.filter(u=>!d.find(B=>u==B)),d.forEach(u=>{u.cancel()}),this._sourceSelector=this._sourceSelector.filter(u=>!l.find(B=>u==B)),r.matchPromise.resolve({matcher:t,result:s})}else{let r=a(d=>{if(this.sustainMode&&!d.sustainWhenNested){this.finalizeMatcherlessTrackers(l);return}let u=new ft(d,t);if(u.result&&u.result.matched==!1){this.finalizeMatcherlessTrackers(l);return}u.promise.then(this.matcherSelectionFilter(u,l.map(B=>B.matchPromise))),this.potentialMatchers.push(u),this.resetSourceHooks()},"replacer");this.emit("rejectionwithaction",{matcher:t,result:s},r);return}}})}finalizeMatcherlessTrackers(t){let i=t.map(s=>({tracker:s,pendingCount:this.potentialMatchers.filter(c=>!!c.allSourceIds.find(l=>s.source.identifier==l)).length}));for(let s of i)s.pendingCount==0&&!s.tracker.preserve&&s.tracker.matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}})}};a(vl,"MatcherSelector");var Bt=vl;var Nl=class Nl{get currentSourceIds(){return this.sources.map(n=>n.identifier)}constructor(n,t){var c,l;let{matcher:i,result:s}=n;this.gestureSetId=t,this.matchedId=i==null?void 0:i.model.id,this.linkType=s.action.type,this.item=s.action.item,this.sources=i==null?void 0:i.sources,(c=this.sources)==null||c.forEach(o=>o.disconnect()),(l=this.sources)==null||l.sort((o,r)=>(i==null?void 0:i.primaryPath)==o?-1:(i==null?void 0:i.primaryPath)==r?1:0),this.allSourceIds=(i==null?void 0:i.allSourceIds)||[]}get interval(){return this.sources.length==0?void 0:this.sources.map(t=>({start:t.path.stats.initialSample.t,end:t.path.stats.lastTimestamp})).reduce((t,i)=>({start:t.start>i.start?i.start:t.start,end:t.end<i.end?i.end:t.end}),{start:Number.POSITIVE_INFINITY,end:Number.NEGATIVE_INFINITY})}};a(Nl,"GestureStageReport");var li=Nl,kl=class kl extends S.default{constructor(t,i,s,c){super();this.selectionHandler=a(t=>R(this,null,function*(){var u,B,b,I,h,F,y,G,x,Z;let i=((u=this.pushedSelector)==null?void 0:u.baseGestureSetId)||((B=this.selector)==null?void 0:B.baseGestureSetId),s=new li(t,i);t.matcher&&this.stageReports.push(s);let c=(b=t.matcher)!=null?b:this.stageReports[this.stageReports.length-1],l=(I=c==null?void 0:c.sources.map(U=>U instanceof re?U.baseSource:U))!=null?I:[],o=t.result.action.type;if((o=="complete"||o=="none")&&(l.forEach(U=>{U.isPathComplete||U.terminate(o=="none")}),!t.result.matched)){this.markedComplete||this.emit("complete");return}if(o=="complete"&&this.touchpointCoordinator&&this.pushedSelector){let H=((h=this.touchpointCoordinator)==null?void 0:h.sustainSelectorSubstack(this.pushedSelector)).map(L=>{let v=new f;return L.path.on("invalidated",()=>v.resolve()),L.path.on("complete",()=>v.resolve()),v.corePromise});H.length>0&&t.result.action.awaitNested&&(yield Promise.all(H),yield de(0)),(F=this.touchpointCoordinator)==null||F.popSelector(this.pushedSelector),this.pushedSelector=null}this.emit("stage",s,U=>{U.type=="pop"?l.forEach(H=>H.popRecognizerConfig()):l.forEach(H=>H.pushRecognizerConfig(U.config))});let r=!1;this.touchpointCoordinator&&(r=!this.touchpointCoordinator.selectorStackIncludes(this.selector));let d=Jl(t.result.action,this.gestureConfig,this.baseGestureSetId);if(r&&(d=d.filter(U=>U.sustainWhenNested)),d.length>0){if(!(o=="chain"&&t.result.action.selectionMode==((y=this.pushedSelector)==null?void 0:y.baseGestureSetId))){if(this.pushedSelector&&(this.pushedSelector.off("rejectionwithaction",this.modelResetHandler),(G=this.touchpointCoordinator)==null||G.popSelector(this.pushedSelector),this.pushedSelector=null),o=="chain"){let L=t.result.action.selectionMode;if(L){let v=new Bt(L);v.on("rejectionwithaction",this.modelResetHandler),this.pushedSelector=v,(x=this.touchpointCoordinator)==null||x.pushSelector(v)}}}((Z=this.pushedSelector)!=null?Z:this.selector).matchGesture(t.matcher,d).then(L=>R(this,null,function*(){return this.selectionHandler(yield L.selectionPromise)}))}else this.markedComplete||this.emit("complete")}),"selectionHandler");this.modelResetHandler=a((t,i)=>{let s=t.matcher.allSourceIds;if(!this.allSourceIds.find(c=>s.indexOf(c)==-1))if(t.result.action.type=="replace")i(Ht(this.gestureConfig,t.result.action.replace));else throw new Error("Missed a case in implementation!")},"modelResetHandler");this.stageReports=[],this.selector=s,this.selector.on("rejectionwithaction",this.modelResetHandler),this.once("complete",()=>{var l;this.completionTime=performance.now(),this.pushedSelector&&((l=this.touchpointCoordinator)==null||l.popSelector(this.pushedSelector),this.pushedSelector=null),this.selector.off("rejectionwithaction",this.modelResetHandler),this.selector.dropSourcesWithIds(this.allSourceIds),this.selector=null}),this.gestureConfig=i,this.touchpointCoordinator=c,Promise.resolve().then(()=>this.selectionHandler(t))}get markedComplete(){return this.completionTime!==void 0}get allSourceIds(){var t,i;return(i=(t=this.stageReports[this.stageReports.length-1])==null?void 0:t.allSourceIds)!=null?i:[]}get baseGestureSetId(){var t,i;return(i=(t=this.selector)==null?void 0:t.baseGestureSetId)!=null?i:null}get potentialModelMatchIds(){if(!this.selector)return[];let t=[this.selector];return this.pushedSelector&&t.push(this.pushedSelector),this.stageReports[this.stageReports.length-1].sources.map(l=>t.map(o=>o.potentialMatchersForSource(l).map(r=>r.model.id))).reduce((l,o)=>l.concat(o)).reduce((l,o)=>{for(let r of o)l.indexOf(r)==-1&&l.push(r);return l},[])}cancel(){this.stageReports[this.stageReports.length-1].sources.forEach(i=>i.baseSource.isPathComplete||i.baseSource.terminate(!0)),this.markedComplete||this.emit("complete")}toJSON(){return this.stageReports}trace(t){t||(t="  ");let i=a(l=>l.length==0?"<empty>":l.length==1?l[0]:l.join(", "),"logTouches"),s=a(l=>l?l.start==l.end?`@ ${l.start.toFixed(2)} ms`:`from ${l.start.toFixed(2)} ms - ${l.end.toFixed(2)} ms`:"","logInterval"),c=this.stageReports.map(l=>t+`${i(l.currentSourceIds)} - ${l.matchedId} ${s(l.interval)}`).reverse();return this.markedComplete&&c.unshift(t+`complete @ ${this.completionTime}`),c.join(`
`)}};a(kl,"GestureSequence");var bn=kl;function Jl(g,n,t){switch(g.type){case"none":case"complete":return[];case"replace":return[Ht(n,g.replace)];case"chain":return[Ht(n,g.next)];default:throw new Error("Unexpected case arose within `processGestureAction` method")}}a(Jl,"modelSetForAction");var El=class El extends S.default{constructor(t,i,s){super();this.selectorStack=[new Bt];this._activeSources=[];this._activeGestures=[];this._history=[];this.modelResetHandler=a((t,i)=>{let s=t.matcher.allSourceIds;if(!this.activeGestures.find(c=>c.allSourceIds.find(l=>s.indexOf(l)!=-1)))if(t.result.action.type=="replace")i(Ht(this.gestureModelDefinitions,t.result.action.replace));else throw new Error("Missed a case in implementation!")},"modelResetHandler");this.onNewTrackedPath=a(t=>R(this,null,function*(){this.addSimpleSourceHooks(t);let i=this.gestureModelDefinitions,s,c;do{s=this.currentSelector;let B=yield s.matchGesture(t,xl(i,s.baseGestureSetId));if(B.sustainModeWithoutMatch){let b=a(I=>{I.stateToken=this.stateToken,I.item=t.currentRecognizerConfig.itemIdentifier(I,null)},"correctSample");t.path instanceof ut&&t.path.coords.forEach(b),t.stateToken=this.stateToken,t.baseItem=t.path.stats.initialSample.item,b(t.path.stats.initialSample),b(t.path.stats.lastSample);continue}else{c=B.selectionPromise;break}}while(s!=this.currentSelector);let l=this.currentSelector;t.setGestureMatchInspector(this.buildGestureMatchInspector(l));let o=a(()=>{this.recordHistory(t)},"preGestureScribe");try{t.path.on("invalidated",o),this.emit("inputstart",t)}catch(B){Le("Error from 'inputstart' event listener",B)}this.inputEngines.forEach(B=>{B.fulfillInputStart(t)});let r=yield c;if(!r||r.result.matched==!1)return;let d=r.matcher.allSourceIds;for(let B of this._activeGestures)if(B.allSourceIds.find(b=>!!d.find(I=>b==I)))return;let u=new bn(r,i,this.currentSelector,this);this._activeGestures.push(u),u.on("complete",()=>{let B=this._activeGestures.indexOf(u);B!=-1&&this._activeGestures.splice(B,1)}),t.path.wasCancelled||(t.path.off("invalidated",o),u.on("complete",()=>this.recordHistory(u))),this.emit("recognizedgesture",u)}),"onNewTrackedPath");if(this.historyMax=s>0?s:0,this.gestureModelDefinitions=t,this.inputEngines=[],i)for(let c of i)this.addEngine(c);this.selectorStack[0].on("rejectionwithaction",this.modelResetHandler)}pushSelector(t){this.selectorStack.push(t),t.on("rejectionwithaction",this.modelResetHandler)}sustainSelectorSubstack(t){if(!t)return[];let i=this.selectorStack.indexOf(t);if(i==-1)return[];if(this.selectorStack.length<=1)throw new Error("May not force the original, base gesture selector into sustain mode.");let s=[];for(let c=i;c<this.selectorStack.length;c++)t=this.selectorStack[c],s=s.concat(t.cascadeTermination());return s}popSelector(t){if(!t)return;let i=this.selectorStack.indexOf(t);if(i!=-1){if(this.selectorStack.length<=1)throw new Error("May not pop the original, base gesture selector.");for(;i<this.selectorStack.length;)t=this.selectorStack[i],t.off("rejectionwithaction",this.modelResetHandler),this.selectorStack.splice(i,1);this.currentSelector.stateToken=this.stateToken}}selectorStackIncludes(t){return this.selectorStack.includes(t)}get currentSelector(){return this.selectorStack[this.selectorStack.length-1]}buildGestureMatchInspector(t){return i=>{let s=this.selectorStack.indexOf(t);return this.selectorStack.slice(s).map(l=>l.potentialMatchersForSource(i).map(o=>o.model.id)).reduce((l,o)=>l.concat(o))}}addEngine(t){t.on("pointstart",this.onNewTrackedPath),this.inputEngines.push(t)}recordHistory(t){let i=this.historyMax;i>0&&(this._history.length==i&&this._history.shift(),this._history.push(t))}get activeGestures(){return[].concat(this._activeGestures)}get activeSources(){return[].concat(this.inputEngines.map(t=>t.activeSources).reduce((t,i)=>t.concat(i),[]))}get history(){return this._history}get historyJSON(){let t=a(function(i,s){return i=="item"?s==null?void 0:s.id:s},"sanitizingReplacer");return JSON.stringify(this.history,t,2)}get stateToken(){return this._stateToken}set stateToken(t){this._stateToken=t,this.inputEngines.forEach(i=>i.stateToken=t),this.currentSelector.stateToken=t}addSimpleSourceHooks(t){t.path.on("invalidated",()=>{let i=this.activeGestures.find(c=>c.allSourceIds.includes(t.identifier));i&&i.cancel();let s=this._activeSources.indexOf(t);this._activeSources=this._activeSources.splice(s,1)}),t.path.on("complete",()=>{let i=this._activeSources.indexOf(t);this._activeSources=this._activeSources.splice(i,1)})}};a(El,"TouchpointCoordinator");var Gs=El;var ps={};Kt(ps,{EMPTY_GESTURE_DEFS:()=>Zl,getGestureModel:()=>Ht,getGestureModelSet:()=>xl});var Yl=class Yl extends Gs{constructor(n,t){let i=Bs(t);n=n||Zl,super(n,null,i.historyLength),this.config=i,this.mouseEngine=new ys(this.config),this.touchEngine=new ms(this.config),this.mouseEngine.registerEventHandlers(),this.touchEngine.registerEventHandlers(),this.addEngine(this.mouseEngine),this.addEngine(this.touchEngine)}destroy(){this.activeGestures.forEach(n=>n.cancel()),this.activeSources.forEach(n=>n.terminate(!0)),this.mouseEngine.unregisterEventHandlers(),this.touchEngine.unregisterEventHandlers(),this.mouseEngine=null,this.touchEngine=null}};a(Yl,"GestureRecognizer");var Lt=Yl;var Tl={};Kt(Tl,{matchers:()=>Cs,specs:()=>ps});var Cs={};Kt(Cs,{GestureMatcher:()=>ft,GestureSequence:()=>bn,GestureStageReport:()=>li,MatcherSelector:()=>Bt,PathMatcher:()=>In,modelSetForAction:()=>Jl});function Qs(g,n){let t=new Map;return n.keys.forEach(i=>{let s=Math.abs(g.x-i.centerX),c=Math.abs(g.y-i.centerY),l,o;s>.5*i.width?(l=s-.5*i.width,s=.5):(l=0,s/=i.width),c>.5*i.height?(o=c-.5*i.height,c=.5):(o=0,c/=i.height),l*=n.kbdScaleRatio,l+=s*i.height,o+=c*i.height;let r=l*l+o*o;t.set(i.keySpec,r)}),t}a(Qs,"keyTouchDistances");function It(g){var s;let n=new Map,t=0;Array.isArray(g)||(g=[g]);for(let c of g)for(let l of c.keys()){let o=1/(Math.pow(c.get(l),2)+3e-5);t+=o,n.set(l,(s=n.get(l))!=null?s:0+o)}let i=[];for(let c of n.keys())i.push({keySpec:c,p:n.get(c)/t});return i.sort(function(c,l){return l.p-c.p})}a(It,"distributionFromDistanceMaps");var wl=["n","ne","e","se","s","sw","w","nw"],Nr=Math.PI,Ml=(()=>{let g=new Map,n=Nr/4;for(let t=0;t<wl.length;t++)g.set(wl[t],[n*t,1]);return g})();function Us(g){return Math.PI/4*wl.indexOf(g)}a(Us,"lockedAngleForDir");function ri(g,n){let t=Us(n),i=g.initialSample,s=g.lastSample.targetX-i.targetX,c=g.lastSample.targetY-i.targetY,l=Math.max(0,-c*Math.cos(t));return Math.max(0,s*Math.sin(t))+l}a(ri,"calcLockedDistance");function Ka(g,n,t,i){return s=>{let c=Us(n),l=i.flick.triggerDist-i.flick.dirLockDist,o=Math.max(0,ri(g.path.stats,n)-i.flick.dirLockDist),d=Math.min(1,.7*o/l),u=Math.sin(c)*d,B=-Math.cos(c)*d;t==null||t.scrollFlickPreview(u,B)}}a(Ka,"buildFlickScroller");var xs=Math.PI/3,zl=class zl{constructor(n,t,i,s,c,l){this.directlyEmitsKeys=!0;this.sequence=n,this.gestureParams=c,this.baseSpec=s.key.spec,this.baseKeyDistances=i.getSimpleTapCorrectionDistances(n.stageReports[0].sources[0].path.stats.initialSample,this.baseSpec);let o=n.stageReports[0].sources[0].baseSource,r=o;n.on("complete",()=>{l==null||l.cancel(),this.baseSpec}),this.sequence.on("stage",u=>{var h;let B=r.path.stats;this.computedFlickDistribution=this.flickDistribution(B,!0);let b=this.computedFlickDistribution[0].keySpec;if(u.matchedId=="flick-restart"){r.path.replaceInitialSample(u.sources[0].path.stats.initialSample);return}if(u.matchedId=="flick-reset-centering"){r=o.constructSubview(!0,!0);return}else if(u.matchedId=="flick-reset-end"){this.emitKey(i,this.baseSpec,r.path.stats);return}else if(u.matchedId=="flick-reset"){this.flickScroller&&(this.flickScroller(r.currentSample),r.path.off("step",this.flickScroller)),this.lockedDir=null,this.lockedSelectable=null,r instanceof re&&r.disconnect();return}else if(u.matchedId=="flick-mid"){if(b==this.baseSpec)return;let F=Object.keys(this.baseSpec.flick).find(y=>this.baseSpec.flick[y]==b);this.lockedDir=F,this.lockedSelectable=b,this.flickScroller&&r.path.off("step",this.flickScroller),this.flickScroller=Ka(r,F,l,this.gestureParams),this.flickScroller(r.currentSample),r.path.on("step",this.flickScroller);return}let I=(h=this.lockedSelectable)!=null?h:b;this.emitKey(i,I,B)});let d=this.buildPopupRecognitionConfig(i);t({type:"push",config:d})}emitKey(n,t,i){let s;ri(i,this.lockedDir)>this.gestureParams.flick.triggerDist?s=n.keyEventFromSpec(t):s=n.keyEventFromSpec(this.baseSpec),s.keyDistribution=this.currentStageKeyDistribution(this.baseKeyDistances),s.inputBreadcrumb=this.sequence.trace(),n.raiseKeyEvent(s,null)}buildPopupRecognitionConfig(n){let t={getBoundingClientRect(){let i=Number.MAX_SAFE_INTEGER;return new DOMRect(-i,-i,2*i,2*i)}};return A(p({},n.gestureEngine.config),{maxRoamingBounds:t,safeBounds:t})}cancel(){}flickDistribution(n,t){let i=this.baseSpec.flick,s=[{spec:this.baseSpec,coord:[NaN,0]}];s=s.concat(Object.keys(i).map(b=>({spec:i[b],coord:Ml.get(b)})));let c=n.angle,l=this.gestureParams.flick.triggerDist,r=Math.min(l,t?l:n.netDistance)/l,d=0,u=s.map(b=>{let I=0,h=b.coord;if(!isNaN(h[0])){let x=c-h[0],Z=2*Nr+h[0]-c;I=Math.min(x*x,Z*Z)}let F=xs*(h[1]-r),y=F*F,G=1/(I+y+1e-6);return d+=G,{keySpec:b.spec,p:G}}),B=1/d;return u.forEach(b=>b.p*=B),u.sort((b,I)=>I.p-b.p)}currentStageKeyDistribution(n){let t=this.baseSpec,i=this.baseKeyDistances,s=this.computedFlickDistribution;if(!i.get(t))return[{keySpec:s[0].keySpec,p:1}];let l=s.findIndex(d=>d.keySpec==t),o=s.splice(l,1)[0].p,r=It(i);return s.concat(r.map(d=>({keySpec:d.keySpec,p:d.p*o})))}};a(zl,"Flick");var oi=zl;var Zs=Ua.TouchLayoutKeySp,ai={longpress:{flickDistStart:8,flickDistFinal:40,waitLength:500,noiseTolerance:10},multitap:{waitLength:300,holdLength:150},flick:{startDist:10,dirLockDist:25,triggerDist:40}};function kr(g){let n=g.getBoundingClientRect();return{clientX:n.left+n.width/2,clientY:n.top+n.height/2}}a(kr,"getKeyCentroid");function Er(g){let n=kr(g);return t=>{let i=t.lastSample.clientX-n.clientX,s=t.lastSample.clientY-n.clientY;return Math.sqrt(i*i+s*s)}}a(Er,"buildDistFromKeyCentroidFunctor");function gi(g){let n=g.key.spec;if(n.sk)return!1;let t=["K_SHIFT","K_ALT","K_CTRL","K_NUMERALS","K_SYMBOLS","K_CURRENCIES"];for(let i of t)if(n.id==i)return!0;if(n.nextlayer)switch(n.sp){case Zs.special:case Zs.specialActive:case Zs.customSpecial:case Zs.customSpecialActive:return!0;default:return!1}else return!1}a(gi,"keySupportsModipress");function Kl(g,n){let t=a((F,y)=>{if(!F)return!1;let G=F.key.spec;switch(y){case"modipress-start":return gi(F);case"special-key-start":return["K_LOPT","K_ROPT","K_BKSP"].indexOf(G.baseKeyID)!=-1;case"longpress":return!0;case"multitap-start":case"modipress-multitap-start":return g.hasMultitaps?!!G.multitap:!1;case"flick-start":return!!G.flick;default:return!0}},"gestureKeyFilter"),i=n;i.longpress.permitsFlick=F=>{let y=F==null?void 0:F.key.spec.flick;return!y||!(y.n||y.nw||y.ne)};let s=i.roamingEnabled=!g.hasFlicks,c=ae(s?dg(i):Kr(i)),l=ae(s?Ol(i):Dr(i)),o=u(ae(Mr(i,!0,s)),0),r=u(ag(i),0),d=u(Fg(i),0);Object.defineProperty(o.contacts[0].model.timer,"duration",{get:a(()=>i.longpress.waitLength,"get")}),Object.defineProperty(r.sustainTimer,"duration",{get:a(()=>i.multitap.waitLength,"get")}),Object.defineProperty(d.sustainTimer,"duration",{get:a(()=>i.multitap.waitLength,"get")});function u(F,y){F=ae(F);let G=F.id;return typeof y=="number"&&(y=[y]),F.contacts.forEach((x,Z)=>{var U;if(y.indexOf(Z)!=-1){let H=(U=x.model.allowsInitialState)!=null?U:()=>!0;x.model=A(p({},x.model),{allowsInitialState:a((L,v,Ae)=>t(Ae,G)&&H(L,v,Ae),"allowsInitialState")})}}),F}a(u,"withKeySpecFiltering");let B=$a(),b=Bg(),I=[o,r,gg(i),c,l,u(B,0),eg(i),ug(),u(b,0),Ig(i),hg(),bg(),d,yg(i),mg()],h=[o.id,c.id,b.id,B.id];return s?(I.push(u(tg(i),0)),I.push(ng())):(I.push(u(zr(i),0)),I.push(sg(i)),I.push(cg(i)),I.push(lg(i)),I.push(ig(i)),I.push(og()),I.push(rg(i)),h.push("flick-start")),{gestures:I,sets:{default:h,modipress:h.filter(F=>F!=b.id),none:[]}}}a(Kl,"gestureSetForLayout");function Dl(){return{itemPriority:0,pathResolutionAction:"reject",pathModel:{evaluate:a(g=>"resolve","evaluate")}}}a(Dl,"instantContactRejectionModel");function Ne(){return{itemPriority:0,pathResolutionAction:"resolve",pathModel:{evaluate:a(g=>"resolve","evaluate")}}}a(Ne,"instantContactResolutionModel");function Da(g){let n=g.flick;return{itemPriority:1,pathModel:{evaluate:a((t,i,s)=>{let c=t.stats,l=s==null?void 0:s.key.spec;if(l&&l.sk){let o=l.flick;if(!(o.nw||o.n||o.ne)){let d=c.netDistance,u=c.angle;if(d*Math.cos(u)>g.longpress.flickDistStart)return"reject"}}return c.netDistance>n.startDist?"resolve":null},"evaluate")},pathResolutionAction:"resolve",pathInheritance:"partial"}}a(Da,"flickStartContactModel");function Yr(g,n){let t=n.key.spec.flick,i=Object.keys(t),s,c=0;for(let l of i){let o=ri(g,l);o>c&&(c=o,s=l)}return{dir:s,dist:c}}a(Yr,"determineLockFromStats");function Oa(g){return{itemPriority:1,pathModel:{evaluate:a((n,t,i)=>{let{dir:s,dist:c}=Yr(n.stats,i);if(c>g.flick.dirLockDist){let l=n.stats.angle,o=Us(s),r=Math.abs(l-o),d=Math.abs(2*Math.PI+o-l);if(r<=xs||d<=xs)return"resolve"}else if(n.isComplete)return"reject"},"evaluate")},pathResolutionAction:"resolve",pathInheritance:"full"}}a(Oa,"flickMidContactModel");function Pa(g){return{itemPriority:1,pathModel:{evaluate:a((n,t,i,s)=>{if(n.isComplete)return"resolve";{let{dir:c}=Yr(s,i);if(ri(n.stats,c)<g.flick.dirLockDist)return"reject"}},"evaluate")},pathResolutionAction:"resolve",pathInheritance:"full"}}a(Pa,"flickEndContactModel");function ja(g,n,t){let i=g.longpress;return{itemPriority:0,pathResolutionAction:"resolve",timer:{get duration(){return i.waitLength},expectedResult:!0},validateItem:a((s,c)=>!!(c!=null&&c.key.spec.sk),"validateItem"),pathModel:{evaluate:a(s=>{var l;let c=s.stats;if(n&&i.permitsFlick(c.lastSample.item)&&((l=c.cardinalDirection)!=null?l:"").indexOf("n")!=-1){let o=c.netDistance,r=c.angle;if(o*Math.cos(r)>i.flickDistFinal)return"resolve"}else if(t){if(c.rawDistance>i.noiseTolerance||c.lastSample.item!=c.initialSample.item)return"reject"}else if(c.lastSample.item!=c.initialSample.item)return"reject";return s.isComplete?"reject":null},"evaluate")}}}a(ja,"longpressContactModel");function Tr(){return{itemPriority:-1,pathResolutionAction:"resolve",pathModel:{evaluate:a(g=>"resolve","evaluate")}}}a(Tr,"modipressContactStartModel");function _a(){return{itemPriority:-1,itemChangeAction:"resolve",pathResolutionAction:"resolve",pathModel:{evaluate:a(g=>{if(g.isComplete)return"reject"},"evaluate")}}}a(_a,"modipressContactHoldModel");function wr(){return{itemPriority:-1,itemChangeAction:"resolve",pathResolutionAction:"resolve",pathModel:{evaluate:a(g=>{if(g.isComplete)return"resolve"},"evaluate")}}}a(wr,"modipressContactEndModel");function Xs(g,n){var i;let t=(i=g==null?void 0:g.roamingEnabled)!=null?i:!0;return{itemPriority:0,itemChangeAction:t?"reject":void 0,pathResolutionAction:"resolve",pathInheritance:!t&&n?"full":"chop",pathModel:{evaluate:a(s=>{if(s.isComplete&&!s.wasCancelled)return"resolve"},"evaluate")}}}a(Xs,"simpleTapContactModel");function qa(){return{itemPriority:0,pathResolutionAction:"resolve",pathModel:{evaluate:a(g=>{if(g.isComplete&&!g.wasCancelled)return"resolve"},"evaluate")}}}a(qa,"subkeySelectContactModel");function $a(){return{id:"special-key-start",resolutionPriority:0,contacts:[{model:p({},Ne()),endOnResolve:!1}],resolutionAction:{type:"chain",next:"special-key-end",item:"current"}}}a($a,"specialKeyStartModel");function eg(g){return{id:"special-key-end",resolutionPriority:0,contacts:[{model:A(p({},Xs(g)),{itemChangeAction:"resolve"}),endOnResolve:!0},{model:Ne(),resetOnInstantFulfill:!0}],resolutionAction:{type:"complete",item:"none"}}}a(eg,"specialKeyEndModel");function Mr(g,n,t){let i={id:"longpress",resolutionPriority:4,contacts:[{model:A(p({},ja(g,n,t)),{itemPriority:1,pathInheritance:"chop"}),endOnResolve:!1},{model:Dl(),resetOnInstantFulfill:!0}],resolutionAction:{type:"chain",next:"subkey-select",selectionMode:"none",item:"none"}};return t?A(p({},i),{rejectionActions:{path:{type:"replace",replace:"longpress-roam"},timer:{type:"replace",replace:"longpress-roam-restore"}}}):i}a(Mr,"longpressModel");function tg(g){let n=Mr(g,!1,!0);return A(p({},n),{id:"longpress-roam"})}a(tg,"longpressModelAfterRoaming");function ng(){return{id:"longpress-roam-restore",contacts:[{model:{pathModel:{evaluate:a(g=>null,"evaluate")},itemChangeAction:"reject",pathInheritance:"full",pathResolutionAction:"reject",itemPriority:0}}],resolutionPriority:-1,rejectionActions:{item:{type:"replace",replace:"longpress-roam"}},resolutionAction:{type:"chain",next:"longpress-roam"}}}a(ng,"longpressRoamRestoration");function zr(g){return{id:"flick-start",resolutionPriority:3,contacts:[{model:Da(g)}],resolutionAction:{type:"chain",item:"none",next:"flick-mid"}}}a(zr,"flickStartModel");function ig(g){let n=zr(g);return A(p({},n),{contacts:[A(p({},n.contacts[0]),{model:A(p({},n.contacts[0].model),{baseCoordReplacer:a((t,i)=>{let s=kr(i),c=Er(i),l=t.initialSample,o=c(t);if(o>g.flick.triggerDist)return s;let r=g.flick.dirLockDist;if(o<r)return l;let d=r/o,u=l.clientX-s.clientX,B=l.clientY-s.clientY;return{clientX:s.clientX+u*d,clientY:s.clientY+B*d}},"baseCoordReplacer")})})],id:"flick-restart",sustainWhenNested:!0})}a(ig,"flickRestartModel");function sg(g){return{id:"flick-mid",resolutionPriority:0,contacts:[{model:Oa(g),endOnReject:!0},{model:Dl(),resetOnInstantFulfill:!0}],rejectionActions:{path:{type:"replace",replace:"flick-reset-end"}},resolutionAction:{type:"chain",item:"none",next:"flick-end"},sustainWhenNested:!0}}a(sg,"flickMidModel");function cg(g){return{id:"flick-reset",resolutionPriority:1,contacts:[{model:A(p({},Ne()),{pathInheritance:"partial"})}],resolutionAction:{type:"chain",next:"flick-reset-centering"},sustainWhenNested:!0}}a(cg,"flickResetModel");function lg(g){return{id:"flick-reset-centering",resolutionPriority:1,contacts:[{model:{pathModel:{evaluate(n,t,i){t||(t=n.stats);let s=Er(i),c=s(n.stats);if(s(t)<c)return"resolve"}},itemPriority:0,pathResolutionAction:"resolve",pathInheritance:"full"}}],resolutionAction:{type:"chain",next:"flick-restart"},sustainWhenNested:!0}}a(lg,"flickResetCenteringModel");function og(){return{id:"flick-reset-end",resolutionPriority:1,contacts:[],sustainTimer:{duration:0,expectedResult:!0},resolutionAction:{type:"complete",item:"base"},sustainWhenNested:!0}}a(og,"flickResetEndModel");function rg(g){return{id:"flick-end",resolutionPriority:0,contacts:[{model:Pa(g)},{model:Ne(),resetOnInstantFulfill:!0}],rejectionActions:{path:{type:"replace",replace:"flick-reset"}},resolutionAction:{type:"complete",item:"current"},sustainWhenNested:!0}}a(rg,"flickEndModel");function ag(g){return{id:"multitap-start",resolutionPriority:2,contacts:[{model:A(p({},Ne()),{itemPriority:1,pathInheritance:"reject",allowsInitialState(n,t,i){return n.item==i}})}],sustainTimer:{duration:g.multitap.waitLength,expectedResult:!1,baseItem:"base"},resolutionAction:{type:"chain",next:"multitap-end",item:"current"}}}a(ag,"multitapStartModel");function gg(g){return{id:"multitap-end",resolutionPriority:2,contacts:[{model:A(p({},Xs(g)),{itemPriority:1,timer:{duration:g.multitap.holdLength,expectedResult:!1}}),endOnResolve:!0},{model:Ne(),resetOnInstantFulfill:!0}],rejectionActions:{timer:{type:"replace",replace:"simple-tap"}},resolutionAction:{type:"chain",next:"multitap-start",item:"none"}}}a(gg,"multitapEndModel");function Kr(g){return{id:"initial-tap",resolutionPriority:1,contacts:[{model:A(p({},Xs(g)),{pathInheritance:"chop",itemPriority:1,timer:{duration:g.multitap.holdLength,expectedResult:!1}}),endOnResolve:!0},{model:Ne(),resetOnInstantFulfill:!0}],sustainWhenNested:!0,rejectionActions:{timer:{type:"replace",replace:"simple-tap"}},resolutionAction:{type:"chain",next:"multitap-start",item:"base"}}}a(Kr,"initialTapModel");function Dr(g){return{id:"simple-tap",resolutionPriority:1,contacts:[{model:A(p({},Xs(g,!0)),{itemPriority:1}),endOnResolve:!0},{model:Ne(),resetOnInstantFulfill:!0}],sustainWhenNested:!0,resolutionAction:{type:"complete",item:"base"}}}a(Dr,"simpleTapModel");function dg(g){let n=Kr(g);return A(p({},n),{rejectionActions:A(p({},n.rejectionActions),{item:{type:"replace",replace:"initial-tap"}})})}a(dg,"initialTapModelWithReset");function Ol(g){let n=Dr(g);return A(p({},n),{rejectionActions:A(p({},n.rejectionActions),{item:{type:"replace",replace:"simple-tap"}})})}a(Ol,"simpleTapModelWithReset");function ug(){return{id:"subkey-select",resolutionPriority:0,contacts:[{model:A(p({},qa()),{pathInheritance:"full",itemPriority:1}),endOnResolve:!0,endOnReject:!0}],resolutionAction:{type:"complete",item:"current"},sustainWhenNested:!0}}a(ug,"subkeySelectModel");function Bg(){return{id:"modipress-start",resolutionPriority:5,contacts:[{model:A(p({},Tr()),{allowsInitialState(g,n,t){return gi(t)},itemChangeAction:"reject",itemPriority:1})}],resolutionAction:{type:"chain",next:"modipress-hold",selectionMode:"modipress",item:"current"}}}a(Bg,"modipressStartModel");function Ig(g){return{id:"modipress-hold",resolutionPriority:5,contacts:[{model:A(p({},_a()),{itemChangeAction:"reject",pathInheritance:"full",timer:{duration:g.multitap.holdLength,expectedResult:!0,inheritElapsed:!0}})},{model:p({},Ne()),resetOnInstantFulfill:!0}],resolutionAction:{type:"chain",next:"modipress-end",selectionMode:"modipress",item:"none"},rejectionActions:{path:{type:"replace",replace:"modipress-end-multitap-transition"}}}}a(Ig,"modipressHoldModel");function bg(){return{id:"modipress-end-multitap-transition",resolutionPriority:5,contacts:[],sustainTimer:{duration:0,expectedResult:!0},resolutionAction:{type:"chain",next:"modipress-multitap-start",item:"none"}}}a(bg,"modipressMultitapTransitionModel");function hg(){return{id:"modipress-end",resolutionPriority:5,contacts:[{model:A(p({},wr()),{itemChangeAction:"reject",pathInheritance:"full"})}],resolutionAction:{type:"complete",item:"none",awaitNested:!0}}}a(hg,"modipressEndModel");function Fg(g){return{id:"modipress-multitap-start",resolutionPriority:6,contacts:[{model:A(p({},Tr()),{pathInheritance:"reject",allowsInitialState(n,t,i){return n.item!=i?!1:gi(i)},itemChangeAction:"reject",itemPriority:1})}],sustainTimer:{duration:g.multitap.waitLength,expectedResult:!1,baseItem:"base"},resolutionAction:{type:"chain",next:"modipress-multitap-end",selectionMode:"modipress",item:"current"}}}a(Fg,"modipressMultitapStartModel");function yg(g){return{id:"modipress-multitap-end",resolutionPriority:5,contacts:[{model:A(p({},wr()),{itemChangeAction:"reject",pathInheritance:"full",timer:{duration:g.multitap.holdLength,expectedResult:!1}})},{model:p({},Dl()),resetOnInstantFulfill:!0}],resolutionAction:{type:"chain",next:"modipress-multitap-start",item:"none"},rejectionActions:{timer:{type:"replace",replace:"modipress-multitap-lock-transition"},path:{type:"replace",replace:"modipress-multitap-lock-transition"}}}}a(yg,"modipressMultitapEndModel");function mg(){return{id:"modipress-multitap-lock-transition",resolutionPriority:5,contacts:[{model:A(p({},Ne()),{pathResolutionAction:"resolve"})}],resolutionAction:{type:"chain",next:"modipress-end",selectionMode:"modipress",item:"none"}}}a(mg,"modipressMultitapLockModel");var Or=A(p({},ae(Ol(null))),{resolutionAction:{type:"complete",item:"current"}}),Pr={gestures:[Or],sets:{default:[Or.id]}};function Vs(g){let n;return typeof g=="string"?n=g:(n=g.style.fontSize,n||(n=getComputedStyle(g).fontSize)),new X(n)}a(Vs,"getFontSizeStyle");function jr(g,n,t){if(g.touchable){let i=g.formFactor=="phone"?1.6*(t?.65:.6)*1.2:2;return X.special(i,"em")}else return n?X.inPixels(n/8):void 0}a(jr,"defaultFontSize");var di;function Ss(g,n,t){t={fontFamily:t.fontFamily,fontSize:t.fontSize},t.fontFamily||(t.fontFamily=getComputedStyle(document.body).fontFamily),(!t.fontSize||t.fontSize=="")&&(t.fontSize="1em");let i=t.fontFamily,s=Vs(t.fontSize),c;s.absolute?c=s.val+"px":c=s.val*n+"px",di=di!=null?di:document.createElement("canvas");let l=di.getContext("2d");return l.font=c+" "+i,l.measureText(g)}a(Ss,"getTextMetrics");var Gg=10,Pl=class Pl{constructor(n,t){this.totalLength=0;this.baseCoord=n,this.curCoord=n,this.baseScrollLeft=t,this.totalLength=0}updateTo(n){let t=this.curCoord;this.curCoord=n;let i=this.baseCoord.targetX-this.curCoord.targetX+this.baseScrollLeft;return this.totalLength+=Math.abs(this.curCoord.targetX-t.targetX),i}get hasScrolled(){return this.totalLength>Gg}};a(Pl,"BannerScrollState");var Ws=Pl;var _r="kmw-suggest-touched",pg="kmw-suggest-banner-scroller",qr=.666,Cg=.85,$r="swallow-fade-transition",ui=class ui{constructor(n,t){this.index=n,this.rtl=t!=null?t:!1,this.constructRoot();let i=this.display=N("span");i.className="kmw-suggestion-text",this.container.appendChild(i)}get computedStyle(){return getComputedStyle(this.display)}constructRoot(){let n=this.div=N("div");n.className="kmw-suggest-option",n.id=ui.BASE_ID+this.index,this.div.suggestion=this;let t=this.container=document.createElement("div");t.className="kmw-suggestion-container";let s=(100-ke.MARGIN*(ke.LONG_SUGGESTION_DISPLAY_LIMIT-1))/ke.LONG_SUGGESTION_DISPLAY_LIMIT;t.style.minWidth=s+"%",n.appendChild(t)}matchKeyboardProperties(n){let t=this.div;if(n){n.KLC&&(t.lang=n.KLC);let i=n.KFont;i&&i.family&&i.family!=""&&(t.style.fontFamily=i.family)}}get suggestion(){return this._suggestion}update(n,t){this._suggestion=n;let i=this.generateSuggestionText(this.rtl);if(this.container.replaceChild(i,this.display),this.display=i,t.minWidth!==void 0&&(this._minWidth=t.minWidth),this._paddingWidth=t.paddingWidth,this._collapsedWidth=t.collapsedWidth,n&&n.displayAs){let s=Ss(n.displayAs,t.emSize,t.styleForFont),c=s.fontBoundingBoxAscent?s.fontBoundingBoxAscent+s.fontBoundingBoxDescent:1,l=Math.min(1,t.height/c);this._textWidth=s.width*l,l<1?this.container.style.fontSize=X.forScalar(l).styleString:delete this.container.style.fontSize}else this._textWidth=0;this.currentWidth=this.collapsedWidth,this.updateLayout()}updateLayout(){if(!this.suggestion&&this.index!=0){this.div.style.width="0px";return}else this.div.style.width="";let n=this.container.style;n.minWidth=this.collapsedWidth+"px",this.rtl?n.marginRight=this.collapsedWidth-this.expandedWidth+"px":n.marginLeft=this.collapsedWidth-this.expandedWidth+"px",this.updateFade()}updateFade(){this.div.classList.add($r),window.requestAnimationFrame(()=>{this.div.classList.remove($r)}),this.div.classList.add(`kmw-hide-fade-${this.rtl?"left":"right"}`);let n=`kmw-hide-fade-${this.rtl?"right":"left"}`;this.expandedWidth-this.collapsedWidth?this.div.classList.remove(n):this.div.classList.add(n)}get targetCollapsedWidth(){return this._collapsedWidth}get textWidth(){return this._textWidth}get paddingWidth(){return this._paddingWidth}get minWidth(){return this._minWidth}set minWidth(n){this._minWidth=n}get expandedWidth(){return this.minWidth>this.spanWidth?this.minWidth:this.spanWidth}get spanWidth(){var t,i;let n=(t=this.textWidth)!=null?t:0;return n&&(n+=(i=this.paddingWidth)!=null?i:0),n}get collapsedWidth(){let n=this.spanWidth<this.targetCollapsedWidth?this.spanWidth:this.targetCollapsedWidth,t=n<this.expandedWidth?n:this.expandedWidth;return this.minWidth>t?this.minWidth:t}get currentWidth(){return this.div.offsetWidth}set currentWidth(n){n<this.collapsedWidth?n=this.collapsedWidth:n>this.expandedWidth&&(n=this.expandedWidth),this.rtl?this.container.style.marginRight=`${n-this.expandedWidth}px`:this.container.style.marginLeft=`${n-this.expandedWidth}px`}highlight(n){let t=this.div;n?t.classList.add(_r):t.classList.remove(_r)}isEmpty(){return!this._suggestion}generateSuggestionText(n){let t=this._suggestion,i,s=N("span");if(s.className="kmw-suggestion-text",t==null)return s;if(t.displayAs==null||t.displayAs=="")i=" ";else{let c=n?8238:8237;i=String.fromCharCode(c)+t.displayAs}return s.innerHTML=i,s}};a(ui,"BannerSuggestion"),ui.BASE_ID="kmw-suggestion-";var jl=ui,O=class O extends Be{constructor(t,i){super(i||Be.DEFAULT_HEIGHT);this.type="suggestion";this.currentSuggestions=[];this.options=[];this.separators=[];this.isRTL=!1;this.onSuggestionUpdate=a(t=>{var I;this.currentSuggestions=t,(I=this.highlightAnimation)==null||I.cancel();let i=this.options[0].computedStyle,s={fontSize:i.fontSize,fontFamily:i.fontFamily},c=getComputedStyle(document.body).fontSize,l=Vs(c).val,o=getComputedStyle(this.options[0].container.firstChild),r=this.width/O.LONG_SUGGESTION_DISPLAY_LIMIT,d=this.height*Cg,u=new X(o.paddingLeft||"4px"),B=new X(o.paddingRight||"4px"),b={paddingWidth:u.val+B.val,emSize:l,styleForFont:s,collapsedWidth:r,minWidth:0,height:d};for(let h=0;h<O.SUGGESTION_LIMIT;h++){let F=this.options[h];if(t.length>h){let y=t[h];F.update(y,b),this.predictionContext.selected==y&&F.highlight(!0)}else F.update(null,b)}this.refreshLayout()},"onSuggestionUpdate");this.refreshLayout=a(()=>{let t=[],i=0,s=Math.min(this.currentSuggestions.length,8);for(let c=0;c<s;c++){let l=this.options[c];l.minWidth=0,i+=l.collapsedWidth,l.collapsedWidth<l.expandedWidth&&t.push(l)}if(s=s||1,i<this.width){let c=this.width*.01*(s-1);for(;i<this.width&&t.length>0;){let o=(this.width-i-c)/t.length;t.sort((B,b)=>B.expandedWidth-b.expandedWidth);let r=t[0],d=r.expandedWidth-r.collapsedWidth,u=Math.min(d,o);u>0&&(t.forEach(B=>B.minWidth=B.collapsedWidth+u),i+=u*t.length),t.splice(0,1)}let l=(this.width-i-c)/s;for(let o=0;o<s;o++){let r=this.options[o];r.minWidth=r.collapsedWidth+l,r.updateLayout()}}for(let c=0;c<O.SUGGESTION_LIMIT-1;c++)this.separators[c].style.display=c<s-1?"":"none"},"refreshLayout");this.getDiv().className=this.getDiv().className+" "+O.BANNER_CLASS,this.container=document.createElement("div"),this.container.className=pg,this.getDiv().appendChild(this.container),this.buildInternals(!1),this.gestureEngine=this.setupInputHandling()}shutdown(){this.gestureEngine.destroy()}buildInternals(t){this.isRTL=t,this.options.length>0&&(this.options=[],this.separators=[]);for(let i=0;i<O.SUGGESTION_LIMIT;i++){let s=new jl(i,t);this.options[i]=s}for(let i=0;i<O.SUGGESTION_LIMIT;i++){let s=t?O.SUGGESTION_LIMIT-i-1:i;if(this.container.appendChild(this.options[s].div),t&&(this.container.scrollLeft=this.container.scrollWidth),i!=O.SUGGESTION_LIMIT-1){let c=N("div");c.className="kmw-banner-separator";let l=c.style;l.marginLeft=`calc(${O.MARGIN/2}% - 0.5px)`,l.marginRight=`calc(${O.MARGIN/2}% - 0.5px)`,this.container.appendChild(c),this.separators[s-(t?1:0)]=c}}}setupInputHandling(){let t=new Ie(this.getDiv(),[-Number.MAX_SAFE_INTEGER]);this.selectionBounds=new Ie(this.getDiv(),[-qr*this.height,-Number.MAX_SAFE_INTEGER]);let i={targetRoot:this.getDiv(),maxRoamingBounds:t,safeBounds:t,itemIdentifier:a(r=>{let d=this.selectionBounds.getBoundingClientRect();if(r.clientX<d.left||r.clientX>d.right||r.clientY<d.top||r.clientY>d.bottom)return null;let u=null,B=Number.MAX_VALUE;for(let b of this.options){let I=b.div.getBoundingClientRect();if(I.left<=r.clientX&&r.clientX<I.right)return b.suggestion?b:null;{let h=(r.clientX<I.left?-1:1)*(r.clientX-I.left);h<B&&(B=h,u=b)}}return u.suggestion?u:null},"itemIdentifier")},s=new Lt(Pr,i),c={source:null,scrollingHandler:null,suggestion:null},l=a(r=>{r.highlight(!0),this.highlightAnimation&&(this.highlightAnimation.cancel(),this.highlightAnimation.decouple()),this.highlightAnimation=new As(this.container,r,!1),this.highlightAnimation.expand()},"markSelection"),o=a(r=>{r.highlight(!1),this.highlightAnimation||(this.highlightAnimation=new As(this.container,r,!1)),this.highlightAnimation.collapse()},"clearSelection");return s.on("inputstart",r=>{if(c.source){r.terminate(!0);return}let d=this._predictionContext.selected;this._predictionContext.selected=null,this.options.forEach(b=>{b.highlight(!1)}),this.scrollState=new Ws(r.currentSample,this.container.scrollLeft);let u=r.baseItem;c.source=r,c.scrollingHandler=b=>{var F;let I=this.scrollState.updateTo(b);(F=this.highlightAnimation)==null||F.setBaseScroll(I);let h=b.item?u:null;h!=c.suggestion&&(c.suggestion&&o(c.suggestion),c.suggestion=h,h&&l(h))},c.suggestion=r.currentSample.item,c.suggestion&&l(c.suggestion);let B=a(()=>{let b=this.currentSuggestions;de(0).then(()=>R(this,null,function*(){if(b==this.currentSuggestions&&(this._predictionContext.selected=d,d)){for(let I of this.options)if(I.suggestion==d){I.highlight(!0);break}}})),c.suggestion&&(o(c.suggestion),c.suggestion=null),c.source=null,c.scrollingHandler=null},"terminationHandler");r.path.on("complete",B),r.path.on("invalidated",B),r.path.on("step",c.scrollingHandler)}),s.on("recognizedgesture",r=>{r.once("stage",d=>{let u=d.item;u&&!this.scrollState.hasScrolled&&this.currentSuggestions.length>0&&(this.currentSuggestions=[],this.predictionContext.accept(u.suggestion).then(()=>{this.container.scrollLeft=this.isRTL?this.container.scrollWidth:0})),this.scrollState=null})}),s}update(){var i;let t=super.update();return(i=this.selectionBounds)==null||i.updatePadding([-qr*this.height,-Number.MAX_SAFE_INTEGER]),t}configureForKeyboard(t,i){let s=t.isRTL;this.container.textContent="",this.buildInternals(s),this.options.forEach(c=>c.matchKeyboardProperties(i)),this.onSuggestionUpdate(this.currentSuggestions)}get predictionContext(){return this._predictionContext}set predictionContext(t){this._predictionContext&&this._predictionContext.off("update",this.onSuggestionUpdate),this._predictionContext=t,t&&(t.on("update",this.onSuggestionUpdate),this.onSuggestionUpdate(t.currentSuggestions))}};a(O,"SuggestionBanner"),O.SUGGESTION_LIMIT=8,O.LONG_SUGGESTION_DISPLAY_LIMIT=3,O.MARGIN=1;var ke=O,me=class me{constructor(n,t,i){this.setScrollOffset=a(()=>{if(!this.scrollContainer)return;let n=this.option.currentWidth-this.option.collapsedWidth,t=this.option.rtl,i=Math.max(this.rootScrollOffset-this.option.div.offsetLeft,0),s=Math.max(this.option.div.offsetLeft+this.option.collapsedWidth-(this.rootScrollOffset+this.scrollContainer.offsetWidth)),c=Math.max(t?s:i,0),l=Math.max(this.collapsedScrollOffset+(t?0:1)*n,0)+(t?0:-1)*c,o=Math.max(this.rootScrollOffset+(t?0:1)*n,0)+(t?0:-1)*c,r=t?Math.max(l,o):Math.min(l,o),d=Math.max(t?this.option.div.offsetLeft+this.option.currentWidth-(r+this.scrollContainer.offsetWidth):r-this.option.div.offsetLeft,0),u=Math.min(n,d),B=l+(t?1:-1)*u+(t?0:1)*c;if(this.scrollContainer.scrollLeft=B,this.pendingAnimation){let b=this.scrollContainer.scrollLeft-B;this.option.currentWidth+=b}},"setScrollOffset");this._expand=a(n=>{if(this.startTimestamp===void 0)return;let t=n-this.startTimestamp,i=t>me.TRANSITION_TIME;i&&(t=me.TRANSITION_TIME);let s=this.option.expandedWidth-this.option.collapsedWidth,c=t/me.TRANSITION_TIME,l=s*c;this.option.currentWidth=l+this.option.collapsedWidth,i?this.clear():this.pendingAnimation=window.requestAnimationFrame(this._expand),this.setScrollOffset()},"_expand");this._collapse=a(n=>{if(this.startTimestamp===void 0)return;let t=n-this.startTimestamp,i=t>me.TRANSITION_TIME;i&&(t=me.TRANSITION_TIME);let s=this.option.expandedWidth-this.option.collapsedWidth,c=1-t/me.TRANSITION_TIME,l=s*c;this.option.currentWidth=l+this.option.collapsedWidth,i?this.clear():this.pendingAnimation=window.requestAnimationFrame(this._collapse),this.setScrollOffset()},"_collapse");this.scrollContainer=n,this.option=t,this.collapsedScrollOffset=n.scrollLeft,this.rootScrollOffset=n.scrollLeft}setBaseScroll(n){this.collapsedScrollOffset=n,this.option.rtl?n>this.rootScrollOffset&&(this.rootScrollOffset=n):n<this.rootScrollOffset&&(this.rootScrollOffset=n),window.requestAnimationFrame(this.setScrollOffset)}decouple(){this.cancel(),this.scrollContainer=null}clear(){this.startTimestamp=null,window.cancelAnimationFrame(this.pendingAnimation),this.pendingAnimation=null}cancel(){this.clear(),this.option.currentWidth=this.option.collapsedWidth}expand(){this.clear(),this.startTimestamp=performance.now();let n=this.option.currentWidth-this.option.collapsedWidth,t=this.option.expandedWidth-this.option.collapsedWidth;n!=0&&(this.startTimestamp-=n/t*me.TRANSITION_TIME),this.pendingAnimation=window.requestAnimationFrame(this._expand)}collapse(){this.clear(),this.startTimestamp=performance.now();let n=this.option.expandedWidth-this.option.currentWidth,t=this.option.expandedWidth-this.option.collapsedWidth;n!=0&&(this.startTimestamp-=n/t*me.TRANSITION_TIME),this.pendingAnimation=window.requestAnimationFrame(this._collapse)}};a(me,"SuggestionExpandContractAnimation"),me.TRANSITION_TIME=250;var As=me;var _l=class _l extends Be{constructor(t){super();this.type="html";let i=this.getDiv(),s=document.createElement("div");s.style.userSelect="none",s.style.height="100%",s.style.width="100%",i.appendChild(s),this.container=s.attachShadow?s.attachShadow({mode:"closed"}):s,this.container.innerHTML=t}get innerHTML(){return this.container.innerHTML}set innerHTML(t){this.container.innerHTML=t}};a(_l,"HTMLBanner");var Rs=_l;var ql=class ql{constructor(n,t,i){this.ImageBanner=gs;this.HTMLBanner=Rs;this.hostDevice=t,this.container=n,this.predictionContext=i,this.inactiveBanner=new gt}get inactiveBanner(){return this._inactiveBanner}set inactiveBanner(n){this._inactiveBanner=n!=null?n:new gt,this.container.banner instanceof ke||(this.container.banner=this._inactiveBanner)}activateBanner(n){let t=this.container.banner;if(t instanceof ke&&(t.predictionContext=null),!n)this.container.banner=this.inactiveBanner;else{let i=new ke(this.hostDevice,this.container.activeBannerHeight);i.predictionContext=this.predictionContext,this.container.banner=i}}selectBanner(n){this.activateBanner(n=="active"||n=="configured"),this.keyboard&&this.container.banner.configureForKeyboard(this.keyboard,this.keyboardStub)}configureForKeyboard(n,t){this.keyboard=n,this.keyboardStub=t,this.container.banner.configureForKeyboard(n,t)}shutdown(){this.container.banner instanceof ke&&(this.container.banner.predictionContext=null)}};a(ql,"BannerController");var Bi=ql;var $l=class $l{constructor(){let n=this.element=document.createElement("div");n.style.userSelect="none",n.className="kmw-osk-none"}postInsert(){}updateState(){}refreshLayout(){}get layoutHeight(){return X.inPixels(0)}};a($l,"EmptyView");var vt=$l;var hn=class hn{constructor(n){this.kbd=n;let t=this.element=document.createElement("div");t.style.userSelect="none",t.className="kmw-osk-static",t.id=hn.ID,t.innerHTML=n.helpText}postInsert(){if(!this.element.parentElement||!document.getElementById(hn.ID))throw new Error("The HelpPage root element has not yet been inserted into the DOM.");this.kbd.hasScript&&this.kbd.embedScript(this.element.parentElement)}updateState(){}refreshLayout(){}get layoutHeight(){return X.inPercent(100)}};a(hn,"HelpPageView"),hn.ID="kmw-osk-help-page";var Ii=hn;var to=class to{constructor(n,t,i){this.keySpec=i,this.centerX=i.proportionalX,this.centerY=t.proportionalY,this.width=i.proportionalWidth,this.height=n.rowProportionalHeight}};a(to,"CorrectiveBaseKeyLayout");var eo=to;function Hs(g){return g.baseKeyID?C.isFrameKey(g.baseKeyID)?!1:!g.isPadding:!1}a(Hs,"correctionKeyFilter");function ea(g,n){return{keys:g.row.map(t=>t.key.map(i=>new eo(g,t,i))).reduce((t,i)=>t.concat(i),[]).filter(t=>Hs(t.keySpec)),kbdScaleRatio:n}}a(ea,"buildCorrectiveLayout");var Qg={"*Shift*":8,"*Enter*":5,"*Tab*":6,"*BkSp*":4,"*Menu*":11,"*Hide*":10,"*Alt*":25,"*Ctrl*":1,"*Caps*":3,"*ABC*":16,"*abc*":17,"*123*":19,"*Symbol*":21,"*Currency*":20,"*Shifted*":9,"*AltGr*":2,"*TabLeft*":7,"*LAlt*":86,"*RAlt*":87,"*LCtrl*":88,"*RCtrl*":89,"*LAltCtrl*":96,"*RAltCtrl*":97,"*LAltCtrlShift*":98,"*RAltCtrlShift*":99,"*AltShift*":100,"*CtrlShift*":101,"*AltCtrlShift*":102,"*LAltShift*":103,"*RAltShift*":104,"*LCtrlShift*":105,"*RCtrlShift*":112,"*LTREnter*":5,"*LTRBkSp*":4,"*RTLEnter*":113,"*RTLBkSp*":114,"*ShiftLock*":115,"*ShiftedLock*":116,"*ZWNJ*":117,"*ZWNJiOS*":117,"*ZWNJAndroid*":118,"*ZWNJGeneric*":121,"*Sp*":128,"*NBSp*":130,"*NarNBSp*":131,"*EnQ*":132,"*EmQ*":133,"*EnSp*":134,"*EmSp*":135,"*PunctSp*":140,"*ThSp*":141,"*HSp*":142,"*ZWSp*":129,"*ZWJ*":119,"*WJ*":120,"*CGJ*":122,"*LTRM*":144,"*RTLM*":145,"*SH*":161,"*HTab*":162},no=Qg;var Ug=["default","shift","shift-on","special","special-on","","","","deadkey","blank","hidden"],Jt=Ug;function Nt(g,n){switch(g){case"*ZWNJ*":g=n.device.OS==W.OperatingSystem.Android?"*ZWNJAndroid*":"*ZWNJiOS*";break;case"*Enter*":g=n.isRTL?"*RTLEnter*":"*LTREnter*";break;case"*BkSp*":g=n.isRTL?"*RTLBkSp*":"*LTRBkSp*";break;default:}let t=no[g],i=57344+t;return t?String.fromCharCode(i):g}a(Nt,"renameSpecialKey");var je=class je{constructor(n,t){this.spec=n,this.layer=t}setButtonClass(){var s;let n=this.spec,t=this.btn,i=0;typeof n.dk=="string"&&n.dk=="1"&&(i=8),i=(s=n.sp)!=null?s:i,(i<0||i>10)&&(i=0),t.className="kmw-key kmw-key-"+Jt[i]}setToggleState(n){let t=this.spec.sp;switch(Jt[t]){case"shift":case"shift-on":n===void 0&&(n=Jt[t]=="shift"),this.spec.sp=1+(n?1:0);break;case"special":case"special-on":n===void 0&&(n=Jt[t]=="special"),this.spec.sp=3+(n?1:0);break;default:return}this.setButtonClass()}isFrameKey(){let n=this.spec.sp||0;switch(Jt[n]){case"default":case"deadkey":return!1;default:return!0}}allowsKeyTip(){return this.isFrameKey()?!1:!this.btn.classList.contains("kmw-spacebar")}highlight(n){let t=this.btn.classList;n?t.contains(je.HIGHLIGHT_CLASS)||t.add(je.HIGHLIGHT_CLASS):t.remove(je.HIGHLIGHT_CLASS)}getIdealFontSize(n,t,i){if(!this._fontFamily)return new X("1em");i!=null||(i=1);let s=t.keyWidth,c=t.keyHeight,l=t.baseEmFontSize.scaledBy(t.layoutFontSize.val),o=this._fontSize;o.absolute||(o=l.scaledBy(o.val));let r={fontFamily:this._fontFamily,fontSize:o.styleString,height:t.keyHeight},d=Ss(n,l.scaledBy(i).val,r),u=.9,B=.9,b=2,I;d.fontBoundingBoxAscent&&(I=d.fontBoundingBoxAscent+d.fontBoundingBoxDescent);let h=I!=null?I:0,F=s*u/(d.width+b),y=h&&c?c*B/h:void 0,G=F;return y&&y<F&&(G=y),X.forScalar(i*Math.min(G,1))}get keyText(){let n=this.spec,t=" ",i=null;return n.text==null||n.text==""?i=t:(i=n.text,i=="*Tab*"&&this.layer=="shift"&&(i="*TabLeft*")),i}generateKeyText(n){let t=this.spec,i=document.createElement("span"),s=i.style;i.className="kmw-key-text";let c=this.keyText,l=Nt(c,n);l!=c&&(c=l,t.font="SpecialOSK"),typeof t.font=="string"&&t.font!=""&&(s.fontFamily=t.font),typeof t.fontsize=="string"&&t.fontsize!=""&&(s.fontSize=t.fontsize);let o={fontSize:s.fontSize};return s.fontFamily?o.fontFamily=s.fontFamily:o.fontFamily=n.fontFamily,n.isRTL&&(c="‏"+c),i.innerText=c,i}resetFontPrecalc(){this._fontFamily=void 0,this._fontSize=void 0,this.label.style.fontSize=""}detectStyles(n){if(!(this.spec.sp==k.spacer||this.spec.sp==k.blank)&&this._fontFamily===void 0){let t=getComputedStyle(this.label);if(!t.fontFamily)return;this._fontFamily=t.fontFamily;let i=new X(t.fontSize),s=n.layoutFontSize;if(s.absolute)this._fontSize=i;else{let c=n.baseEmFontSize,l=s.scaledBy(c.val),o=i.val/l.val;this._fontSize=X.forScalar(o)}}}refreshLayout(n){if(this.label)if(this.label.classList.contains("kmw-spacebar-caption")){let t=this.getIdealFontSize(this.keyText,n);this.label.style.setProperty("font-size",t.styleString,"important")}else{let t=this.label.textContent,i=this.getIdealFontSize(t,n);this.label.style.fontSize=i.styleString}}};a(je,"OSKKey"),je.specialCharacters=no,je.BUTTON_CLASSES=Jt,je.HIGHLIGHT_CLASS="kmw-key-touched";var Ee=je;var io=class io{constructor(n,t){this.key=n,this.keyId=t}};a(io,"KeyData");var Fn=io;function fs(g,n){let t=g;for(let i in n)t.hasOwnProperty(i)||(t[i]=n[i]);return t}a(fs,"link");var so=class so extends Ee{constructor(n,t,i){super(n,t),this.row=i}getId(){return this.spec.elementID}getCoreId(){return this.spec.coreID}getBaseId(){return this.spec.baseKeyID}generateKeyCapLabel(){let n=C.keyCodes[this.spec.baseKeyID];switch(n){case 186:n=59;break;case 187:n=61;break;case 188:n=44;break;case 189:n=45;break;case 190:n=46;break;case 191:n=47;break;case 192:n=96;break;case 219:n=91;break;case 220:n=92;break;case 221:n=93;break;case 222:n=39;break;default:(n<48||n>90)&&(n=0)}let t=document.createElement("div");return t.className="kmw-key-label",n>0&&(t.innerText=String.fromCharCode(n)),t}processSubkeys(n,t){let i,s=n.subKeys=this.spec.sk;for(i=0;i<s.length;i++){if(s[i].sp==1||s[i].sp==2){let c=s[i].text;s[i].text=Nt(c,t)}s[i].layer||(s[i].layer=n.key.layer)}}construct(n){let t=this.spec,i=document.createElement("div");i.className="kmw-key-square";let s=document.createElement("div"),c=this.btn=fs(s,new Fn(this,t.id));this.setButtonClass();let l=this.capLabel=this.generateKeyCapLabel();c.appendChild(l),c.id=this.getId(),c.appendChild(this.label=this.generateKeyText(n)),typeof t.sk!="undefined"&&t.sk!=null?this.processSubkeys(c,n):c.subKeys=null;let o=this.generateHint(n);return c.appendChild(o),i.appendChild(c),this.preview=document.createElement("div"),this.preview.style.display="none",c.appendChild(this.preview),this.square=i}generateHint(n){let t=document.createElement("div");t.className="kmw-key-popup-icon";let i=this.spec.hintSrc;if(!i)return t;if(i.font&&i.font!="SpecialOSK"?t.style.fontFamily=i.font:t.classList.add("kmw-key-text"),i.fontsize){let l=new X(i.fontsize);t.style.fontSize=l.scaledBy(.5).styleString}let s=i==this.spec?this.spec.hint:i.text,c=Nt(s,n);return c=="•"&&(t.style.fontWeight="bold"),s!=c&&(t.style.fontFamily="SpecialOSK"),t.textContent=c,t}setPreview(n){let t=this.preview;n?(this.previewHost=n,this.preview=this.previewHost.element):(this.previewHost=null,this.preview=document.createElement("div"),this.preview.style.display="none"),n==null||n.setCancellationHandler(()=>{this.setPreview(null)}),this.btn.replaceChild(this.preview,t)}refreshLayout(n){super.refreshLayout(n),n.baseEmFontSize.val<12?this.capLabel.style.fontSize="6px":this.capLabel.style.fontSize=X.forScalar(.5).styleString}get displaysKeyCap(){return this.capLabel&&this.capLabel.style.display=="block"}set displaysKeyCap(n){if(!this.capLabel)throw new Error("Key element not yet constructed; cannot display key cap");this.capLabel.style.display=n?"block":"none"}};a(so,"OSKBaseKey");var bi=so;var Ls=.15,co=class co{constructor(n,t,i){let s=this.element=document.createElement("div");s.className="kmw-key-row",this.heightFraction=1/t.row.length;let c=i.key;this.spec=i,this.keys=[];for(let l=0;l<c.length;l++){let o=c[l],r=new bi(o,t.id,this),d=r.construct(n);this.keys.push(r),s.appendChild(d)}}get displaysKeyCaps(){if(this.keys.length>0)return this.keys[0].displaysKeyCap}set displaysKeyCaps(n){for(let t of this.keys)t.displaysKeyCap=n}refreshLayout(n){let t=this.element.style,i=n.heightStyle.scaledBy(this.heightFraction);t.maxHeight=t.lineHeight=t.height=i.styleString;let s=n.heightStyle.absolute?i:X.forScalar(1),c=s.scaledBy(Ls/2),l=s.scaledBy(1-Ls);this.keys.forEach(o=>{let r=o.square,d=o.btn,u=r.style;u.height=u.minHeight=s.styleString;let B=d.style;B.top=c.styleString,B.height=B.lineHeight=B.minHeight=l.styleString})}buildKeyLayout(n,t){let i=n.widthStyle.scaledBy(t.spec.proportionalWidth),s=n.heightStyle.scaledBy(this.heightFraction).scaledBy(1-Ls);return{keyWidth:i.val*(i.absolute?1:n.keyboardWidth),keyHeight:s.val*(s.absolute?1:n.keyboardHeight),baseEmFontSize:n.baseEmFontSize,layoutFontSize:n.layoutFontSize}}detectStyles(n){this.keys.forEach(t=>{t.detectStyles(this.buildKeyLayout(n,t))})}refreshKeyLayouts(n){this.keys.forEach(t=>{var B;let i=t.btn,s=n.widthStyle,c=n.heightStyle,l=s.scaledBy(t.spec.proportionalWidth),o=s.scaledBy(t.spec.proportionalPad),r=c.scaledBy(this.heightFraction).scaledBy(1-Ls),d=c.absolute?r.styleString:"100%",u=this.buildKeyLayout(n,t);(B=i.key)==null||B.refreshLayout(u),t.square.style.width=l.styleString,t.square.style.marginLeft=o.styleString,t.btn.style.width=s.absolute?l.styleString:"100%",t.square.style.height=d})}};a(co,"OSKRow");var hi=co;var lo=class lo{get rowHeight(){return this._rowHeight}get id(){return this.spec.id}constructor(n,t,i){this.spec=i;let s=this.element=document.createElement("div"),c=s.style;s.className="kmw-key-layer",i.row.length>4&&n.device.formFactor=="phone"&&(s.className=s.className+" kmw-5rows"),c.fontFamily="font"in t?t.font:"",this.nextlayer=i.id,s.layer=i.id,typeof i.nextlayer=="string"&&(s.nextLayer=this.nextlayer=i.nextlayer);let o=i.row;this.rows=[];for(let r=0;r<o.length;r++){let d=new hi(n,i,o[r]);d.displaysKeyCaps=t.displayUnderlying,s.appendChild(d.element),this.rows.push(d)}if(n.device.touchable&&(this.globeKey=this.findKey("K_LOPT"),this.hideKey=this.findKey("K_ROPT")),this.spaceBarKey=this.findKey("K_SPACE"),this.capsKey=this.findKey("K_CAPS"),this.numKey=this.findKey("K_NUMLOCK"),this.scrollKey=this.findKey("K_SCROLL"),this.spaceBarKey){let r=this.spaceBarKey.label,d=this.spaceBarKey.btn;typeof d.className=="undefined"||d.className==""?d.className="kmw-spacebar":d.className.indexOf("kmw-spacebar")==-1&&(d.className+=" kmw-spacebar"),r.className!="kmw-spacebar-caption"&&(r.className="kmw-spacebar-caption")}}findKey(n){for(let t of this.rows)for(let i of t.keys)if(i.getBaseId()==n)return i;return null}showLanguage(n){if(this.spaceBarKey)try{let t=this.spaceBarKey.label;this.spaceBarKey.spec.text=n,(t.innerText!=n||n=="")&&(t.innerText=n)}catch(t){}}refreshLayout(n){this.rows.forEach(l=>l.detectStyles(n));let t=n.keyboardHeight,i=this.rows.length,s=this._rowHeight=Math.floor(t/(i==0?1:i)),c=n.widthStyle.absolute;c&&(this.element.style.height=t+"px"),this.showLanguage(n.spacebarText);for(let l=0;l<i;l++){let o=this.rows[l],r=(i-l-1)*s+1;c&&(this.spec.row[l].proportionalY=(t-r-s/2)/t),o.refreshLayout(n)}for(let l of this.rows)l.refreshKeyLayouts(n)}};a(lo,"OSKLayer");var Fi=lo;var xg=.06,oo=class oo{constructor(n,t,i){this._layers={};this._activeLayerId="default";let s=t.layout(i);this.spec=s,this.vkbd=n;let c=this.element=document.createElement("div"),l=c.style;c.className="kmw-key-layer-group",s!=null&&(l.width="100%",l.height="100%",this.activeLayerId="default")}buildLayer(n){let t=this.spec,i=t.getLayer(n);if(!i)return null;let s=new Fi(this.vkbd,t,i);return this._layers[n]=s,this.element.appendChild(s.element),s}getLayer(n){let t=this._layers[n];return t||(t=this.buildLayer(n),t&&(this._layers[n]=t,t.element.style.display="none")),t}get activeLayer(){return this.activeLayerId?this._layers[this.activeLayerId]:null}get layers(){let t=this.spec.layer.map(i=>i.id);for(let i of t)this.buildLayer(i);return this._layers}get activeLayerId(){return this._activeLayerId}set activeLayerId(n){this._activeLayerId=n,this.getLayer(n);for(let t of Object.keys(this._layers)){let i=this._layers[t],s=i.element;i.id==n?s.style.display="block":s.style.display="none"}}findNearestKey(n){if(!n)return null;let t=n.stateToken;if(!t)throw new Error("Layer id not set for input coordinate");let i=this._layers[t];if(!i)throw new Error(`Layer id ${t} could not be found`);return this.nearestKey(n,i)}blinkLayer(n){if(typeof n=="string"){let i=n;if(n=this.getLayer(i),!n)throw new Error(`Layer id ${i} could not be found`)}let t=n;if(t.element.style.display!="block")for(let i in this._layers){if(this._layers[i].element.style.display=="block"){let s=this._layers[i];s.element.style.display="none"}this._layers[i].element.style.display="none"}t.element.style.display="block",Promise.resolve().then(()=>{let i=this._layers[this._activeLayerId];(t.element.style.display=="block"||i.element.style.display!="block")&&(t.element.style.display="none",i.element.style.display="block")})}nearestKey(n,t){if(t.rows.length==0)return null;let i={x:n.targetX/this.computedWidth,y:n.targetY/this.computedHeight};if(!isFinite(i.x)||!isFinite(i.y))return null;let s=Math.max(0,Math.min(t.rows.length-1,Math.floor(i.y*t.rows.length))),c=t.rows[s],l=null,o=Number.MAX_VALUE;for(let r of c.keys){let d=r.spec;if(d.sp==k.blank||d.sp==k.spacer)continue;let u=d.proportionalWidth/2,B=Math.abs(i.x-d.proportionalX);if(B-u<=0)return r.btn;{let b=B-u;b<o&&(o=b,l=r)}}return o<=xg?l.btn:null}resetPrecalcFontSizes(){for(let n of Object.values(this._layers))for(let t of n.rows)for(let i of t.keys)i.resetFontPrecalc();this._heightPadding=void 0}refreshLayout(n){if(!(isNaN(n.keyboardWidth)||isNaN(n.keyboardHeight))){if(this.computedWidth=n.keyboardWidth,this.computedHeight=n.keyboardHeight,this._heightPadding===void 0){let t=getComputedStyle(this.element),i=parseInt(t.paddingTop,10)||0,s=parseInt(t.paddingBottom,10)||0;this._heightPadding=i+s}this.activeLayer&&this.activeLayer.refreshLayout(n)}}get verticalPadding(){var n;return(n=this._heightPadding)!=null?n:0}};a(oo,"OSKLayerGroup");var yi=oo;var ta="kmw-",na="top",ro=class ro{constructor(n,t){this.state=!1;this.orientation=na;this.vkbd=n;let i=this.element=document.createElement("div");i.className="kmw-keytip",i.id="kmw-keytip",i.style.pointerEvents="none",i.style.display="none",i.appendChild(this.tip=document.createElement("div")),i.appendChild(this.cap=document.createElement("div")),this.tip.appendChild(this.preview=document.createElement("div")),this.tip.className="kmw-keytip-tip",this.cap.className="kmw-keytip-cap",this.constrain=t,this.reorient=s=>{this.orientation=s,this.show(this.key,this.state,this.previewHost)}}show(n,t,i){var c;let s=this.vkbd;if(t&&s.layerGroup.blinkLayer(n.key.spec.displayLayer),t&&n.offsetParent){let l=n.key.row.element,o=n.getClientRects()[0],r=l.getClientRects()[0],d=o.left-r.left,u=o.width,B=o.height,b=1.8,I=this.element.style,F=s.topContainer.getBoundingClientRect(),y=n.getBoundingClientRect(),G,x=this.orientation,Z=y.bottom-F.top;G=Z+(x=="top"?1:-1);let U=G-Math.floor(G),H=u+Math.ceil(u*.3)*2,L=Math.ceil(2.3*B)+U;x=="bottom"&&(G+=L-B),I.top="auto";let v=x=="top"?"bottom":"top";this.tip.classList.remove(`${ta}${v}`),this.tip.classList.add(`${ta}${x}`),I.bottom=Math.floor(F.height-G)+"px",I.textAlign="center",I.overflow="visible",I.width=H+"px",I.height=L+"px";let Ae=this.vkbd.currentLayer.element.style.fontFamily,Ye=getComputedStyle(s.element);I.fontFamily=n.key.spec.font||Ae||Ye.fontFamily;let wt=parseInt(Ye.fontSize,10);if(wt==Number.NaN&&(wt=0),wt!=0){let nt={keyWidth:1.6*u,keyHeight:1.6*B,baseEmFontSize:s.getKeyEmFontSize(),layoutFontSize:new X(s.kbdDiv.style.fontSize)};I.fontSize=n.key.getIdealFontSize(n.key.keyText,nt,b).styleString}let q=(H-u)/2;d<q?(this.cap.style.left="1px",d+=q-1):d>window.innerWidth-u-q?(this.cap.style.left=H-u-1+"px",d-=q-1):this.cap.style.left=q+"px",I.left=d-q+"px";let Te=getComputedStyle(this.element),Sn=F.height,mt=parseFloat(Te.bottom),Wn=parseFloat(Te.height),tt=Math.ceil(L/2);this.cap.style.width=u+"px",this.tip.style.height=tt+"px";let Mt=3,An=tt-Mt+"px";x=="top"?(this.cap.style.top=An,this.cap.style.bottom=""):(this.cap.style.top="",this.cap.style.bottom=An);let Rn=Z-Math.floor(G)+L-(x=="top"?tt:-Mt*2);if(this.cap.style.height=Rn+"px",this.constrain&&Wn+mt>Sn){let nt=Wn+mt-Sn;I.height=L-nt+"px";let Ba=Math.max(0,L-nt-L/2+2);this.cap.style.height=Ba+"px"}else mt<0&&(I.bottom="0px",this.cap.style.height=Math.max(0,Rn+mt)+"px");if(I.display="block",this.previewHost==i)return;let we=this.preview;this.previewHost&&this.previewHost.off("preferredOrientation",this.reorient),this.previewHost=i,i&&(this.previewHost.on("preferredOrientation",this.reorient),this.preview=this.previewHost.element,this.tip.replaceChild(this.preview,we),i.setCancellationHandler(()=>this.show(null,!1,null)),i.on("startFade",()=>{this.element.classList.remove("kmw-preview-fade"),this.element.offsetWidth,this.element.classList.add("kmw-preview-fade")}))}else{this.element.style.display="none",(c=this.previewHost)==null||c.off("preferredOrientation",this.reorient),this.previewHost=null;let l=this.preview;this.preview=document.createElement("div"),this.tip.replaceChild(this.preview,l),this.element.classList.remove("kmw-preview-fade"),this.orientation=na}this.key=n,this.state=t}};a(ro,"KeyTip");var mi=ro;var ao="kmw-keypreview",Zg="kmw-preview-overlay",Xg="kmw-keytip",go=class go{constructor(n){this.state=!1;this.vkbd=n;let t=this.element=document.createElement("div");t.className=ao,t.id="kmw-keytip",t.style.pointerEvents="none",t.style.display="none",this.preview=document.createElement("div"),t.appendChild(this.preview)}show(n,t,i){let s=this.vkbd,c=n==null?void 0:n.key.spec.displayLayer;if(t&&s.layerGroup.blinkLayer(c),t&&(n!=null&&n.offsetParent)){let l=this.vkbd.topContainer.getBoundingClientRect(),o=n.getBoundingClientRect(),r=c!=s.layerId?Zg:"";this.element.className=`${ao} ${n.className} ${r}`,this.element.id=`${Xg}-${n.id}`;let d=this.element.style,u=this.vkbd.currentLayer.element.style.fontFamily;if(d.fontFamily=n.key.spec.font||u,d.left=o.left-l.left+"px",d.top=o.top-l.top+"px",d.width=o.width+"px",d.height=o.height+"px",this.element.style.display="block",this.previewHost==i)return;let B=this.preview;this.previewHost=i,i&&(this.preview=this.previewHost.element,this.element.replaceChild(this.preview,B),i.setCancellationHandler(()=>this.show(null,!1,null)),i.on("startFade",()=>{this.element.classList.remove("kmw-preview-fade"),this.element.offsetWidth,this.element.classList.add("kmw-preview-fade")}))}else{this.element.style.display="none",this.element.className=ao,this.previewHost=null;let l=this.preview;this.preview=document.createElement("div"),this.element.replaceChild(this.preview,l),this.element.classList.remove("kmw-preview-fade")}this.key=n,this.state=t}};a(go,"TabletKeyTip");var vs=go;function Se(g){try{if(g=="desktop")return 1;let n=document.documentElement.clientWidth;if(screen.width>n)return 1;let t=screen.width;return Fe()?screen.width<screen.height&&(t=screen.height):screen.width>screen.height&&(t=screen.height),Math.round(100*t/n)/100}catch(n){return 1}}a(Se,"getViewportScale");var kt=class kt{constructor(n,t){this.directlyEmitsKeys=!0;this.hasModalVisualization=!1;this.deleteRepeater=a(()=>{this.repeatClosure(),this.timerHandle=window.setTimeout(this.deleteRepeater,kt.REPEAT_DELAY)},"deleteRepeater");this.source=n;let i=n.stageReports[0].item;i.key.highlight(!0),this.repeatClosure=()=>{t(),i.key.highlight(!0)},this.timerHandle=window.setTimeout(this.deleteRepeater,kt.INITIAL_DELAY),this.source.on("complete",()=>{window.clearTimeout(this.timerHandle),this.timerHandle=void 0,i.key.highlight(!1)})}cancel(){this.deleteRepeater(),this.source.cancel()}currentStageKeyDistribution(){return null}};a(kt,"HeldRepeater"),kt.INITIAL_DELAY=500,kt.REPEAT_DELAY=100;var Js=kt;var uo=class uo extends Ee{constructor(n,t){if(typeof t!="string"||t=="")throw"The 'layer' parameter for subkey construction must be properly defined.";super(n,t)}getId(){return"popup-"+this.spec.elementID}construct(n,t,i,s){let c=this.spec,l=document.createElement("div"),o=l.style;l.className="kmw-key-square-ex",s&&(o.marginTop="5px"),o.width=i+"px",o.height=t.offsetHeight+"px";let r=document.createElement("div"),d=this.btn=fs(r,new Fn(this,c.id));this.setButtonClass(),d.id=this.getId();let u=d.style;return u.height=o.height,u.lineHeight=t.style.lineHeight,u.width=o.width,u.position="absolute",d.appendChild(this.label=this.generateKeyText(n)),l.appendChild(d),this.square=l}allowsKeyTip(){return!1}};a(uo,"OSKSubKey");var Gi=uo;var ia=.2,Vg=1.2,ca=3,yn=5,sa=6+ca,Bo=class Bo{constructor(n,t,i,s,c){this.directlyEmitsKeys=!0;this.shouldLockLayer=!1;var x;this.baseKey=s,this.source=n,this.gestureParams=c,i.layerLocked&&(this.shouldLockLayer=!0),n.on("complete",()=>{var Z;(Z=this.currentSelection)==null||Z.key.highlight(!1),this.clear()}),n.on("stage",()=>{let Z=this.currentSelection;if(Z){let U=i.keyEventFromSpec(Z.key.spec);U.keyDistribution=this.currentStageKeyDistribution(),U.inputBreadcrumb=this.source.trace(),i.raiseKeyEvent(U,Z)}});let l=n.stageReports[0].sources[0].constructSubview(!0,!1);l.path.on("step",Z=>{var U,H;l.path.stats.netDistance>=4&&((U=this.currentSelection)==null||U.key.highlight(!1),(H=Z.item)==null||H.key.highlight(!0),this.currentSelection=Z.item)}),this.currentSelection=s,s.key.highlight(!0);let o=s.subKeys,r=this.element=document.createElement("div");r.id="kmw-popup-keys";let d=r.style;d.fontFamily=i.fontFamily;let u=getComputedStyle(s);d.fontSize=u.fontSize,d.visibility="hidden";let B=s.key.layer;(typeof B!="string"||B=="")&&(B=i.layerId);let b=o.length,I=Math.ceil(b/9),h=Math.ceil(b/I);this.subkeys=[];let F=yn,y=0;for(let Z=0,U=0;Z<b;Z++,U++){let H=typeof o[Z].width!="undefined"?o[Z].width*s.offsetWidth/100:s.offsetWidth;H>i.width-2*yn&&(H=i.width-2*yn),(F+H+yn>i.width||U>=h)&&(y++,U=0,F=yn);let v=new Gi(o[Z],B).construct(i,s,H,y>0);F+=H+yn,this.menuWidth=Math.max((x=this.menuWidth)!=null?x:0,F),this.subkeys.push(v.firstChild),r.appendChild(v)}d.width=this.menuWidth+"px",this.shim=document.createElement("div"),this.shim.id="kmw-popup-shim",i.device.formFactor==W.FormFactor.Phone&&this.selectDefaultSubkey(s,r),i.element.appendChild(this.element),i.topContainer.appendChild(this.shim),this.reposition(i);let G=this.buildPopupRecognitionConfig(i);t({type:"push",config:G})}buildPopupRecognitionConfig(n){let t=this.element.getBoundingClientRect(),i=this.baseKey.getBoundingClientRect(),s=this.subkeys[0].style,l=-.666*Number.parseInt(s.height,10),o=3,r=i.bottom-t.bottom,d=new Ie(this.element,[l*o,l,-r<l?-r:l]),u={getBoundingClientRect(){let B=Number.MAX_SAFE_INTEGER;return new DOMRect(-B,-B,2*B,2*B)}};return{targetRoot:this.element,inputStartBounds:n.element,maxRoamingBounds:u,safeBounds:u,itemIdentifier:a((B,b)=>{let I=d.getBoundingClientRect(),h=null,F=Number.MAX_VALUE,y=Number.MAX_VALUE;if(B.clientX<I.left||B.clientX>I.right||B.clientY<I.top||B.clientY>I.bottom)return null;for(let G of this.subkeys){let x=G.getBoundingClientRect(),Z=Number.MAX_VALUE,U=Number.MAX_VALUE;if(x.left<=B.clientX&&B.clientX<x.right?Z=0:Z=x.left>=B.clientX?x.left-B.clientX:B.clientX-x.right,x.top<=B.clientY&&B.clientY<x.bottom?U=0:U=x.top>=B.clientY?x.top-B.clientY:B.clientY-x.bottom,Z==0&&U==0)return G;(Z<y||Z==y&&U<F)&&(y=Z,h=G,F=U)}return h},"itemIdentifier")}}reposition(n){let t=this.element,i=this.baseKey,s=n.topContainer,c=i.key.row.element,l=t.style,o=i.offsetParent?i.offsetParent.offsetLeft:0,r=i.offsetLeft+o+.5*(i.offsetWidth-t.offsetWidth),d=n.width-t.offsetWidth;r>d&&(r=d),r<0&&(r=0),l.left=r+"px";let u=s.getBoundingClientRect(),B=c.getBoundingClientRect();l.top=B.top-u.top-t.offsetHeight-ca+"px",l.visibility="visible";let b=n.isEmbedded,I=getComputedStyle(t),h=parseFloat(I.top),F=0,y=0;h<F&&b&&(y=F-h,l.top=F+"px"),this.callout=this.addCallout(i,y,n.element,n.topContainer,n.device.formFactor=="tablet")}addCallout(n,t,i,s,c){t=t||0;let l=getComputedStyle(this.element),o=Math.max(Number.parseInt(l.borderRadius),0),r=n.getBoundingClientRect(),d=s.getBoundingClientRect(),u=Math.floor(Number.parseInt(l.top,10)+Number.parseInt(l.height,10)+Number.parseInt(l.paddingTop,10)/2+Number.parseInt(l.paddingBottom,10)),B=ia*(r.height-t),b=ia*r.height,I=B+sa,h=I/(b+sa),F=r.bottom-d.top-u-1,y=F<I?F:I;if(y>0){let G=document.createElement("div"),x=G.style;G.id="kmw-popup-callout",i.appendChild(G),x.top=u+"px",x.borderTopWidth=y+"px";let Z=Vg*h,U=r.width*Z,H=this.menuWidth-2*o,L=H<U?H:U,v=r.left-d.left-(L-r.width)/2,Ae=Math.max(0,v+L-(d.right-o)),Ye=Math.max(0,o-v);return x.left=r.left-d.left-(L-r.width)/2+Ye+"px",x.borderLeftWidth=L/2-Ye+"px",x.borderRightWidth=L/2-Ae+"px",G}else return null}selectDefaultSubkey(n,t){var c;let i,s=n.subKeys;for(let l=0;l<s.length;l++){let o=s[l],r=t.childNodes[l].firstChild;if(o.default){i=r;break}else if(!n.key||!n.key.spec)continue;o.elementID==n.key.spec.elementID&&(i=r)}i&&((c=this.currentSelection)==null||c.key.highlight(!1),this.currentSelection=i,i.key.highlight(!0))}get hasModalVisualization(){return this.element.style.visibility=="visible"}buildCorrectiveLayout(){let n=this.element.getBoundingClientRect(),t=n.width/n.height;return{keys:this.subkeys.map(s=>{let c=s.getBoundingClientRect();return{keySpec:s.key.spec,centerX:(c.right-c.width/2-n.left)/n.width,centerY:(c.bottom-c.height/2-n.top)/n.height,width:c.width/n.width,height:c.height/n.height}}),kbdScaleRatio:t}}currentStageKeyDistribution(){let n=this.source.stageReports[this.source.stageReports.length-1],t=this.source.stageReports[0],i=n.sources[0],s=i.currentSample,c=this.element.getBoundingClientRect(),l={x:s.targetX/c.width,y:s.targetY/c.height};l.x=l.x<0?0:l.x>1?1:l.x,l.y=l.y<0?0:l.y>1?1:l.y;let o=Qs(l,this.buildCorrectiveLayout()),r=o.get(s.item.key.spec),d=Math.min(i.path.stats.duration-t.sources[0].path.stats.duration,this.gestureParams.longpress.waitLength)/(2*this.gestureParams.longpress.waitLength),u=Math.min(i.path.stats.rawDistance,this.gestureParams.longpress.noiseTolerance*4)/(this.gestureParams.longpress.noiseTolerance*8),B=Math.min(d*d,u*u),b=r+B,I=new Map,h=this.subkeys.find(F=>F.keyId==this.baseKey.keyId);return h?I.set(h.key.spec,b):I.set(this.baseKey.key.spec,b),It([o,I])}cancel(){this.clear(),this.source.cancel()}clear(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.shim.parentNode&&this.shim.parentNode.removeChild(this.shim),this.callout&&this.callout.parentNode&&this.callout.parentNode.removeChild(this.callout)}};a(Bo,"SubkeyPopup");var mn=Bo;var Io=class Io{constructor(n,t,i){this.directlyEmitsKeys=!0;this.shouldRestore=!1;this.hasModalVisualization=!1;let s=n.stageReports[0];this.originalLayer=s.sources[0].stateToken,this.source=n,this.completionCallback=()=>{t.lockLayer(!1),this.shouldRestore&&(t.layerId=this.originalLayer,t.updateState()),i==null||i()},t.lockLayer(!0),n.on("stage",c=>{let l=c.matchedId;l.includes("modipress")&&l.includes("-end")?this.clear():l.includes("modipress")&&l.includes("-hold")&&(this.shouldRestore=!0)}),n.on("complete",()=>this.cancel())}get isLocked(){return this.shouldRestore}setLocked(){this.shouldRestore=!0}get completed(){return this.completionCallback===null}clear(){let n=this.completionCallback;this.completionCallback=null,n==null||n()}cancel(){this.clear(),this.source.cancel()}currentStageKeyDistribution(n){return null}};a(Io,"Modipress");var bt=Io;var bo=class bo{constructor(n,t,i,s,c){this.directlyEmitsKeys=!0;this.hasModalVisualization=!1;this.tapIndex=0;this.baseKey=i,this.baseContextToken=s,this.multitaps=[i.key.spec].concat(i.key.spec.multitap),this.sequence=n;let l=a(B=>{var I;(I=this.modipress)==null||I.clear();let b=new bt(n,t,()=>{this.modipress=t.activeModipress=null});this.modipress=t.activeModipress=b},"startModipress");this.originalLayer=t.layerId,this.keyboardId=t.layoutKeyboard.id;let o=a(B=>(this.tapIndex+B)%this.multitaps.length,"tapLookahead"),r=a(()=>{c==null||c.setMultitapHint(this.multitaps[o(0)],this.multitaps[o(1)],t)},"updatePreview");n.on("complete",()=>{var B;(B=this.modipress)==null||B.cancel(),this.clear()});let d=a(B=>{var G;switch(B.matchedId){case"modipress-hold":this.clear(),n.off("stage",d);return;case"modipress-end-multitap-transition":case"modipress-multitap-end":case"modipress-end":case"multitap-end":case"simple-tap":return;case"modipress-multitap-lock-transition":(G=this.modipress)==null||G.setLocked();return;case"modipress-multitap-start":case"multitap-start":break;default:throw new Error(`Unsupported gesture state encountered during multitap: 
${this.sequence.trace()}`)}this.tapIndex=o(1);let b=this.multitaps[this.tapIndex];r();let I=t.keyEventFromSpec(b);I.baseTranscriptionToken=this.baseContextToken,this.baseContextToken==null&&console.warn("Multitap init warning:  no associated base context (with base key "+i.key.spec.coreID+")");let h=B.sources[0].currentSample,F=this.baseKey.key.spec,y=t.getSimpleTapCorrectionDistances(h,F);if(h.stateToken!=t.layerId&&!B.matchedId.includes("modipress")){let x=t.layerGroup.findNearestKey(A(p({},h),{stateToken:t.layerId}));if(Hs(x.key.spec)){let Z=y.get(x.key.spec);Z==null?console.warn(`Could not find fat-finger probability for current layer's key:  current key = ${x.key.spec.elementID}, current layer = ${t.layerId}, keyboard = ${this.keyboardId}`):(y.delete(x.key.spec),y.set(h.item.key.spec,Z))}}h.item&&Hs(h.item.key.spec)&&(I.keyDistribution=this.currentStageKeyDistribution(y)),I.kNextLayer||(I.kNextLayer=this.originalLayer),I.inputBreadcrumb=this.sequence.trace(),t.raiseKeyEvent(I,null),B.matchedId=="modipress-multitap-start"&&l(B)},"stageHandler");n.on("stage",d),n.stageReports[0].matchedId=="modipress-start"&&l(n.stageReports[0]),r()}currentStageKeyDistribution(n){let t=It(n),i=t.findIndex(r=>r.keySpec==this.baseKey.key.spec);if(i==-1)return gi(this.baseKey)||console.warn(`Could not find base key's probability for multitap correction adjustments: ${this.baseKey.key.spec.elementID}, keyboard = ${this.keyboardId}`),t;let s=t.splice(i,1)[0].p,c=0,l=[];for(let r=0;r<this.multitaps.length;r++){let d=this.multitaps[r],u=Math.abs(r-this.tapIndex)%this.multitaps.length,B=(r+this.multitaps.length-this.tapIndex)%this.multitaps.length,b=u<B?u:B,I=1/((1+b)*(1+b));c+=I,l.push({keySpec:d,p:I})}let o=s/c;return l.forEach(r=>{r.p=o*r.p}),t.concat(l).sort((r,d)=>d.p-r.p)}cancel(){this.clear(),this.sequence.cancel()}clear(){}};a(bo,"Multitap");var pi=bo;var Ci=1.4142,ho=a(g=>Math.abs(g)<1e-10?0:g,"coerceZeroes"),Fo=class Fo extends S.default{constructor(t,i,s,c){var b;super();this.flickPreviews=new Map;this.orientation="top";let l=t.key.spec,o=this.flickEdgeLength=Math.max(s,c),r=this.div=document.createElement("div");r.className=r.id="kmw-gesture-preview",r.style.pointerEvents="none";let d=this.previewImgContainer=document.createElement("div");this.previewImgContainer.id="kmw-preview-img-container";let u=this.label=document.createElement("span");if(u.className="kmw-gesture-base-label kmw-key-text",u.id="kmw-gesture-base-label",d.appendChild(u),u.textContent=t.key.label.textContent,this.div.appendChild(this.previewImgContainer),l.flick){let I=l.flick||{};Object.keys(I).forEach(h=>{let F=document.createElement("div");F.className="kmw-flick-preview kmw-key-text",F.textContent=I[h].text;let y=F.style,G=Ml.get(h),x=ho(-Math.sin(G[0])),Z=ho(Math.cos(G[0]));y.width="100%",y.textAlign="center",x<0?y.right=-x*Ci*o+"px":x>0?y.left=x*Ci*o+"px":y.left="0px",y.height="100%",y.lineHeight="100%",Z<0?y.bottom=-Z*Ci*o+"px":Z>0?y.top=Z*Ci*o+"px":y.top="0px",this.flickPreviews.set(h,F),d.appendChild(F)})}let B=this.hintLabel=document.createElement("div");B.className="kmw-key-popup-icon",i||(B.textContent=l==l.hintSrc?l.hint:(b=l.hintSrc)==null?void 0:b.text,B.style.fontWeight=B.textContent=="•"?"bold":""),r.appendChild(B)}get element(){return this.div}refreshLayout(){let t=getComputedStyle(this.div),i=Number.parseInt(t.height,10);this.flickPreviews.forEach(s=>{s.style.lineHeight=s.style.height=`${i}px`})}cancel(){var t;(t=this.onCancel)==null||t.call(this),this.onCancel=null}setCancellationHandler(t){this.onCancel=t}setMultitapHint(t,i,s){var o,r;let c=Nt(t.text,s),l=Nt(i.text,s);this.label.textContent=c,this.hintLabel.textContent=l,this.label.style.fontFamily=c!=t.text?"SpecialOSK":(o=t.font)!=null?o:this.label.style.fontFamily,this.hintLabel.style.fontFamily=l!=i.text?"SpecialOSK":(r=i.font)!=null?r:this.hintLabel.style.fontFamily,this.emit("startFade"),this.clearFlick()}scrollFlickPreview(t,i){this.clearHint();let s=this.previewImgContainer.style,c=this.flickEdgeLength*Ci;s.marginLeft=`${c*t}px`,s.marginTop=`${c*i}px`;let l=ho(i)<0?"bottom":"top";this.orientation!=l&&(this.orientation=l,this.emit("preferredOrientation",l))}clearFlick(){this.previewImgContainer.style.marginTop="0px",this.previewImgContainer.style.marginLeft="0px",this.previewImgContainer.classList.add("kmw-flick-clear")}clearHint(){this.hintLabel.classList.add("kmw-hint-clear")}clearAll(){this.clearFlick()}};a(Fo,"GesturePreviewHost");var Ns=Fo;var la=it.TIER!="stable"||it.VERSION_ENVIRONMENT!="",Sg=la?10:0,Qi=class Qi extends S.default{constructor(t){var d,u,B;super();this.layerLocked=!1;this.layerIndex=0;this.isStatic=!1;this._fixedWidthScaling=!1;this._fixedHeightScaling=!0;this._borderWidth=0;this.stateKeys={K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1};this.activeGestures=[];this.activeModipress=null;this.config=t,this.config.device=t.device||t.hostDevice,this.config.isEmbedded=t.isEmbedded||!1,t.isStatic&&(this.isStatic=t.isStatic),(d=this.config).gestureParams||(d.gestureParams=p({},ai)),this._fixedWidthScaling=this.device.touchable&&!this.isStatic,this._fixedHeightScaling=this.device.touchable&&!this.isStatic;let i=document.createElement("div");this.config.styleSheetManager=t.styleSheetManager||new ue(i);let s;if(t.keyboard)s=this.kbdLayout=t.keyboard.layout(t.device.formFactor),this.layoutKeyboardProperties=t.keyboardMetadata,this.isRTL=t.keyboard.isRTL;else{let b=T.buildDefaultLayout(null,null,t.device.formFactor);s=this.kbdLayout=jt.polyfill(b,null,t.device.formFactor),this.layoutKeyboardProperties=null,this.isRTL=!1}"font"in s?this.fontFamily=s.font:this.fontFamily="";let c=t.device.formFactor;this.layoutKeyboard=t.keyboard,this.layoutKeyboard||(this.layoutKeyboard=new w(null)),this.layerGroup=new yi(this,this.layoutKeyboard,c),i.appendChild(this.layerGroup.element),this.kbdDiv=i,this.isStatic||(this.gestureEngine=this.constructGestureEngine()),i.classList.add(t.device.formFactor,"kmw-osk-inner-frame");let l=(B=(u=this.layoutKeyboard)==null?void 0:u.id.replace("Keyboard_",""))!=null?B:"",o=l.indexOf("::");o!=-1&&(l=l.substring(o+2));let r="kmw-keyboard-"+l;this.element.classList.add(r)}get gestureParams(){return this.config.gestureParams}get layerId(){var t,i;return(i=(t=this.layerGroup)==null?void 0:t.activeLayerId)!=null?i:"default"}set layerId(t){let i=t!=this.layerId;if(this.layerGroup.getLayer(t))this.layerGroup.activeLayerId=t,this.gestureEngine&&(this.gestureEngine.stateToken=t);else throw new Error(`Keyboard ${this.layoutKeyboard.id} does not have a layer with id ${t}`);i&&!this.deferLayout&&(this.updateState(),this.layerGroup.refreshLayout(this.constructLayoutParams()))}get currentLayer(){var t;return(t=this.layerGroup)==null?void 0:t.activeLayer}get lgKey(){var t,i;return(i=(t=this.currentLayer)==null?void 0:t.globeKey)==null?void 0:i.btn}get hkKey(){var t,i;return(i=(t=this.currentLayer)==null?void 0:t.hideKey)==null?void 0:i.btn}get spaceBar(){var t,i;return(i=(t=this.currentLayer)==null?void 0:t.spaceBarKey)==null?void 0:i.btn}constructGestureEngine(){let t={targetRoot:this.element,mouseEventRoot:document.body,maxRoamingBounds:new Ie(this.topContainer,[NaN]),itemIdentifier:a((o,r)=>this.layerGroup.findNearestKey(o),"itemIdentifier"),recordingMode:la,historyLength:Sg},i=new Lt(Kl(this.kbdLayout,this.gestureParams),t);i.stateToken=this.layerId;let s={},c=a(o=>{for(let r of Object.keys(s)){if(r==o)continue;s[r].source.terminate(!0)}},"clearActiveGestures"),l=new Map;return i.on("inputstart",o=>{var B;let r=this.highlightKey(o.currentSample.item,!0);r&&((B=this.gesturePreviewHost)==null||B.cancel(),this.gesturePreviewHost=r),s[o.identifier]={source:o,roamingHighlightHandler:null,key:o.currentSample.item,previewHost:r};let d=s[o.identifier],u=a(()=>{de(0).then(()=>{let b=d.previewHost;b&&(b.cancel(),this.gesturePreviewHost=null,d.previewHost=null),d.key&&(this.highlightKey(d.key,!1),d.key=null)})},"endHighlighting");d.roamingHighlightHandler=b=>{var F;let I=b.item,h=s[o.identifier].key;if(!this.kbdLayout.hasFlicks&&I!=h){this.highlightKey(h,!1),(F=this.gesturePreviewHost)==null||F.cancel(),this.gesturePreviewHost=null,d.previewHost=null;let y=this.highlightKey(I,!0);y&&(this.gesturePreviewHost=y,d.previewHost=y),s[o.identifier].key=I}},o.path.on("invalidated",u),o.path.on("complete",u),o.path.on("step",d.roamingHighlightHandler)}),i.on("recognizedgesture",o=>{var r;(r=this.activeModipress)==null||r.setLocked(),o.on("complete",()=>{var d;for(let u of o.allSourceIds)(d=s[u])!=null&&d.previewHost&&(this.gesturePreviewHost=null,s[u].previewHost.cancel()),delete s[u]}),o.on("stage",(d,u)=>{let B=o.allSourceIds.map(Z=>{var U;return(U=s[Z])==null?void 0:U.previewHost}).find(Z=>!!Z),b=a(()=>{B&&(B.cancel(),this.gesturePreviewHost=null)},"clearPreviewHost"),I=l.get(o);!I&&B&&!d.matchedId.includes("flick")&&B.clearFlick();let h;for(let Z of d.allSourceIds){let U=a(H=>{H.key&&(this.highlightKey(H.key,!1),H.key=null),H.source.path.off("step",H.roamingHighlightHandler)},"clearRoaming");if(h=s[Z],h)U(h);else{let H=Z;de(0).then(()=>{let L=s[H];L&&U(L)})}}let F=d.item,y=d.sources[0],G=null;if(F&&!(I&&I[0].directlyEmitsKeys)){let Z,U=this.getSimpleTapCorrectionDistances(y.currentSample,F.key.spec);I&&(Z=I[0].currentStageKeyDistribution(U)),Z||(Z=It(U));let H=!this.layerLocked&&I&&I[0]instanceof mn&&I[0].shouldLockLayer;try{H&&this.lockLayer(!0),G=this.modelKeyClick(o,Z)}finally{H&&this.lockLayer(!1)}}if(o.stageReports.length>1&&d.matchedId!="modipress-end")return;let x=o.stageReports[0].item;if(d.matchedId=="special-key-start")F.key.spec.baseKeyID=="K_BKSP"?(b(),I=[new Js(o,()=>this.modelKeyClick(o))]):F.key.spec.baseKeyID=="K_LOPT"&&(o.on("complete",()=>{F.key.highlight(!1),this.emit("globekey",F,!1)}),c(y.identifier),F.key.highlight(!0));else if(d.matchedId.indexOf("longpress")>-1)b(),I=[new mn(o,u,this,o.stageReports[0].sources[0].baseItem,this.gestureParams)];else if(x!=null&&x.key.spec.multitap&&(d.matchedId=="initial-tap"||d.matchedId=="multitap"||d.matchedId=="modipress-start"))h.previewHost=null,o.on("complete",()=>{b()}),I=[new pi(o,this,x,G.contextToken,B)];else if(d.matchedId.indexOf("flick")>-1)I=[new oi(o,u,this,o.stageReports[0].sources[0].baseItem,this.gestureParams,B)];else if(d.matchedId.includes("modipress")&&d.matchedId.includes("-start"))if(b(),this.layerLocked)console.warn("Unexpected state:  modipress start attempt during an active modipress");else{I||(I=[]);let Z=new bt(o,this,()=>{let U=I.indexOf(Z);U>-1&&I.splice(U,1),this.activeModipress=null});I.push(Z),this.activeModipress=Z}else b();I&&(this.activeGestures=this.activeGestures.concat(I),l.set(o,I),o.on("complete",()=>{let Z=this.activeGestures.filter(U=>I.includes(U));this.activeGestures=this.activeGestures.filter(U=>!I.includes(U)),Z.forEach(U=>{U instanceof bt&&U.cancel()})}))})}),i}get element(){return this.kbdDiv}get device(){return this.config.device}get hostDevice(){return this.config.hostDevice}get fontRootPath(){return this.config.pathConfig.fonts}get styleSheetManager(){return this.config.styleSheetManager}get topContainer(){return this.config.topContainer}get isEmbedded(){return this.config.isEmbedded}postInsert(){}get width(){return this._width}get height(){return this._height}get layoutWidth(){if(this.usesFixedWidthScaling){let t=this.width;return t-=this._borderWidth*2,X.inPixels(t)}else return X.forScalar(1)}get layoutHeight(){if(this.usesFixedHeightScaling){let t=this.height;return t-=this._borderWidth*2,t=isNaN(t)||t<0?0:t,X.inPixels(t)}else return X.forScalar(1)}get internalHeight(){return this.usesFixedHeightScaling?X.inPixels(this.layoutHeight.val-this._borderWidth*2-this.layerGroup.verticalPadding):X.forScalar(1)}get fontSize(){return this._fontSize||(this._fontSize=new X("1em")),this._fontSize}set fontSize(t){this._fontSize=t,this.kbdDiv.style.fontSize=t.styleString}get usesFixedWidthScaling(){return this._fixedWidthScaling}set usesFixedWidthScaling(t){this._fixedWidthScaling=t}get usesFixedHeightScaling(){return this._fixedHeightScaling}set usesFixedHeightScaling(t){this._fixedHeightScaling=t}get usesFixedPositioning(){let t=this.element;for(;t;){if(getComputedStyle(t).position=="fixed")return!0;t=t.offsetParent}return!1}setSize(t,i,s){this._width=t,this._height=i,this.kbdDiv&&(this.kbdDiv.style.width=t?this._width+"px":"",this.kbdDiv.style.height=i?this._height+"px":"",!this.device.touchable&&i&&(this.fontSize=new X(this._height/8+"px")),s||this.refreshLayout())}getTouchCoordinatesOnKeyboard(t){let i={x:t.targetX,y:t.targetY};return i.x/=this.layerGroup.element.offsetWidth,i.y/=this.kbdDiv.offsetHeight,i}getSimpleTapCorrectionDistances(t,i){let s=this.getTouchCoordinatesOnKeyboard(t),l=this.layerGroup.element.offsetWidth,o=this.kbdDiv.offsetHeight;if(!l||!o)return new Map;let r=l/o,d=ea(this.kbdLayout.getLayer(this.layerId),r);return Qs(s,d)}modelKeyClick(t,i){var r;if(!t)throw new Error("cannot model key event without its gesture");let s=t.stageReports[t.stageReports.length-1],c=s.item,l=(r=s.sources[0])==null?void 0:r.currentSample;if(!c)throw new Error(`Cannot model keypress without a selected key: 
${t.trace()}`);let o=this.initKeyEvent(c);return l&&(o.source=l),i&&(o.keyDistribution=i),o.inputBreadcrumb=t.trace(),this.raiseKeyEvent(o,c)}initKeyEvent(t){this.highlightKey(t,!1);let i=t.key?t.key.spec:null;return i?this.keyEventFromSpec(i):null}keyEventFromSpec(t){let i=this.layoutKeyboard.constructKeyEvent(t,this.device,this.stateKeys);return i.srcKeyboard=this.layoutKeyboard,i}_UpdateVKShiftStyle(t){var o;let i;t||(t=this.layerId);let s=this.layerGroup.getLayer(t);if(!s||(this.gestureEngine&&(this.gestureEngine.stateToken=t),!((o=this.layoutKeyboard)!=null&&o.usesDesktopLayoutOnDevice(this.device))))return;let c=["K_CAPS","K_NUMLOCK","K_SCROLL"],l=[s.capsKey,s.numKey,s.scrollKey];for(i=0;i<l.length;i++)l[i]!=null&&l[i].setToggleState(this.stateKeys[c[i]])}updateStateKeys(t){for(let i of Object.keys(this.stateKeys))this.stateKeys[i]=t[i];this._UpdateVKShiftStyle()}highlightKey(t,i){if(!t||!t.key||t.className==""||t.className.indexOf("kmw-key-row")>=0)return null;let s=t.key.allowsKeyTip();return i=this.activeGestures.find(l=>l.hasModalVisualization)?!1:i,t.key.highlight(i),i&&s?this.gesturePreviewHost?null:this.showGesturePreview(t):null}getKeyEmFontSize(){if(this.device.formFactor=="desktop")return this.fontSize.scaledBy(.8);{let t=getComputedStyle(document.body).fontSize,i=new X(t),s=1;if(!this.isStatic){if(this.fontSize.absolute)return this.fontSize;s=this.fontSize.val}return i.scaledBy(s)}}updateState(){this.currentLayer&&(this.nextLayer=this.layerId,this.currentLayer.nextlayer&&(this.nextLayer=this.currentLayer.nextlayer),this.layerGroup.activeLayerId=this.layerId,this._UpdateVKShiftStyle())}refreshLayout(){if(this.deferLayout)return;let t=this.device,i=1;t.OS==W.OperatingSystem.iOS&&!this.isEmbedded&&(i=i/Se(this.device.formFactor));let s=this.kbdDiv.style;this.usesFixedHeightScaling&&this.height&&(s.height=s.maxHeight=this.height+"px"),s.fontSize=this.fontSize.scaledBy(i).styleString;let c=this.width&&this.height,l=getComputedStyle(this.kbdDiv),o=getComputedStyle(this.layerGroup.element),r=l.height!=""&&l.height!="auto",d=o.height!=""&&o.height!="auto";if(l.border&&(this._borderWidth=new X(l.borderWidth).val),c)this._computedWidth=this.width,this._computedHeight=this.height;else if(r)this._computedWidth=parseInt(l.width,10),this._computedHeight=parseInt(l.height,10);else if(d)this._computedWidth=parseInt(o.width,10),this._computedHeight=parseInt(o.height,10);else return;this.layerGroup.refreshLayout(this.constructLayoutParams()),this.isStatic||(this.gestureEngine.config.maxRoamingBounds.updatePadding([-.333*this.currentLayer.rowHeight]),this.gestureParams.longpress.flickDistStart=.24*this.currentLayer.rowHeight,this.gestureParams.flick.startDist=.3*this.currentLayer.rowHeight,this.gestureParams.flick.dirLockDist=.35*this.currentLayer.rowHeight,this.gestureParams.flick.triggerDist=.75*this.currentLayer.rowHeight,this.gestureParams.longpress.flickDistFinal=.75*this.currentLayer.rowHeight)}constructLayoutParams(){var t,i;return{keyboardWidth:this._computedWidth-2*this._borderWidth,keyboardHeight:this._computedHeight-2*this._borderWidth-this.layerGroup.verticalPadding,widthStyle:this.layoutWidth,heightStyle:this.internalHeight,baseEmFontSize:this.getKeyEmFontSize(),layoutFontSize:new X(this.layerGroup.element.style.fontSize),spacebarText:(i=(t=this.layoutKeyboardProperties)==null?void 0:t.displayName)!=null?i:"(System keyboard)"}}appendStyleSheet(){let t=this.layoutKeyboard,i=this.layoutKeyboardProperties;this.styleSheet&&this.styleSheet.parentNode&&this.styleSheet.parentNode.removeChild(this.styleSheet);let s=i==null?void 0:i.textFont,c=i==null?void 0:i.oskFont;this.styleSheetManager.addStyleSheetForFont(s,this.fontRootPath,this.device.OS),this.styleSheetManager.addStyleSheetForFont(c,this.fontRootPath,this.device.OS),this.config.specialFont&&this.styleSheetManager.addStyleSheetForFont(this.config.specialFont,"",this.device.OS);let l=this.addFontStyle(s,c);t!=null&&typeof t.oskStyling=="string"&&(l=l+t.oskStyling),l&&(this.styleSheet=ot(l),this.styleSheetManager.linkStylesheet(this.styleSheet)),this.styleSheetManager.allLoadedPromise().then(()=>{this.layerGroup.resetPrecalcFontSizes(),this.refreshLayout()})}addFontStyle(t,i){let s="",c=a(l=>l.family.replace(/\u0022/g,"").replace(/,/g,'","'),"family");return(t||i)&&(s=`
.kmw-key-text {
  font-family: "${c(i||t)}";
}

.kmw-suggestion-text {
  font-family: "${c(t||i)}";
}
`),s}static buildDocumentationKeyboard(t,i,s,c,l,o){if(!t)return null;let r=typeof c=="undefined"?"desktop":c,d=typeof l=="undefined"?"default":l,u={};u.formFactor=r,r!="desktop"?(u.OS=W.OperatingSystem.iOS,u.touchable=!0):(u.OS=W.OperatingSystem.Windows,u.touchable=!1);let B=t.layout(r),b=new W("other",u.formFactor,u.OS,u.touchable),I=new Qi({keyboard:t,keyboardMetadata:i,hostDevice:b,isStatic:!0,topContainer:null,pathConfig:s,styleSheetManager:null,specialFont:{family:"SpecialOSK",files:[`${s.resources}/osk/keymanweb-osk.ttf`],path:""}});I.layerGroup.element.className=I.kbdDiv.className,I.layerGroup.element.classList.add(u.formFactor+"-static");let h=I.kbdDiv.childNodes[0],F=document.createElement("div");F.classList.add(u.OS.toLowerCase(),u.formFactor),B!=null?(I.layerId=d,I.layerGroup.activeLayerId=d,I.setSize(800,o),I.fontSize=jr(b,o,!1),F.style.fontSize=I.element.style.fontSize,I.refreshLayout(),h.style.height=I.kbdDiv.style.height,h.style.maxHeight=I.kbdDiv.style.maxHeight):h.innerHTML="<p style='color:#c40; font-size:0.5em;margin:10px;'>No "+r+" layout is defined for "+t.name+".</p>",h.style.border="1px solid #ccc",I.updateState();let y=a(()=>R(this,null,function*(){if(document.contains(h))try{yield I.styleSheetManager.allLoadedPromise();let x=I.styleSheet;x&&h.appendChild(x);let Z=[].concat(I.styleSheetManager.sheets);for(let U of Z)U!=x&&(U.href||(I.styleSheetManager.unlink(U),document.head.appendChild(U)));I.refreshLayout(),I.styleSheet=null,I.shutdown()}finally{G.disconnect()}}),"detectAndHandleInsertion"),G=new MutationObserver(y);G.observe(document.body,{childList:!0,subtree:!0}),F.append(h);for(let x of pe.STYLESHEET_FILES){let Z=`${s.resources}/osk/${x}`,U=I.styleSheetManager.linkExternalSheet(Z,!0);U.parentNode.removeChild(U),F.appendChild(U)}return I.appendStyleSheet(),delete I._width,delete I._height,F}onHide(){this.hkKey&&this.highlightKey(this.hkKey,!1)}optionKey(t,i,s){i.indexOf("K_LOPT")>=0?this.emit("globekey",t,s):i.indexOf("K_ROPT")>=0&&s&&this.emit("hiderequested",t)}showGesturePreview(t){let i=this.keytip,s=this.constructLayoutParams(),c=s.keyboardWidth*t.key.spec.proportionalWidth,l=s.keyboardHeight/this.currentLayer.rows.length,o=new Ns(t,this.device.formFactor=="phone",c,l);return i==null?t.key.setPreview(o):i.show(t,!0,o),o.refreshLayout(),o}createKeyTip(){if(this.keytip==null)if(this.device.formFactor=="phone"){let t=this.isEmbedded;this.keytip=new mi(this,t)}else this.keytip=new vs(this);this.keytip&&this.keytip.element&&this.element.appendChild(this.keytip.element)}createGlobeHint(){return this.config.embeddedGestureConfig.createGlobeHint?this.config.embeddedGestureConfig.createGlobeHint(this):null}shutdown(){var t;this.styleSheet&&this.styleSheet.parentNode&&this.styleSheet.parentNode.removeChild(this.styleSheet),this.activeGestures.forEach(i=>i.cancel()),this.gestureEngine&&this.gestureEngine.destroy(),this.deleting&&window.clearTimeout(this.deleting),(t=this.keytip)==null||t.show(null,!1,null)}lockLayer(t){this.layerLocked=t}raiseKeyEvent(t,i){if(t.kName=="K_LOPT"||t.kName=="K_ROPT")return this.optionKey(i,t.kName,!0),{};let s={},c=a((l,o)=>{var d,u;s.contextToken=(d=l==null?void 0:l.transcription)==null?void 0:d.token;let r=(u=l==null?void 0:l.transcription)==null?void 0:u.transform;s.alteredText=l&&(!r||Wt(r))},"keyEventCallback");return this.layerLocked&&(t.kNextLayer=this.layerId),this.emit("keyevent",t,c),s}};a(Qi,"VisualKeyboard"),Qi.specialCharacters=Ee.specialCharacters;var Ge=Qi;var yo=class yo extends S.default{};a(yo,"Activator");var _e=yo,mo=class mo extends _e{get enabled(){return!0}set enabled(n){}get activate(){return!0}get conditionsMet(){return!0}};a(mo,"StaticActivator");var Et=mo;var Go=class Go{constructor(){this.map=new Map}promiseForTouchpoint(n){return this.map.get(n)||this.map.set(n,new f),this.map.get(n)}maintainTouches(n){let t=Array.from(this.map.keys());for(let i=0;i<n.length;i++){let s=t.indexOf(n.item(i).identifier);s!=-1&&t.splice(s,1)}for(let i of t)this.map.get(i).resolve(),this.map.delete(i)}};a(Go,"TouchEventPromiseMap");var Ui=Go;function oa(g){let n="osk/";return g.isEmbedded&&(n=""),`${g.pathConfig.resources}/${n}`}a(oa,"getResourcePath");var Gn=class Gn extends S.default{constructor(t){var s;super();this.legacyEvents=new dn;this.needsLayout=!0;this.touchEventPromiseManager=new Ui;this.activationListener=a(t=>{if(!this.mayDisable&&!this.activationModel.enabled){this.activationModel.off("activate",this.activationListener);try{this.activationModel.enabled=!0}finally{this.activationModel.on("activate",this.activationListener)}}this.commonCheckAndDisplay()},"activationListener");this.layerChangeHandler=a((t,i)=>{var s,c;return this.vkbd&&this.vkbd._UpdateVKShiftStyle(i),(this.vkbd&&this.vkbd.layerId!=i||t.value!=i)&&(s=this.vkbd)!=null&&s.layerGroup.getLayer(i)&&!((c=this.vkbd)!=null&&c.layerLocked)&&(this.vkbd.layerId=i),!1},"layerChangeHandler");this._Visible=!1;this.config=t=p({},t),(s=this.config).gestureParams||(s.gestureParams=ai),this.config.allowHideAnimations===void 0&&(this.config.allowHideAnimations=!0),this.config.device=t.device||t.hostDevice,this.config.isEmbedded=t.isEmbedded||!1,this.config.embeddedGestureConfig=t.embeddedGestureConfig||{},this.config.activator.on("activate",this.activationListener),this._Box=N("div"),this.kbdStyleSheetManager=new ue(this._Box,this.config.doCacheBusting||!1),this.uiStyleSheetManager=new ue(this._Box),this.bannerView=new as,this.bannerView.events.on("bannerchange",()=>this.refreshLayout()),this._Box.appendChild(this.bannerView.element),this._bannerController=new Bi(this.bannerView,this.hostDevice,this.config.predictionContextManager),this.keyboardView=this._GenerateKeyboardView(null,null),this._Box.appendChild(this.keyboardView.element);let i=oa(this.config);for(let c of Gn.STYLESHEET_FILES){let l=`${i}${c}`;this.uiStyleSheetManager.linkExternalSheet(l)}this.setBaseMouseEventListeners(),this.hostDevice.touchable&&this.setBaseTouchEventListeners(),this._Box.style.display="none"}get keyCodes(){return C.keyCodes}get modifierCodes(){return C.modifierCodes}get modifierBitmasks(){return C.modifierBitmasks}get stateBitmasks(){return C.stateBitmasks}get gestureParams(){return this.config.gestureParams}get configuration(){return this.config}get bannerController(){return this._bannerController}get hostDevice(){return this.config.hostDevice}get fontRootPath(){return this.config.pathConfig.fonts}get isEmbedded(){return this.config.isEmbedded}setBaseMouseEventListeners(){this._Box.onmouseenter=t=>{this.mouseEnterPromise&&this.mouseEnterPromise.resolve(),this.mouseEnterPromise=new f,this.emit("pointerinteraction",this.mouseEnterPromise.corePromise)},this._Box.onmouseleave=t=>{this.mouseEnterPromise.resolve(),this.mouseEnterPromise=null}}removeBaseMouseEventListeners(){this._Box.onmouseenter=null,this._Box.onmouseleave=null}setBaseTouchEventListeners(){let t=a(function(i){return i.cancelable&&i.preventDefault(),i.stopPropagation(),!1},"commonPrevention");this._boxBaseTouchEventCancel=i=>(this.touchEventPromiseManager.maintainTouches(i.touches),t(i)),this._boxBaseTouchStart=i=>{for(let s=0;s<i.changedTouches.length;s++){let c=this.touchEventPromiseManager.promiseForTouchpoint(i.changedTouches[s].identifier);this.emit("pointerinteraction",c.corePromise)}return this.touchEventPromiseManager.maintainTouches(i.touches),t(i)},this._Box.addEventListener("touchstart",this._boxBaseTouchStart,!1),this._Box.addEventListener("touchmove",this._boxBaseTouchEventCancel,!1),this._Box.addEventListener("touchend",this._boxBaseTouchEventCancel,!1),this._Box.addEventListener("touchcancel",this._boxBaseTouchEventCancel,!1)}removeBaseTouchEventListeners(){this._boxBaseTouchEventCancel&&(this._Box.removeEventListener("touchstart",this._boxBaseTouchStart,!1),this._Box.removeEventListener("touchmove",this._boxBaseTouchEventCancel,!1),this._Box.removeEventListener("touchend",this._boxBaseTouchEventCancel,!1),this._Box.removeEventListener("touchcancel",this._boxBaseTouchEventCancel,!1),this._boxBaseTouchEventCancel=null,this._boxBaseTouchStart=null)}get targetDevice(){return this.config.device}set targetDevice(t){this.allowsDeviceChange(t)?(this.config.device=t,this.loadActiveKeyboard()):console.error("May not change target device for this OSKView type.")}allowsDeviceChange(t){return!1}get activationModel(){return this.config.activator}set activationModel(t){if(!t)throw new Error("The activation model may not be set to null or undefined!");this.config.activator.off("activate",this.activationListener),t.on("activate",this.activationListener),this.config.activator=t,this.commonCheckAndDisplay()}get mayDisable(){var t;return!(this.hostDevice.touchable||(t=this.activeKeyboard)!=null&&t.keyboard.isCJK)}get displayIfActive(){return this.activationModel.enabled}commonCheckAndDisplay(){this.activationModel.activate&&this.activeKeyboard?this.present():this.startHide(!1)}get vkbd(){return this.keyboardView instanceof Ge?this.keyboardView:null}get banner(){return this.bannerView}get width(){return this._width}get height(){return this._height}get computedWidth(){return this.needsLayout&&this.refreshLayout(),this._computedWidth}get computedHeight(){return this.needsLayout&&this.refreshLayout(),this._computedHeight}get baseFontSize(){var t;return((t=this.parsedBaseFontSize)==null?void 0:t.styleString)||""}get parsedBaseFontSize(){var c,l;this._baseFontSize||(this._baseFontSize=Gn.defaultFontSize(this.targetDevice,this.computedHeight,this.isEmbedded));let t=(l=(c=this.vkbd)==null?void 0:c.layerGroup)==null?void 0:l.spec.fontsize;t===""&&(t="1em");let i=Number(t),s=isNaN(i)?t:i+"pt";if(s){let o=new X(s);return o.absolute?o:this._baseFontSize.scaledBy(o.val)}else return this._baseFontSize}static defaultFontSize(t,i,s){if(t.touchable){let c=t.formFactor=="phone"?1.6*(s?.65:.6)*1.2:2;return X.special(c,"em")}else return i?X.inPixels(i/8):void 0}get activeKeyboard(){return this.keyboardData}set activeKeyboard(t){var i;this.keyboardData=t,this.loadActiveKeyboard(),(i=this.keyboardData)!=null&&i.keyboard.isCJK&&(this.activationModel.enabled=!0)}computeFrameHeight(){var t,i;return(((t=this.headerView)==null?void 0:t.layoutHeight.val)||0)+(((i=this.footerView)==null?void 0:i.layoutHeight.val)||0)}setSize(t,i,s){let c=!1,l,o;!t&&t!==0||!i&&i!==0||(Number.isFinite(t)?l=X.inPixels(t):l=new X(t),Number.isFinite(i)?o=X.inPixels(i):o=new X(i),t&&i&&(c=!this._width||!this._height,c=c||l.styleString!=this._width.styleString,c=c||o.styleString!=this._height.styleString,this._width=l,this._height=o),this.needsLayout=this.needsLayout||c,this.refreshLayoutIfNeeded(s))}setNeedsLayout(){this.needsLayout=!0}batchLayoutAfter(t){if(this.deferLayout){t();return}let i=this.vkbd;try{this.deferLayout=!0,i&&(i.deferLayout=!0),t()}finally{this.deferLayout=!1,i&&(i.deferLayout=!1),this.vkbd&&(this.vkbd.deferLayout=!1),this.refreshLayout()}}refreshLayout(t){var o,r;if(!this.keyboardView||this.deferLayout||!(this.width&&this.height))return;let s=this.width.absolute&&this.height.absolute,c=getComputedStyle(this._Box),l=c.height!=""&&c.height!="auto";if(s)this._computedWidth=this.width.val,this._computedHeight=this.height.val;else if(l){let d=this._Box.parentElement;this._computedWidth=this.width.val*(this.width.absolute?1:d.offsetWidth),this._computedHeight=this.height.val*(this.height.absolute?1:d.offsetHeight)}else{console.warn("Unable to properly perform layout - specification uses a relative spec, thus relies upon insertion into the DOM for layout.");return}if(this.needsLayout=!1,this.banner.element.style.fontSize=this.baseFontSize,this.vkbd&&(this.vkbd.fontSize=this.parsedBaseFontSize),t||((o=this.headerView)==null||o.refreshLayout(),this.bannerView.width=this.computedWidth,this.bannerView.refreshLayout(),(r=this.footerView)==null||r.refreshLayout()),this.vkbd){let d=this.computedHeight-this.computeFrameHeight();this.bannerView.height>0&&(d-=this.bannerView.height+5),this.vkbd.setSize(this.computedWidth,d,t);let u=this._Box.style;u.width=u.maxWidth=this.computedWidth+"px",u.height=u.maxHeight=this.computedHeight+"px"}else{let d=this._Box.style;d.width="auto",d.height="auto",d.maxWidth=d.maxHeight=""}}refreshLayoutIfNeeded(t){this.needsLayout&&this.refreshLayout(t)}postKeyboardLoad(){this._Visible=!1,this.postKeyboardAdjustments(),this.displayIfActive&&this.present()}loadActiveKeyboard(){var c,l,o,r,d;this.setBoxStyling(),this.needsLayout=!0;let t=this.keyboardView,i=this.kbdStyleSheetManager;this.kbdStyleSheetManager=new ue(this._Box,this.config.doCacheBusting||!1);let s=this.keyboardView=this._GenerateKeyboardView((c=this.keyboardData)==null?void 0:c.keyboard,(l=this.keyboardData)==null?void 0:l.metadata);if(this._Box.replaceChild(s.element,t.element),s.postInsert(),(d=this.bannerController)==null||d.configureForKeyboard((o=this.keyboardData)==null?void 0:o.keyboard,(r=this.keyboardData)==null?void 0:r.metadata),t instanceof Ge&&t.shutdown(),i.unlinkAll(),this.banner.appendStyles(),this.vkbd){this.vkbd.deferLayout=this.deferLayout,this.vkbd.createKeyTip();let u=this.vkbd.createGlobeHint();u&&this._Box.appendChild(u.element),this.vkbd.appendStyleSheet()}this.postKeyboardLoad()}_GenerateKeyboardView(t,i){let s=this.targetDevice;return this._Box.className="",t==null&&!s.touchable?new vt:t&&t.layout(s.formFactor)?this._GenerateVisualKeyboard(t,i):!t||!i?this._GenerateVisualKeyboard(null,null):new Ii(t)}_GenerateVisualKeyboard(t,i){let s=this.targetDevice,c=oa(this.config),l=new Ge({keyboard:t,keyboardMetadata:i,device:s,hostDevice:this.hostDevice,topContainer:this._Box,styleSheetManager:this.kbdStyleSheetManager,pathConfig:this.config.pathConfig,embeddedGestureConfig:this.config.embeddedGestureConfig,isEmbedded:this.config.isEmbedded,specialFont:{family:"SpecialOSK",files:[`${c}/keymanweb-osk.ttf`],path:""},gestureParams:this.config.gestureParams});return l.on("keyevent",(o,r)=>this.emit("keyevent",o,r)),l.on("globekey",(o,r)=>this.emit("globekey",o,r)),l.on("hiderequested",o=>{this.doHide(!0),this.emit("hiderequested",o)}),this._Box.className=s.formFactor+" "+s.OS.toLowerCase()+" kmw-osk-frame",l}present(){if(this.mayShow()){if(this.keyboardView.updateState(),this._Box.style.display="block",this.refreshLayoutIfNeeded(),this._Visible=!0,this._Box.style.opacity="1",this._Box.style.visibility=="hidden"){let t=this;window.setTimeout(function(){t._Box.style.visibility="visible"},0)}this.setDisplayPositioning()}}startHide(t){if(!this.mayHide(t))return;t&&(this.activationModel.enabled=!!(this.keyboardData.keyboard.isCJK||this.hostDevice.touchable));let i=null;this._Box&&this.hostDevice.touchable&&!(this.keyboardView instanceof vt)&&this.config.allowHideAnimations?i=this.useHideAnimation():i=Promise.resolve(!0);let s=this;i.then(function(c){c&&s.finalizeHide()}),this.doHide(t)}finalizeHide(){if(!(document.body.className.indexOf("osk-always-visible")>=0&&this.hostDevice.formFactor=="desktop")){if(this._Box){let t=this._Box.style;t.display="none",t.transition="",t.opacity="1",this._Visible=!1}this.vkbd&&this.vkbd.onHide()}}mayShow(){return!(!this.activationModel.conditionsMet||!this.keyboardView||this.keyboardView instanceof vt||!this.activationModel.enabled||!this._Box)}mayHide(t){return!(this.activationModel.conditionsMet&&!this.mayDisable||this.activationModel instanceof Et||!t&&this.hostDevice.formFactor=="desktop"&&document.body.className.indexOf("osk-always-visible")>=0)}useHideAnimation(){let t=this._Box.style,i=this;return new Promise(function(s){let c=a(function(){return i._Box.removeEventListener("transitionend",c,!1),i._Box.removeEventListener("webkitTransitionEnd",c,!1),i._Box.removeEventListener("transitioncancel",c,!1),i._Box.removeEventListener("webkitTransitionCancel",c,!1),i._animatedHideTimeout!=0&&window.clearTimeout(i._animatedHideTimeout),i._animatedHideTimeout=0,i._Visible&&i.activationModel.conditionsMet?(t.transition="",t.opacity="1",s(!1),!1):(s(!0),!0)},"cleanup"),l=a(function(){i._Box.removeEventListener("transitionrun",l,!1),i._Box.removeEventListener("webkitTransitionRun",l,!1),i._Box.addEventListener("transitionend",c,!1),i._Box.addEventListener("webkitTransitionEnd",c,!1),i._Box.addEventListener("transitioncancel",c,!1),i._Box.addEventListener("webkitTransitionCancel",c,!1)},"startup");i._Box.addEventListener("transitionrun",l,!1),i._Box.addEventListener("webkitTransitionRun",l,!1),t.transition="opacity 0.5s linear 0",t.opacity="0",i._animatedHideTimeout=window.setTimeout(c,200)})}hideNow(){if(!this.mayHide(!1)||!this._Box)return;this._animatedHideTimeout&&(window.clearTimeout(this._animatedHideTimeout),this._animatedHideTimeout=0);let t=this._Box.style;t.transition="",t.opacity="0",this.finalizeHide()}shutdown(){this.removeBaseMouseEventListeners(),this.removeBaseTouchEventListeners();let t=this._Box;t.parentElement&&t.parentElement.removeChild(t),this.kbdStyleSheetManager.unlinkAll(),this.uiStyleSheetManager.unlinkAll(),this.bannerController.shutdown()}getRect(){let t={};return t.left=t.left=K(this._Box),t.top=t.top=D(this._Box),t.width=this.computedWidth,t.height=this.computedHeight,t}isEnabled(){return this.displayIfActive}isVisible(){return this._Visible}hide(){this.activationModel.enabled=!1,this.startHide(!0)}show(t){arguments.length>0?this.activationModel.enabled=t:this.activationModel.conditionsMet&&(this.activationModel.enabled=!this.activationModel.enabled)}doShow(t){this.legacyEvents.callEvent("show",t)}doHide(t){let i={HiddenByUser:t};this.legacyEvents.callEvent("hide",i)}addEventListener(t,i){this.legacyEvents.addEventListener(t,i)}removeEventListener(t,i){this.legacyEvents.removeEventListener(t,i)}};a(Gn,"OSKView"),Gn.STYLESHEET_FILES=["kmwosk.css","globe-hint.css"];var pe=Gn;var xi=class xi extends S.default{constructor(t){super();this.mouseCancellingHandler=a(function(t){return t.preventDefault(),t.cancelBubble=!0,!1},"mouseCancellingHandler");this._element=this.buildTitleBar(),this.helpEnabled=!1,this.configEnabled=!1,t&&(this.element.onmousedown=t.mouseDownHandler)}get helpEnabled(){return this._helpEnabled}set helpEnabled(t){this._helpEnabled=t,this._helpButton.style.display=t?"inline":"none"}get configEnabled(){return this._configEnabled}set configEnabled(t){this._configEnabled=t,this._configButton.style.display=t?"inline":"none"}get layoutHeight(){return xi.DISPLAY_HEIGHT}get element(){return this._element}setPinCJKOffset(){this._unpinButton.style.left="15px"}showPin(t){this._unpinButton.style.display=t?"block":"none"}setTitle(t){this._caption.innerHTML=t}setTitleFromKeyboard(t){let i="<span style='font-weight:bold'>"+(t==null?void 0:t.name)+"</span>";this._caption.innerHTML=i}buildTitleBar(){let t=N("div");t.id="keymanweb_title_bar",t.className="kmw-title-bar";let i=this._caption=N("span");i.className="kmw-title-bar-caption",i.style.color="#fff",t.appendChild(i);let s=this._closeButton=this.buildCloseButton();return this._closeButton.onclick=()=>(this.emit("close"),!1),t.appendChild(s),s=this._helpButton=this.buildHelpButton(),this._helpButton.onclick=()=>(this.emit("help"),!1),t.appendChild(s),s=this._configButton=this.buildConfigButton(),this._configButton.onclick=()=>(this.emit("config"),!1),t.appendChild(s),s=this._unpinButton=this.buildUnpinButton(),this._unpinButton.onclick=()=>(this.emit("unpin"),!1),t.appendChild(s),t}buildCloseButton(){let t=N("div");return t.id="kmw-close-button",t.className="kmw-title-bar-image",t.onmousedown=this.mouseCancellingHandler,t}buildHelpButton(){let t=N("div");return t.id="kmw-help-image",t.className="kmw-title-bar-image",t.title="KeymanWeb Help",t.onmousedown=this.mouseCancellingHandler,t}buildConfigButton(){let t=N("div");return t.id="kmw-config-image",t.className="kmw-title-bar-image",t.title="KeymanWeb Configuration Options",t.onmousedown=this.mouseCancellingHandler,t}buildUnpinButton(){let t=N("div");return t.id="kmw-pin-image",t.className="kmw-title-bar-image",t.title="Pin the On Screen Keyboard to its default location on the active text box",t.onmousedown=this.mouseCancellingHandler,t}refreshLayout(){}};a(xi,"TitleBar"),xi.DISPLAY_HEIGHT=X.inPixels(20);var pn=xi;var Zi=class Zi extends S.default{constructor(t){super();this.mouseCancellingHandler=a(function(t){return t.preventDefault(),t.cancelBubble=!0,!1},"mouseCancellingHandler");this._element=this.buildResizeBar(),t&&(this._resizeHandle.onmousedown=t.mouseDownHandler)}get layoutHeight(){return Zi.DISPLAY_HEIGHT}get element(){return this._element}get handle(){return this._resizeHandle}allowResizing(t){this._resizeHandle.style.display=t?"block":"none"}buildResizeBar(){let t=N("div");t.className="kmw-footer",t.onmousedown=this.mouseCancellingHandler;let i=N("div");i.className="kmw-footer-caption",i.innerHTML='<a href="https://keyman.com/developer/keymanweb/">KeymanWeb</a>',i.id="keymanweb-osk-footer-caption",i.addEventListener("dblclick",c=>(this.emit("showbuild"),!1),!1),t.appendChild(i);let s=N("div");return s.className="kmw-footer-resize",t.appendChild(s),this._resizeHandle=s,t}refreshLayout(){}};a(Zi,"ResizeBar"),Zi.DISPLAY_HEIGHT=X.inPixels(16);var Xi=Zi;var Cn=class Cn{constructor(n,t,i){this.x=n,this.y=t}static fromEvent(n){let t;if(window.TouchEvent&&n instanceof TouchEvent||n.changedTouches?t=n.changedTouches[0]:t=n,t.pageX)return new Cn(t.pageX,t.pageY,n);if(t.clientX){let i=t.clientX+document.body.scrollLeft,s=t.clientY+document.body.scrollTop;return new Cn(i,s,n)}else return new Cn(null,null,n)}};a(Cn,"InputEventCoordinate");var ks=Cn,Co=class Co{constructor(n){this._VPreviousMouseMove=document.onmousemove,this._VPreviousMouseUp=document.onmouseup,this._VPreviousCursor=document.body.style.cursor,this._VPreviousMouseButton=typeof n.which=="undefined"?n.button:n.which}restore(){document.onmousemove=this._VPreviousMouseMove,document.onmouseup=this._VPreviousMouseUp,document.body.style.cursor&&(document.body.style.cursor=this._VPreviousCursor)}matchesCausingClick(n){return this._VPreviousMouseButton==(typeof n.which=="undefined"?n.button:n.which)}};a(Co,"MouseStartSnapshot");var po=Co,Qo=class Qo{constructor(n){this.startHandler=this._VMoveMouseDown.bind(this),this.cursorType=n}get enabled(){return this._enabled}set enabled(n){this._enabled=n}get isActive(){return!!this._mouseStartSnapshot}get mouseDownHandler(){return this.startHandler}_VMoveMouseDown(n){return!n||!this._enabled?!0:(this._mouseStartSnapshot||(this._mouseStartSnapshot=new po(n)),this._startCoord=ks.fromEvent(n),document.onmousemove=this._VMoveMouseMove.bind(this),document.onmouseup=this._VMoveMouseUp.bind(this),document.body.style.cursor&&(document.body.style.cursor=this.cursorType),n.preventDefault(),n.cancelBubble=!0,this.onDragStart(),!1)}_VMoveMouseMove(n){if(!n||!this.enabled)return!0;if(n.preventDefault(),n.cancelBubble=!0,this._mouseStartSnapshot.matchesCausingClick(n)){let t=ks.fromEvent(n),i=t.x-this._startCoord.x,s=t.y-this._startCoord.y;return this.onDragMove(i,s),!1}else return this._VMoveMouseUp(n)}_VMoveMouseUp(n){return n?(this._mouseStartSnapshot.restore(),this._mouseStartSnapshot=null,n.preventDefault(),n.cancelBubble=!0,this.onDragRelease(),!1):!0}};a(Qo,"MouseDragOperation");var Qn=Qo;var Uo=class Uo extends _e{constructor(){super(...arguments);this._enabled=!0;this.actValue=null}get activate(){return this._enabled&&!!this.actValue}checkState(t){this.activate!=t&&this.emit("activate",this.activate)}get enabled(){return this._enabled}set enabled(t){let i=this.activate;this._enabled=t,this.checkState(i)}get activationTrigger(){return this.actValue}set activationTrigger(t){let i=this.activate,s=this.actValue;this.actValue=t,this.checkState(i),s!=t&&this.emit("triggerchange",t)}get conditionsMet(){return!!this.activationTrigger}};a(Uo,"TwoStateActivator");var ht=Uo;var xo=class xo extends oe{constructor(){super("KeymanWeb_OnScreenKeyboard")}loadWithDefaults(n){return p(p({},n),this.load())}load(){let n=super.load((t,i)=>{switch(i){case"version":return t;default:return Number.parseInt(t,10)}});return n.width||delete n.width,n.height||delete n.height,n}save(n){super.save(n)}};a(xo,"FloatingOSKCookieSerializer");var Es=xo;var Zo=class Zo extends pe{constructor(t){t.activator=t.activator||new ht;super(t);this.userPositioned=!1;this.specifiedPosition=!1;this.noDrag=!1;this.layoutSerializer=new Es;this.restorePosition=function(t){let i=this._Visible,s=new f;this.emit("dragmove",s.corePromise),this.loadPersistedLayout(),this.userPositioned=!1,t||(delete this.dfltX,delete this.dfltY),this.savePersistedLayout(),i&&this.present(),this.titleBar.showPin(!1),s.resolve(),this.doResizeMove()}.bind(this);this.typedActivationModel.on("triggerchange",()=>this.setDisplayPositioning()),document.body.appendChild(this._Box),this.titleBar=new pn(this.titleDragHandler),this.titleBar.on("help",()=>{this.legacyEvents.callEvent("helpclick",{})}),this.titleBar.on("config",()=>{this.legacyEvents.callEvent("configclick",{})}),this.titleBar.on("close",()=>this.startHide(!0)),this.titleBar.on("unpin",()=>this.restorePosition(!0)),this.resizeBar=new Xi(this.resizeDragHandler),this.resizeBar.on("showbuild",()=>this.emit("showbuild")),this.headerView=this.titleBar,this._Box.insertBefore(this.headerView.element,this._Box.firstChild);let i=a(l=>{let o=this.headerView;if(o&&o instanceof pn)switch(l){case"configclick":o.configEnabled=this.legacyEvents.listenerCount("configclick")>0;break;case"helpclick":o.helpEnabled=this.legacyEvents.listenerCount("helpclick")>0;break;default:return}},"onListenedEvent"),s=new gn(this),c=new gn(this.legacyEvents);for(let l of[s,c])l.on("listeneradded",i),l.on("listenerremoved",i);this.activeKeyboard&&this.postKeyboardAdjustments(),this.loadPersistedLayout()}get typedActivationModel(){return this.activationModel}_Unload(){this.keyboardView=null,this.bannerView=null,this._Box=null}setBoxStyling(){let t=this._Box.style;t.zIndex="9999",t.display="none",t.width="auto",t.position="absolute"}postKeyboardAdjustments(){this.titleBar&&(this.enableMoveResizeHandlers(),this.activeKeyboard&&this.titleBar.setTitleFromKeyboard(this.activeKeyboard.keyboard),this.vkbd?(this.footerView=this.resizeBar,this._Box.appendChild(this.footerView.element)):(this.footerView&&this._Box.removeChild(this.footerView.element),this.footerView=null),this.loadPersistedLayout(),this.setNeedsLayout())}isEnabled(){return this.displayIfActive}isVisible(){return this._Visible}savePersistedLayout(){let t=this.getPos(),i={visible:this.displayIfActive?1:0,userSet:this.userPositioned?1:0,left:t.left,top:t.top,_version:z.CURRENT.toString()};this.vkbd&&(i.width=this.width.val,i.height=this.height.val),this.layoutSerializer.save(i)}loadPersistedLayout(){let t=this.layoutSerializer.loadWithDefaults({visible:1,userSet:0,left:-1,top:-1,_version:void 0,width:.3*screen.width,height:.15*screen.height});this.activationModel.enabled=t.visible==1,this.userPositioned=t.userSet==1,this.x=t.left,this.y=t.top;let i=t._version,s=i===void 0,c=t.width,l=t.height;c<.2*screen.width&&(c=.2*screen.width),l<.1*screen.height&&(l=.1*screen.height),c>.9*screen.width&&(c=.9*screen.width),l>.5*screen.height&&(l=.5*screen.height),(s||!i)&&(this.headerView&&this.headerView.layoutHeight.absolute&&(l+=this.headerView.layoutHeight.val),this.footerView&&this.footerView.layoutHeight.absolute&&(l+=this.footerView.layoutHeight.val)),this.setSize(c,l),(this.x==-1||this.y==-1||!this._Box)&&(this.userPositioned=!1),this.x<window.pageXOffset-.8*c&&(this.x=window.pageXOffset-.8*c),this.y<0&&(this.x=-1,this.y=-1,this.userPositioned=!1),this.userPositioned&&this._Box&&this.setPos({left:this.x,top:this.y})}getDefaultKeyboardHeight(){if(this.configuration.heightOverride)return this.configuration.heightOverride();let t=Math.floor(Math.min(screen.availHeight,screen.availWidth)/2);if(this.targetDevice.formFactor=="phone"){let i=Math.min(screen.height,screen.width),s=Math.max(screen.height,screen.width);Fe()?t=t*(s/i)/1.6:t=Math.floor(Math.max(screen.availHeight,screen.availWidth)/3)}return this.targetDevice.OS==W.OperatingSystem.iOS&&(t=t/Se(this.targetDevice.formFactor)),t}getDefaultWidth(){if(this.configuration.widthOverride)return this.configuration.widthOverride();let t;if(this.targetDevice.OS==W.OperatingSystem.iOS)t=window.innerWidth;else if(this.targetDevice.OS==W.OperatingSystem.Android)try{t=document.documentElement.clientWidth}catch(i){t=screen.availWidth}else t=screen.width;return t}doResizeMove(t){this.legacyEvents.callEvent("resizemove",t)}setRect(t){if(this._Box==null||this.targetDevice.formFactor!="desktop")return;let i=this._Box,s=i.style;if("left"in t&&(this.x=t.left-K(i)+i.offsetLeft,s.left=this.x+"px",this.dfltX=s.left),"top"in t&&(this.y=t.top-D(i)+i.offsetTop,s.top=this.y+"px",this.dfltY=s.top),this.vkbd!=null){let c=this.vkbd.kbdDiv,l=c.style;if("width"in t){let o=t.width-(i.offsetWidth-c.offsetWidth);o<.2*screen.width&&(o=.2*screen.width),o>.9*screen.width&&(o=.9*screen.width),l.width=o+"px",this.setSize(o,this.computedHeight,!0)}if("height"in t){let o=t.height-(i.offsetHeight-c.offsetHeight);o<.1*screen.height&&(o=.1*screen.height),o>.5*screen.height&&(o=.5*screen.height),l.height=o+"px",l.fontSize=o/8+"px",this.setSize(this.computedWidth,o,!0)}"nosize"in t&&(this.resizingEnabled=!t.nosize)}"nomove"in t&&(this.noDrag=t.nomove,this.movementEnabled=!this.noDrag),this.savePersistedLayout()}getPos(){let t=this._Box;return{left:this._Visible?t.offsetLeft:this.x,top:this._Visible?t.offsetTop:this.y}}setPos(t){if(typeof this._Box!="undefined"){if(this.userPositioned){let i=t.left,s=t.top;typeof i!="undefined"&&(i<-.8*this._Box.offsetWidth&&(i=-.8*this._Box.offsetWidth),this.userPositioned&&(this._Box.style.left=i+"px",this.x=i)),typeof s!="undefined"&&(s<0&&(s=0),this.userPositioned&&(this._Box.style.top=s+"px",this.y=s))}this.titleBar.showPin(this.userPositioned)}}setDisplayPositioning(){let t=this._Box.style;if(t.position="absolute",this.activationModel.activate&&(t.display="block"),t.left="0px",this.specifiedPosition||this.userPositioned)t.left=this.x+"px",t.top=this.y+"px";else{let i=this.typedActivationModel.activationTrigger||null;this.dfltX?t.left=this.dfltX:typeof i!="undefined"&&i!=null&&(t.left=K(i)+"px"),this.dfltY?t.top=this.dfltY:typeof i!="undefined"&&i!=null&&(t.top=D(i)+i.offsetHeight+"px")}this.specifiedPosition=!1}presentAtPosition(t,i){this.mayShow()&&(this.specifiedPosition=t>=0||i>=0,this.specifiedPosition&&(this.x=t,this.y=i),this.specifiedPosition=this.specifiedPosition||this.userPositioned,this.present())}present(){this.mayShow()&&(this.titleBar.showPin(this.userPositioned),super.present(),this.doShow({x:this._Box.offsetLeft,y:this._Box.offsetTop,userLocated:this.userPositioned}))}startHide(t){super.startHide(t),t&&this.savePersistedLayout()}show(t){t!==void 0?super.show(t):super.show(),this.savePersistedLayout()}userLocated(){return this.userPositioned}get movementEnabled(){return this.titleDragHandler.enabled}set movementEnabled(t){this.titleDragHandler.enabled=t,this.titleBar.showPin(t&&this.userPositioned)}get resizingEnabled(){return this.resizeDragHandler.enabled}set resizingEnabled(t){this.resizeDragHandler.enabled=t,this.resizeBar.allowResizing(t)}get isBeingMoved(){return this.titleDragHandler.isActive}get isBeingResized(){return this.resizeDragHandler.isActive}enableMoveResizeHandlers(){this.titleDragHandler.enabled=!this.noDrag,this.resizeDragHandler.enabled=!0}get titleDragHandler(){let t=this;return this._moveHandler?this._moveHandler:(this._moveHandler=new class extends Qn{constructor(){super("move")}onDragStart(){this.startX=t._Box.offsetLeft,this.startY=t._Box.offsetTop,t.activeKeyboard.keyboard.isCJK&&t.titleBar.setPinCJKOffset(),this.dragPromise&&this.dragPromise.resolve(),this.dragPromise=new f,t.emit("dragmove",this.dragPromise.corePromise)}onDragMove(i,s){t.titleBar.showPin(!0),t.userPositioned=!0,t._Box.style.left=this.startX+i+"px",t._Box.style.top=this.startY+s+"px";let c=t.getRect();t.setSize(c.width,c.height,!0),t.x=c.left,t.y=c.top}onDragRelease(){t.vkbd&&(t.vkbd.currentKey=null),this.dragPromise.resolve(),this.dragPromise.then(()=>{t.userPositioned=!0,t.doResizeMove(),t.savePersistedLayout()}),this.dragPromise=null}},this._moveHandler)}get resizeDragHandler(){let t=this;return this._resizeHandler?this._resizeHandler:(this._resizeHandler=new class extends Qn{constructor(){super("se-resize")}onDragStart(){this.startWidth=t.computedWidth,this.startHeight=t.computedHeight,this.dragPromise&&this.dragPromise.resolve(),this.dragPromise=new f,t.emit("resizemove",this.dragPromise.corePromise)}onDragMove(i,s){let c=this.startWidth+i,l=this.startHeight+s;c<.2*screen.width&&(c=.2*screen.width),l<.1*screen.height&&(l=.1*screen.height),c>.9*screen.width&&(c=.9*screen.width),l>.5*screen.height&&(l=.5*screen.height),t.setSize(c,l,!0)}onDragRelease(){t.vkbd&&(t.vkbd.currentKey=null),t.vkbd&&(this.startWidth=t.computedWidth,this.startHeight=t.computedHeight),t.refreshLayout(),this.dragPromise.resolve(),this.dragPromise.then(()=>{t.doResizeMove(),t.savePersistedLayout()}),this.dragPromise=null}},this._resizeHandler)}};a(Zo,"FloatingOSKView");var qe=Zo;var Xo=class Xo extends pe{constructor(t){t.isEmbedded?t.activator=t.activator||new Et:t.activator=t.activator||new ht;super(t);this.isResizing=!1;this.restorePosition=function(t){}.bind(this);document.body.appendChild(this._Box)}_Unload(){this.keyboardView=null,this.bannerView=null,this._Box=null}setBoxStyling(){let t=this._Box.style;t.zIndex="9999",t.display="none",t.width="100%",t.position="fixed"}refreshLayout(t){if(!this.isResizing){try{this.isResizing=!0,this.doResize()}finally{this.isResizing=!1}super.refreshLayout(t)}}doResize(){if(this.vkbd){let t=this.getDefaultKeyboardHeight();this.setSize(this.getDefaultWidth(),t+this.banner.height)}}postKeyboardAdjustments(){this.doResize()}getDefaultKeyboardHeight(){var l,o;let t=this.targetDevice;if(this.configuration.heightOverride)return this.configuration.heightOverride();let i=(l=document==null?void 0:document.documentElement)==null?void 0:l.clientWidth,s=(o=document==null?void 0:document.documentElement)==null?void 0:o.clientHeight;if(typeof i=="undefined"&&(i=Math.min(screen.height,screen.width),s=Math.max(screen.height,screen.width),Fe())){let r=i;i=s,s=r}let c=Math.floor(Math.min(s,i)/2);return t.formFactor=="phone"&&(Fe()?c=Math.floor(s/1.6):c=Math.floor(s/2.4)),this.targetDevice.OS==W.OperatingSystem.iOS&&(c=c/Se(this.targetDevice.formFactor)),c}getDefaultWidth(){var s;let t=this.targetDevice;if(this.configuration.widthOverride)return this.configuration.widthOverride();let i;return i=(s=document==null?void 0:document.documentElement)==null?void 0:s.clientWidth,typeof i=="undefined"&&(this.targetDevice.OS==W.OperatingSystem.iOS?i=window.innerWidth:t.OS==W.OperatingSystem.Android?i=screen.availWidth:i=screen.width),i}setRect(t){}getPos(){let t=this._Box;return{left:this._Visible?t.offsetLeft:this.x,top:this._Visible?t.offsetTop:this.y}}setPos(t){}setDisplayPositioning(){let t=this._Box.style;this.vkbd&&(t.position="fixed",t.left=t.bottom="0px",t.border="none",t.borderTop="1px solid gray")}present(){super.present(),this.legacyEvents.callEvent("show",{})}};a(Xo,"AnchoredOSKView");var Un=Xo;var Vo=class Vo extends _e{constructor(){super(...arguments);this.flag=!0}get enabled(){return this.flag}set enabled(t){this.activate=t}get activate(){return this.flag}set activate(t){this.flag!=t&&(this.flag=t,this.emit("activate",t))}get conditionsMet(){return!0}};a(Vo,"SimpleActivator");var xn=Vo;var So=class So extends pe{constructor(t){t.activator=t.activator||new xn;super(t);this.restorePosition=function(t){}.bind(this)}get element(){return this._Box}_Unload(){this.keyboardView=null,this.bannerView=null,this._Box=null}setBoxStyling(){let t=this._Box.style;t.display="none",t.position="relative"}postKeyboardAdjustments(){}getDefaultKeyboardHeight(){return this.keyboardView instanceof Ge?this.keyboardView.height:this.computedHeight}getDefaultWidth(){return this.computedWidth}setRect(t){}getPos(){let t=this._Box;return{left:this._Visible?t.offsetLeft:void 0,top:this._Visible?t.offsetTop:void 0}}setPos(t){}present(){super.present(),this.legacyEvents.callEvent("show",{})}setDisplayPositioning(){}allowsDeviceChange(t){return!0}};a(So,"InlinedOSKView");var Zn=So;var Ro={};Kt(Ro,{AnchoredOSKView:()=>Vi,FloatingOSKView:()=>Si,InlinedOSKView:()=>Wo});function Ao(g){return{hostDevice:g.config.hostDevice,pathConfig:g.config.paths,predictionContextManager:g.contextManager.predictionContext,isEmbedded:!1}}a(Ao,"buildBaseOskConfiguration");var Ho=class Ho extends Un{constructor(n,t){let i=p(p({},Ao(n)),t||{});super(i)}};a(Ho,"PublishedAnchoredOSKView");var Vi=Ho,fo=class fo extends qe{constructor(n,t){let i=p(p({},Ao(n)),t||{});super(i)}};a(fo,"PublishedFloatingOSKView");var Si=fo,Lo=class Lo extends Zn{constructor(n,t){let i=p(p({},Ao(n)),t||{});super(i)}};a(Lo,"PublishedInlineOSKView");var Wo=Lo;var vo=class vo extends lt{constructor(){super(...arguments);this.events=new S.default;this.changed=!1}focus(){let t=this.getElement();t.focus&&t.focus()}isForcingScroll(){return!1}dispatchInputEventOn(t){let i;window.InputEvent&&(i=new InputEvent("input",{bubbles:!0,cancelable:!1})),t&&i&&t.dispatchEvent(i)}};a(vo,"OutputTarget");var P=vo;var Jo=class Jo extends P{constructor(n){super(),this.root=n,this._cachedSelectionStart=-1}get isSynthetic(){return!1}static isSupportedType(n){return n=="email"||n=="search"||n=="text"||n=="url"}getElement(){return this.root}clearSelection(){this.getCaret(),this.root.value=Q.substr(this.root.value,0,this.processedSelectionStart)+Q.substr(this.root.value,this.processedSelectionEnd),this.setCaret(this.processedSelectionStart)}isSelectionEmpty(){return this.root.selectionStart==this.root.selectionEnd}hasSelection(){return!0}invalidateSelection(){this._cachedSelectionStart=-1}getCaret(){return this.root.selectionStart!=this._cachedSelectionStart&&(this._cachedSelectionStart=this.root.selectionStart,this.processedSelectionStart=Q.codeUnitToCodePoint(this.root.value,this.root.selectionStart),this.processedSelectionEnd=Q.codeUnitToCodePoint(this.root.value,this.root.selectionEnd)),this.root.selectionDirection=="forward"?this.processedSelectionEnd:this.processedSelectionStart}getDeadkeyCaret(){return this.getCaret()}setCaret(n){this.setSelection(n,n,"none")}setSelection(n,t,i){let s=Q.codePointToCodeUnit(this.root.value,n),c=Q.codePointToCodeUnit(this.root.value,t);this.root.setSelectionRange(s,c,i),this.processedSelectionStart=n,this.processedSelectionEnd=t,this.forceScroll(),this.root.setSelectionRange(s,c,i)}forceScroll(){let n=this.getElement(),t=n.selectionStart,i=n.selectionEnd;this._activeForcedScroll=!0;try{n.blur(),n.focus()}finally{n.selectionStart=t,n.selectionEnd=i,this._activeForcedScroll=!1}}isForcingScroll(){return this._activeForcedScroll}getSelectionDirection(){return this.root.selectionDirection}getTextBeforeCaret(){return this.getCaret(),Q.substring(this.getText(),0,this.processedSelectionStart)}getSelectedText(){return this.getCaret(),Q.substring(this.getText(),this.processedSelectionStart,this.processedSelectionEnd)}setTextBeforeCaret(n){this.getCaret();let t=this.processedSelectionEnd-this.processedSelectionStart,i=this.getSelectionDirection(),s=Q.length(n);this.root.value=n+Q.substring(this.getText(),this.processedSelectionStart),this.setSelection(s,s+t,i)}setTextAfterCaret(n){let t=this.getSelectionDirection();this.root.value=this.getTextBeforeCaret()+n,this.setSelection(this.processedSelectionStart,this.processedSelectionEnd,t)}getTextAfterCaret(){return this.getCaret(),Q.substring(this.getText(),this.processedSelectionEnd)}getText(){return this.root.value}deleteCharsBeforeCaret(n){if(n>0){let t=this.getTextBeforeCaret(),i=this.processedSelectionStart;n>i&&(n=i),this.adjustDeadkeys(-n),this.setTextBeforeCaret(Q.substring(t,0,i-n)),this.setCaret(i-n)}}insertTextBeforeCaret(n){if(!n)return;let t=this.getCaret(),i=this.getTextBeforeCaret(),s=Q.substring(this.getText(),this.processedSelectionStart);this.adjustDeadkeys(Q.length(n)),this.root.value=i+n+s,this.setCaret(t+Q.length(n))}handleNewlineAtCaret(){let n=this.root;n&&(n.type=="search"||n.type=="submit")?(n.disabled=!1,n.form.submit()):this.events.emit("unhandlednewline",n)}doInputEvent(){this.dispatchInputEventOn(this.root)}};a(Jo,"Input");var $e=Jo;var No=class No extends P{constructor(n){super(),this.root=n,this._cachedSelectionStart=-1}get isSynthetic(){return!1}getElement(){return this.root}clearSelection(){this.getCaret(),this.root.value=Q.substr(this.root.value,0,this.processedSelectionStart)+Q.substr(this.root.value,this.processedSelectionEnd),this.setCaret(this.processedSelectionStart)}isSelectionEmpty(){return this.root.selectionStart==this.root.selectionEnd}hasSelection(){return!0}invalidateSelection(){this._cachedSelectionStart=-1}getCaret(){return this.root.selectionStart!=this._cachedSelectionStart&&(this._cachedSelectionStart=this.root.selectionStart,this.processedSelectionStart=Q.codeUnitToCodePoint(this.root.value,this.root.selectionStart),this.processedSelectionEnd=Q.codeUnitToCodePoint(this.root.value,this.root.selectionEnd)),this.root.selectionDirection=="forward"?this.processedSelectionEnd:this.processedSelectionStart}getDeadkeyCaret(){return this.getCaret()}setCaret(n){this.setSelection(n,n,"none")}setSelection(n,t,i){let s=Q.codePointToCodeUnit(this.root.value,n),c=Q.codePointToCodeUnit(this.root.value,t);this.root.setSelectionRange(s,c,i),this.processedSelectionStart=n,this.processedSelectionEnd=t,this.forceScroll(),this.root.setSelectionRange(s,c,i)}forceScroll(){let n=this.getElement(),t=n.selectionStart,i=n.selectionEnd;this._activeForcedScroll=!0;try{n.blur(),n.focus()}finally{n.selectionStart=t,n.selectionEnd=i,this._activeForcedScroll=!1}}isForcingScroll(){return this._activeForcedScroll}getSelectionDirection(){return this.root.selectionDirection}getTextBeforeCaret(){return this.getCaret(),Q.substring(this.getText(),0,this.processedSelectionStart)}setTextBeforeCaret(n){this.getCaret();let t=this.processedSelectionEnd-this.processedSelectionStart,i=this.getSelectionDirection(),s=Q.length(n);this.root.value=n+Q.substring(this.getText(),this.processedSelectionStart),this.setSelection(s,s+t,i)}setTextAfterCaret(n){let t=this.getSelectionDirection();this.root.value=this.getTextBeforeCaret()+n,this.setSelection(this.processedSelectionStart,this.processedSelectionEnd,t)}getTextAfterCaret(){return this.getCaret(),Q.substring(this.getText(),this.processedSelectionEnd)}getSelectedText(){return this.getCaret(),Q.substring(this.getText(),this.processedSelectionStart,this.processedSelectionEnd)}getText(){return this.root.value}deleteCharsBeforeCaret(n){if(n>0){let t=this.getTextBeforeCaret(),i=this.processedSelectionStart;n>i&&(n=i),this.adjustDeadkeys(-n),this.setTextBeforeCaret(Q.substr(t,0,i-n)),this.setCaret(i-n)}}insertTextBeforeCaret(n){if(!n)return;let t=this.getCaret(),i=this.getTextBeforeCaret(),s=Q.substring(this.getText(),this.processedSelectionStart);this.adjustDeadkeys(Q.length(n)),this.root.value=i+n+s,this.setCaret(t+Q.length(n))}handleNewlineAtCaret(){this.insertTextBeforeCaret(`
`)}doInputEvent(){this.dispatchInputEventOn(this.root)}};a(No,"TextArea");var Xn=No;var ko=class ko{constructor(n,t){this.node=n,this.offset=t}};a(ko,"SelectionCaret");var Wi=ko,Eo=class Eo{constructor(n,t){this.start=n,this.end=t}};a(Eo,"SelectionRange");var Ai=Eo,Yo=class Yo{constructor(n,t){this.cmd=n,this.stateType=t}};a(Yo,"StyleCommand");var be=Yo,To=class To extends P{constructor(n){if(super(),this.root=n,n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.designMode=="on")this.doc=n.contentWindow.document,this.docRoot=n.contentWindow.document.documentElement;else throw"Specified IFrame is not in design-mode!"}get isSynthetic(){return!1}getElement(){return this.root}focus(){this.doc.defaultView.focus()}isSelectionEmpty(){return this.hasSelection()?this.doc.getSelection().isCollapsed:!0}hasSelection(){let n=this.doc.getSelection(),t=document.getSelection();return t.anchorNode==n.anchorNode&&t.focusNode==n.focusNode,!0}clearSelection(){if(this.hasSelection()){let n=this.doc.getSelection();n.isCollapsed||n.deleteFromDocument()}else console.warn("Attempted to clear an unowned Selection!")}invalidateSelection(){}getCarets(){let n=this.doc.getSelection(),t=n.anchorNode.compareDocumentPosition(n.focusNode);if(n.isCollapsed){let i=new Wi(n.anchorNode,n.anchorOffset);return new Ai(i,i)}else{let i=new Wi(n.anchorNode,n.anchorOffset),s=new Wi(n.focusNode,n.focusOffset);return i.node==s.node&&(t=s.offset-i.offset>0?2:4),t&2?new Ai(i,s):new Ai(s,i)}}getDeadkeyCaret(){return Q.length(this.getTextBeforeCaret())}getTextBeforeCaret(){if(!this.hasSelection())return this.getText();let n=this.getCarets().start;return n.node.nodeType!=3?"":n.node.textContent.substr(0,n.offset)}getSelectedText(){return""}getTextAfterCaret(){if(!this.hasSelection())return"";let n=this.getCarets().end;return n.node.nodeType!=3?"":n.node.textContent.substr(n.offset)}getText(){return this.docRoot.innerText}deleteCharsBeforeCaret(n){if(!this.hasSelection()||n<=0)return;let t=this.getCarets().start;if(n>t.offset&&(n=t.offset),t.node.nodeType!=3){console.warn("Deletion of characters requested without available context!");return}let i=this.doc.createRange(),s=t.offset-Q.substr(t.node.nodeValue.substr(0,t.offset),-n).length;i.setStart(t.node,s),i.setEnd(t.node,t.offset),this.adjustDeadkeys(-n),i.deleteContents()}insertTextBeforeCaret(n){if(!this.hasSelection())return;let t=this.getCarets().start,i=Q.length(n),s=this.doc.getSelection();if(i==0)return;this.adjustDeadkeys(i);let c=this.root.ownerDocument.createRange();if(t.node.nodeType==3){let l=t.node;l.insertData(t.offset,n),c.setStart(l,t.offset+n.length)}else{let l=this.doc.createTextNode(n),o=this.doc.createRange();o.setStart(t.node,t.offset),o.collapse(!0),o.insertNode(l),c.setStart(l,n.length)}c.collapse(!0),s.removeAllRanges();try{s.addRange(c)}catch(l){t.node.parentElement.scrollIntoView(),s.addRange(c)}s.collapseToEnd()}handleNewlineAtCaret(){}setTextAfterCaret(n){if(!this.hasSelection())return;let t=this.getCarets().end;if(Q.length(n)!=0)if(t.node.nodeType==3){let s=t.node;s.replaceData(t.offset,s.length,n)}else{let s=t.node.ownerDocument.createTextNode(n),c=this.root.ownerDocument.createRange();c.setStart(t.node,t.offset),c.collapse(!0),c.insertNode(s)}}saveProperties(){let n=[new be("backcolor",1),new be("fontname",1),new be("fontsize",1),new be("forecolor",1),new be("bold",0),new be("italic",0),new be("strikethrough",0),new be("subscript",0),new be("superscript",0),new be("underline",0)];this.doc.defaultView&&n.push(new be("hilitecolor",1));for(let t=0;t<n.length;t++){let i=n[t];i.stateType==1?i.cache=this.doc.queryCommandValue(i.cmd):i.cache=this.doc.queryCommandState(i.cmd)}this.commandCache=n}restoreProperties(n){this.commandCache||console.error("No command cache exists to restore!");for(let t=0;t<this.commandCache.length;t++){let i=this.commandCache[t];i.stateType==1?this.doc.queryCommandValue(i.cmd)!=i.cache&&(n&&n(),this.doc.execCommand(i.cmd,!1,i.cache)):this.doc.queryCommandState(i.cmd)!=i.cache&&(n&&n(),this.doc.execCommand(i.cmd,!1,null))}}doInputEvent(){this.dispatchInputEventOn(this.root)}};a(To,"DesignIFrame");var j=To;var wo=class wo{constructor(n,t){this.node=n,this.offset=t}};a(wo,"SelectionCaret");var Ri=wo,Mo=class Mo{constructor(n,t){this.start=n,this.end=t}};a(Mo,"SelectionRange");var Hi=Mo,zo=class zo extends P{constructor(n){if(n.isContentEditable)super(),this.root=n;else throw"Specified element is not already content-editable!"}get isSynthetic(){return!1}getElement(){return this.root}isSelectionEmpty(){return this.hasSelection()?this.root.ownerDocument.getSelection().isCollapsed:!0}hasSelection(){let n=this.root.ownerDocument.getSelection();return!(this.root!=n.anchorNode&&!this.root.contains(n.anchorNode)||this.root!=n.focusNode&&!this.root.contains(n.focusNode))}clearSelection(){if(this.hasSelection()){let n=this.root.ownerDocument.getSelection();n.isCollapsed||n.deleteFromDocument()}else console.warn("Attempted to clear an unowned Selection!")}invalidateSelection(){}getCarets(){let n=this.root.ownerDocument.getSelection(),t=n.anchorNode.compareDocumentPosition(n.focusNode);if(n.isCollapsed){let i=new Ri(n.anchorNode,n.anchorOffset);return new Hi(i,i)}else{let i=new Ri(n.anchorNode,n.anchorOffset),s=new Ri(n.focusNode,n.focusOffset);return i.node==s.node&&(t=s.offset-i.offset>0?2:4),t&2?new Hi(i,s):new Hi(s,i)}}getDeadkeyCaret(){return Q.length(this.getTextBeforeCaret())}getTextBeforeCaret(){if(!this.hasSelection())return this.getText();let n=this.getCarets().start;return n.node.nodeType!=3?"":n.node.textContent.substr(0,n.offset)}getSelectedText(){return""}getTextAfterCaret(){if(!this.hasSelection())return"";let n=this.getCarets().end;return n.node.nodeType!=3?"":n.node.textContent.substr(n.offset)}getText(){return this.root.innerText}deleteCharsBeforeCaret(n){if(!this.hasSelection()||n<=0)return;let t=this.getCarets().start;if(n>t.offset&&(n=t.offset),t.node.nodeType!=3){console.warn("Deletion of characters requested without available context!");return}let i=this.root.ownerDocument.createRange(),s=t.offset-Q.substr(t.node.nodeValue.substr(0,t.offset),-n).length;i.setStart(t.node,s),i.setEnd(t.node,t.offset),this.adjustDeadkeys(-n),i.deleteContents()}insertTextBeforeCaret(n){if(!this.hasSelection())return;let t=this.getCarets().start,i=Q.length(n),s=this.root.ownerDocument.getSelection();if(i==0)return;this.adjustDeadkeys(i);let c=this.root.ownerDocument.createRange();if(t.node.nodeType==3){let l=t.node;l.insertData(t.offset,n),c.setStart(l,t.offset+n.length)}else{let l=t.node.ownerDocument.createTextNode(n),o=this.root.ownerDocument.createRange();o.setStart(t.node,t.offset),o.collapse(!0),o.insertNode(l),c.setStart(l,n.length)}c.collapse(!0),s.removeAllRanges();try{s.addRange(c)}catch(l){t.node.parentElement.scrollIntoView(),s.addRange(c)}s.collapseToEnd()}handleNewlineAtCaret(){}setTextAfterCaret(n){if(!this.hasSelection())return;let t=this.getCarets().end;if(Q.length(n)!=0)if(t.node.nodeType==3){let s=t.node;s.replaceData(t.offset,s.length,n)}else{let s=t.node.ownerDocument.createTextNode(n),c=this.root.ownerDocument.createRange();c.setStart(t.node,t.offset),c.collapse(!0),c.insertNode(s)}}doInputEvent(){this.dispatchInputEventOn(this.root)}};a(zo,"ContentEditable");var Yt=zo;function _(g,n){let t;return g?g.Window?n=="Window":(g.defaultView?t=g.defaultView[n]:g.ownerDocument&&(t=g.ownerDocument.defaultView[n]),t?g instanceof t:!1):!1}a(_,"nestedInstanceOf");function Ys(g){if(_(g,"HTMLInputElement"))return new $e(g);if(_(g,"HTMLTextAreaElement"))return new Xn(g);if(_(g,"HTMLIFrameElement")){let n=g;return n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.designMode=="on"?new j(n):g.isContentEditable?new Yt(g):null}else if(g.isContentEditable)return new Yt(g);return null}a(Ys,"wrapElement");var Ko=class Ko{constructor(){this.pending=!1;let n=this.bg=document.createElement("div"),t=document.createElement("div"),i=this.lt=document.createElement("div"),s=this.gr=document.createElement("div"),c=this.bx=document.createElement("div");n.className="kmw-wait-background",t.className="kmw-wait-box",this.dismiss=null,i.className="kmw-wait-text",s.className="kmw-wait-graphic",c.className="kmw-alert-close";let l=t.onmousedown=t.onclick=r=>{c.style.display=="block"&&(n.style.display="none",this.dismiss&&this.dismiss())};t.addEventListener("touchstart",l,!1);let o=n.onmousedown=n.onclick=r=>{r.preventDefault(),r.stopPropagation()};n.addEventListener("touchstart",o,!1),t.appendChild(c),t.appendChild(i),t.appendChild(s),n.appendChild(t),document.body.appendChild(n)}get rootElement(){return this.bg}wait(n){let t=this.bg;typeof t=="undefined"||t==null||(n?(this.pending=!0,window.setTimeout(()=>{this.pending&&(window.scrollTo(0,0),this.bx.style.display="none",this.lt.className="kmw-wait-text",this.lt.innerHTML=n,this.gr.style.display="block",t.style.display="block")},1e3)):this.pending&&(this.lt.innerHTML="",this.pending=!1,t.style.display="none"))}alert(n,t){let i=this.bg;this.bx.style.display="block",this.lt.className="kmw-alert-text",this.lt.innerHTML=n,this.gr.style.display="none",i.style.display="block",this.dismiss=arguments.length>1?t:null}shutdown(){this.bg.parentNode.removeChild(this.bg)}};a(Ko,"AlertHost");var Ft=Ko;function fi(){return document.readyState==="complete"?Promise.resolve():new Promise((g,n)=>{let t=a(()=>{window.removeEventListener("load",t),g()},"loadHandler");window.addEventListener("load",t)})}a(fi,"whenDocumentReady");var Do=class Do extends Yn{initialize(n){this._options?this._options=p(p({},this._options),n):this._options=p({},n),super.initialize(n),this._options=n,this._ui=n.ui,this._attachType=n.attachType,fi().then(()=>{var t;n.useAlerts&&!this.alertHost?this._alertHost=new Ft:!n.useAlerts&&this.alertHost&&((t=this._alertHost)==null||t.shutdown(),this._alertHost=null)})}get options(){return this._options}get attachType(){return this._attachType}get alertHost(){return this._alertHost}set signalUser(n){(!n||n!=this.alertHost)&&this.alertHost.shutdown(),this._alertHost=n}debugReport(){let n=super.debugReport();return n.attachType=this.attachType,n.ui=this._ui,n.keymanEngine="app/browser",n}onRuleFinalization(n,t){let i=n.transcription.transform;Wt(i)||t instanceof P&&(t.changed=!0)}};a(Do,"BrowserConfiguration");var Ts=Do,ra=p({ui:"",attachType:"",useAlerts:!0},Ac);var Oo=class Oo{constructor(n,t,i){this.interface=n,this.keyboard=t}};a(Oo,"AttachmentInfo");var Li=Oo;function et(g){let n=g==null?void 0:g.target;return We(n)}a(et,"eventOutputTarget");function We(g){var n;if(g==null)return null;if(g.body&&(g=g.body),g.nodeType==3&&(g=g.parentNode),_(g,"HTMLInputElement")){let t=g.type.toLowerCase();if(!(t=="text"||t=="search"))return null}return(n=g._kmwAttachment)==null?void 0:n.interface}a(We,"outputTargetForElement");var ws=class ws extends S.default{constructor(t,i){if(!t)throw new Error("Cannot attach to a null/undefined document");super();this.baseFont="";this.appliedFont="";this.embeddedPageContexts=[];this._inputList=[];this._sortedInputs=[];this._InputModeObserverCore=a(t=>{this.disableInputModeObserver();try{for(let i of t){let s=i.target;this.isAttached(s)&&(s._kmwAttachment.inputMode=s.inputMode,this.device.touchable&&(s.inputMode="none"))}}finally{this.enableInputModeObserver()}},"_InputModeObserverCore");this._EnablementMutationObserverCore=a(t=>{for(let i=0;i<t.length;i++){let s=t[i],c=s.oldValue?s.oldValue.indexOf("kmw-disabled")>=0:!1,l=s.target.className.indexOf("kmw-disabled")>=0;if(c&&!l?this._EnableControl(s.target):!c&&l&&this._DisableControl(s.target),!l&&s.attributeName=="readonly"){let o=s.oldValue?s.oldValue!=null:!1,r=s.target;if(r instanceof r.ownerDocument.defaultView.HTMLInputElement||r instanceof r.ownerDocument.defaultView.HTMLTextAreaElement){let d=r.readOnly;o&&!d?this._EnableControl(s.target):!o&&d&&this._DisableControl(s.target)}}}},"_EnablementMutationObserverCore");this._AutoAttachObserverCore=a(t=>{let i=[],s=[];for(let c=0;c<t.length;c++){let l=t[c];for(let o=0;o<l.addedNodes.length;o++)i=i.concat(this._GetDocumentEditables(l.addedNodes[o]));for(let o=0;o<l.removedNodes.length;o++)s=s.concat(this._GetDocumentEditables(l.removedNodes[o]))}for(let c=0;c<i.length;c++)this.isKMWInput(i[c])&&this._MutationAdditionObserved(i[c]);for(let c=0;c<s.length;c++){let l=!1,o=s[c];if(o instanceof o.ownerDocument.defaultView.HTMLIFrameElement){for(let r=0;r<this.embeddedPageContexts.length;r++)if(this.embeddedPageContexts[r].options.owner==o){this.embeddedPageContexts[r].shutdown(),this.embeddedPageContexts.splice(r,1),l=!0;break}if(!l){for(let r=0;r<this._inputList.length;r++)if(this._inputList[r]==o){this.detachFromControl(o),this._inputList[r]==o&&this._inputList.splice(r,1);break}}}else this.isKMWInput(o)&&this._MutationRemovalObserved(o)}(i.length||s.length)&&(this.device.touchable?this.device.touchable&&window.setTimeout(()=>{this.listInputs()},1):this.listInputs())},"_AutoAttachObserverCore");this._MutationAdditionObserved=a(t=>{if(t instanceof t.ownerDocument.defaultView.HTMLIFrameElement){let i=a(()=>{window.setTimeout(()=>{this.attachToControl(t)},1)},"attachFunctor");t.addEventListener("load",i)}else this.attachToControl(t)},"_MutationAdditionObserved");this._MutationRemovalObserved=a(t=>{this.detachFromControl(t)},"_MutationRemovalObserved");this.options=i,this.document=t,this.stylesheetManager=new ue(this.document.body)}get device(){return this.options.hostDevice}get window(){return this.document.defaultView}get inputList(){let t=this.embeddedPageContexts.map(i=>i.inputList).reduce((i,s)=>i.concat(s),[]);return[].concat(this._inputList).concat(t)}get sortedInputs(){return this._sortedInputs}install(t){this.manualAttach=t,this.baseFont=this.getBaseFont(),this.manualAttach||(this._SetupDocument(this.document.documentElement),this.listInputs()),this.options.owner||this.initMutationObservers(this.document,t)}setupElementAttachment(t){if(!t._kmwAttachment){let i=Ys(t);i||_(t,"HTMLIFrameElement")||console.warn("Could not create processing interface for newly-attached element!"),t._kmwAttachment=new Li(i,null,this.device.touchable)}}clearElementAttachment(t){t._kmwAttachment=null}isKMWInput(t){if(t instanceof t.ownerDocument.defaultView.HTMLTextAreaElement)return!0;if(t instanceof t.ownerDocument.defaultView.HTMLInputElement){if($e.isSupportedType(t.type))return!0}else if(t instanceof t.ownerDocument.defaultView.HTMLIFrameElement)try{if(t.contentWindow){let i=t.contentWindow.document;if(i)return!(this.device.touchable&&i.designMode.toLowerCase()=="on")}else return!!t._kmwAttachment}catch(i){console.warn("Error during attachment to / detachment from iframe: "),console.warn(i)}else if(t.isContentEditable)return!0;return!1}isAttached(t){if(t._kmwAttachment)return!0;if(_(t,"HTMLIFrameElement")){if(t.contentDocument==this.document)return!0;for(let s of this.embeddedPageContexts)if(s.isAttached(t))return!0}return!1}isKMWDisabled(t){let i=t.className;return t.readOnly?!0:!!(i&&i.indexOf("kmw-disabled")>=0)}enableInputElement(t){var i;this.isKMWDisabled(t)||(t instanceof t.ownerDocument.defaultView.HTMLIFrameElement?this._AttachToIframe(t):(this.setupElementAttachment(t),t._kmwAttachment.inputMode=(i=t.inputMode)!=null?i:"text",this.disableInputModeObserver(),t.inputMode="none",this.enableInputModeObserver(),t.classList.add("keymanweb-font"),this._inputList.push(t),this.emit("enabled",t)))}disableInputElement(t){var i;if(t)if(t.ownerDocument.defaultView&&t instanceof t.ownerDocument.defaultView.HTMLIFrameElement||t instanceof HTMLIFrameElement)this._DetachFromIframe(t);else{if(this.isAttached(t)){let l=(i=t._kmwAttachment)==null?void 0:i.inputMode;this.disableInputModeObserver(),t.inputMode=l,this.enableInputModeObserver()}t.className.indexOf("keymanweb-font")>=0&&(t.className=t.className.replace("keymanweb-font","").trim());let c=this.inputList.indexOf(t);c>-1&&this._inputList.splice(c,1),this.emit("disabled",t)}}enableTouchElement(t){return this.isKMWDisabled(t)?(this.emit("disabled",t),!1):(this.isAttached(t)||this.setupElementAttachment(t),this.enableInputElement(t),!0)}disableTouchElement(t){if(this.isAttached(t)){let i=t._kmwAttachment.inputMode;this.disableInputModeObserver(),t.inputMode=i,this.enableInputModeObserver()}}_AttachToIframe(t){try{let i=t.contentWindow.document;if(i){if(i.designMode.toLowerCase()=="on")this.setupElementAttachment(t),i.body._kmwAttachment=t._kmwAttachment,this._inputList.push(t),this.emit("enabled",t);else if(this.embeddedPageContexts.filter(s=>s.document==i).length==0){let s=new ws(i,A(p({},this.options),{owner:t}));this.embeddedPageContexts.push(s),s.on("enabled",c=>this.emit("enabled",c)),s.on("disabled",c=>this.emit("disabled",c)),s.install(this.manualAttach)}}}catch(i){}}_DetachFromIframe(t){let i=a(()=>{this.clearElementAttachment(t);let s=this._inputList.indexOf(t);s!=-1&&this._inputList.splice(s,1),this.emit("disabled",t)},"detachFromDesignIframe");try{let s=t.contentWindow.document;if(s){if(s.designMode.toLowerCase()=="on")s.body._kmwAttachment=null,i();else for(let c=0;c<this.embeddedPageContexts.length;c++)if(this.embeddedPageContexts[c].document==s){let l=this.embeddedPageContexts.splice(c,1)[0];l._ClearDocument(s.body),l.shutdown(),this.embeddedPageContexts.splice(c,1);break}}}catch(s){t._kmwAttachment&&i()}}attachToControl(t){let i=this.device.touchable;this.isAttached(t)&&!(t instanceof t.ownerDocument.defaultView.HTMLIFrameElement)||(this.isKMWInput(t)?this.isKMWDisabled(t)?this.emit("disabled",t):i?this.enableTouchElement(t):this.enableInputElement(t):i&&this.emit("disabled",t))}detachFromControl(t){(this.isAttached(t)||t instanceof t.ownerDocument.defaultView.HTMLIFrameElement)&&(this.isKMWInput(t)&&(this.isKMWDisabled(t)||this._DisableControl(t)),this.clearElementAttachment(t))}_DisableControl(t){(this.isAttached(t)||t instanceof t.ownerDocument.defaultView.HTMLIFrameElement)&&(this.device.touchable&&this.disableTouchElement(t),this.listInputs(),this.disableInputElement(t))}_EnableControl(t){this.isAttached(t)?(this.device.touchable?this.enableTouchElement(t):this.enableInputElement(t),this.listInputs()):_(t,"HTMLIFrameElement")&&this._AttachToIframe(t)}disableControl(t){this.isAttached(t)||console.warn("KeymanWeb is not attached to element "+t);let i=t.className;i.indexOf("kmw-disabled")<0&&(t.className=i?i+" kmw-disabled":"kmw-disabled")}enableControl(t){!this.isAttached(t)&&!_(t,"HTMLIFrameElement")&&console.warn("KeymanWeb is not attached to element "+t);let i=t.className;i.indexOf("kmw-disabled")>=0&&(t.className=i.replace("kmw-disabled","").trim())}listInputs(){let t=[],i=document.getElementsByTagName("input"),s=document.getElementsByTagName("textarea");for(let l=0;l<i.length;l++)$e.isSupportedType(i[l].type)&&i[l].className.indexOf("kmw-disabled")<0&&t.push({ip:i[l],x:K(i[l]),y:D(i[l])});for(let l=0;l<s.length;l++)s[l].className.indexOf("kmw-disabled")<0&&t.push({ip:s[l],x:K(s[l]),y:D(s[l])});t.sort((l,o)=>l.y!=o.y?l.y-o.y:l.x-o.x);let c=[];for(let l=0;l<t.length;l++)c.push(t[l].ip);this._sortedInputs=c}findNeighboringInput(t,i){let s,c=this.sortedInputs;if(c.length==0)return null;for(s=0;s<c.length&&c[s]!=t;s++);return s==c.length&&!i&&s--,s=i?s-1:s+1,s=s>=c.length?s-c.length:s,s=s<0?s+c.length:s,c[s]}_GetDocumentEditables(t){let i=[];if(t.ownerDocument&&t instanceof t.ownerDocument.defaultView.HTMLElement){let s=t.ownerDocument.defaultView;(t instanceof s.HTMLInputElement||t instanceof s.HTMLTextAreaElement||t instanceof s.HTMLIFrameElement)&&i.push(t)}if(t.getElementsByTagName){let s=a(function(c){return is(t.getElementsByTagName(c))},"LiTmp");i=i.concat(s("INPUT"),s("TEXTAREA"),s("IFRAME"))}return t.querySelectorAll&&(i=i.concat(is(t.querySelectorAll("[contenteditable]")))),t.ownerDocument&&t instanceof t.ownerDocument.defaultView.HTMLElement&&t.isContentEditable&&i.push(t),i}_SetupDocument(t){let i=this._GetDocumentEditables(t);for(let s=0;s<i.length;s++)this.attachToControl(i[s])}_ClearDocument(t){let i=this._GetDocumentEditables(t);for(let s=0;s<i.length;s++)this.detachFromControl(i[s])}initMutationObservers(t,i){if(typeof MutationObserver=="function"){let s=t.querySelector("body"),c;i||(c={childList:!0,subtree:!0},this.attachmentObserver=new MutationObserver(this._AutoAttachObserverCore),this.attachmentObserver.observe(s,c)),c={subtree:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["class","readonly"]},this.enablementObserver=new MutationObserver(this._EnablementMutationObserverCore),this.enablementObserver.observe(s,c),this.inputModeObserver=new MutationObserver(this._InputModeObserverCore),this.enableInputModeObserver()}else console.warn("Your browser is outdated and does not support MutationObservers, a web feature needed by KeymanWeb to support dynamically-added elements.")}enableInputModeObserver(){var s;let t=document.querySelector("body"),i={subtree:!0,attributes:!0,attributeFilter:["inputmode"]};(s=this.inputModeObserver)==null||s.observe(t,i)}disableInputModeObserver(){var t;(t=this.inputModeObserver)==null||t.disconnect()}getBaseFont(){let t=document.getElementsByTagName("input"),i=document.getElementsByTagName("textarea"),s=0,c,l="Arial,sans-serif";if(t.length==0&&i.length==0)s=0;else if(t.length>0&&i.length==0)s=1;else if(t.length==0&&i.length>0)s=2;else{let o=t[0],r=i[0];o.offsetTop<r.offsetTop?s=1:o.offsetTop>r.offsetTop?s=2:o.offsetLeft<r.offsetLeft?s=1:o.offsetLeft>r.offsetLeft&&(s=2)}switch(s){case 0:c=l;break;case 1:c=getComputedStyle(t[0]).fontFamily||"";break;case 2:c=getComputedStyle(i[0]).fontFamily||"";break}return(typeof c=="undefined"||c=="monospace")&&(c=l),c}buildAttachmentFontStyle(t){let i=t,s=this.baseFont;i&&typeof i.family!="undefined"&&(s=i.family),s=s.replace(/\u0022/g,"");let c=new RegExp("\\s?"+s+",?"),l=this.appliedFont.replace(/\u0022/g,"");l=l.replace(c,""),l=l.replace(/,$/,""),l==""?l=s:l=s+","+l,l='"'+l.replace(/\,\s?/g,'","')+'"';let o=`.keymanweb-font{
font-family:`+l+` !important;
}
`;return this.appliedFont=l,o}setAttachmentFont(t,i,s){this.stylesheetManager.unlinkAll(),this.stylesheetManager.addStyleSheetForFont(t,i,s),this.stylesheetManager.linkStylesheet(ot(this.buildAttachmentFontStyle(t)))}shutdown(){var t,i,s,c;try{(t=this.enablementObserver)==null||t.disconnect(),(i=this.attachmentObserver)==null||i.disconnect(),(s=this.inputModeObserver)==null||s.disconnect(),(c=this.stylesheetManager)==null||c.unlinkAll(),this.inputModeObserver=null,this.embeddedPageContexts.forEach(l=>{try{l.shutdown()}catch(o){}});for(let l of this.inputList)try{this.detachFromControl(l)}catch(o){this.emit("disabled",l)}this._inputList=[]}catch(l){console.error("Error occurred during shutdown"),console.error(l)}}};a(ws,"PageContextAttachment");var vi=ws;var jo=class jo{constructor(n,t){this.activationPending=n,this.activated=t}};a(jo,"FocusStateAPIObject");var Po=jo,_o=class _o extends S.default{constructor(t){super();this._maintainingFocus=!1;this.restoringFocus=!1;this._IgnoreNextSelChange=0;this.isTargetForcingScroll=t}get maintainingFocus(){return this._maintainingFocus}set maintainingFocus(t){let i=this._maintainingFocus;this._maintainingFocus=t,i&&!t&&this.emit("maintainingfocusend")}getUIState(){return new Po(this.maintainingFocus,this.restoringFocus)}setMaintainingFocus(t){this.maintainingFocus=!!t}setFocusTimer(){this.focusing=!0,this.focusTimer=window.setTimeout(()=>{this.focusing=!1},50)}};a(_o,"FocusAssistant");var Ms=_o;function aa(g,n){let t=n!=null&&n.isRTL?"rtl":"ltr";g&&(g instanceof g.ownerDocument.defaultView.HTMLInputElement||g instanceof g.ownerDocument.defaultView.HTMLTextAreaElement?g.value.length==0&&(g.dir=t):typeof g.textContent=="string"&&g.textContent.length==0&&(g.dir=t))}a(aa,"_SetTargDir");var zs=class zs extends wn{constructor(t,i){super(t);this.cookieManager=new oe("KeymanWeb_Keyboard");this.focusAssistant=new Ms(()=>{var t;return(t=this.activeTarget)==null?void 0:t.isForcingScroll()});this.domEventTracker=new Xe;this._ControlFocus=a(t=>{let i=et(t);return i&&this.setActiveTarget(i,!0),!0},"_ControlFocus");this._ControlBlur=a(t=>{if(this.focusAssistant._IgnoreNextSelChange)return this.focusAssistant._IgnoreNextSelChange--,t.cancelBubble=!0,t.stopPropagation(),!0;if(this.focusAssistant.isTargetForcingScroll())return t.cancelBubble=!0,t.stopPropagation(),!0;let i=et(t);if(i==null)return!0;this.lastActiveTarget&&this._BlurKeyboardSettings(this.lastActiveTarget.getElement());let s=this.activeTarget;this.currentTarget=null,(s||this.lastActiveTarget)&&(this.mostRecentTarget=i),this.focusAssistant.restoringFocus=!1;let c=this.activeKeyboard,l=this.focusAssistant.maintainingFocus;return!l&&c&&c.keyboard.notify(0,i,0),s&&!this.activeTarget&&this.emit("targetchange",null),this.apiEvents.callEvent("controlblurred",{target:i.getElement(),event:t,isActivating:l}),this.doChangeEvent(i),this.resetContext(),!0},"_ControlBlur");this._Click=a(t=>(this.resetContext(),!0),"_Click");this.nonKMWTouchHandler=a(t=>{this.focusAssistant.focusing=!1,clearTimeout(this.focusAssistant.focusTimer),this.forgetActiveTarget()},"nonKMWTouchHandler");this._eventsObj=i,this.page=new vi(window.document,{hostDevice:this.engineConfig.hostDevice}),this.focusAssistant.on("maintainingfocusend",()=>{!this.activeTarget&&this.mostRecentTarget&&this.emit("targetchange",this.activeTarget)})}get apiEvents(){return this._eventsObj()}initialize(){this.on("keyboardasyncload",(t,i)=>{var s;(s=this.engineConfig.alertHost)==null||s.wait("Installing keyboard<br/>"+t.name),i.then(()=>{var c;(c=this.engineConfig.alertHost)==null||c.wait()})}),this.engineConfig.deferForInitialization.then(()=>{let t=this.engineConfig.hostDevice,i=a(s=>s.stopPropagation(),"noPropagation");this.page.on("enabled",s=>{if(!(s._kmwAttachment.interface instanceof j))t.touchable&&(this.domEventTracker.detachDOMEvent(s,"touchstart",this.nonKMWTouchHandler),this.domEventTracker.attachDOMEvent(s,"touchmove",i,!1),this.domEventTracker.attachDOMEvent(s,"touchend",i,!1)),this.domEventTracker.attachDOMEvent(s,"focus",this._ControlFocus),this.domEventTracker.attachDOMEvent(s,"blur",this._ControlBlur),this.domEventTracker.attachDOMEvent(s,"click",this._Click);else{let c=s.contentWindow.document;t.browser=="firefox"?(this.domEventTracker.attachDOMEvent(c,"focus",this._ControlFocus),this.domEventTracker.attachDOMEvent(c,"blur",this._ControlBlur)):(this.domEventTracker.attachDOMEvent(c.body,"focus",this._ControlFocus),this.domEventTracker.attachDOMEvent(c.body,"blur",this._ControlBlur))}s.ownerDocument.activeElement==s&&this.setActiveTarget(We(s),!0)}),this.page.on("disabled",s=>{var l;if(!_(s,"HTMLIFrameElement"))t.touchable&&this.domEventTracker.attachDOMEvent(s,"touchstart",this.nonKMWTouchHandler,!1),this.domEventTracker.detachDOMEvent(s,"focus",this._ControlFocus),this.domEventTracker.detachDOMEvent(s,"blur",this._ControlBlur),this.domEventTracker.detachDOMEvent(s,"click",this._Click);else{let o=s.contentWindow.document;t.browser=="firefox"?(this.domEventTracker.detachDOMEvent(o,"focus",this._ControlFocus),this.domEventTracker.detachDOMEvent(o,"blur",this._ControlBlur)):(this.domEventTracker.detachDOMEvent(o.body,"focus",this._ControlFocus),this.domEventTracker.detachDOMEvent(o.body,"blur",this._ControlBlur))}let c=(l=this.mostRecentTarget)==null?void 0:l.getElement();c&&c==s&&this.forgetActiveTarget()}),this.page.install(this.engineConfig.attachType=="manual")})}get activeTarget(){let t=this.focusAssistant.maintainingFocus;return this.currentTarget||(t?this.mostRecentTarget:null)}get lastActiveTarget(){return this.mostRecentTarget}deactivateCurrentTarget(){let t=this.activeTarget||this.lastActiveTarget;t&&this.page.isAttached(t.getElement())&&this._BlurKeyboardSettings(t.getElement()),this.activeTarget||this.setActiveTarget(null,!0)}forgetActiveTarget(){this.focusAssistant.maintainingFocus=!1,this.focusAssistant.restoringFocus=!1;let t=this.activeTarget||this.mostRecentTarget;t&&this._BlurKeyboardSettings(t.getElement()),this.setActiveTarget(null,!0),t==this.lastActiveTarget&&(this.mostRecentTarget=null)}setActiveTarget(t,i){var r;let s=this.mostRecentTarget,c=this.activeTarget;if(t==c){c&&(this.currentTarget=c);return}let l=!!s;if(this.currentTarget=this.mostRecentTarget=t,this.predictionContext.setCurrentTarget(t),this.focusAssistant.restoringFocus?this._BlurKeyboardSettings(t.getElement()):t&&this._FocusKeyboardSettings(t.getElement(),!l),this._CommonFocusHelper(t))return;let o=t==null?void 0:t.getElement();if(t instanceof j&&(o=t.docRoot),o&&o.ownerDocument&&o instanceof o.ownerDocument.defaultView.HTMLElement&&aa(o,(r=this.activeKeyboard)==null?void 0:r.keyboard),t!=c&&this.emit("targetchange",t),i){let d=s==null?void 0:s.getElement();s instanceof j&&(d=s.docRoot),o?this.apiEvents.callEvent("controlfocused",{target:o,activeControl:d}):d&&this.apiEvents.callEvent("controlblurred",{target:d,event:null,isActivating:this.focusAssistant.maintainingFocus})}}get activeKeyboard(){return this._activeKeyboard}restoreLastActiveTarget(){this.mostRecentTarget&&(this.focusAssistant.restoringFocus=!0,this.mostRecentTarget.focus(),this.focusAssistant.restoringFocus=!1)}insertText(t,i,s){this.restoreLastActiveTarget();let c=this.activeTarget;return c==null&&this.mostRecentTarget&&(c=this.activeTarget),c!=null?super.insertText(t,i,s):!1}currentKeyboardSrcTarget(){let t=this.currentTarget||this.mostRecentTarget;return this.isTargetKeyboardIndependent(t)?t:null}isTargetKeyboardIndependent(t){let i=t==null?void 0:t.getElement()._kmwAttachment;return!!(i!=null&&i.keyboard||(i==null?void 0:i.keyboard)==="")}activateKeyboardForTarget(t,i){var c,l;let s=i==null?void 0:i.getElement()._kmwAttachment;if(s?(s.keyboard=(c=t==null?void 0:t.metadata.id)!=null?c:"",s.languageCode=(l=t==null?void 0:t.metadata.langId)!=null?l:""):this.globalKeyboard=t,this.currentKeyboardSrcTarget()==i){this._activeKeyboard=t;let o=t==null?void 0:t.metadata;this.page.setAttachmentFont(o==null?void 0:o.KFont,this.engineConfig.paths.fonts,this.engineConfig.hostDevice.OS)}}setKeyboardForTarget(t,i,s){if(t instanceof j){console.warn("'keymanweb.setKeyboardForControl' cannot set keyboard on iframes.");return}let c=t.getElement()._kmwAttachment,l=this.currentKeyboardSrcTarget()==t;if(c){if(c.keyboard=i||null,c.languageCode=s||null,l||this.currentKeyboardSrcTarget()==t){let o=this.globalKeyboard.metadata;this.activateKeyboard(c.keyboard||o.id,c.languageCode||o.langId,!0)}}else return}getKeyboardStubForTarget(t){if(this.isTargetKeyboardIndependent(t)){let i=t.getElement()._kmwAttachment;return this.keyboardCache.getStub(i.keyboard,i.languageCode)}else return this.globalKeyboard.metadata}getFallbackStubKey(){let t={id:"",langId:""};return this.engineConfig.hostDevice.touchable&&this.keyboardCache.defaultStub||t}activateKeyboard(t,i,s){return R(this,null,function*(){var l,o,r,d,u,B;s||(s=!1);let c=this.currentKeyboardSrcTarget();this.engineConfig.deferForInitialization.isFulfilled||(yield this.engineConfig.deferForInitialization.corePromise),t||(t=this.getFallbackStubKey().id,i=this.getFallbackStubKey().langId);try{let b=yield Ei(zs.prototype,this,"activateKeyboard").call(this,t,i,s);return(l=this.engineConfig.alertHost)==null||l.wait(),s&&!c&&this.cookieManager.save({current:`${t}:${i}`}),c==this.currentKeyboardSrcTarget()&&(aa((o=this.currentTarget)==null?void 0:o.getElement(),this.keyboardCache.getKeyboard(t)),this.page.setAttachmentFont((d=(r=this.activeKeyboard)==null?void 0:r.metadata)==null?void 0:d.KFont,this.engineConfig.paths.fonts,this.engineConfig.hostDevice.OS),this.restoreLastActiveTarget()),b}catch(b){let I=a(()=>R(this,null,function*(){let F=this.getFallbackStubKey();F.id!=t&&(yield this.activateKeyboard(F.id,F.langId,!0).catch(()=>{}))}),"fallback");(u=this.engineConfig.alertHost)==null||u.wait();let h=(b==null?void 0:b.message)||"Sorry, the "+t+" keyboard for "+i+" is not currently available.";throw b instanceof xt?console.error(b||h):console.warn(b||h),this.engineConfig.alertHost?(B=this.engineConfig.alertHost)==null||B.alert(h,I):yield I(),b}})}_BlurKeyboardSettings(t,i,s){var o;let c=this.activeKeyboard?this.activeKeyboard.keyboard.id:"",l=(o=this.activeKeyboard)==null?void 0:o.metadata.langId;i!==void 0&&s!==void 0&&(c=i,l=s),t&&t._kmwAttachment.keyboard!=null?(t._kmwAttachment.keyboard=c,t._kmwAttachment.languageCode=l):this.globalKeyboard=this.activeKeyboard}_FocusKeyboardSettings(t,i){var l;let s=t._kmwAttachment,c=this.globalKeyboard;s.keyboard!=null?this.activateKeyboard(s.keyboard,s.languageCode,!0):!i&&(c==null?void 0:c.metadata)!=((l=this._activeKeyboard)==null?void 0:l.metadata)&&this.activateKeyboard(c==null?void 0:c.metadata.id,c==null?void 0:c.metadata.langId,!0)}_CommonFocusHelper(t){var c;let i=this.focusAssistant,s=(c=this.activeKeyboard)==null?void 0:c.keyboard;return i.restoringFocus||(t==null||t.deadkeys().clear(),s==null||s.notify(0,t,1)),!i.restoringFocus&&this.mostRecentTarget!=t&&(i.maintainingFocus=!1),i.restoringFocus=!1,this.resetContext(),!1}doChangeEvent(t){if(t.changed){let i=new Event("change",{bubbles:!0,cancelable:!1});t.getElement().dispatchEvent(i)}t.changed=!1}getSavedKeyboardRaw(){let i=new oe("KeymanWeb_Keyboard").load(decodeURIComponent);return typeof i.current!="string"?null:i.current=="Keyboard_us:eng"?"Keyboard_us:en":i.current}getSavedKeyboard(){let t=this.getSavedKeyboardRaw(),i=this.keyboardCache.getStubList(),s;for(let c=0;c<i.length;c++)if(s=i[c].KI+":"+i[c].KLC,s==t)return s;for(let c=0;c<i.length;c++)if(s=i[c].KI+":"+i[c].KLC,s=="Keyboard_us:en")return s;return i.length>0?i[0].KI+":"+i[0].KLC:"Keyboard_us:en"}restoreSavedKeyboard(t){let s=t.split(":");if(s.length<2&&(s[1]=""),this.keyboardCache.getStub(s[0],s[1]))this.activateKeyboard(s[0],s[1]);else{let{id:l,langId:o}=this.getFallbackStubKey();this.activateKeyboard(l,o)}}shutdown(){this.page.shutdown(),this.domEventTracker.shutdown()}};a(zs,"ContextManager");var Ji=zs;var qo=class qo extends Re{constructor(n){super(),this.contextManager=n}isCommand(n){switch(this.codeForEvent(n)){case C.keyCodes.K_TAB:case C.keyCodes.K_TABBACK:case C.keyCodes.K_TABFWD:return!0;default:return super.isCommand(n)}}applyCommand(n,t){let i=this.codeForEvent(n),s=a(c=>{var d;let l=this.contextManager,o=(d=l.activeTarget)==null?void 0:d.getElement(),r=l.page.findNeighboringInput(o,c);r==null||r.focus()},"moveToNext");switch(i){case C.keyCodes.K_TAB:s((n.Lmodifiers&m.K_SHIFTFLAG)!=0);break;case C.keyCodes.K_TABBACK:s(!0);break;case C.keyCodes.K_TABFWD:s(!1);break}super.applyCommand(n,t)}};a(qo,"DefaultBrowserRules");var Ni=qo;function $o(g){return g.keyCode?g.keyCode:g.which?g.which:null}a($o,"_GetEventKeyCode");function Ks(g,n,t){if(g.cancelBubble===!0)return null;let i=$o(g);if(i==null)return null;let s=n.modStateFlags,c=0,l=!1,o=!1,r=C.keyCodes;switch(i){case r.K_CTRL:case r.K_LCTRL:case r.K_RCTRL:case r.K_CONTROL:case r.K_LCONTROL:case r.K_RCONTROL:l=!0;break;case r.K_LMENU:case r.K_RMENU:case r.K_ALT:case r.K_LALT:case r.K_RALT:o=!0;break}c|=g.getModifierState("Shift")?16:0,g.getModifierState("Control")&&(c|=g.location!=0&&l?g.location==1?m.LCTRLFLAG:m.RCTRLFLAG:s&3),g.getModifierState("Alt")&&(c|=g.location!=0&&o?g.location==1?m.LALTFLAG:m.RALTFLAG:s&12);let d=0;d|=g.getModifierState("CapsLock")?m.CAPITALFLAG:m.NOTCAPITALFLAG,d|=g.getModifierState("NumLock")?m.NUMLOCKFLAG:m.NOTNUMLOCKFLAG,d|=g.getModifierState("ScrollLock")?m.SCROLLFLAG:m.NOTSCROLLFLAG,c|=d;let u=n.modStateFlags!=c;n.modStateFlags=c;let B=m.RALTFLAG|m.LCTRLFLAG;(s&B)==B&&(c&B)!=B&&(c&=~B),c&m.RALTFLAG&&(c&=~m.LCTRLFLAG);let b=C.modifierBitmasks,I=n.activeKeyboard,h;I&&I.isChiral?(h=c&b.CHIRAL,I.emulatesAltGr&&(h&b.ALT_GR_SIM)==b.ALT_GR_SIM&&(h^=b.ALT_GR_SIM,h|=m.RALTFLAG)):h=c&16|(c&(m.LCTRLFLAG|m.RCTRLFLAG)?32:0)|(c&(m.LALTFLAG|m.RALTFLAG)?64:0),h|=g.metaKey?m.K_METAFLAG:0,t.browser==W.Browser.Firefox&&ie.browserMap.FF["k"+i]&&(i=ie.browserMap.FF["k"+i]);let F=new ne({device:t,kName:"",Lcode:i,Lmodifiers:h,Lstates:d,LmodifierChange:u,isSynthetic:!1}),y=typeof g.charCode!="undefined"&&g.charCode!=null&&(g.charCode==0||(h&111)!=0);F.LisVirtualKey=y||g.type!="keypress",F=Hc(F,I,n.baseLayout);let G=new ne(F);return G.source=g,G}a(Ks,"preprocessKeyboardEvent");var er=class er extends Mn{constructor(t,i,s){super();this.domEventTracker=new Xe;this.swallowKeypress=!1;this._KeyDown=a(t=>{var l;let i=this.contextManager.activeKeyboard,s=et(t);if(!s||i==null)return!0;let c=s.getElement();return((l=c==null?void 0:c.getAttribute("class"))==null?void 0:l.indexOf("kmw-disabled"))>=0?!0:this.keyDown(t)},"_KeyDown");this._KeyPress=a(t=>{var s;return!et(t)||((s=this.contextManager.activeKeyboard)==null?void 0:s.keyboard)==null?!0:this.keyPress(t)},"_KeyPress");this._KeyUp=a(t=>{let i=et(t),s=Ks(t,this.processor,this.hardDevice);if(s==null||i==null)return!0;let c=i.getElement();if(s.Lcode==13){let l=!1;if(_(c,"HTMLTextAreaElement")&&(l=!0),!l){if(c instanceof c.ownerDocument.defaultView.HTMLInputElement)if(c.form&&(c.type=="search"||c.type=="submit"))c.form.submit();else{let o=this.contextManager.page.findNeighboringInput(c,!1);o==null||o.focus()}return!0}}return this.keyUp(t)},"_KeyUp");this.hardDevice=t,this.contextManager=s,this.processor=i;let c=s.page,l=this.domEventTracker;c.on("enabled",o=>{let r=We(o);if(!(r instanceof j))l.attachDOMEvent(o,"keypress",this._KeyPress),l.attachDOMEvent(o,"keydown",this._KeyDown),l.attachDOMEvent(o,"keyup",this._KeyUp);else{let d=r.getElement().contentDocument;l.attachDOMEvent(d.body,"keydown",this._KeyDown),l.attachDOMEvent(d.body,"keypress",this._KeyPress),l.attachDOMEvent(d.body,"keyup",this._KeyUp)}}),c.on("disabled",o=>{let r=We(o);if(!(r instanceof j))l.detachDOMEvent(o,"keypress",this._KeyPress),l.detachDOMEvent(o,"keydown",this._KeyDown),l.detachDOMEvent(o,"keyup",this._KeyUp);else{let d=r.getElement().contentDocument;l.detachDOMEvent(d.body,"keydown",this._KeyDown),l.detachDOMEvent(d.body,"keypress",this._KeyPress),l.detachDOMEvent(d.body,"keyup",this._KeyUp)}})}keyDown(t){this.swallowKeypress=!1;let i=Ks(t,this.processor,this.hardDevice);if(i==null)return!0;let s={LeventMatched:!1};return this.emit("keyevent",i,(c,l)=>{s.LeventMatched=c&&!c.triggerKeyDefault,s.LeventMatched?(t&&t.preventDefault&&(t.preventDefault(),t.stopPropagation()),this.swallowKeypress=!!i.Lcode,i.Lcode==8&&(this.swallowKeypress=!1)):this.swallowKeypress=!1}),!s.LeventMatched}keyUp(t){let i=Ks(t,this.processor,this.hardDevice);if(i==null)return!0;let s=et(t);return this.processor.doModifierPress(i,s,!1)}keyPress(t){var c;let i=Ks(t,this.processor,this.hardDevice);if(i==null||i.LisVirtualKey)return!0;if(!((c=this.contextManager.activeKeyboard)!=null&&c.keyboard.isMnemonic))return!this.swallowKeypress||i.Lcode<32||this.hardDevice.browser==W.Browser.Safari&&i.Lcode>63232&&i.Lcode<63744;let s={};return this.swallowKeypress||this.emit("keyevent",i,(l,o)=>{s.preventDefaultKeystroke=!!l}),this.swallowKeypress||s.preventDefaultKeystroke?(this.swallowKeypress=!1,t&&t.preventDefault&&(t.preventDefault(),t.stopPropagation()),!1):(this.swallowKeypress=!1,!0)}shutdown(){this.domEventTracker.shutdown()}};a(er,"HardwareEventKeyboard");var ki=er;var tr=class tr{constructor(){this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight}equals(n){return this.innerWidth==n.innerWidth&&this.innerHeight==n.innerHeight}};a(tr,"RotationState");var Ds=tr,yt=class yt{constructor(n){this.idlePermutationCounter=yt.IDLE_PERMUTATION_CAP;this.keyman=n}resolve(){var i;let n=this.keyman.osk;(i=this.keyman.touchLanguageMenu)==null||i.hide(),this.keyman.touchLanguageMenu=null,n.setNeedsLayout(),this.oskVisible&&n.present(),this.isActive=!1,this.updateTimer&&(window.clearInterval(this.updateTimer),this.rotState=null);let t=this.keyman.contextManager.activeTarget;t&&window.setTimeout(()=>{this.keyman.ensureElementVisibility(t.getElement())},0)}initNewRotation(){this.oskVisible=this.keyman.osk.isVisible(),this.keyman.osk.hideNow(),this.isActive=!0}init(){let n=this.keyman.config.hostDevice.OS,t=this.keyman.util;n=="ios"?(t.attachDOMEvent(window,"orientationchange",()=>(this.iOSEventHandler(),!1)),t.attachDOMEvent(window,"resize",()=>(this.iOSEventHandler(),!1))):n=="android"&&("onmozorientationchange"in screen?t.attachDOMEvent(screen,"mozorientationchange",()=>(this.initNewRotation(),!1)):t.attachDOMEvent(window,"orientationchange",()=>(this.initNewRotation(),!1)),t.attachDOMEvent(window,"resize",()=>(this.resolve(),!1)))}iOSEventHandler(){this.isActive||(this.initNewRotation(),this.rotState=new Ds,this.updateTimer=window.setInterval(this.iOSEventUpdate.bind(this),yt.UPDATE_INTERVAL)),this.idlePermutationCounter=0}iOSEventUpdate(){let n=new Ds;this.rotState.equals(n)?++this.idlePermutationCounter==yt.IDLE_PERMUTATION_CAP&&this.resolve():(this.rotState=n,this.idlePermutationCounter=0)}};a(yt,"RotationProcessor"),yt.IDLE_PERMUTATION_CAP=15,yt.UPDATE_INTERVAL=20;var Os=yt;var nr=class nr{constructor(n,t){this.domEventTracker=new Xe;this.suppressFocusCheck=a(n=>(this.focusAssistant.isTargetForcingScroll()&&(n.stopPropagation(),n.cancelBubble=!0),!0),"suppressFocusCheck");this.pageFocusHandler=a(()=>{var n;return!this.focusAssistant.maintainingFocus&&((n=this.engine.osk)!=null&&n.vkbd)&&(this.engine.contextManager.deactivateCurrentTarget(),this.engine.contextManager.resetContext()),!1},"pageFocusHandler");this.touchStartActivationHandler=a(n=>{var s,c;let t=this.engine.osk;if(!t)return!1;let i=this.engine.config.hostDevice;if(this.deactivateOnRelease=!0,this.touchY=n.touches[0].screenY,this.deactivateOnScroll=!1,i.OS=="android"&&i.browser=="chrome"){if(typeof t._Box=="undefined"||typeof t._Box.style=="undefined")return!1;let l=n.target.parentElement;if(typeof l!="undefined"&&l!=null&&(((s=l.getAttribute("class"))==null?void 0:s.indexOf("kmw-key-"))>=0||typeof l.parentElement!="undefined"&&l.parentElement!=null&&(l=l.parentElement,((c=l.getAttribute("class"))==null?void 0:c.indexOf("kmw-key-"))>=0)))return!1;this.deactivateOnScroll=!0}return!1},"touchStartActivationHandler");this.touchMoveActivationHandler=a(n=>{this.deactivateOnScroll&&(this.focusAssistant.focusing=!1,this.engine.contextManager.deactivateCurrentTarget());let t=n.touches[0].screenY,i=this.touchY;return(t-i>5||i-t<5)&&(this.deactivateOnRelease=!1),!1},"touchMoveActivationHandler");this.touchEndActivationHandler=a(n=>(this.deactivateOnRelease&&!this.engine.touchLanguageMenu&&!this.focusAssistant.focusing&&this.engine.contextManager.deactivateCurrentTarget(),this.deactivateOnRelease=!1,!1),"touchEndActivationHandler");this._WindowLoad=a(()=>{document.body.scrollTop=0,typeof document.documentElement!="undefined"&&(document.documentElement.scrollTop=0)},"_WindowLoad");this._WindowUnload=a(()=>{this.engine.shutdown()},"_WindowUnload");this.window=n,this.engine=t,this.attachHandlers(),t.config.hostDevice.touchable&&(this.buildPageTrailer(),this.rotationProcessor=new Os(this.engine),this.rotationProcessor.init())}buildPageTrailer(){let n=this.mobilePageTrailer=document.createElement("div"),t=n.style;n.className="kmw-page-trailer",t.width="100%",t.height=screen.width/2+"px",document.body.appendChild(n)}get focusAssistant(){return this.engine.contextManager.focusAssistant}attachHandlers(){let n=this.domEventTracker,t=this.engine.config.hostDevice,i=this.window.document.body;n.attachDOMEvent(this.window,"focus",this.pageFocusHandler,!1),n.attachDOMEvent(this.window,"blur",this.pageFocusHandler,!1),n.attachDOMEvent(i,"focus",this.suppressFocusCheck,!0),n.attachDOMEvent(i,"blur",this.suppressFocusCheck,!0),t.touchable&&(n.attachDOMEvent(i,"touchstart",this.touchStartActivationHandler,!1),n.attachDOMEvent(i,"touchmove",this.touchMoveActivationHandler,!1),n.attachDOMEvent(i,"touchend",this.touchEndActivationHandler,!1)),n.attachDOMEvent(window,"load",this._WindowLoad,!1),n.attachDOMEvent(window,"unload",this._WindowUnload,!1),n.attachDOMEvent(document,"keyup",this.engine.hotkeyManager._Process,!1)}shutdown(){var s;let n=this.domEventTracker,t=this.engine.config.hostDevice,i=this.window.document.body;n.detachDOMEvent(this.window,"focus",this.pageFocusHandler,!1),n.detachDOMEvent(this.window,"blur",this.pageFocusHandler,!1),n.detachDOMEvent(i,"focus",this.suppressFocusCheck,!0),n.detachDOMEvent(i,"blur",this.suppressFocusCheck,!0),t.touchable&&(n.detachDOMEvent(i,"touchstart",this.touchStartActivationHandler,!1),n.detachDOMEvent(i,"touchmove",this.touchMoveActivationHandler,!1),n.detachDOMEvent(i,"touchend",this.touchEndActivationHandler,!1),(s=this.mobilePageTrailer)==null||s.parentElement.removeChild(this.mobilePageTrailer)),n.detachDOMEvent(window,"load",this._WindowLoad,!1),n.detachDOMEvent(window,"unload",this._WindowUnload,!1),n.detachDOMEvent(document,"keyup",this.engine.hotkeyManager._Process,!1)}};a(nr,"PageIntegrationHandlers");var Ps=nr;function Ce(g){let n=document.createElement(g);return n.style.userSelect="none",n.style.MozUserSelect="none",n.style.KhtmlUserSelect="none",n.style.UserSelect="none",n.style.WebkitUserSelect="none",n}a(Ce,"_CreateElement");function Tt(g,n){try{if(g&&typeof window.getComputedStyle!="undefined")return window.getComputedStyle(g,"").getPropertyValue(n)}catch(t){}return""}a(Tt,"getStyleValue");var ir=class ir{constructor(n){this.keyman=n,this.scrolling=!1,this.shim=this.constructShim()}constructShim(){let n=this,t=Ce("div"),i=this.keyman.osk;return t.id="kmw-language-menu-background",t.addEventListener("touchstart",s=>{if(s.preventDefault(),n.hide(),s.touches.length>2){let c=s.touches[1].pageX,l=s.touches[1].pageY,o=i.vkbd.spaceBar;c>o.offsetLeft&&c<o.offsetLeft+o.offsetWidth&&l>o.offsetTop&&l<o.offsetTop+o.offsetHeight&&this.keyman.osk.emit("showbuild")}},!1),t}show(){let n=this.keyman.config.hostDevice,t=this.keyman.keyboardRequisitioner.cache.getStubList();if(t.length<1)return;let s=this.lgList=Ce("div");this.lgList.id="kmw-language-menu";let c=this;document.body.appendChild(this.shim);let l=Ce("div"),o=l.style,r=Ce("div");l.id="kmw-menu-scroll-container",r.id="kmw-menu-scroller","WebkitOverflowScrolling"in o&&(o.WebkitOverflowScrolling="touch"),l.appendChild(r),s.appendChild(l);let d,u=Ce("div");u.id="kmw-menu-index";for(let y=1;y<=26;y++)d=Ce("p"),d.innerHTML=String.fromCharCode(y+64),u.appendChild(d);if(u.addEventListener("touchstart",function(y){c.scrollToLanguage(y,l,r)},!1),u.addEventListener("touchend",function(y){y.stopPropagation()},!1),s.appendChild(u),s.addEventListener("scroll",function(y){c.scrolling=!0},!1),l.addEventListener("scroll",function(y){l.scrollTop<1&&(l.scrollTop=1),l.scrollTop>l.scrollHeight-l.offsetHeight-1&&(l.scrollTop=l.scrollHeight-l.offsetHeight-1)},!1),this.activeLgNo=this.addLanguages(r,t),this.lgList.style.visibility="hidden",document.body.appendChild(this.lgList),n.OS=="android"&&"devicePixelRatio"in window&&(this.lgList.style.fontSize=2/window.devicePixelRatio+"em"),n.OS=="android"&&n.formFactor=="tablet"&&"devicePixelRatio"in window){let y=parseInt(Tt(s,"width"),10),G=s.style;isNaN(y)||(G.width=G.maxWidth=2*y/window.devicePixelRatio+"px"),y=parseInt(Tt(l,"width"),10),G=l.style,isNaN(y)||(G.width=G.maxWidth=2*y/window.devicePixelRatio+"px"),y=parseInt(Tt(r,"width"),10),G=r.style,isNaN(y)||(G.width=G.maxWidth=2*y/window.devicePixelRatio+"px")}this.adjust(0);let B=u.childNodes[1].offsetTop-u.childNodes[0].offsetTop,b=Math.floor(s.offsetHeight/26),I=Math.round(100*b/B)/100,h=I>.6?1:2;I>1.25&&(I=1.25);for(let y=0;y<26;y++){let G=u.childNodes[y].style;h==2&&y%2==1?G.display="none":(G.fontSize=I*h+"em",G.lineHeight=b*h+"px")}let F=l.offsetWidth;l.scrollHeight>l.offsetHeight+3?F=F+u.offsetWidth:u.style.display="none",s.style.width=F+"px",this.lgList.style.visibility="",this.scrollToIndex(this.activeLgNo,l,r)}adjust(n){let t=this.keyman.osk,i=this.keyman.config.hostDevice,s=this.lgList,c=s.firstChild,l=c.firstChild,o=0,r=window.innerHeight-t.vkbd.lgKey.offsetHeight-16,d=s.style,u=s.childNodes[1],B=l.childNodes.length+n-1,b=l.firstChild.firstChild.offsetHeight,I=B*b;i.OS=="ios"&&(i.formFactor=="phone"?(o=Fe()?36:0,r=(window.innerHeight-o-16)*Se(i.formFactor)):i.formFactor=="tablet"&&(o=Fe()?16:0,r=r-o)),d.left=K(t.vkbd.lgKey)+"px",I>r&&(I=r),d.height=I+"px",d.bottom="0px",u.style.height=c.style.height=d.height}scrollToLanguage(n,t,i){n.stopImmediatePropagation(),n.stopPropagation(),n.preventDefault();let s=n.touches[0].target;if(s.nodeName!="P")return;let c,l=s.innerHTML.charCodeAt(0),o=i.childNodes;try{for(c=0;c<o.length-1&&!(o[c].firstChild.innerHTML.toUpperCase().charCodeAt(0)>=l);c++);}catch(r){}this.scrollToIndex(c,t,i)}scrollToIndex(n,t,i){let s;try{s=i.firstChild.getBoundingClientRect().height*(n-.5)+1,t.scrollTop=s}catch(l){s=0}try{t.scrollTop<0&&(t.scrollTop=0),t.scrollTop>t.scrollHeight-t.offsetHeight-1&&(t.scrollTop=t.scrollHeight-t.offsetHeight-1)}catch(l){}}addLanguages(n,t){var u;let i=t.length,s=this.keyman.config.hostDevice,c=[];for(let B=0;B<i;B++){let b=t[B].KL;c.indexOf(b)==-1&&c.push(b)}c.sort();let l=Math.round(100/Se(s.formFactor))/100,o=-1;for(let B=0;B<c.length;B++){let b=Ce("div");b.className="kbd-list-closed";let I=Ce("p");I.kList=[];for(let F=0;F<i;F++)t[F].KL==c[B]&&I.kList.push(t[F]);s.OS=="ios"&&(I.style.fontSize=l+"em"),b.appendChild(I),n.appendChild(b),c[B]==((u=this.keyman.contextManager.activeKeyboard)==null?void 0:u.metadata.langName)&&(o=B);let h=this;if(I.kList.length>1){I.className="kbd-list",I.innerHTML=c[B]+"...",I.scrolled=!1,I.ontouchend=F=>{F.stopPropagation(),I.scrolled?I.scrolled=!1:I.parentElement.className=I.parentElement.className=="kbd-list-closed"?"kbd-list-open":"kbd-list-closed",h.adjust(I.parentElement.className=="kbd-list-closed"?0:I.kList.length)},I.addEventListener("touchstart",function(F){F.stopPropagation()},!1),I.addEventListener("touchmove",function(F){I.scrolled=!0,F.stopPropagation()},!1);for(let F=0;F<I.kList.length;F++){let y=Ce("p");y.className="kbd-list-entry",s.OS=="ios"&&(y.style.fontSize=l+"em"),this.addKeyboard(I.kList[F],y,!1),b.appendChild(y)}}else I.innerHTML=c[B],I.className="kbd-single-entry",this.addKeyboard(I.kList[0],I,!0);B==o&&(I.className=I.className+" current")}let r=Ce("div");r.id="kmw-menu-footer";let d=a(function(B){B.cancelable&&B.preventDefault(),B.stopPropagation()},"cancelTouch");return r.addEventListener("touchstart",d,!1),r.addEventListener("touchmove",d,!1),r.addEventListener("touchend",d,!1),n.appendChild(r),o}addKeyboard(n,t,i){t.kn=n.KI,t.kc=n.KLC,t.innerHTML=i?n.KL:n.KN.replace(" Keyboard","");let s=this,c=a(()=>{if(this.originalBodyStyle)return console.error("Unexpected state:  `originalBodyStyle` was not cleared by a previous `unlockBodyScroll()` call"),!1;this.originalBodyStyle={};let B=this.originalBodyStyle,b=document.body.style;return B.overflowY=b.overflowY,B.height=b.height,b.overflowY="hidden",b.height="100%",!0},"lockBodyScroll"),l=a(()=>{if(!this.originalBodyStyle){console.error("Unexpected state:  `originalBodyStyle` is unset; cannot restore original body style");return}let B=this.originalBodyStyle,b=document.body.style;b.overflowY=B.overflowY,b.height=B.height,this.originalBodyStyle=null},"unlockBodyScroll"),o=a(function(B){B.stopPropagation(),this.className.indexOf("selected")<=0&&(this.className=this.className+" selected"),s.scrolling=!1,s.y0=B.touches[0].pageY,c()},"touchStart"),r=a(function(B){B.stopImmediatePropagation();let b=s.lgList.childNodes[0],I=b.scrollHeight-b.offsetHeight,h;if(typeof B.pageY!="undefined")h=B.pageY;else if(typeof B.touches!="undefined")h=B.touches[0].pageY;else return!1;let F=h-s.y0;if(F<0)b.scrollTop>=I-1&&(s.y0=h);else if(F>0)b.scrollTop<2&&(s.y0=h);else return!1;return(F<-5||F>5)&&(s.scrolling=!0,this.className=this.className.replace(/\s*selected/,""),s.y0=h),!0},"touchMove"),d=a(function(B){let b=this;return typeof B.stopImmediatePropagation!="undefined"?B.stopImmediatePropagation():B.stopPropagation(),s.scrolling?this.className=this.className.replace(/\s*selected/,""):(s.keyman.contextManager.focusAssistant.setFocusTimer(),s.lgList.style.display="none",s.keyman.contextManager.activateKeyboard(b.kn,b.kc,!0),s.keyman.contextManager.restoreLastActiveTarget(),s.hide()),l(),!0},"touchEnd"),u=a(function(B){l()},"touchCancel");t.addEventListener("touchstart",o,!1),t.addEventListener("touchmove",r,!1),t.addEventListener("touchend",d,!1),t.addEventListener("touchcancel",u,!1)}hide(){let n=this.keyman.osk;this.lgList&&(n.vkbd.highlightKey(n.vkbd.lgKey,!1),this.lgList.style.visibility="hidden",window.setTimeout(()=>{this.shim.parentElement&&(document.body.removeChild(this.shim),document.body.removeChild(this.lgList))},500)),this.keyman.touchLanguageMenu=null}};a(ir,"LanguageMenu");var js=ir;function ga(g,n,t){let i=t.focusAssistant;n.on("globekey",(s,c)=>{c&&n.hostDevice.touchable&&(g.touchLanguageMenu=new js(g),g.touchLanguageMenu.show()),n.vkbd&&n.vkbd.highlightKey(s,!1)}),n.on("hiderequested",s=>{n&&(n.startHide(!0),t.forgetActiveTarget())}),n.addEventListener("hide",s=>{var c;s!=null&&s.HiddenByUser&&((c=t.activeTarget)==null||c.focus())}),n.on("showbuild",()=>{var s;(s=g.config.alertHost)==null||s.alert("KeymanWeb Version "+Ln.VERSION+'<br /><br /><span style="font-size:0.8em">Copyright &copy; 2007-2023 SIL International</span>')}),n.on("dragmove",s=>R(this,null,function*(){i.restoringFocus=!0,yield s,t.restoreLastActiveTarget(),i.restoringFocus=!1,i.setMaintainingFocus(!1)})),n.on("resizemove",s=>R(this,null,function*(){i.restoringFocus=!0,yield s,t.restoreLastActiveTarget(),i.restoringFocus=!1,i.setMaintainingFocus(!1)})),n.on("pointerinteraction",s=>R(this,null,function*(){i.setMaintainingFocus(!0),yield s,i.setMaintainingFocus(!1)}))}a(ga,"setupOskListeners");function Ag(g){let n=document.createElement(g);return n.style.userSelect="none",n}a(Ag,"createUnselectableElement");var sr=class sr{constructor(n){this.getAbsoluteX=K;this.getAbsoluteY=D;this._GetAbsoluteX=K;this._GetAbsoluteY=D;this._GetAbsolute=this.getAbsolute;this.toNzString=this.nzString;this.createElement=Ag;this.getStyleValue=Tt;this.config=n,this.stylesheetManager=new ue(document.body,n.applyCacheBusting),this.domEventTracker=new Xe}isTouchDevice(){return this.config.hostDevice.touchable}getAbsolute(n){return{x:K(n),y:D(n)}}getOption(n,t){return n in this.config.paths?this.config.paths[n]:n in this.config.options?this.config.options[n]:arguments.length>1?t:""}setOption(n,t){switch(n){case"attachType":break;case"ui":break;case"useAlerts":this.config.signalUser=t?new Ft:null;break;case"setActiveOnRegister":this.config.activateFirstKeyboard=!!t;break;case"spacebarText":this.config.spacebarText=t;break;default:throw new Error("Path-related options may not be changed after the engine has initialized.")}}loadCookie(n){return new oe(n).load(decodeURIComponent)}saveCookie(n,t){new oe(n).save(t,encodeURIComponent)}addStyleSheet(n){let t=ot(n);return this.stylesheetManager.linkStylesheet(t),t}removeStyleSheet(n){return this.stylesheetManager.unlink(n)}linkStyleSheet(n){this.stylesheetManager.linkExternalSheet(n)}getLanguageCodes(n){return n.indexOf("-")==-1?[n]:n.split("-")}attachDOMEvent(n,t,i,s){this.domEventTracker.attachDOMEvent(n,t,i,s)}detachDOMEvent(n,t,i,s){this.domEventTracker.detachDOMEvent(n,t,i,s)}get alertHost(){return this.config.alertHost?this.config.alertHost:(this._alertHost||(this._alertHost=new Ft),this._alertHost)}alert(n,t){this.alertHost.alert(n,t)}nzString(n,t){let i="";return arguments.length>1&&(i=t),typeof n=="undefined"||n==null||n==0||n==""?i:""+n}toNumber(n,t){let i=parseInt(n,10);return isNaN(i)?t:i}toFloat(n,t){let i=parseFloat(n);return isNaN(i)?t:i}rgba(n,t,i,s,c){let l="transparent";try{l="rgba("+t+","+i+","+s+","+c+")"}catch(o){l="rgb("+t+","+i+","+s+")"}return l}shutdown(){var n,t,i;(n=this.stylesheetManager)==null||n.unlinkAll(),(t=this.domEventTracker)==null||t.shutdown(),(i=this._alertHost)==null||i.shutdown()}};a(sr,"UtilApiEndpoint");var _s=sr;var lr=class lr{constructor(n,t,i){this.code=n,this.shift=t,this.handler=i}matches(n,t){return this.code==n&&this.shift==t}};a(lr,"Hotkey");var cr=lr,or=class or{constructor(){this.hotkeys=[];this._Process=a(n=>{n||(n=window.event);let t=$o(n);if(t==null)return!1;let i=(n.shiftKey?16:0)|(n.ctrlKey?32:0)|(n.altKey?64:0);for(let s=0;s<this.hotkeys.length;s++)if(this.hotkeys[s].matches(t,i))return this.hotkeys[s].handler(),n.returnValue=!1,n&&n.preventDefault&&n.preventDefault(),n.cancelBubble=!0,!1;return!0},"_Process")}addHotKey(n,t,i){for(let s=0;s<this.hotkeys.length;s++)if(this.hotkeys[s].code==n&&this.hotkeys[s].shift==t){this.hotkeys[s].handler=i;return}this.hotkeys.push(new cr(n,t,i))}removeHotkey(n,t){for(let i=0;i<this.hotkeys.length;i++)if(this.hotkeys[i].matches(n,t)){this.hotkeys.splice(i,1);return}}};a(or,"HotkeyManager");var qs=or;var ar=class ar{constructor(n){this.e=n,this.c=n.style.backgroundColor}reset(){this.e.style.backgroundColor=this.c}};a(ar,"BeepData");var rr=ar,gr=class gr{constructor(n){this._BeepObjects=[];this._BeepTimeout=0;this.reset=a(()=>{this.keyboardInterface.resetContextCache();let n;for(this._BeepTimeout=0,n=0;n<this._BeepObjects.length;n++)this._BeepObjects[n].reset();this._BeepObjects=[]},"reset");this.keyboardInterface=n}beep(n){if(!(n instanceof P))return;let t=n.getElement();if(n instanceof j&&(t=n.docRoot),!!t&&!(!t.style||typeof t.style.backgroundColor=="undefined")){for(let i=0;i<this._BeepObjects.length;i++)if(this._BeepObjects[i].e==t)return;this._BeepObjects.push(new rr(t)),t.style.backgroundColor="#000000",this._BeepTimeout==0&&(this._BeepTimeout=1,window.setTimeout(this.reset,50))}}};a(gr,"BeepHandler");var $s=gr;var dr=class dr extends Rt{constructor(t,i){super(t,i);this.GetLastActiveElement=this.getLastActiveElement;this.FocusLastActiveElement=this.focusLastActiveElement;this.HideHelp=this.hideHelp;this.ShowHelp=this.showHelp;this.ShowPinnedHelp=this.showPinnedHelp}saveFocus(){this.engine.contextManager.focusAssistant._IgnoreNextSelChange=1}getLastActiveElement(){return this.engine.contextManager.lastActiveTarget}focusLastActiveElement(){this.engine.contextManager.restoreLastActiveTarget()}hideHelp(){this.engine.osk.startHide(!0)}showHelp(t,i){let s=this.engine.osk;s instanceof qe?s.presentAtPosition(t,i):s.present()}showPinnedHelp(){let t=this.engine.osk;t instanceof qe&&(!t.activeKeyboard.keyboard.isCJK||!this.ruleBehavior)&&(t.userPositioned=!0),t.present()}};a(dr,"KeyboardInterface");var Vn=dr;(function(){Vn.__publishShorthandAPI()})();var tc=class tc extends ni{constructor(t,i){let s=new Ts(i);super(t,s,new Ji(s,()=>this.legacyAPIEvents),c=>({keyboardInterface:new Vn(window,c),defaultOutputRules:new Ni(c.contextManager)}));this._initialized=0;this.hotkeyManager=new qs;this.getOskHeight=null;this.getOskWidth=null;this.helpURL="https://help.keyman.com/go";this.keyEventRefocus=a(()=>{this.contextManager.restoreLastActiveTarget()},"keyEventRefocus");this._GetKeyboardDetail=a(function(t,i){return{Name:t.KN,InternalName:t.KI,LanguageName:t.KL,LanguageCode:t.KLC,RegionName:t.KR,RegionCode:t.KRC,CountryName:t.KC,CountryCode:t.KCC,KeyboardID:t.KD,Font:t.KFont,OskFont:t.KOskFont,HasLoaded:!!i,IsRTL:i?i.isRTL:null}},"_GetKeyboardDetail");this._util=new _s(s),this.beepHandler=new $s(this.core.keyboardInterface),this.core.keyboardProcessor.beepHandler=()=>this.beepHandler.beep(this.contextManager.activeTarget),this.hardKeyboard=new ki(s.hardDevice,this.core.keyboardProcessor,this.contextManager),this.contextManager.on("targetchange",c=>{let l=c==null?void 0:c.getElement();this.osk&&(this.osk.activationModel.activationTrigger=l),this.config.hostDevice.touchable&&c&&this.ensureElementVisibility(l)})}ensureElementVisibility(t){if(!t||!this.osk)return;let i=D(t),s=window.pageYOffset,c=i-s;i>=s&&(c-=window.innerHeight-this.osk._Box.offsetHeight-t.offsetHeight-2,c<0&&(c=0)),c!=0&&window.scrollTo(0,c+s)}get util(){return this._util}get views(){return Ro}get initialized(){return this._initialized}get ui(){return this._ui}set ui(t){this._ui&&this._ui.shutdown(),this._ui=t,this.config.deferForInitialization.isFulfilled&&t.initialize()}init(t){return R(this,null,function*(){let s=new Vt().detect(),c=p(p({},ra),t);if(this.config.hostDevice=s,this.config.initialize(c),this._initialized=1,yield fi(),this.config.deferForInitialization.isResolved)return Promise.resolve();yield Ei(tc.prototype,this,"init").call(this,c),this.keyboardRequisitioner.cloudQueryEngine.once("unboundregister",()=>{var o;(o=this.contextManager.activeKeyboard)!=null&&o.keyboard||this.setActiveKeyboard("","")}),this.contextManager.initialize();let l=this.contextManager.getSavedKeyboardRaw();s.touchable?this.osk=new Vi(this):this.osk=new Si(this),ga(this,this.osk,this.contextManager),this.pageIntegration=new Ps(window,this),this.config.finalizeInit(),this.ui&&(this.ui.initialize(),this.legacyAPIEvents.callEvent("loaduserinterface",{})),this._initialized=2,yield Promise.resolve(),l||(l=this.contextManager.getSavedKeyboard()),l&&this.contextManager.restoreSavedKeyboard(l),yield Promise.resolve()})}get register(){return this.keyboardRequisitioner.cloudQueryEngine.registerFromCloud}getUIState(){return this.contextManager.focusAssistant.getUIState()}activatingUI(t){this.contextManager.focusAssistant.setMaintainingFocus(!!t)}setKeyboardForControl(t,i,s){if(t instanceof t.ownerDocument.defaultView.HTMLIFrameElement){console.warn("'keymanweb.setKeyboardForControl' cannot set keyboard on iframes.");return}if(!this.isAttached(t)){console.error("KeymanWeb is not attached to element "+t);return}let c=null;if(i&&(c=this.keyboardRequisitioner.cache.getStub(i,s),!c))throw new Error(`No keyboard has been registered with id ${i} and language code ${s}.`);this.contextManager.setKeyboardForTarget(t._kmwAttachment.interface,i,s)}getKeyboardForControl(t){let i=We(t);return this.contextManager.getKeyboardStubForTarget(i).id}getLanguageForControl(t){let i=We(t);return this.contextManager.getKeyboardStubForTarget(i).langId}isAttached(t){return this.contextManager.page.isAttached(t)}addKeyboards(...t){return this.config.deferForInitialization.then(()=>{if(!t||!t[0]||t[0].length==0)return this.keyboardRequisitioner.fetchCloudCatalog().catch(i=>(console.error(i[0].error),i));{let i=[];return Array.isArray(t[0])?i=i.concat(t[0]):Array.isArray(t)&&(i=i.concat(t)),this.keyboardRequisitioner.addKeyboardArray(i)}})}addKeyboardsForLanguage(t){return this.config.deferForInitialization.then(()=>typeof t=="string"?this.keyboardRequisitioner.addLanguageKeyboards(t.split(",").map(i=>i.trim())):this.keyboardRequisitioner.addLanguageKeyboards(t))}isCJK(t){let i;if(t){let s=t;s.KeyboardID?i=this.keyboardRequisitioner.cache.getKeyboard(s.KeyboardID):i=new w(t)}else i=this.core.activeKeyboard;return i&&i.isCJK}getKeyboard(t,i){let s=this.keyboardRequisitioner.cache.getStub(t,i),c=this.keyboardRequisitioner.cache.getKeyboardForStub(s);return s&&this._GetKeyboardDetail(s,c)}getKeyboards(){let t=[],i=this.keyboardRequisitioner.cache,s=i.getStubList();for(let c=0;c<s.length;c++){let l=s[c],o=i.getKeyboardForStub(l),r=this._GetKeyboardDetail(l,o);t.push(r)}return t}removeKeyboards(...t){var i;for(let s=0;s<t.length;s++)this.keyboardRequisitioner.cache.forgetKeyboard(t[s],!0),((i=this.contextManager.activeKeyboard)==null?void 0:i.metadata.id)==le(t[s])&&this.contextManager.activateKeyboard("","");return!0}getSavedKeyboard(){return this.contextManager.getSavedKeyboard()}focusLastActiveElement(){var t;(t=this.contextManager.lastActiveTarget)==null||t.focus()}getLastActiveElement(){var t;return(t=this.contextManager.lastActiveTarget)==null?void 0:t.getElement()}setActiveElement(t,i){if(typeof t=="string"){let c=t;if(t=document.getElementById(t),!t)throw new Error(`Could not find the specified element (id: ${c}`)}let s=We(t);if(!s)throw new Error(`KMW is not attached to the specified element (id: ${t.id}).`);this.contextManager.setActiveTarget(s,i)}moveToElement(t){typeof t=="string"&&(t=document.getElementById(t)),t.focus()}addHotKey(t,i,s){this.hotkeyManager.addHotKey(t,i,s)}removeHotKey(t,i){this.hotkeyManager.removeHotkey(t,i)}attachToControl(t){this.contextManager.page.attachToControl(t)}detachFromControl(t){this.contextManager.page.detachFromControl(t)}disableControl(t){this.contextManager.page.disableControl(t)}enableControl(t){this.contextManager.page.enableControl(t)}BuildVisualKeyboard(t,i,s,c){let l=null;t!=null&&(l=this.keyboardRequisitioner.cache.getKeyboard(t)),l=l||this.core.activeKeyboard;let o=this.keyboardRequisitioner.cache.getStub(l),r=this.getOskHeight,d=(typeof r=="function"?r():null)||this.osk.computedHeight||200;return Ge.buildDocumentationKeyboard(l,o,this.config.paths,s,c,d)}shutdown(){var t,i;this.pageIntegration.shutdown(),this.contextManager.shutdown(),(t=this.osk)==null||t.shutdown(),this.core.languageProcessor.shutdown(),this.hardKeyboard.shutdown(),this.util.shutdown(),this.legacyAPIEvents.callEvent("unloaduserinterface",{}),(i=this.ui)==null||i.shutdown()}};a(tc,"KeymanEngine");var ec=tc;var da=document.getElementsByTagName("script"),ua=da[da.length-1].src,Rg=ua.substr(0,ua.lastIndexOf("/")+1);window.keyman=new ec(an,Rg);})();
//# sourceMappingURL=keymanweb.js.map

(function(){var f;if(!(!((f=keyman==null?void 0:keyman.ui)===null||f===void 0)&&f.name))try{if(s=keyman,d=s.util,d.isTouchDevice())throw"";p=function(){function l(){var e=this;this.name="toggle",this.initialized=!1,this.controller=null,this.oskButton=null,this.kbdButton=null,this.controllerHovered=!1,this.keyboards=[],this.lastActiveKeyboard=-1,this.selectedMenuItem=null,this.updateList=!0,this.updateTimer=null,this.switchOsk=function(){if(!(s.getActiveKeyboard()==""||s.isCJK())&&s.osk){var o=!s.osk.isEnabled();s.osk.show(o),e.oskButton._setSelected(o)}},this.switchSingleKbd=function(){var o=s.getActiveKeyboard()=="",n=0,t="",a="";if(o){if(e.keyboards.length==0)return;e.lastActiveKeyboard<e.keyboards.length&&e.lastActiveKeyboard>=0&&(n=e.lastActiveKeyboard),t=e.keyboards[n]._InternalName,a=e.keyboards[n]._LanguageCode,s.setActiveKeyboard(t,a),e.lastActiveKeyboard=n}else s.setActiveKeyboard("");e.kbdButton&&e.kbdButton._setSelected(o)},this.switchNextKbd=function(){var o=s.getActiveKeyboard()=="",n="",t="";if(o){if(e.keyboards.length==0)return;n=e.keyboards[0]._InternalName,t=e.keyboards[0]._LanguageCode,s.setActiveKeyboard(n,t),e.lastActiveKeyboard=0}else e.lastActiveKeyboard==e.keyboards.length-1?(s.setActiveKeyboard(""),o=!1):(n=e.keyboards[++e.lastActiveKeyboard]._InternalName,t=e.keyboards[e.lastActiveKeyboard]._LanguageCode,s.setActiveKeyboard(n,t),o=!0);e.kbdButton&&e.kbdButton._setSelected(o)},this.updateKeyboardList=function(){if(!!(s.initialized||e.initialized)){e.updateList=!1;var o=s.getKeyboards(),n=d.getOption("resources")+"ui/toggle/";if(o.length>1){var t=document.getElementById("KMW_Controller_Img");t.src=n+"kmw_logo_16_down.gif",t.style.width="100%",e.controller.style.background="url("+n+"kmwcontroller2x.gif)",e.kbdButton.getElem().id="kmwico",e.kbdButton.getElem().style.width="36px",e.kbdButton._onmouseover=function(){e.keyboardMenu.className="sfhover"},e.kbdButton._onmouseout=function(){e.keyboardMenu.className="sfunhover"},e.kbdButton._onclick=null,e.createMenu()}else if(o.length==1){var t=document.getElementById("KMW_Controller_Img");t.src=n+"kmw_logo_16.gif",e.kbdButton.getElem().id="kmwico",e.kbdButton.getElem().style.width="24px";var a=o[0].InternalName,r=o[0].LanguageCode;e.controller.style.background="url("+n+"kmwcontroller2.gif)",e.keyboards.push({_InternalName:a,_LanguageCode:r,_Index:0}),e.kbdButton._onclick=e.switchSingleKbd,e.kbdButton._onmouseover=function(){},e.kbdButton._onmouseout=function(){},e.createMenu(),typeof e.keyboardMenu!="undefined"&&delete e.keyboardMenu}var i=s.getSavedKeyboard().split(":");e.updateMenu(i[0],i[1])}}}return l.prototype.doFocus=function(e,o,n){if(!!this.initialized){window.event&&s.isAttached(window.event.srcElement)&&(e=window.event.srcElement),o?this.controller.style.display="block":!s.getUIState().activationPending&&!this.controllerHovered&&(this.controller.style.display="none");var t,a,r=d.getAbsolute(e),i=r.x,h=r.y,u=e.ownerDocument;u.designMode=="on"&&u.defaultView&&u.defaultView.frameElement?(t=u.defaultView.frameElement.clientWidth,a=u.defaultView.frameElement.clientHeight):(t=e.offsetWidth,a=e.offsetHeight),i+t>window.innerWidth+document.documentElement.scrollLeft-this.controller.offsetWidth-1?h+=a:(i+=t+2,h+=a-29),!(isNaN(i)||isNaN(h))&&(this.controller.style.left=i+"px",this.controller.style.top=h+"px")}},l.prototype.registerEvents=function(){var e=this,o=s.osk;!o||(o.addEventListener("show",function(n){return e.controller.style.display="block",e.oskButton._setSelected(!0),n}),o.addEventListener("hide",function(n){n.HiddenByUser&&e.oskButton._setSelected(!1)}))},l.prototype.button=function(e,o,n){var t=this,a=function(){function r(){var i=this;this._onclick=null,this._onmouseover=null,this._onmouseout=null,this._down=!1,this._over=!1,this.__mouseover=function(){t.controllerHovered=!0,i._over=!0,i._onmouseover!=null&&i._onmouseover(),i.__updatestyle()},this.__mouseout=function(){t.controllerHovered=!1,i._over=!1,i._onmouseout!=null&&i._onmouseout(),i.__updatestyle()},this.__click=function(){return s.activatingUI(!1),i._onclick!=null?i._onclick():!1},this.__mousedown=function(){return s.activatingUI(!0),i._down=!0,i.__updatestyle(),!1},this.__mouseup=function(){i._down=!1,i.__updatestyle()},this._selected=n;var h=d.getOption("resources")+"ui/toggle/",u=d.createElement("img");this._elem=d.createElement("div"),this._elem._owningObject=this,u.style.display="block",u.src=h+e,u.id="KMW_Controller_Img",this._elem.style.margin="0px",this._elem.style.width="24px",this._elem.style.height="24px",this._elem.style.zIndex="10002",this._elem.style.lineHeight="100%",this._elem.style.styleFloat=this._elem.style.cssFloat="left",u.title=o,u.alt=o,this._elem.appendChild(u),this._elem.onmouseover=this.__mouseover,this._elem.onmouseout=this.__mouseout,this._elem.onmousedown=this.__mousedown,this._elem.onmouseup=this.__mouseup,u._owningObject=this,u.onclick=this.__click,this.__updatestyle()}return r.prototype.getElem=function(){return this._elem},r.prototype.__updatestyle=function(){var i=this._elem.style;this._over?(i.margin="0px",this._selected?(i.border="solid 1px #ad4a28",i.background="#dfb4b4"):(i.border="solid 1px #dfb4b4",i.background="#f3e5de")):this._selected?(i.background="#f3e5de",i.margin="0px",i.border="solid 1px #ad4a28"):(i.background="none",i.margin="1px",i.border="none")},r.prototype._setSelected=function(i){s.activatingUI(!1),this._selected=i,this.__updatestyle()},r.prototype._getSelected=function(){return this._selected},r.prototype._getOver=function(){return this._over},r.prototype._getDown=function(){return this._down},r}();return new a},l.prototype.initialize=function(){if(!(!s.initialized||d.isTouchDevice())){this.initialized?this.controller.innerHTML="":this.controller=d.createElement("div");var e=d.getOption("resources")+"ui/toggle/";this.controller.style.background="url("+e+"kmwcontroller2x.gif)",this.controller.style.padding="1px 2px";var o=d.loadCookie("KeymanWeb_Keyboard"),n=!1;typeof o.current!="undefined"&&(n=o.current.indexOf("---")<0),this.kbdButton=this.button("kmw_logo_16.gif","Use Web Keyboard",n),this.controller.appendChild(this.kbdButton.getElem());var t=d.loadCookie("KeymanWeb_OnScreenKeyboard"),a=!0;typeof t.visible!="undefined"&&(a=t.visible==1),this.oskButton=this.button("kmw_osk_16.gif","Show On Screen Keyboard",a),this.oskButton._onclick=this.switchOsk,this.controller.appendChild(this.oskButton.getElem()),this.initialized||(this.controller.style.display="none"),this.controller.style.zIndex="10001",this.controller.style.position="absolute",this.initialized||document.body.appendChild(this.controller),this.initialized=!0,this.updateKeyboardList(),this.registerEvents(),d.addStyleSheet(this.stylingCSS)}},l.prototype.shutdown=function(){var e=this.controller;e&&e.parentNode.removeChild(e)},l.prototype.selectKbd=function(e){var o,n,t;return e<0?(o="",n="",t=""):(o=this.keyboards[e]._InternalName,n=this.keyboards[e]._LanguageCode,t=this.keyboards[e]._Index),s.setActiveKeyboard(o,n),s.focusLastActiveElement(),this.kbdButton._setSelected(o!=""),e>=0&&(this.lastActiveKeyboard=e),!1},l.prototype.updateMenu=function(e,o){for(var n=document.getElementById("KMWSel_$"),t=0;t<this.keyboards.length;t++)this.keyboards[t]._InternalName==e&&this.keyboards[t]._LanguageCode==o&&(n=document.getElementById("KMWSel_"+this.keyboards[t]._InternalName+"$"+this.keyboards[t]._Index));n&&(this.selectedMenuItem!=null&&(this.selectedMenuItem.className=""),n.className="selected",this.selectedMenuItem=n),this.oskButton&&(o=="cmn"||o=="jpn"||o=="kor"?this.oskButton.getElem().style.display="none":e==""?this.oskButton.getElem().style.display="none":this.oskButton.getElem().style.display="block")},Object.defineProperty(l.prototype,"stylingCSS",{get:function(){return"\n#KeymanWeb_KbdList {\n  display: block;\n  position: absolute;\n  width: auto;\n  line-height: 100%;\n  margin: 0;\n  clear: both;\n  float: none;\n  top: auto;\n  border: solid 2px #ad4a28;\n  -moz-border-radius: 4px;\n  -webkit-border-radius: 4px;\n  border-radius: 4px;\n  box-shadow: 4px 4px 2px rgba(136,136,136,.5);\n  -webkit-box-shadow: 4px 4px 2px rgba(136,136,136,.5);\n  -moz-box-shadow: 4px 4px 2px rgba(136,136,136,.5);\n  list-style: none;\n  padding: 0;\n  background: white;\n  max-height: 300px;\n  overflow-y: scroll;\n  overflow-x: hidden;\n  white-space: nowrap;\n  z-index: 10001; /* above the osk */\n}\n\n.sfunhover#KeymanWeb_KbdList {\n  display: none; left: -999px;\n}\n\n.sfhover#KeymanWeb_KbdList {\n  display: block;\n  left: auto;\n}\n\n#KeymanWeb_KbdList li {\n  float: none;\n  width: auto;\n  padding: 0;\n  margin: 0;\n  text-align: left;\n}\n\n#KeymanWeb_KbdList li a {\n  display: block;\n  padding: 2px 4px;\n  color: #404040;\n  font-family: Tahoma,Verdana,Arial,sans-serif;\n  font-size: 8pt;\n  text-decoration: none;\n}\n\n#KeymanWeb_KbdList li a.selected {\n  font-weight: bold;\n  color: black;\n}\n\n#KeymanWeb_KbdList li a:hover {\n  color: white;\n  background-color: #ad4a28;\n  text-decoration: underline;\n}\n"},enumerable:!1,configurable:!0}),l.prototype.createMenu=function(){var e=this;typeof this.keyboardMenu=="undefined"?(this.keyboardMenu=d.createElement("ul"),this.keyboardMenu.id="KeymanWeb_KbdList",this.keyboardMenu.className="sfunhover"):this.keyboardMenu.innerHTML="";var o=d.createElement("li"),n=d.createElement("a");n.innerHTML="(System keyboard)",n.href="#",n.onclick=function(){return e.selectKbd(-1)},n.id="KMWSel_$",n.className="selected",o.appendChild(n),this.selectedMenuItem=n,this.keyboardMenu.appendChild(o);var t=s.getKeyboards(),a=[];this.keyboards=[];for(var r=0;r<t.length;r++){var i=d.createElement("li"),h=d.createElement("a");h.innerHTML=t[r].LanguageName+" - "+t[r].Name,a[t[r].InternalName]||(a[t[r].InternalName]=0),a[t[r].InternalName]++;var u=a[t[r].InternalName];this.keyboards.push({_InternalName:t[r].InternalName,_LanguageCode:t[r].LanguageCode,_Index:u}),h.href="#",h.onclick=function(g){return function(){return e.selectKbd(g)}}(this.keyboards.length-1),h.id="KMWSel_"+t[r].InternalName+"$"+u,i.appendChild(h),this.keyboardMenu.appendChild(i)}this.keyboardMenu.parentNode!=this.kbdButton.getElem()&&this.kbdButton.getElem().appendChild(this.keyboardMenu)},l}(),c=s.ui=new p,s.addHotKey(191,32,c.switchSingleKbd),s.addHotKey(191,48,c.switchNextKbd),s.addHotKey(191,64,c.switchOsk),s.addEventListener("controlfocused",function(l){c.doFocus(l.target,!0,l.activeControl)}),s.addEventListener("controlblurred",function(l){c.doFocus(l.target,!1,null)}),s.addEventListener("keyboardregistered",function(l){c.updateList=!0,c.updateTimer&&clearTimeout(c.updateTimer),c.updateTimer=window.setTimeout(c.updateKeyboardList,200)}),s.addEventListener("keyboardchange",function(l){c.updateMenu(l.internalName,l.languageCode)}),c.initialize()}catch(l){}var s,d,p,c;})();
//# sourceMappingURL=kmwuitoggle.js.map
